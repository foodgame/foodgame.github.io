function getRankInfo(i,e){var t=Number.MAX_VALUE;i.stirfry>0&&(t=Math.min(t,e.stirfryVal/i.stirfry)),i.boil>0&&(t=Math.min(t,e.boilVal/i.boil)),i.knife>0&&(t=Math.min(t,e.knifeVal/i.knife)),i.fry>0&&(t=Math.min(t,e.fryVal/i.fry)),i.bake>0&&(t=Math.min(t,e.bakeVal/i.bake)),i.steam>0&&(t=Math.min(t,e.steamVal/i.steam));var r={},a=0,n="-",o=0;return t!=Number.MAX_VALUE&&(t>=5?(a=100,n="传",o=5):t>=4?(a=50,n="神",o=4):t>=3?(a=30,n="特",o=3):t>=2?(a=10,n="优",o=2):t>=1&&(a=0,n="可",o=1)),r.rankAddition=a,r.rankDisp=n,r.rankVal=o,r}function getRecipeAddition(i,e,t,r,a,n){var o=0,f=new Addition;for(var s in i){var l=i[s],c=checkSkillCondition(l,e,t,r,a,null);c.pass&&(isRecipePriceAddition(l,r,n)&&(o+=l.value*c.count),isRecipeBasicAddition(l,r)&&addEffectAddition(f,l,c.count))}var d={};return d.price=o,d.basic=f,d}function isRecipePriceAddition(i,e,t){var r=i.type;if("UseAll"==r){if(e.rarity==i.rarity)return!0}else if("UseFish"==r){for(var a in e.materials)if("池塘"==e.materials[a].origin)return!0}else if("UseCreation"==r){for(var a in e.materials)if("作坊"==e.materials[a].origin)return!0}else if("UseMeat"==r){for(var a in e.materials)if("牧场"==e.materials[a].origin||"鸡舍"==e.materials[a].origin||"猪圈"==e.materials[a].origin)return!0}else if("UseVegetable"==r){for(var a in e.materials)if("菜棚"==e.materials[a].origin||"菜地"==e.materials[a].origin||"森林"==e.materials[a].origin)return!0}else if("UseStirfry"==r){if(e.stirfry>0)return!0}else if("UseBoil"==r){if(e.boil>0)return!0}else if("UseFry"==r){if(e.fry>0)return!0}else if("UseKnife"==r){if(e.knife>0)return!0}else if("UseBake"==r){if(e.bake>0)return!0}else if("UseSteam"==r){if(e.steam>0)return!0}else if("UseSweet"==r){if("Sweet"==e.condiment)return!0}else if("UseSour"==r){if("Sour"==e.condiment)return!0}else if("UseSpicy"==r){if("Spicy"==e.condiment)return!0}else if("UseSalty"==r){if("Salty"==e.condiment)return!0}else if("UseBitter"==r){if("Bitter"==e.condiment)return!0}else if("UseTasty"==r){if("Tasty"==e.condiment)return!0}else if("Gold_Gain"==r){if(!t||0==t.Id||t.Satiety||t.IsActivity)return!0}else if("CookbookPrice"==r)return!0;return!1}function isRecipeBasicAddition(i,e){var t=i.type;if("BasicPrice"==t)return!0;if("BasicPriceUseFish"==t){for(var r in e.materials)if("池塘"==e.materials[r].origin)return!0}else if("BasicPriceUseCreation"==t){for(var r in e.materials)if("作坊"==e.materials[r].origin)return!0}else if("BasicPriceUseMeat"==t){for(var r in e.materials)if("牧场"==e.materials[r].origin||"鸡舍"==e.materials[r].origin||"猪圈"==e.materials[r].origin)return!0}else if("BasicPriceUseVegetable"==t){for(var r in e.materials)if("菜棚"==e.materials[r].origin||"菜地"==e.materials[r].origin||"森林"==e.materials[r].origin)return!0}else if("BasicPriceUseStirfry"==t){if(e.stirfry>0)return!0}else if("BasicPriceUseBoil"==t){if(e.boil>0)return!0}else if("BasicPriceUseFry"==t){if(e.fry>0)return!0}else if("BasicPriceUseKnife"==t){if(e.knife>0)return!0}else if("BasicPriceUseBake"==t){if(e.bake>0)return!0}else if("BasicPriceUseSteam"==t){if(e.steam>0)return!0}else if("BasicPriceUseSweet"==t){if("Sweet"==e.condiment)return!0}else if("BasicPriceUseSour"==t){if("Sour"==e.condiment)return!0}else if("BasicPriceUseSpicy"==t){if("Spicy"==e.condiment)return!0}else if("BasicPriceUseSalty"==t){if("Salty"==e.condiment)return!0}else if("BasicPriceUseBitter"==t){if("Bitter"==e.condiment)return!0}else if("BasicPriceUseTasty"==t&&"Tasty"==e.condiment)return!0;return!1}function getMaterialsAddition(i,e){var t=0;for(var r in i.materials)for(var a in e)if(i.materials[r].material==e[a].materialId&&e[a].addition){t+=Number(e[a].addition);break}return+t.toFixed(2)}function buildRecipeMenu(i){var e=[],t={};return t.data=i,e.push(t),e}function getPercentDisp(i){return 0!=i?i.toString()+"%":""}function getAbsDisp(i){return 0==i?"":i.toString()}function calMaterialReduce(i,e,t){if(i&&i.materialEffects){var r=new Addition;for(var a in i.materialEffects){var n=i.materialEffects[a];"MaterialReduce"==n.conditionType&&n.conditionValueList.indexOf(e)>=0&&setAddition(r,n)}return t=Math.ceil(calReduce(t,r)),t>1?t:1}return t}function calReduce(i,e){return+((i-e.abs)*(1-e.percent/100)).toFixed(2)}function getRecipeQuantity(i,e,t,r){var a=1;if((!t.hasOwnProperty("DisableMultiCookbook")||0==t.DisableMultiCookbook)&&(a=i.limitVal,r))for(var n in r.maxLimitEffect)r.maxLimitEffect[n].rarity==i.rarity&&(a+=r.maxLimitEffect[n].value);for(var o in i.materials){var f=!1;for(var s in e)if(i.materials[o].material==e[s].materialId){if(f=!0,Number.isInteger(parseInt(e[s].quantity))){var l=calMaterialReduce(r,i.materials[o].material,i.materials[o].quantity),c=Math.floor(e[s].quantity/l);c<a&&(a=c)}break}if(!f)return 0}return a<0?0:a}function getRecipeResult(i,e,t,r,a,n,o,f,s,l,c,d,u){var p={},m=0,v=0,y=0,b=0,k=0,A=0,h=new Addition,g=0;if(i&&i.chefId){var S=getRankInfo(t,i);if(p.rankVal=S.rankVal,p.rankDisp=S.rankDisp,!l&&0==S.rankVal)return p;if(o&&o.hasOwnProperty("DisableCookbookRank")&&0!=o.DisableCookbookRank||(m=S.rankAddition),p.rankAdditionDisp=getPercentDisp(m),!o||!o.hasOwnProperty("DisableChefSkillEffect")||0==o.DisableChefSkillEffect){var D=getRecipeAddition(i.specialSkillEffect,i,c,t,r,o);v+=D.price,addAddition(h,D.basic);var V=getRecipeAddition(i.selfUltimateEffect,i,c,t,r,o);if(v+=V.price,addAddition(h,V.basic),d)for(var P in d){var M=d[P].effect;isRecipePriceAddition(M,t,o)&&(g+=M.value*d[P].count),isRecipeBasicAddition(M,t)&&addEffectAddition(h,M,d[P].count)}}for(var P in i.disk.ambers){var E=i.disk.ambers[P].data;if(E){var C=getRecipeAddition(E.allEffect[i.disk.level-1],i,c,t,r,o);v+=C.price,addAddition(h,C.basic)}}if(p.chefSkillAdditionDisp=getPercentDisp(v),(!o||!o.hasOwnProperty("DisableEquipSkillEffect")||0==o.DisableEquipSkillEffect)&&e&&e.effect){var I=updateEquipmentEffect(e.effect,i.selfUltimateEffect),R=getRecipeAddition(I,i,c,t,r,o);y=R.price,addAddition(h,R.basic)}p.equipSkillAdditionDisp=getPercentDisp(y),k+=Number(i.addition)}if(p.satiety=t.rarity,u){var U=0;for(var P in u){var T=u[P].effectType,w=u[P].effectValue;"IntentAdd"==T&&(U+=w)}var B=new Addition,N=0,x=new Addition;for(var P in u){var O=u[P].buffId;T=u[P].effectType,w=u[P].effectValue;"BasicPriceChange"==T?(O||(w*=1+.01*U),B.abs+=w):"BasicPriceChangePercent"==T?(O||(w*=1+.01*U),B.percent+=w):"SatietyChange"==T?(O||(w*=1+.01*U),x.abs+=w):"SatietyChangePercent"==T?(O||(w*=1+.01*U),x.percent+=w):"SetSatietyValue"==T?p.satiety=w:"PriceChangePercent"==T&&(O||(w*=1+.01*U),N+=w)}h.abs+=B.abs,h.percent+=B.percent,k+=N/100,p.satiety=Math.ceil(calAddition(p.satiety,x))}if(p.partialAdditionDisp=getPercentDisp(g),p.basicPercentDisp=getPercentDisp(h.percent),p.basicAbsDisp=getAbsDisp(h.abs),(!o||!o.hasOwnProperty("DisableCondimentEffect")||0==o.DisableCondimentEffect)&&s){p.useCondiment=!0;var q=getRecipeAddition(s.effect,i,c,t,r,o);A=q.price}if(p.condimentSkillAdditionDisp=getPercentDisp(A),o&&o.hasOwnProperty("DisableDecorationEffect")&&0!=o.DisableDecorationEffect||f&&(b=f),p.decorationAdditionDisp=getPercentDisp(b),k+=Number(t.addition),o&&o.hasOwnProperty("MaterialsEffect")){var F=getMaterialsAddition(t,n);k+=F}var L=(m+v+y+A+b+t.ultimateAddition+g)/100,J=calAddition(t.price,h);u||(J=Math.floor(J)),p.data=t,p.quantity=r,p.max=a,p.limit=r,p.bonusAdditionDisp=getPercentDisp(+(100*k).toFixed(2)),p.totalPrice=t.price*r,p.realPrice=Math.ceil(+(J*(1+L)).toFixed(2));var K=Math.ceil(+(J*(1+L+k)).toFixed(2));p.bonusScore=K-p.realPrice,p.totalBonusScore=p.bonusScore*r,p.score=K,p.totalScore=K*r,p.totalTime=t.time*r,p.totalTimeDisp=secondsToTime(p.totalTime);var _=Math.floor(3600*p.realPrice/t.time);p.efficiency=_;var G=0;return i&&p.rankVal>0&&(G=_),p.chefEff=G,p}function calAddition(i,e){return+((i+e.abs)*(1+e.percent/100)).toFixed(2)}function getTimeAddition(i){var e=0;for(var t in i)"OpenTime"==i[t].type&&(e+=i[t].value);return+e.toFixed(2)}function updateEquipmentEffect(i,e){var t=i;for(var r in e)if("MutiEquipmentSkill"==e[r].type)for(var a in t=JSON.parse(JSON.stringify(i)),t){var n=new Addition;setAddition(n,e[r]),t[a].value=calAddition(t[a].value,n)}return t}function setAddition(i,e){"Abs"==e.cal?i.abs=+(i.abs+e.value).toFixed(2):"Percent"==e.cal&&(i.percent=+(i.percent+e.value).toFixed(2))}function addEffectAddition(i,e,t){"Abs"==e.cal?i.abs+=e.value*t:"Percent"==e.cal&&(i.percent+=e.value*t)}function addAddition(i,e){i.abs+=e.abs,i.percent+=e.percent}function Addition(){this.abs=0,this.percent=0}function secondsToTime(i){i=Number(i);var e=Math.floor(i/3600/24),t=Math.floor(i/3600%24),r=Math.floor(i/60%60),a=Math.floor(i%60),n="";return e>0&&(n+=e+"天"),t>0&&(n+=t+"小时"),r>0&&(n+=r+"分"),a>0&&(n+=a+"秒"),n}function getEquipInfo(i,e){var t=null;if(i)for(var r in e)if(i==e[r].equipId)return e[r];return t}function getCondimentInfo(i,e){var t=null;if(i)for(var r in e)if(i==e[r].condimentId)return e[r];return t}function setDataForChef(i,e,t,r,a,n,o,f,s,l){var c=new Addition,d=new Addition,u=new Addition,p=new Addition,m=new Addition,v=new Addition,y=0,b=0,k=0,A=0,h=new Addition,g=new Addition,S=new Addition,D=new Addition,V=new Addition,P=new Addition,M=[],E=[],C=[];if(i.selfUltimateEffect=[],!s||!s.hasOwnProperty("DisableChefSkillEffect")||0==s.DisableChefSkillEffect){if(C=C.concat(i.specialSkillEffect),C=C.concat(r),n)for(var I in n)if(i.chefId==n[I].chefId){i.selfUltimateEffect=n[I].effect,C=C.concat(n[I].effect);break}if(a)for(var I in a){var R=checkSkillCondition(a[I],i,null,null,null,null);R.pass&&(C=C.concat(a[I]))}}if((!s||!s.hasOwnProperty("DisableEquipSkillEffect")||0==s.DisableEquipSkillEffect)&&t&&e&&e.effect){var U=updateEquipmentEffect(e.effect,i.selfUltimateEffect);C=C.concat(U)}if(o&&(C=C.concat(o)),l)for(var I in i.disk.ambers){var T=i.disk.ambers[I].data;T&&(C=C.concat(T.allEffect[i.disk.level-1]))}for(var I in C){var w=C[I].type,B=C[I].tag;B&&i.tags.indexOf(B)<0||("Stirfry"==w?setAddition(c,C[I]):"Boil"==w?setAddition(d,C[I]):"Knife"==w?setAddition(u,C[I]):"Fry"==w?setAddition(p,C[I]):"Bake"==w?setAddition(m,C[I]):"Steam"==w?setAddition(v,C[I]):"Meat"==w?y+=C[I].value:"Creation"==w?b+=C[I].value:"Vegetable"==w?k+=C[I].value:"Fish"==w?A+=C[I].value:"Sweet"==w?setAddition(h,C[I]):"Sour"==w?setAddition(g,C[I]):"Spicy"==w?setAddition(S,C[I]):"Salty"==w?setAddition(D,C[I]):"Bitter"==w?setAddition(V,C[I]):"Tasty"==w?setAddition(P,C[I]):"MaxEquipLimit"==w&&"Self"==C[I].condition?M=M.concat(C[I]):"MaterialReduce"==w&&"Self"==C[I].condition&&(E=E.concat(C[I])))}i.meatVal=i.meat+y,i.creationVal=i.creation+b,i.vegVal=i.veg+k,i.fishVal=i.fish+A,i.meatDisp=getAtrributeDisp(i.meatVal,i.meat,f),i.creationDisp=getAtrributeDisp(i.creationVal,i.creation,f),i.vegDisp=getAtrributeDisp(i.vegVal,i.veg,f),i.fishDisp=getAtrributeDisp(i.fishVal,i.fish,f),i.stirfryVal=Math.ceil(calAddition(i.stirfry,c)),i.boilVal=Math.ceil(calAddition(i.boil,d)),i.knifeVal=Math.ceil(calAddition(i.knife,u)),i.fryVal=Math.ceil(calAddition(i.fry,p)),i.bakeVal=Math.ceil(calAddition(i.bake,m)),i.steamVal=Math.ceil(calAddition(i.steam,v)),i.stirfryDisp=getAtrributeDisp(i.stirfryVal,i.stirfry,f),i.boilDisp=getAtrributeDisp(i.boilVal,i.boil,f),i.knifeDisp=getAtrributeDisp(i.knifeVal,i.knife,f),i.fryDisp=getAtrributeDisp(i.fryVal,i.fry,f),i.bakeDisp=getAtrributeDisp(i.bakeVal,i.bake,f),i.steamDisp=getAtrributeDisp(i.steamVal,i.steam,f),i.sweetVal=Math.ceil(calAddition(i.sweet,h)),i.sourVal=Math.ceil(calAddition(i.sour,g)),i.spicyVal=Math.ceil(calAddition(i.spicy,S)),i.saltyVal=Math.ceil(calAddition(i.salty,D)),i.bitterVal=Math.ceil(calAddition(i.bitter,V)),i.tastyVal=Math.ceil(calAddition(i.tasty,P)),i.sweetDisp=getAtrributeDisp(i.sweetVal,i.sweet,f),i.sourDisp=getAtrributeDisp(i.sourVal,i.sour,f),i.spicyDisp=getAtrributeDisp(i.spicyVal,i.spicy,f),i.saltyDisp=getAtrributeDisp(i.saltyVal,i.salty,f),i.bitterDisp=getAtrributeDisp(i.bitterVal,i.bitter,f),i.tastyDisp=getAtrributeDisp(i.tastyVal,i.tasty,f),i.maxLimitEffect=M,i.materialEffects=E}function getAtrributeDisp(i,e,t){var r="";if(t)return i&&(r=i),r;e&&(r+=e);var a=i-e;return a&&(a>0&&(r+="+"),r+=a),r}function getRarityDisp(i){for(var e="",t=0;t<i;t++)e+="&#x2605;";return e}function isNumeric(i){return!isNaN(parseFloat(i))&&isFinite(i)}function isChefAddType(i){return"Stirfry"==i||"Boil"==i||"Knife"==i||"Fry"==i||"Bake"==i||"Steam"==i}function getCustomRound(i){return i.Satiety?i.IntentList.length:3}function getPartialRecipeAdds(i,e,t){for(var r=getCustomRound(t),a=[],n=0;n<3*r;n++)a.push([]);for(var o in i){var f=i[o].chef;if(f.chefId&&t.calPartialChefIds.indexOf(f.chefId)>=0)for(var s in e){var l=e[s];if(f.ultimateSkill==l.skillId){var c=i[o].recipes;for(var d in l.effect){var u=l.effect[d];if("Partial"==u.condition)if(u.conditionType&&"PerRank"!=u.conditionType&&"SameSkill"!=u.conditionType&&"PerSkill"!=u.conditionType){for(var p in i)if(!(t.Satiety&&p<o)){b=3*Number(p);for(var m in i[p].recipes){v=checkSkillCondition(u,i[p].chef,null,i[p].recipes[m].data,i[p].recipes[m].quantity,null);if(v.pass){y={};y.effect=u,y.count=v.count,a[b+Number(m)].push(y)}}}}else{var v=checkSkillCondition(u,f,c,null,null,i);if(v.pass){var y={};y.effect=u,y.count=v.count;var b=0;t.Satiety&&(b=3*Number(o));for(n=b;n<3*r;n++)a[n].push(y)}}else if("Next"==u.condition&&Number(o)<r-1){v=checkSkillCondition(u,f,c,null,null,null);if(v.pass){y={};y.effect=u,y.count=v.count;for(b=3*Number(o)+3,n=0;n<3;n++)a[b+n].push(y)}}}break}}}return a}function checkSkillCondition(i,e,t,r,a,n){var o={pass:!0,count:1};if(!i.conditionType)return o;if("Rank"==i.conditionType){if(r&&e&&e.chefId){var f=getRankInfo(r,e);if(f.rankVal>=i.conditionValue)return o}}else if("PerRank"==i.conditionType){var s=0;for(var l in t){var c=t[l];if(c.data){f=getRankInfo(c.data,e);f.rankVal>=i.conditionValue&&s++}}if(s>0)return o.count=s,o}else if("ExcessCookbookNum"==i.conditionType){if(r&&a>=i.conditionValue)return o}else if("FewerCookbookNum"==i.conditionType){if(r&&a<=i.conditionValue)return o}else if("CookbookRarity"==i.conditionType){if(r&&i.conditionValueList.indexOf(r.rarity)>=0)return o}else if("ChefTag"==i.conditionType){if(e&&e.chefId){s=0;for(var l in i.conditionValueList)e.tags.indexOf(i.conditionValueList[l])>=0&&s++;if(s>0)return o}}else if("CookbookTag"==i.conditionType){if(r){s=0;for(var l in i.conditionValueList)r.tags.indexOf(i.conditionValueList[l])>=0&&s++;if(s>0)return o.count=s,o}}else if("SameSkill"==i.conditionType){var d=0,u=0,p=0,m=0,v=0,y=0,b=0;for(var l in t){c=t[l].data;c&&(c.stirfry>0&&(u++,3==u&&d++),c.boil>0&&(p++,3==p&&d++),c.knife>0&&(m++,3==m&&d++),c.fry>0&&(v++,3==v&&d++),c.bake>0&&(y++,3==y&&d++),c.steam>0&&(b++,3==b&&d++))}if(d>0)return o.count=d,o}else if("PerSkill"==i.conditionType){s=0;if(n)for(var l in n)for(var k in n[l].recipes){c=n[l].recipes[k].data;c&&(1==i.conditionValue&&c.stirfry>0?s++:2==i.conditionValue&&c.fry>0?s++:3==i.conditionValue&&c.bake>0?s++:4==i.conditionValue&&c.steam>0?s++:5==i.conditionValue&&c.boil>0?s++:6==i.conditionValue&&c.knife>0&&s++)}if(s>0)return o.count=s,o}else"MaterialReduce"==i.conditionType||console.log("unknown conditionType: "+i.conditionType);return o.pass=!1,o}function getSelfUltimateData(i,e,t,r){var a=[];if(t)for(var n in r)for(var o in i)if(r[n]==i[o].chefId){for(var f in e)if(i[o].ultimateSkill==e[f].skillId){var s=[];for(var l in e[f].effect)"Self"==e[f].effect[l].condition&&s.push(e[f].effect[l]);if(s.length){var c={};c.chefId=i[o].chefId,c.effect=s,a.push(c)}break}break}return a}function getPartialChefAddsByIds(i,e,t,r){var a=[];if(t)for(var n in r)for(var o in i){var f=i[o];if(r[n]==f.chefId){for(var s in e){var l=e[s];if(f.ultimateSkill==l.skillId){for(var c in l.effect){var d=l.effect[c];"Partial"==d.condition&&isChefAddType(d.type)&&a.push(d)}break}}break}}return a}function getPartialChefAdds(i,e,t){for(var r=getCustomRound(t),a=[],n=0;n<r;n++)a.push([]);for(var o in i){var f=i[o].chef;if(f.chefId&&t.calPartialChefIds.indexOf(f.chefId)>=0)for(var s in e){var l=e[s];if(f.ultimateSkill==l.skillId){for(var c in l.effect){var d=JSON.parse(JSON.stringify(l.effect[c]));if("Partial"==d.condition){if(isChefAddType(d.type)){var u=0;t.Satiety&&(u=Number(o));for(n=u;n<r;n++)a[n].push(d)}}else"Next"==d.condition&&Number(o)<r-1&&isChefAddType(d.type)&&a[Number(o)+1].push(d)}break}}}return a}function updateMaterialsData(i,e,t,r){for(var a in e.data.materials)for(var n in i)if(e.data.materials[a].material==i[n].materialId&&Number.isInteger(parseInt(i[n].quantity))){var o=calMaterialReduce(r,e.data.materials[a].material,e.data.materials[a].quantity);i[n].quantity-=o*t}}function getMaxNSum(i,e){i.sort(function(i,e){return e.totalScore-i.totalScore});for(var t=0,r=Math.min(i.length,e),a=0;a<r;a++)t+=i[a].totalScore;return t}function getMaxNSumRecipes(i,e){var t=[];for(var r in i)for(var a in i[r].recipes)t.push(i[r].recipes[a]);t.sort(function(i,e){return e.totalScore-i.totalScore});var n=[],o=[],f=0;for(var s in t)if(o.indexOf(t[s].recipeId)<0&&(o.push(t[s].recipeId),n.push(t[s]),o.length<=e.rule.RecipesNumLimit&&(f+=t[s].totalScore),o.length==e.rule.ChefNumLimit*e.rule.RecipesNumLimit))break;return{recipes:n,sum:f}}