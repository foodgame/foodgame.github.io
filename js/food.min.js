function commaSeparatedMatch(e,a){if(0===a.length)return!0;for(var t=a.split(/[,\s]/),i=0;i<t.length;i++)if(0!==t[i].length&&-1!==e.indexOf(t[i]))return!0;return!1}function init(e){var a;initFunction();try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}if(private)$.ajax({cache:!1,success:function(t){$.ajax({cache:!1,success:function(i){t=$.extend(t,i);var l=generateData(e,t,a);initTables(l,a)},error:function(){var i=generateData(e,t,a);initTables(i,a)},url:"others/data/data3.json"})},error:function(){var t=generateData(e,null,a);initTables(t,a)},url:"others/data/data2.json"});else{var i=generateData(e,null,a);initTables(i,a)}}function initFunction(){var e=getParameterByName("a");e&&"cb8f8a72f7e4924a75cb75a4a59c0b8d61e70c0cb84f84edf7ede4c8"==lcode(e)&&(private=!0,$("head").append('<link rel="stylesheet" type="text/css" href="others/css/image.css">'),$("#chk-recipe-no-origin").closest(".btn").removeClass("hidden"),$("#chk-chef-no-origin").closest(".btn").removeClass("hidden"),$("#chk-equip-no-origin").closest(".btn").removeClass("hidden"),$("#chk-decoration-no-origin").closest(".btn").removeClass("hidden"),$("#chk-cal-results-lock-order").closest(".btn").removeClass("hidden"),$("#btn-cal-recipes-select-all").removeClass("hidden"),$("#btn-cal-recipes-deselect-all").removeClass("hidden"))}function initTables(e,a){var t;$.fn.selectpicker.Constructor.DEFAULTS.liveSearchStyle="commaSplitContains",$(window).width()<=768&&($("#chk-setting-desktop").bootstrapToggle("off"),isMobile=!0),a&&(a.desktop?($("#chk-setting-desktop").bootstrapToggle("on"),isMobile=!1):0==a.desktop&&($("#chk-setting-desktop").bootstrapToggle("off"),isMobile=!0)),updateSetting(a),isMobile&&($(".mobile-setting").hide(),expendBtn=!1),initSetting(e),updateMenu(a),updateActivity(a),setPartialUltimateOptions(e.chefs,e.partialSkill),initRecipeTable(e),initChefTable(e),initEquipTable(e),initDecorationTable(e),initMaterialTable(e),initCondimentTable(e),initQuestTable(e),initImportExport(e),initCalTables(e),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})},initInfo(e),initVersionTip(a),initTooltip(),$('.main-nav a[data-toggle="tab"]').on("show.bs.tab",function(e){".pane-recipes"==$(e.target).attr("href")?$("#select-partial-ultimate").appendTo("#select-partial-ultimate-recipe"):".pane-chefs"==$(e.target).attr("href")&&$("#select-partial-ultimate").appendTo("#select-partial-ultimate-chef")}),$('.main-nav a[data-toggle="tab"]').on("shown.bs.tab",function(e){isMobile?($(".dataTables_scrollBody:visible table.dataTable").DataTable().draw(!1),"true"!=$(this).attr("data-init")&&updateScrollHeight()):reInitFixedHeader()}),isMobile&&$(".dataTables_scrollBody table.dataTable").on("page.dt",function(){$(this).closest(".dataTables_scrollBody").scrollTop(0)}),$(".select-wrapper").hover(function(){if(!t){var e=$(this).find(".bootstrap-select");t=setTimeout(function(){e.hasClass("open")||(t=null,e.find("select").selectpicker("toggle"))},200)}},function(){t&&(window.clearTimeout(t),t=null);var e=$(this).find(".bootstrap-select");e.hasClass("open")&&e.find("select").selectpicker("toggle")}),monitorStyle(),window.location.href.indexOf("github")>0&&$(".loading h3").remove(),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden"),isMobile||reInitFixedHeader(),initLayout()}function reInitFixedHeader(){$("#recipe-table").DataTable().fixedHeader.adjust(),$("#chef-table").DataTable().fixedHeader.adjust(),$("#equip-table").DataTable().fixedHeader.adjust(),$("#decoration-table").DataTable().fixedHeader.adjust(),$("#quest-table").DataTable().fixedHeader.adjust(),$("#condiment-table").DataTable().fixedHeader.adjust(),$("#cal-recipes-table").DataTable().fixedHeader.adjust(),private&&($("#cal-chefs-table").DataTable().fixedHeader.adjust(),$("#cal-equips-table").DataTable().fixedHeader.adjust(),$("#cal-materials-table").DataTable().fixedHeader.adjust())}function updateScrollHeight(){var e=$(".dataTables_scrollBody:visible"),a=$("body").height()-e.height(),t=$(window).height()-a-5+"px",i="height";e.closest(".pane-materials").length>0&&(i="max-height"),e.css(i)!=t&&(e.css(i,t),e.find("table.dataTable").DataTable().columns.adjust().draw(!1),$('.nav-tabs li.active a[data-toggle="tab"]').attr("data-init","true"))}function initTableResponsiveDisplayEvent(e){e.on("responsive-display",function(e,a,t,i,l){if(i){var c=$(t.node()).next("tr");if(c.length)if(isMobile){var r=$(this).closest(".dataTables_scrollBody"),s=c.offset().top-r.offset().top+c.outerHeight()-r.height();s>=0&&r.scrollTop(s+r.scrollTop()+10)}else{s=c.offset().top+c.outerHeight()-$(window).height();s>=$(window).scrollTop()&&$(window).scrollTop(s+10)}}})}function initTableScrollEvent(e){isMobile&&$(e).find(".dataTables_scrollBody").on("scroll",function(e){$(this).find(".child-inner").css("margin-left",$(this).scrollLeft()+"px")})}function getResponsiveStyle(e){var a="";if(isMobile){var t=e.closest(".dataTables_scroll").find(".dataTables_scrollBody");a=" style='max-width:"+(t.width()-20)+"px;margin-left:"+t.scrollLeft()+"px'"}return a}function initTooltip(){$('.tooltip-pin[data-toggle="tooltip"]').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$("body").on("click",function(e){$('[data-toggle="tooltip"]').each(function(){$(this).is(e.target)||0!=$(this).has(e.target).length||$(this).tooltip("hide")})}),updateTooltip()}function updateTooltip(){$("#chk-setting-show-help").prop("checked")?($('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$('[data-toggle="tooltip"]').on("show.bs.tooltip",function(){$('[data-toggle="tooltip"]').not(this).tooltip("hide")})):$('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip("destroy")}function initSetting(e){$("#chk-setting-desktop").change(function(){updateLocalData("desktop",$("#chk-setting-desktop").prop("checked")),window.location.reload()}),$("#chk-setting-show-help").change(function(){updateTooltip(),updateSettingLocalData()}),$("#chk-setting-expand-btn").change(function(){updateSettingLocalData(),window.location.reload()}),$("#chk-setting-auto-update").change(function(){updateSettingLocalData()}),$("#chk-setting-show-final").change(function(){updateRecipeChefTable(e),updateSettingLocalData()}),$("#chk-setting-done-mark").change(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp;var c=getRankGiftInfo(i,i.rank);i.rankGiftVal=c.rankGiftVal,i.rankGiftDisp=c.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw(!1),updateSettingLocalData()}),$("#select-setting-page-length").on("changed.bs.select",function(){var e=$(this).val();$("#recipe-table").DataTable().page.len(e).draw(),$("#chef-table").DataTable().page.len(e).draw(),$("#equip-table").DataTable().page.len(e).draw(),$("#decoration-table").DataTable().page.len(e).draw(),$("#quest-table").DataTable().page.len(e).draw(),$("#condiment-table").DataTable().page.len(e).draw(),$("#cal-recipes-table").DataTable().page.len(e).draw(),private&&($("#cal-chefs-table").DataTable().page.len(e).draw(),$("#cal-equips-table").DataTable().page.len(e).draw(),$("#cal-materials-table").DataTable().page.len(e).draw()),updateSettingLocalData()})}function initLayout(){isMobile?($("#top-menu").appendTo("#menu-modal .modal-body"),$("#mobile-menu-btn").removeClass("hidden"),document.getElementById("viewport").setAttribute("content","width=device-width"),updateScrollHeight()):($("#top-menu").appendTo("#desktop-menu"),$("#mobile-menu-btn").addClass("hidden"),document.getElementById("viewport").setAttribute("content",""))}function initRecipeTable(e){reInitRecipeTable(e),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-rarity").val();return 0==c.length||!!$('#chk-recipe-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-skill").val();if(0==c.length)return!0;var r=$("#chk-recipe-multiple-skill").prop("checked");for(var s in c)if(i[""+c[s]]>0){if(!r)return!0}else if(r)return!1;return!!r}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-category").val();if(0==c.length)return!0;var r=$("#chk-recipe-multiple-category").prop("checked");for(var s in c)if(i[""+c[s]]){if(!r)return!0}else if(r)return!1;return!!r}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-condiment").val();if(0==c.length)return!0;for(var r in c)if(i.condiment==c[r])return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=Number($("#input-recipe-price").val());return i.price>=c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-guest").val();if(0==c.length)return!0;for(var r in c){if(i.guestsVal.indexOf(" "+c[r]+" ")>=0)return!0;if($("#chk-recipe-rank-guest").prop("checked")&&i.rankGuestsVal.indexOf(" "+c[r]+" ")>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-antique").val();if(0==c.length)return!0;for(var r in c){if(i.guestsVal.indexOf(c[r])>=0)return!0;if($("#chk-recipe-rank-antique").prop("checked")&&i.rankGiftVal.indexOf(c[r])>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-no-origin").prop("checked");return!!(c||!c&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-combo").prop("checked");return!!(!c||c&&i.comboVal)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-ex-no").prop("checked");return!(c&&(!c||i.ex))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$("#chk-recipe-got").prop("checked");return!!(!c||c&&i.got)});var a=$(".pane-recipes .search-box input");for(var t in $.fn.dataTableExt.afnFiltering.push(function(e,t,i,l,c){if(e.nTable!=document.getElementById("recipe-table"))return!0;var r=$.trim(a.val());return!!commaSeparatedMatch(l.name,r)||(!!commaSeparatedMatch(l.materialsVal,r)||(!(!commaSeparatedMatch(l.origin,r)||-1!=l.origin.indexOf("神级"))||!!commaSeparatedMatch(l.tagsDisp,r)))}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,c){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.allSelectedMaterials.length)return!0;var r=$("#chk-recipe-multiple-material").prop("checked");for(var s in e.allSelectedMaterials){var n=!1;for(var o in l.materials)if(l.materials[o].material==e.allSelectedMaterials[s]){n=!0;break}if(n){if(!r)return!0}else if(r)return!1}return!!r}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,c){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.selectedQuests.length)return!0;for(var r in e.selectedQuests)if("修炼任务"==e.selectedQuests[r].type){var s=e.selectedQuests[r].conditions;for(var n in s)if(s[n].num){var o=getMaxLimit(e,s[n].rarity);return 2*o+l.limitVal>=s[n].num}break}return!0}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,c){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(e.selectedQuests.length){for(var r in e.selectedQuests){var s=e.selectedQuests[r].conditions,n=!1;for(var o in s){var p=!0;if(s[o].recipeId&&s[o].recipeId!=l.recipeId&&(p=!1),s[o].materialId){var d=!1;for(var u in l.materials)if(l.materials[u].material==s[o].materialId){d=!0;break}d||(p=!1)}if(s[o].guest&&l.guestsVal.indexOf(s[o].guest)<0&&(!$("#chk-recipe-rank-guest").prop("checked")||l.rankGuestsVal.indexOf(s[o].guest)<0)&&(p=!1),(s[o].anyGuest||s[o].newGuest)&&(l.guestsVal||$("#chk-recipe-rank-guest").prop("checked")&&l.rankGuestsVal||(p=!1)),s[o].skill&&0==l[""+s[o].skill]&&(p=!1),s[o].rarity&&l.rarity<s[o].rarity&&(p=!1),s[o].price&&l.price<s[o].price&&(p=!1),s[o].category&&(l[""+s[o].category]||(p=!1)),s[o].condiment&&l.condiment!=s[o].condiment&&(p=!1),p){n=!0;break}}if(!n)return!1}return!0}return!0}),e.materials)$("#chk-recipe-show-material").append("<option value='"+e.materials[t].materialId+"'>"+e.materials[t].name+"</option>");for(var t in $("#chk-recipe-show-material").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeTableData(e),$(this).val().length&&$("#recipe-table").DataTable().order([33,"desc"]),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-material").click(function(){$("#recipe-table").DataTable().draw()}),e.chefs)$("#chk-recipe-show-chef").append("<option value='"+e.chefs[t].chefId+"'>"+e.chefs[t].name+"</option>");for(var t in $("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(a,t,i,l){if($("#select-recipe-chef-quest").find('option:not([value=""])').remove(),1==$(this).val().length){var c=$(this).val()[0];for(var r in e.chefs)if(e.chefs[r].chefId==c){for(var s in e.chefs[r].ultimateGoal)for(var n in e.quests)if(e.chefs[r].ultimateGoal[s]==e.quests[n].questId){e.quests[n].hasOwnProperty("conditions")&&$("#select-recipe-chef-quest").append("<option value='"+e.quests[n].questId+"'>"+e.quests[n].goal+"</option>");break}break}}$("#select-recipe-chef-quest").selectpicker("refresh"),changeSelectStyle("#select-recipe-chef-quest"),updateRecipesChefsData(e),updateRecipeQuest(e,!0)}),$("#select-recipe-chef-quest").on("changed.bs.select",function(a,t,i,l){var c=!1;""!=l&&""!=$(this).val()||(updateRecipesChefsData(e),c=!0),l!=$(this).val()&&updateRecipeQuest(e,c)}),e.guests)$("#chk-recipe-guest").append("<option value='"+e.guests[t].name+"'>"+e.guests[t].name+"</option>");for(var i in $("#chk-recipe-guest").selectpicker().on("changed.bs.select",function(e,a,t,i){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),$("#chk-recipe-rank-guest").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-guest").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-antique").selectpicker().on("changed.bs.select",function(){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),$("#chk-recipe-rank-antique").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-antique").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGiftInfo(i,i.rank);i.rankGiftVal=l.rankGiftVal,i.rankGiftDisp=l.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),e.activities)$("#select-recipe-quest").append("<optgroup label='"+e.activities[i].name+"'></optgroup>");for(var t in e.quests)if(e.quests[t].hasOwnProperty("conditions")){var l="<option value='"+e.quests[t].questId+"' data-tokens='"+e.quests[t].type+"'>"+e.quests[t].questIdDisp+". "+e.quests[t].goal+"</option>";"修炼任务"!=e.quests[t].type&&$("#select-recipe-quest optgroup[label='"+e.quests[t].type+"']").append(l)}$("#select-recipe-quest").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeQuest(e)}),$("#chk-recipe-show").on("changed.bs.select",function(){initRecipeShow(),updateMenuLocalData()}),$("#chk-recipe-rarity").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-skill").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-skill").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-category").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-category").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-condiment").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-price").on("input",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-combo").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-ex-no").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-got").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-no-origin").click(function(){$("#recipe-table").DataTable().draw()}),$("#btn-recipe-reset").click(function(){$("#chk-recipe-rarity").selectpicker("deselectAll"),$("#chk-recipe-skill").selectpicker("deselectAll"),$("#chk-recipe-multiple-skill").prop("checked",!1),$("#chk-recipe-category").selectpicker("deselectAll"),$("#chk-recipe-multiple-category").prop("checked",!1),$("#chk-recipe-condiment").selectpicker("deselectAll"),$("#chk-recipe-combo").prop("checked",!1),$("#chk-recipe-ex-no").prop("checked",!1),$("#chk-recipe-got").prop("checked",!1),$("#chk-recipe-no-origin").prop("checked",!0),$("#input-recipe-price").val(""),$("#chk-recipe-guest").selectpicker("deselectAll"),$("#chk-recipe-rank-guest").prop("checked",!0),$("#chk-recipe-antique").selectpicker("deselectAll"),$("#chk-recipe-show-material").selectpicker("deselectAll"),$("#chk-recipe-multiple-material").prop("checked",!1),$(".pane-recipes .search-box input").val(""),$("#chk-recipe-show-chef").selectpicker("deselectAll"),$("#select-recipe-chef-quest").selectpicker("val",""),$("#select-recipe-quest").selectpicker("deselectAll"),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-apply-ex").change(function(){$(this).prop("checked")?$(".recipe-apply-ex").show():$(".recipe-apply-ex").hide(),updateRecipeChefTable(e)}),$("#chk-recipe-apply-ex-person").change(function(){updateRecipeChefTable(e)}),$("#btn-recipe-recal").click(function(){updateRecipeChefTable(e)}),initRecipeShow()}function updateRecipeQuest(e,a){$(".quest-warning").empty();var t=[],i=[],l=!1,c=[],r=!1,s=$("#select-recipe-quest").val(),n=$("#select-recipe-chef-quest").val();if(n.length&&s.push(n),s.length){var o="";for(var p in s)for(var d in e.quests)if(s[p]==e.quests[d].questId){for(var u in t.push(e.quests[d]),o+="["+e.quests[d].type+"] ","修炼任务"!=e.quests[d].type&&(o+=e.quests[d].questIdDisp+". "),o+=e.quests[d].goal+"<br>",e.quests[d].conditions){if(e.quests[d].conditions[u].newGuest&&(o=o.replace(/(新的)/g,"<span class='text-danger'>$1</span>")),2==e.quests[d].conditions[u].rank?o=o.replace(/(优级)/g,"<span class='text-danger'>$1</span>"):3==e.quests[d].conditions[u].rank?o=o.replace(/(特级)/g,"<span class='text-danger'>$1</span>"):4==e.quests[d].conditions[u].rank&&(o=o.replace(/(神级)/g,"<span class='text-danger'>$1</span>")),e.quests[d].conditions[u].num){o=o.replace(/(一次)/g,"<span class='text-danger'>$1</span>");var f=new RegExp("("+e.quests[d].conditions[u].num+"份)","g");o=o.replace(f,"<span class='text-danger'>$1</span>")}"修炼任务"==e.quests[d].type&&(4==e.quests[d].conditions[u].rank?r=!0:c=[16,"asc"]),e.quests[d].conditions[u].materialId&&e.quests[d].conditions[u].materialEff?(i.push(e.quests[d].conditions[u].materialId),c=[33,"desc"]):c=e.quests[d].conditions[u].materialEff?[21,"desc"]:e.quests[d].conditions[u].condimentEff?[22,"desc"]:e.quests[d].conditions[u].goldEff?[20,"desc"]:[16,"asc"]}break}$(".quest-warning").append(o),$(".quest-warning").removeClass("hidden")}else $(".quest-warning").addClass("hidden");e.selectedQuests=t,arraysEqual(e.questMaterials,i)||(e.questMaterials=i,l=!0),(l||a)&&updateRecipeTableData(e),r&&(c=[[e.recipeColNum+e.recipeAddColNum-2,"asc"],[16,"asc"]]),$("#recipe-table").DataTable().order(c).draw()}function reInitRecipeTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"name",width:"86px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:"stirfry",width:"20px",orderSequence:["desc","asc"]},{data:"boil",width:"20px",orderSequence:["desc","asc"]},{data:"knife",width:"20px",orderSequence:["desc","asc"]},{data:"fry",width:"20px",orderSequence:["desc","asc"]},{data:"bake",width:"20px",orderSequence:["desc","asc"]},{data:"steam",width:"20px",orderSequence:["desc","asc"]},{data:{_:"condiment",display:"condimentDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"materialsVal",display:"materialsDisp"}},{data:{_:"price",display:"priceDisp"},width:"30px",orderSequence:["desc","asc"]},{data:"exPrice",orderSequence:["desc","asc"]},{data:{_:"exTime",display:"exTimeDisp"},visible:private,className:"none"},{data:{_:"time",display:"timeDisp"}},{data:{_:"limitVal",display:"limitDisp"},orderSequence:["desc","asc"]},{data:"totalPrice",orderSequence:["desc","asc"]},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency",orderSequence:["desc","asc"]},{data:"allMaterialsEff",orderSequence:["desc","asc"]},{data:"condimentEff",orderSequence:["desc","asc"]},{data:"origin"},{data:"unlock"},{data:{_:"comboVal",display:"comboDisp"}},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"guestsVal",display:"guestsDisp"}},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:{_:"rankGiftVal",display:"rankGiftDisp"}},{data:{_:"rank",sort:"rankSort"},className:"nodetails",width:"41px"},{data:"ex",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t="",i=[];$.fn.DataTable.isDataTable("#recipe-table")&&(t=$(".pane-recipes .search-box input").val(),i=getTableOrder($("#recipe-table").DataTable(),a.length),$("#recipe-table").DataTable().MakeCellsEditable("destroy"),$("#recipe-table").DataTable().destroy()),$("#recipe-table").html($("#recipe-table-header").html());for(var l=0;l<e.recipeAddColNumMax;l++)a.push({data:{_:"custom."+l+".value",display:"custom."+l+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#recipe-table thead tr").append("<th></th>");var c=!0,r=!1,s=!1;isMobile&&(c=!1,r=!0,s={left:[3]});var n="td:not(.nodetails)";expendBtn&&(n=".td-expend");var o=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:i,autoWidth:!1,fixedHeader:c,scrollX:r,fixedColumns:s,responsive:{details:{type:"column",target:n,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var c=5;c<=10;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:30==l?"无":31==l||32==l?"否":"")+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#recipe-table"))+">"+i+"</div>"}}}});$(".pane-recipes div.search-box").html('<input type="search" value="'+t+'" class="form-control input-sm monitor-none" placeholder="查找 菜名 材料 来源">');var p=getRankOptions(),d=getGotOptions();o.MakeCellsEditable({columns:[30,31,32],inputTypes:[{column:30,type:"list",options:p},{column:31,type:"list",options:d},{column:32,type:"list",options:d}],onUpdate:function(a,t,i,l){if(30==i.index().column){var c=t.data();c.rankSort=getRankSortValue(c.rank);var r=getRankGuestInfo(c,c.rank);c.rankGuestsVal=r.rankGuestsVal,c.rankGuestsDisp=r.rankGuestsDisp;var s=getRankGiftInfo(c,c.rank);c.rankGiftVal=s.rankGiftVal,c.rankGiftDisp=s.rankGiftDisp,t.data(c),o.draw(!1)}31==i.index().column&&i.data()!=l&&($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-recipe-recal").closest(".inline-wrapper").removeClass("hidden")),updateRecipesLocalData()}}),$(".pane-recipes .search-box input").on("input",function(){o.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(o),initTableScrollEvent(".pane-recipes")}function updateRecipeTableData(e){e.allSelectedMaterials=[];var a=$("#chk-recipe-show-material").val();for(var t in a)e.allSelectedMaterials.push(Number(a[t]));for(var t in e.questMaterials)e.allSelectedMaterials.indexOf(e.questMaterials[t])<0&&e.allSelectedMaterials.push(e.questMaterials[t]);var i=$("#select-recipe-chef-quest").val(),l=$("#chk-recipe-show-chef").val();e.recipeAddColNum=2*l.length+(i.length>0?1:0)+e.allSelectedMaterials.length,e.recipeAddColNum>e.recipeAddColNumMax&&(e.recipeAddColNumMax=e.recipeAddColNum,reInitRecipeTable(e),initRecipeShow(),isMobile&&updateScrollHeight());for(t=0;t<e.recipeAddColNumMax;t++)$($("#recipe-table").DataTable().column(e.recipeColNum+t).header()).removeClass("all").addClass("never");for(var t in e.recipes){for(var c in e.recipes[t].custom=[],e.allSelectedMaterials){var r=0;for(var s in e.recipes[t].materials)if(e.recipes[t].materials[s].material==e.allSelectedMaterials[c]){r=e.recipes[t].materials[s].quantity;break}var n=0;e.recipes[t].time>0&&(n=3600*r/e.recipes[t].time);var o=n?Math.floor(n):"";e.recipes[t].custom.push({display:o,value:n})}for(var p=0;p<l.length;p++)e.recipes[t].custom.push({display:e.recipes[t].chefs[p].rankDisp,value:e.recipes[t].chefs[p].rankVal}),i.length&&e.recipes[t].custom.push({display:e.recipes[t].chefs[p].skillDiffDisp,value:e.recipes[t].chefs[p].skillDiffVal}),e.recipes[t].custom.push({display:e.recipes[t].chefs[p].efficiency,value:e.recipes[t].chefs[p].efficiency})}var d=0;for(var c in e.allSelectedMaterials)for(j in e.materials)if(e.allSelectedMaterials[c]==e.materials[j].materialId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.materials[j].name+"/h").removeClass("never").addClass("all"),d++;break}for(var t in l)for(j in e.chefs)if(l[t]==e.chefs[j].chefId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.chefs[j].name).removeClass("never").addClass("all"),d++,i.length&&($($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("神差值").removeClass("never").addClass("all"),d++),$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("效率").removeClass("never").addClass("all"),d++;break}$("#recipe-table").DataTable().clear().rows.add(e.recipes),$("#recipe-table").DataTable().responsive.rebuild(),$("#recipe-table").DataTable().responsive.recalc()}function updateRecipesChefsData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#select-recipe-chef-quest").val(),i=$("#chk-recipe-show-chef").val();if(i.length>0)for(var l in e.recipes)for(var c in e.recipes[l].chefs=[],i)for(var r in e.chefs)if(i[c]==e.chefs[r].chefId){var s=null;a&&(s=e.chefs[r].equip);var n=getRecipeResult(e.chefs[r],s,e.recipes[l],e.recipes[l].limit,e.recipes[l].limit,e.materials,null,0,null,!1,buildRecipeMenu(e.recipes[l]),null),o={};if(o.rankVal=n.rankVal,o.rankDisp=n.rankDisp,o.efficiency=n.chefEff||"",t.length){var p=getSkillDiff(e.chefs[r],e.recipes[l],4);o.skillDiffDisp=p.disp,o.skillDiffVal=p.value}e.recipes[l].chefs.push(o);break}}function getChefSillDiff(e,a){var t="",i=e.stirfryVal-a.stirfryVal;i>0&&(t+="炒-"+i+" ");var l=e.boilVal-a.boilVal;l>0&&(t+="煮-"+l+" ");var c=e.knifeVal-a.knifeVal;c>0&&(t+="切-"+c+" ");var r=e.fryVal-a.fryVal;r>0&&(t+="炸-"+r+" ");var s=e.bakeVal-a.bakeVal;s>0&&(t+="-"+s+" ");var n=e.steamVal-a.steamVal;return n>0&&(t+="蒸-"+n+" "),""!=t&&(t=t.slice(0,-1)),t}function addCheffSkillDiff(e,a){if(a.stirfry>0){var t=a.stirfry-e.stirfryVal;t>0&&(e.stirfryVal+=t)}if(a.boil>0){var i=a.boil-e.boilVal;i>0&&(e.boilVal+=i)}if(a.knife>0){var l=a.knife-e.knifeVal;l>0&&(e.knifeVal+=l)}if(a.fry>0){var c=a.fry-e.fryVal;c>0&&(e.fryVal+=c)}if(a.bake>0){var r=a.bake-e.bakeVal;r>0&&(e.bakeVal+=r)}if(a.steam>0){var s=a.steam-e.steamVal;s>0&&(e.steamVal+=s)}}function getSkillDiff(e,a,t){var i=e.stirfryVal-a.stirfry*t,l=e.boilVal-a.boil*t,c=e.knifeVal-a.knife*t,r=e.fryVal-a.fry*t,s=e.bakeVal-a.bake*t,n=e.steamVal-a.steam*t,o="",p=0;i<0&&a.stirfry>0&&(o+="炒"+i+" ",p+=i),l<0&&a.boil>0&&(o+="煮"+l+" ",p+=l),c<0&&a.knife>0&&(o+="切"+c+" ",p+=c),r<0&&a.fry>0&&(o+="炸"+r+" ",p+=r),s<0&&a.bake>0&&(o+="烤"+s+" ",p+=s),n<0&&a.steam>0&&(o+="蒸"+n+" ",p+=n),""!=o&&(o=o.slice(0,-1));var d={};return d.disp=o,d.value=-p,d}function updateChefTableData(e){var a=Number($("#chk-chef-show-skill-diff").val()),t=$("#chk-chef-show-recipe").val();e.chefAddColNum=t.length*(2+(a?1:0)),e.chefAddColNum>e.chefAddColNumMax&&(e.chefAddColNumMax=e.chefAddColNum,reInitChefTable(e),initChefShow(),isMobile&&updateScrollHeight());for(var i=0;i<e.chefAddColNumMax;i++)$($("#chef-table").DataTable().column(e.chefColNum+i).header()).removeClass("all").addClass("never");for(var i in e.chefs){e.chefs[i].custom=[];for(var l=0;l<t.length;l++)e.chefs[i].custom.push({display:e.chefs[i].recipes[l].rankDisp,value:e.chefs[i].recipes[l].rankVal}),a&&e.chefs[i].custom.push({display:e.chefs[i].recipes[l].skillDiffDisp,value:e.chefs[i].recipes[l].skillDiffVal}),e.chefs[i].custom.push({display:e.chefs[i].recipes[l].efficiency,value:e.chefs[i].recipes[l].efficiency})}var c=0;for(var i in t)for(j in e.recipes)if(t[i]==e.recipes[j].recipeId){$($("#chef-table").DataTable().column(e.chefColNum+c).header()).text(e.recipes[j].name).removeClass("never").addClass("all"),c++,a&&($($("#chef-table").DataTable().column(e.chefColNum+c).header()).text(getSkillDiffText(a)).removeClass("never").addClass("all"),c++),$($("#chef-table").DataTable().column(e.chefColNum+c).header()).text("效率").removeClass("never").addClass("all"),c++;break}t.length&&(order=a?[[e.chefColNum+1,"asc"],[e.chefColNum+2,"desc"]]:[e.chefColNum+1,"desc"],$("#chef-table").DataTable().order(order)),$("#chef-table").DataTable().clear().rows.add(e.chefs),$("#chef-table").DataTable().responsive.rebuild(),$("#chef-table").DataTable().responsive.recalc()}function getSkillDiffText(e){return 5==e?"传差值":4==e?"神差值":3==e?"特差值":2==e?"优差值":""}function updateChefsRecipesData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=Number($("#chk-chef-show-skill-diff").val()),i=$("#chk-chef-show-recipe").val();if(i.length>0)for(var l in e.chefs)for(var c in e.chefs[l].recipes=[],i)for(var r in e.recipes)if(i[c]==e.recipes[r].recipeId){var s=null;a&&(s=e.chefs[l].equip);var n=getRecipeResult(e.chefs[l],s,e.recipes[r],e.recipes[r].limit,e.recipes[r].limit,e.materials,null,0,null,!1,buildRecipeMenu(e.recipes[r]),null),o={};if(o.rankVal=n.rankVal,o.rankDisp=n.rankDisp,o.efficiency=n.chefEff||"",t){var p=getSkillDiff(e.chefs[l],e.recipes[r],t);o.skillDiffDisp=p.disp,o.skillDiffVal=p.value}e.chefs[l].recipes.push(o)}}function getTableOrder(e,a){var t=[],i=e.order();for(var l in i){var c=i[l][0];c<a&&t.push(i[l])}return t}function initChefTable(e){for(var a in reInitChefTable(e),e.recipes)$("#chk-chef-show-recipe").append("<option value='"+e.recipes[a].recipeId+"'>"+e.recipes[a].name+"</option>");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-rarity").val();return 0==c.length||!!$('#chk-chef-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-gender").val();return 0==c.length||!!$('#chk-chef-gender option[value="'+i.gender+'"]').is(":selected")
}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-category").val();if(0==c.length)return!0;var r=$("#chk-chef-category-equip").prop("checked"),s=i.specialSkillEffect.concat(i.ultimateSkillEffect);for(var n in r&&i.equip&&(s=s.concat(i.equip.effect)),c)for(var o in s)if(s[o].type==c[n]){if("OpenTime"!=s[o].type)return!0;if(s[o].value<0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-condiment").val();if(0==c.length)return!0;for(var r in c)if(i[c[r]+"Val"]>0)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-no-origin").prop("checked");return!!(c||!c&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-ultimate-no").prop("checked");return!(c&&(!c||i.ultimate))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$("#chk-chef-got").prop("checked");return!!(!c||c&&i.got)});var t=$(".pane-chefs .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,i,l,c){if(e.nTable!=document.getElementById("chef-table"))return!0;var r=$.trim(t.val());return!!commaSeparatedMatch(l.name,r)||(!!commaSeparatedMatch(l.specialSkillDisp,r)||(!!commaSeparatedMatch(l.origin,r)||(!!commaSeparatedMatch(l.ultimateSkillDisp,r)||!!commaSeparatedMatch(l.tagsDisp,r))))}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(a,t,i,l){updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw()}),$("#chk-chef-show-skill-diff").on("changed.bs.select",function(){$("#chk-chef-show-recipe").val().length&&(updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw())}),$("#chk-chef-show").on("changed.bs.select",function(){initChefShow(),updateMenuLocalData()}),$("#chk-chef-rarity").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-gender").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category-equip").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-condiment").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-ultimate-no").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-got").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-no-origin").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-apply-ultimate").change(function(){$(this).prop("checked")?$(".chef-apply-ultimate").show():$(".chef-apply-ultimate").hide(),updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate-person").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-partial-ultimate").selectpicker().on("changed.bs.select",function(){updateRecipeChefTable(e)}),$("#chk-chef-apply-equips").change(function(){updateRecipeChefTable(e)}),$("#btn-chef-recal").click(function(){updateRecipeChefTable(e)}),$("#btn-chef-reset").click(function(){$("#chk-chef-rarity").selectpicker("deselectAll"),$("#chk-chef-gender").selectpicker("deselectAll"),$("#chk-chef-category").selectpicker("deselectAll"),$("#chk-chef-condiment").selectpicker("deselectAll"),$("#chk-chef-ultimate-no").prop("checked",!1),$("#chk-chef-got").prop("checked",!1),$("#chk-chef-no-origin").prop("checked",!0),$("#chk-chef-show-recipe").selectpicker("deselectAll"),$(".pane-chefs .search-box input").val(""),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#chef-table").DataTable().draw()}),initChefShow()}function reInitChefTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-chef-icon",orderable:!1,searchable:!1},{data:"name",width:"81px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:{_:"meatVal",display:"meatDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"creationVal",display:"creationDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"vegVal",display:"vegDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fishVal",display:"fishDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"gender",width:"30px"},{data:{_:"sweetVal",display:"sweetDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"sourVal",display:"sourDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"spicyVal",display:"spicyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"saltyVal",display:"saltyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bitterVal",display:"bitterDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"tastyVal",display:"tastyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"origin"},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"equipId",display:"equipDisp"},className:"nodetails"},{data:"ultimateGoalDisp"},{data:"ultimateSkillDisp"},{data:"ultimate",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t="",i=[];$.fn.DataTable.isDataTable("#chef-table")&&(t=$(".pane-chefs .search-box input").val(),i=getTableOrder($("#chef-table").DataTable(),a.length),$("#chef-table").DataTable().MakeCellsEditable("destroy"),$("#chef-table").DataTable().destroy()),$("#chef-table").html($("#chef-table-header").html());for(var l=0;l<e.chefAddColNumMax;l++)a.push({data:{_:"custom."+l+".value",display:"custom."+l+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#chef-table thead tr").append("<th></th>");var c=!0,r=!1,s=!1;isMobile&&(c=!1,r=!0,s={left:[0,3]});var n="td:not(.nodetails)";expendBtn&&(n=".td-expend");var o=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:i,autoWidth:!1,fixedHeader:c,scrollX:r,fixedColumns:s,responsive:{details:{type:"column",target:n,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var c=5;c<=10;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else{if(l>12&&l<=15)continue;if(12==l){i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>采集：</span>";for(c=12;c<=15;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else{if(l>17&&l<=22)continue;if(17==l){i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>调料：</span>";for(c=17;c<=22;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:19==l?"无":22==l||23==l?"否":"")+"</span></div>"}}}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#chef-table"))+">"+i+"</div>"}}}});$(".pane-chefs div.search-box").html('<input type="search" value="'+t+'" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">');var p=getGotOptions(),d=getEquipsOptions(e.equips,e.skills);o.MakeCellsEditable({columns:[25,28,29],inputTypes:[{column:25,type:"list",search:!0,clear:!0,done:!0,options:d},{column:28,type:"list",options:p},{column:29,type:"list",options:p}],onUpdate:function(a,t,i,l){if(25==i.index().column){var c=t.data(),r=null,s="";if(c.equipId)for(var n in e.equips)if(c.equipId==e.equips[n].equipId){r=e.equips[n],s=e.equips[n].disp;break}c.equip=r,c.equipDisp=s,t.data(c),o.draw(!1)}25!=i.index().column&&28!=i.index().column||i.data()==l||($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-chef-recal").closest(".inline-wrapper").removeClass("hidden")),updateChefsLocalData()}}),$(".pane-chefs .search-box input").on("input",function(){o.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(o),initTableScrollEvent(".pane-chefs")}function initEquipTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#equip-table").DataTable({data:e.equips,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#equip-table"))+">"+i+"</div>"}}}});$(".pane-equips div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var c=$("#chk-equip-skill").val();if(0==c.length)return!0;var r=i.effect,s=$("#chk-equip-multiple-skill").prop("checked"),n=!1;for(var o in(1==c.length||s)&&(n=$("#chk-equip-filter-negative-skill").prop("checked")),c){var p=!0,d=c[o].split(",");for(var u in d){var f=!1;for(var h in r)if(r[h].type==d[u]){if(n&&r[h].value<0)return!1;f=!0;break}if(!f){if(s)return!1;p=!1;break}}if(!s&&p)return!0}return!!s}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var c=$("#chk-equip-filter-all-skill").prop("checked");if(!c)return!0;var r=i.effect,s="Stirfry,Boil,Knife,Fry,Bake,Steam",n=s.split(",");for(var o in n){var p=!1;for(var d in r)if(r[d].type==n[o]){p=!0;break}if(!p)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var c=$("#chk-equip-no-origin").prop("checked");return!!(c||!c&&i.origin)});var s=$(".pane-equips .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var c=$.trim(s.val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.skillDisp,c)||!!commaSeparatedMatch(i.origin,c))}),$("#chk-equip-show").on("changed.bs.select",function(){initEquipShow(),updateMenuLocalData()}),$("#chk-equip-skill").selectpicker().on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],r.order([5,"desc"])),r.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var c in l.effect)if((l.effect[c].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[c].type)&&(l.skillSort=l.effect[c].value,"Percent"==l.effect[c].cal)){l.skillSort*=1e4;break}this.data(l)}),r.draw()}),$("#chk-equip-no-origin").click(function(){r.draw()}),$("#chk-equip-multiple-skill").click(function(){r.draw()}),$("#chk-equip-filter-negative-skill").click(function(){r.draw()}),$("#chk-equip-filter-all-skill").click(function(){r.draw()}),$(".pane-equips .search-box input").on("input",function(){r.draw(),changeInputStyle(this)}),$("#btn-equip-reset").click(function(){$("#chk-equip-skill").selectpicker("deselectAll"),$("#chk-equip-multiple-skill").prop("checked",!1),$("#chk-equip-filter-negative-skill").prop("checked",!1),$("#chk-equip-filter-all-skill").prop("checked",!1),$("#chk-equip-no-origin").prop("checked",!0),$(".pane-equips .search-box input").val(""),checkMonitorStyle(),r.draw()}),initTableResponsiveDisplayEvent(r),initTableScrollEvent(".pane-equips"),initEquipShow()}function initDecorationTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"id",width:"1px"},{data:"icon",className:"td-decoration-icon",orderable:!1,searchable:!1},{data:"name",width:"145px",className:"all fixedcolumn"},{data:{_:"gold",display:"goldDisp"},orderSequence:["desc","asc"]},{data:"tipMin",orderSequence:["desc","asc"]},{data:"tipMax",orderSequence:["desc","asc"]},{data:{_:"tipTime",display:"tipTimeDisp"},orderSequence:["desc","asc"]},{data:"minEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"maxEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"avgEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"position"},{data:{_:"suit",display:"suitDisp"},orderSequence:["desc","asc"]},{data:{_:"suitGold",display:"suitGoldDisp"},orderSequence:["desc","asc"]},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,4]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#decoration-table").DataTable({data:e.decorations,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个装饰",0:"",1:"选择了 %d 个装饰"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[0,"desc"],[11,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<4?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#decoration-table"))+">"+i+"</div>"}}}});$(".pane-decorations div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 套装 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var c=$("#chk-decoration-position").val();if(0==c.length)return!0;var r=i.position;return!!$('#chk-decoration-position option[value="'+r+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var c=$("#chk-decoration-no-origin").prop("checked");return!!(c||!c&&i.origin)});var s=$(".pane-decorations .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var c=$.trim(s.val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.suit,c)||!!commaSeparatedMatch(i.origin,c))}),$("#chk-decoration-show").on("changed.bs.select",function(){initDecorationShow(),updateMenuLocalData()}),$("#chk-decoration-position").on("changed.bs.select",function(){r.draw()}),$("#chk-decoration-no-origin").click(function(){r.draw()}),$(".pane-decorations .search-box input").on("input",function(){r.draw(),changeInputStyle(this)});var n="<option></option>";for(var o in e.suits)n+="<option value='"+e.suits[o].name+"'>"+e.suits[o].name+"</option>";$("#select-decoration-suit").append(n).selectpicker().change(function(){var e=$("#select-decoration-suit").val();$("#select-decoration-suit").selectpicker("val",""),r.rows().deselect(),r.rows().every(function(a,t,i){this.data().suit==e&&this.select()}),r.draw()}),$("#btn-decoration-deselect-all").click(function(){$("#chk-decoration-position").selectpicker("deselectAll"),$("#select-decoration-suit").selectpicker("val",""),r.rows().deselect()}),r.on("user-select",function(e,a,t,i,l){var c=i.index().row,s=r.rows(c).data()[0];r.rows({selected:!0}).every(function(e,a,t){this.data().position==s.position&&this.data().id!=s.id&&this.deselect()})}),r.on("select",function(a,t,i,l){updateDecorationSum(e)}),r.on("deselect",function(a,t,i,l){updateDecorationSum(e)}),initTableResponsiveDisplayEvent(r),initTableScrollEvent(".pane-decorations"),initDecorationShow()}function updateDecorationSum(e){var a=$("#decoration-table").DataTable().rows({selected:!0}).data().toArray(),t=0,i=0,l=[];for(var c in a)a[c].suit&&l.indexOf(a[c].suit)<0&&l.push(a[c].suit),a[c].avgEff&&(t+=a[c].avgEff),i+=a[c].gold;var r=0;for(var c in l)r+=getSuitGold(e,a,l[c]);var s="";a.length&&(s="平均玉璧/天:"+ +t.toFixed(1)+" 收入加成: "+getPercentDisp(+(100*(i+r)).toFixed(2))),$("#decoration-sum").html(s)}function getSuitGold(e,a,t){for(var i in e.suits)if(e.suits[i].name==t){for(var l in e.suits[i].decorations){var c=!1;for(var r in a)if(e.suits[i].decorations[l]==a[r].id){c=!0;break}if(!c)return 0}return e.suits[i].gold}return 0}function initMaterialTable(e){for(var a in e.maps)$("#select-material-origin").append("<option value='"+e.maps[a].name+"'>"+e.maps[a].name+"</option>");reInitMaterialTable(e),$("#select-material-origin").selectpicker().change(function(){reInitMaterialTable(e)}),$("#chk-material-season").click(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()}),$("#input-material-addition, #input-material-skill").on("input",function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()})}function reInitMaterialTable(e){var a=[{data:"name",className:"fixedcolumn"},{data:"skill",defaultContent:""}];$.fn.DataTable.isDataTable("#material-table")&&$("#material-table").DataTable().destroy();var t,i=$("#select-material-origin").val();for(var l in e.maps)if(i==e.maps[l].name){t=e.maps[l];break}for(var l in $("#material-table thead tr").first().html("").append("<th rowspan='2'>食材</th><th rowspan='2'>点数</th>"),$("#material-table thead tr").last().html(""),t.time)$("#material-table thead tr").first().append("<th colspan='2'>"+secondsToTime(t.time[l])+"</th>"),$("#material-table thead tr").last().append("<th>最小</th><th>最大</th>"),a.push({data:"time."+l+".0"}),a.push({data:"time."+l+".1"});var c=getMaterialsData(e,t),r=!1,s=!1;isMobile&&(r=!0,s={left:[0]});var n=$("#material-table").DataTable({data:c,columns:a,dom:"<'row'<'col-sm-12'tr>>",paging:!1,ordering:!1,info:!1,deferRender:!0,autoWidth:!1,scrollX:r,fixedColumns:s});initTableScrollEvent(".pane-materials"),n.draw()}function initCondimentTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"condimentId",width:"1px"},{data:"icon",className:"td-condiment-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#condiment-table").DataTable({data:e.condiments,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#condiment-table"))+">"+i+"</div>"}}}});$(".pane-condiments div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var c=$("#chk-condiment-origin").val();if(0==c.length)return!0;for(var r in c)if(c[r]==i.origin)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var c=$("#chk-condiment-skill").val();if(0==c.length)return!0;var r=$("#chk-condiment-multiple-skill").prop("checked"),s=i.effect;for(var n in c){var o=!0,p=c[n].split(",");for(var d in p){var u=!1;for(var f in s)if(s[f].type==p[d]){u=!0;break}if(!u){if(r)return!1;o=!1;break}}if(!r&&o)return!0}return!!r});var s=$(".pane-condiments .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var c=$.trim(s.val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.skillDisp,c)||!!commaSeparatedMatch(i.origin,c))}),$("#chk-condiment-show").on("changed.bs.select",function(){initCondimentShow(),updateMenuLocalData()}),$("#chk-condiment-origin").on("changed.bs.select",function(){r.draw()}),$("#chk-condiment-skill").selectpicker().on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],r.order([5,"desc"])),r.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var c in l.effect)if((l.effect[c].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[c].type)&&(l.skillSort=l.effect[c].value,"Percent"==l.effect[c].cal)){l.skillSort*=1e4;break}this.data(l)}),r.draw()}),$("#chk-condiment-multiple-skill").click(function(){r.draw()}),$(".pane-condiments .search-box input").on("input",function(){r.draw(),changeInputStyle(this)}),$("#btn-condiment-reset").click(function(){$("#chk-condiment-origin").selectpicker("deselectAll"),$("#chk-condiment-skill").selectpicker("deselectAll"),$("#chk-condiment-multiple-skill").prop("checked",!1),$(".pane-condiments .search-box input").val(""),checkMonitorStyle(),r.draw()}),initTableResponsiveDisplayEvent(r),initTableScrollEvent(".pane-condiments"),initCondimentShow()}function initQuestTable(e){for(var a in e.activities)$("#select-quest-type").append("<option>"+e.activities[a].name+"</option>");var t=[{data:"questIdDisp",width:"25px",className:"fixedcolumn"},{data:"preId",defaultContent:"",orderable:!1,width:"35px"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],i=getQuestsData(e.quests,$("#select-quest-type").val()),l=!0,c=!1,r=!1;isMobile&&(l=!1,c=!0,r={leftColumns:[0]});var s=$("#quest-table").DataTable({data:i,columns:t,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:l,scrollX:c,fixedColumns:r});$(".pane-quest div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 编号 任务 奖励">');var n=$(".pane-quest .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("quest-table"))return!0;var c=$.trim(n.val());return!!commaSeparatedMatch(i.questIdDisp.toString(),c)||(!!commaSeparatedMatch(i.goal,c)||!!commaSeparatedMatch(i.rewardsVal,c))}),$(".pane-quest .search-box input").on("input",function(){s.draw(),changeInputStyle(this)}),$("#select-quest-type").selectpicker().change(function(){var a=getQuestsData(e.quests,$(this).val());s.clear().rows.add(a).draw(),initQuestShow(s)}),initTableScrollEvent(".pane-quest"),initQuestShow(s)}function initImportExport(e){$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$("#import-msg-2").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=importData(e,$("#input-export-import").val());a?($("#input-export-import").val(""),$("#import-msg-2").html("导入成功 !")):$("#import-msg-2").html("导入失败 !")},0)}),$("#btn-export-download").click(function(){var e=new Blob([generateExportData()],{type:"text/plain;charset=utf-8"});saveAs(e,"food.txt")}),$("#file-import").change(function(){$("#import-msg").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=document.getElementById("file-import").files[0],t=new FileReader;t.onload=function(a){var t=importData(e,a.target.result);t?$("#import-msg").html("导入成功 !"):$("#import-msg").html("导入失败 !")},t.readAsText(a,"UTF-8"),$(this).val("")},0)})}function importData(e,a){var t;try{t=JSON.parse(a)}catch(e){return!1}for(var i in e.recipes){for(var l in t.recipes)if(e.recipes[i].recipeId==t.recipes[l].id){if(t.recipes[l].hasOwnProperty("rank")){e.recipes[i].rank=t.recipes[l].rank,e.recipes[i].rankSort=getRankSortValue(t.recipes[l].rank);var c=getRankGuestInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGuestsVal=c.rankGuestsVal,e.recipes[i].rankGuestsDisp=c.rankGuestsDisp;var r=getRankGiftInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGiftVal=r.rankGiftVal,e.recipes[i].rankGiftDisp=r.rankGiftDisp}t.recipes[l].hasOwnProperty("ex")&&(e.recipes[i].ex=t.recipes[l].ex),t.recipes[l].hasOwnProperty("got")&&(e.recipes[i].got=t.recipes[l].got);break}for(var l in t.recipesTags)if(e.recipes[i].recipeId==t.recipesTags[l].recipeId){e.recipes[i].tags=t.recipesTags[l].tags,e.recipes[i].tagsDisp=getTagsDisp(t.recipesTags[l].tags,t.tags),e.recipes[i].exTime=t.recipesTags[l].experienceTime,e.recipes[i].exTimeDisp=getExTimeDisp(t.recipesTags[l].experienceTime,e.recipes[i].time);break}}for(var i in e.chefs){for(var l in t.chefs)if(e.chefs[i].chefId==t.chefs[l].id){if(t.chefs[l].hasOwnProperty("got")&&(e.chefs[i].got=t.chefs[l].got),t.chefs[l].hasOwnProperty("ult")&&(e.chefs[i].ultimate=t.chefs[l].ult),t.chefs[l].hasOwnProperty("equip")){for(var s in e.equips)if(t.chefs[l].equip==e.equips[s].equipId){e.chefs[i].equip=e.equips[s],e.chefs[i].equipId=e.equips[s].equipId,e.chefs[i].equipDisp=e.equips[s].disp;break}}else e.chefs[i].equip=null,e.chefs[i].equipId="",e.chefs[i].equipDisp="";break}for(var l in t.chefsTags)if(e.chefs[i].chefId==t.chefsTags[l].chefId){e.chefs[i].tags=t.chefsTags[l].tags,e.chefs[i].tagsDisp=getTagsDisp(t.chefsTags[l].tags,t.tags);break}}var n="";for(var i in t.rules){var o=!1;for(var l in e.rules)if(t.rules[i].Id==e.rules[l].Id){e.rules[l]=t.rules[i],o=!0;break}o||(e.rules.push(t.rules[i]),n+="<option value='"+t.rules[i].Id+"'>"+t.rules[i].Title+"</option>")}$("#select-cal-rule").append(n).selectpicker("refresh"),t.calChefs&&($("#cal-chefs-table").DataTable().rows().deselect(),$("#cal-chefs-table").DataTable().rows(function(e,a,i){for(var l in t.calChefs)if(a.chefId==t.calChefs[l])return!0;return!1}).select()),t.calEquips&&($("#cal-equips-table").DataTable().rows().deselect(),$("#cal-equips-table").DataTable().rows(function(e,a,i){for(var l in t.calEquips)if(a.equipId==t.calEquips[l])return!0;return!1}).select()),updateMenu(t),updateSetting(t),t.decorationEffect&&(e.decorationEffect=t.decorationEffect,$("#input-cal-decoration").val(t.decorationEffect||"")),updateActivity(t);try{localStorage.setItem("data",generateExportData())}catch(e){}return e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),initRecipeShow(),initChefShow(),initEquipShow(),initDecorationShow(),initCondimentShow(),!0}function updateRecipesLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.recipes=generateRecipesExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateChefsLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.chefs=generateChefsExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateMenuLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.menu=generateMenuExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateSettingLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.setting=generateSettingExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateDecorationLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.decorationEffect=Number($("#input-cal-decoration").val());try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateActivityLocalData(){updateLocalData("activity",generateActivityExportData())}function updateLocalData(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}t||(t={}),t[e]=a;try{localStorage.setItem("data",JSON.stringify(t))}catch(e){}}function generateExportData(){var e={};return e.recipes=generateRecipesExportData(),e.chefs=generateChefsExportData(),e.menu=generateMenuExportData(),e.setting=generateSettingExportData(),e.decorationEffect=Number($("#input-cal-decoration").val()),e.activity=generateActivityExportData(),JSON.stringify(e)}function generateRecipesExportData(){var e=[],a=$("#recipe-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].recipeId,i.rank=a[t].rank,i.ex=a[t].ex,i.got=a[t].got,e.push(i)}return e}function generateChefsExportData(){var e=[],a=$("#chef-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].chefId,i.got=a[t].got,i.ult=a[t].ultimate,a[t].equip&&(i.equip=a[t].equip.equipId),e.push(i)}return e}function generateMenuExportData(){var e={version:4};return e.recipe=$("#chk-recipe-show").val(),e.chef=$("#chk-chef-show").val(),e.equip=$("#chk-equip-show").val(),e.decoration=$("#chk-decoration-show").val(),e.condiment=$("#chk-condiment-show").val(),e}function updateMenu(e){e&&e.menu&&(2==e.menu.version&&(updateMenu2to3(e.menu.recipe,"0"),updateMenu2to3(e.menu.chef,"0"),updateMenu2to3(e.menu.equip,"0"),updateMenu2to3(e.menu.decoration,"1"),updateMenu2to3(e.menu.condiment,"0")),e.menu.version<4&&updateMenu3to4(e.menu.recipe),$("#chk-recipe-show").selectpicker("val",e.menu.recipe),$("#chk-chef-show").selectpicker("val",e.menu.chef),$("#chk-equip-show").selectpicker("val",e.menu.equip),$("#chk-decoration-show").selectpicker("val",e.menu.decoration),$("#chk-condiment-show").selectpicker("val",e.menu.condiment))}function updateMenu2to3(e,a){for(var t in e)e[t]=(Number(e[t])+1).toString();e.push(a)}function updateMenu3to4(e){for(var a in e)Number(e[a])>21&&(e[a]=(Number(e[a])+1).toString())}
function generateSettingExportData(){var e={};return e.help=$("#chk-setting-show-help").prop("checked"),e.expandbtn=$("#chk-setting-expand-btn").prop("checked"),e.auto=$("#chk-setting-auto-update").prop("checked"),e.final=$("#chk-setting-show-final").prop("checked"),e.mark=$("#chk-setting-done-mark").prop("checked"),e.pagelen=Number($("#select-setting-page-length").val()),e}function updateSetting(e){e&&e.setting&&($("#chk-setting-show-help").prop("checked")!=e.setting.help&&(e.setting.help?$("#chk-setting-show-help").bootstrapToggle("on"):$("#chk-setting-show-help").bootstrapToggle("off")),$("#chk-setting-expand-btn").prop("checked")!=e.setting.expandbtn&&(e.setting.expandbtn?$("#chk-setting-expand-btn").bootstrapToggle("on"):($("#chk-setting-expand-btn").bootstrapToggle("off"),expendBtn=!1)),$("#chk-setting-auto-update").prop("checked")!=e.setting.auto&&(e.setting.auto?$("#chk-setting-auto-update").bootstrapToggle("on"):$("#chk-setting-auto-update").bootstrapToggle("off")),$("#chk-setting-show-final").prop("checked")!=e.setting.final&&(e.setting.final?$("#chk-setting-show-final").bootstrapToggle("on"):$("#chk-setting-show-final").bootstrapToggle("off")),$("#chk-setting-done-mark").prop("checked")!=e.setting.mark&&(e.setting.mark?$("#chk-setting-done-mark").bootstrapToggle("on"):$("#chk-setting-done-mark").bootstrapToggle("off")),Number($("#select-setting-page-length").val())!=e.setting.pagelen&&e.setting.pagelen&&$("#select-setting-page-length").selectpicker("val",e.setting.pagelen))}function generateActivityExportData(){var e={};return e.stirfryPrice=$("#input-cal-activity-stirfry-price").val(),e.bakePrice=$("#input-cal-activity-bake-price").val(),e.steamPrice=$("#input-cal-activity-steam-price").val(),e.boilPrice=$("#input-cal-activity-boil-price").val(),e.fryPrice=$("#input-cal-activity-fry-price").val(),e.knifePrice=$("#input-cal-activity-knife-price").val(),e.sourPrice=$("#input-cal-activity-sour-price").val(),e.sweetPrice=$("#input-cal-activity-sweet-price").val(),e.bitterPrice=$("#input-cal-activity-bitter-price").val(),e.spicyPrice=$("#input-cal-activity-spicy-price").val(),e.saltyPrice=$("#input-cal-activity-salty-price").val(),e.tastyPrice=$("#input-cal-activity-tasty-price").val(),e.vegetablePrice=$("#input-cal-activity-vegetable-price").val(),e.creationPrice=$("#input-cal-activity-creation-price").val(),e.fishPrice=$("#input-cal-activity-fish-price").val(),e.meatPrice=$("#input-cal-activity-meat-price").val(),e.goldPrice=$("#input-cal-activity-gold-price").val(),e.stirfry=$("#input-cal-activity-stirfry").val(),e.bake=$("#input-cal-activity-bake").val(),e.steam=$("#input-cal-activity-steam").val(),e.boil=$("#input-cal-activity-boil").val(),e.fry=$("#input-cal-activity-fry").val(),e.knife=$("#input-cal-activity-knife").val(),e.limit1=$("#input-cal-activity-1-limit").val(),e.limit2=$("#input-cal-activity-2-limit").val(),e.limit3=$("#input-cal-activity-3-limit").val(),e.limit4=$("#input-cal-activity-4-limit").val(),e.limit5=$("#input-cal-activity-5-limit").val(),e}function updateActivity(e){var a=e&&e.activity;a&&($("#input-cal-activity-stirfry-price").val(a.stirfryPrice),$("#input-cal-activity-bake-price").val(a.bakePrice),$("#input-cal-activity-steam-price").val(a.steamPrice),$("#input-cal-activity-boil-price").val(a.boilPrice),$("#input-cal-activity-fry-price").val(a.fryPrice),$("#input-cal-activity-knife-price").val(a.knifePrice),$("#input-cal-activity-sour-price").val(a.sourPrice),$("#input-cal-activity-sweet-price").val(a.sweetPrice),$("#input-cal-activity-bitter-price").val(a.bitterPrice),$("#input-cal-activity-spicy-price").val(a.spicyPrice),$("#input-cal-activity-salty-price").val(a.saltyPrice),$("#input-cal-activity-tasty-price").val(a.tastyPrice),$("#input-cal-activity-vegetable-price").val(a.vegetablePrice),$("#input-cal-activity-creation-price").val(a.creationPrice),$("#input-cal-activity-fish-price").val(a.fishPrice),$("#input-cal-activity-meat-price").val(a.meatPrice),$("#input-cal-activity-gold-price").val(a.goldPrice),$("#input-cal-activity-stirfry").val(a.stirfry),$("#input-cal-activity-bake").val(a.bake),$("#input-cal-activity-steam").val(a.steam),$("#input-cal-activity-boil").val(a.boil),$("#input-cal-activity-fry").val(a.fry),$("#input-cal-activity-knife").val(a.knife),$("#input-cal-activity-1-limit").val(a.limit1),$("#input-cal-activity-2-limit").val(a.limit2),$("#input-cal-activity-3-limit").val(a.limit3),$("#input-cal-activity-4-limit").val(a.limit4),$("#input-cal-activity-5-limit").val(a.limit5))}function initCalTables(e){setSelfUltimateOptions(e.chefs,e.skills),setExOptions(e.recipes),initCalRecipesTable(),initCalCustomTable(e),initCalRules(e),private?($(".pane-cal").addClass("admin"),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),$("#input-cal-thread").val(navigator.hardwareConcurrency)):$(".admin-only").remove()}function showCalSubPane(){$(".pane-cal-sub").addClass("hidden");var e=$("input[name='rad-cal-pane-options']:checked");".pane-cal-recipes"==e.attr("data-pane")&&"false"==$("#pane-cal-recipes").attr("data-cal")&&($("#pane-cal-recipes").attr("data-cal","true"),calRecipesResults(currentRule)),$(e.attr("data-pane")).removeClass("hidden"),isMobile?($(".dataTables_scrollBody:visible table.dataTable").DataTable().draw(!1),"true"!=$(e).attr("data-init")&&($(e).attr("data-init","true"),updateScrollHeight())):reInitFixedHeader()}function initCalRules(e){var a="";for(var t in e.rules)a+="<option value='"+e.rules[t].Id+"'>"+e.rules[t].Title+"</option>";$("#select-cal-rule").append(a).selectpicker().change(function(){$("#btn-cal-rule-load").addClass("btn-danger")}),$("#input-cal-decoration").val(e.decorationEffect||""),loadUltimate(e,!0),$("#btn-cal-rule-load").click(function(){$(this).hasClass("btn-danger")?loadCalRule(e):bootbox.confirm({size:"small",message:"<div class='text-center'>确定重新加载?</div>",locale:"zh_CN",callback:function(a){a&&loadCalRule(e)}})}),$("input[name='rad-cal-pane-options']").change(function(){showCalSubPane()}),$("#input-cal-decoration").on("input",function(){updateDecorationLocalData(),setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$(".cal-settings input").on("input",function(){setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#chk-cal-partial-ultimate").selectpicker().on("changed.bs.select",function(){setCalConfigData(currentRule,e),calCustomResults(e)}),$("#chk-cal-self-ultimate").selectpicker().on("changed.bs.select",function(){setCalConfigData(currentRule,e),calCustomResults(e)}),$("#chk-cal-ex").selectpicker().on("changed.bs.select",function(){setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-load-ultimate").click(function(){$("#cal-ultimate input").val(""),loadUltimate(e,!0),setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-load-all-ultimate").click(function(){$("#cal-ultimate input").val(""),loadUltimate(e,!1),setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-clear-ultimate").click(function(){$("#cal-ultimate input").val(""),$("#chk-cal-partial-ultimate").selectpicker("deselectAll"),$("#chk-cal-self-ultimate").selectpicker("deselectAll"),$("#chk-cal-ex").selectpicker("deselectAll"),setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#cal-activity input").on("input",function(){updateActivityLocalData()}),$("#btn-cal-clear-activity").click(function(){$("#cal-activity input").val(""),updateActivityLocalData(),setCalConfigData(currentRule,e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#chk-cal-got").click(function(){$("#cal-recipes-table").DataTable().draw()}),$("#select-cal-order").change(function(){sortRecipesResult()}),isMobile&&($("#chk-cal-details").prop("checked",!1),$(".recipe-box").addClass("no-details")),$("#chk-cal-details").click(function(){$(this).prop("checked")?$(".recipe-box").removeClass("no-details"):$(".recipe-box").addClass("no-details")}),$("#btn-cal-clear-custom").click(function(){initCustomData(),calCustomResults(e),currentRule.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")})}function loadCalRule(e){var a=Math.floor($("#select-cal-rule").val());for(var t in e.rules)if(e.rules[t].Id==a){currentRule=e.rules[t];break}currentRule&&($("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),setTimeout(function(){loadRule(e,currentRule),setCalConfigData(currentRule,e),$("#pane-cal-recipes").attr("data-cal","false"),$(".loading").addClass("hidden"),$(".cal-menu").removeClass("hidden"),showCalSubPane(),$("#btn-cal-rule-load").prop("disabled",!1).removeClass("btn-danger")},0))}function loadUltimate(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}var l=getUltimateData(e.chefs,t,e.skills,!0,a),c=l.global;for(var r in c)"Stirfry"!=c[r].type||c[r].tag?"Boil"!=c[r].type||c[r].tag?"Knife"!=c[r].type||c[r].tag?"Fry"!=c[r].type||c[r].tag?"Bake"!=c[r].type||c[r].tag?"Steam"!=c[r].type||c[r].tag?1!=c[r].tag?2!=c[r].tag?"MaxEquipLimit"!=c[r].type||1!=c[r].rarity?"MaxEquipLimit"!=c[r].type||2!=c[r].rarity?"MaxEquipLimit"!=c[r].type||3!=c[r].rarity?"MaxEquipLimit"!=c[r].type||4!=c[r].rarity?"MaxEquipLimit"!=c[r].type||5!=c[r].rarity?"UseAll"!=c[r].type||1!=c[r].rarity?"UseAll"!=c[r].type||2!=c[r].rarity?"UseAll"!=c[r].type||3!=c[r].rarity?"UseAll"!=c[r].type||4!=c[r].rarity?"UseAll"!=c[r].type||5!=c[r].rarity?"Material_Gain"!=c[r].type&&console.log(c[r].type):$("#input-cal-ultimate-5-price").val(c[r].value):$("#input-cal-ultimate-4-price").val(c[r].value):$("#input-cal-ultimate-3-price").val(c[r].value):$("#input-cal-ultimate-2-price").val(c[r].value):$("#input-cal-ultimate-1-price").val(c[r].value):$("#input-cal-ultimate-5-limit").val(c[r].value):$("#input-cal-ultimate-4-limit").val(c[r].value):$("#input-cal-ultimate-3-limit").val(c[r].value):$("#input-cal-ultimate-2-limit").val(c[r].value):$("#input-cal-ultimate-1-limit").val(c[r].value):$("#input-cal-ultimate-female-skill").val(c[r].value):$("#input-cal-ultimate-male-skill").val(c[r].value):$("#input-cal-ultimate-steam").val(c[r].value):$("#input-cal-ultimate-bake").val(c[r].value):$("#input-cal-ultimate-fry").val(c[r].value):$("#input-cal-ultimate-knife").val(c[r].value):$("#input-cal-ultimate-boil").val(c[r].value):$("#input-cal-ultimate-stirfry").val(c[r].value);var s=l.partial,n=[];for(var r in s)n.push(s[r].chefId);$("#chk-cal-partial-ultimate").selectpicker("val",n);var o=l.self,p=[];for(var r in o)p.push(o[r].chefId);$("#chk-cal-self-ultimate").selectpicker("val",p);var d=[];for(var r in e.recipes)(a&&"是"==e.recipes[r].ex||!a)&&d.push(e.recipes[r].recipeId);$("#chk-cal-ex").selectpicker("val",d)}function setCalConfigData(e,a){e.decorationEffect=Number($("#input-cal-decoration").val());var t=[],i=Number($("#input-cal-ultimate-stirfry").val());if(i){var l={type:"Stirfry"};l.value=i,l.condition="Global",l.cal="Abs",t.push(l)}var c=Number($("#input-cal-ultimate-boil").val());if(c){l={type:"Boil"};l.value=c,l.condition="Global",l.cal="Abs",t.push(l)}var r=Number($("#input-cal-ultimate-knife").val());if(r){l={type:"Knife"};l.value=r,l.condition="Global",l.cal="Abs",t.push(l)}var s=Number($("#input-cal-ultimate-fry").val());if(s){l={type:"Fry"};l.value=s,l.condition="Global",l.cal="Abs",t.push(l)}var n=Number($("#input-cal-ultimate-bake").val());if(n){l={type:"Bake"};l.value=n,l.condition="Global",l.cal="Abs",t.push(l)}var o=Number($("#input-cal-ultimate-steam").val());if(o){l={type:"Steam"};l.value=o,l.condition="Global",l.cal="Abs",t.push(l)}var p=Number($("#input-cal-ultimate-male-skill").val());if(p){var d={type:"Stirfry"};d.value=p,d.condition="Global",d.cal="Abs",d.tag=1,t.push(d);var u={type:"Boil"};u.value=p,u.condition="Global",u.cal="Abs",u.tag=1,t.push(u);var f={type:"Knife"};f.value=p,f.condition="Global",f.cal="Abs",f.tag=1,t.push(f);var h={type:"Fry"};h.value=p,h.condition="Global",h.cal="Abs",h.tag=1,t.push(h);var m={type:"Bake"};m.value=p,m.condition="Global",m.cal="Abs",m.tag=1,t.push(m);var v={type:"Steam"};v.value=p,v.condition="Global",v.cal="Abs",v.tag=1,t.push(v)}var b=Number($("#input-cal-ultimate-female-skill").val());if(b){d={type:"Stirfry"};d.value=b,d.condition="Global",d.cal="Abs",d.tag=2,t.push(d);u={type:"Boil"};u.value=b,u.condition="Global",u.cal="Abs",u.tag=2,t.push(u);f={type:"Knife"};f.value=b,f.condition="Global",f.cal="Abs",f.tag=2,t.push(f);h={type:"Fry"};h.value=b,h.condition="Global",h.cal="Abs",h.tag=2,t.push(h);m={type:"Bake"};m.value=b,m.condition="Global",m.cal="Abs",m.tag=2,t.push(m);v={type:"Steam"};v.value=b,v.condition="Global",v.cal="Abs",v.tag=2,t.push(v)}var g=Number($("#input-cal-ultimate-1-limit").val());if(g){l={type:"MaxEquipLimit"};l.value=g,l.condition="Global",l.cal="Abs",l.rarity=1,t.push(l)}var k=Number($("#input-cal-ultimate-2-limit").val());if(k){l={type:"MaxEquipLimit"};l.value=k,l.condition="Global",l.cal="Abs",l.rarity=2,t.push(l)}var y=Number($("#input-cal-ultimate-3-limit").val());if(y){l={type:"MaxEquipLimit"};l.value=y,l.condition="Global",l.cal="Abs",l.rarity=3,t.push(l)}var D=Number($("#input-cal-ultimate-4-limit").val());if(D){l={type:"MaxEquipLimit"};l.value=D,l.condition="Global",l.cal="Abs",l.rarity=4,t.push(l)}var x=Number($("#input-cal-ultimate-5-limit").val());if(x){l={type:"MaxEquipLimit"};l.value=x,l.condition="Global",l.cal="Abs",l.rarity=5,t.push(l)}var w=Number($("#input-cal-ultimate-1-price").val());if(w){l={type:"UseAll"};l.value=w,l.condition="Global",l.cal="Percent",l.rarity=1,t.push(l)}var T=Number($("#input-cal-ultimate-2-price").val());if(T){l={type:"UseAll"};l.value=T,l.condition="Global",l.cal="Percent",l.rarity=2,t.push(l)}var q=Number($("#input-cal-ultimate-3-price").val());if(q){l={type:"UseAll"};l.value=q,l.condition="Global",l.cal="Percent",l.rarity=3,t.push(l)}var S=Number($("#input-cal-ultimate-4-price").val());if(S){l={type:"UseAll"};l.value=S,l.condition="Global",l.cal="Percent",l.rarity=4,t.push(l)}var C=Number($("#input-cal-ultimate-5-price").val());if(C){l={type:"UseAll"};l.value=C,l.condition="Global",l.cal="Percent",l.rarity=5,t.push(l)}var R=$("#chk-cal-partial-ultimate").val();for(var E in R)R[E]=Number(R[E]);var I=getPartialUltimateData(a.chefs,a.partialSkill,!0,R),N=$("#chk-cal-self-ultimate").val();for(var E in N)N[E]=Number(N[E]);var M=getSelfUltimateData(a.chefs,a.skills,!0,N),A=getActivityConfigData(e);e.calGlobalUltimateData=t,e.calPartialChefIds=R,e.calSelfUltimateData=M,e.calActivityUltimateData=A;var O=$("#chk-cal-ex").val();for(var E in O)O[E]=Number(O[E]);for(var E in e.menus){var G=O.indexOf(e.menus[E].recipe.data.recipeId)>=0;setDataForRecipe(e.menus[E].recipe.data,t,G,A,!0,e);var P=getRecipeQuantity(e.menus[E].recipe.data,e.materials,e),V=getRecipeResult(null,null,e.menus[E].recipe.data,P,P,e.materials,e,e.decorationEffect,null,!1,buildRecipeMenu(e.menus[E].recipe.data),null);V.available=P,V.availableScore=Math.ceil(+(V.totalScore/V.max*P).toFixed(2)),e.menus[E].recipe=V}for(var E in e.chefs)setDataForChef(e.chefs[E],null,!1,t,I,null,M,A,!0,e)}function getActivityConfigData(e){var a=[];if(e.IsActivity){var t=Number($("#input-cal-activity-stirfry").val());if(t){var i={type:"Stirfry"};i.value=t,i.condition="Global",i.cal="Abs",a.push(i)}var l=Number($("#input-cal-activity-boil").val());if(l){i={type:"Boil"};i.value=l,i.condition="Global",i.cal="Abs",a.push(i)}var c=Number($("#input-cal-activity-knife").val());if(c){i={type:"Knife"};i.value=c,i.condition="Global",i.cal="Abs",a.push(i)}var r=Number($("#input-cal-activity-fry").val());if(r){i={type:"Fry"};i.value=r,i.condition="Global",i.cal="Abs",a.push(i)}var s=Number($("#input-cal-activity-bake").val());if(s){i={type:"Bake"};i.value=s,i.condition="Global",i.cal="Abs",a.push(i)}var n=Number($("#input-cal-activity-steam").val());if(n){i={type:"Steam"};i.value=n,i.condition="Global",i.cal="Abs",a.push(i)}var o=Number($("#input-cal-activity-1-limit").val());if(o){i={type:"MaxEquipLimit"};i.value=o,i.condition="Global",i.cal="Abs",i.rarity=1,a.push(i)}var p=Number($("#input-cal-activity-2-limit").val());if(p){i={type:"MaxEquipLimit"};i.value=p,i.condition="Global",i.cal="Abs",i.rarity=2,a.push(i)}var d=Number($("#input-cal-activity-3-limit").val());if(d){i={type:"MaxEquipLimit"};i.value=d,i.condition="Global",i.cal="Abs",i.rarity=3,a.push(i)}var u=Number($("#input-cal-activity-4-limit").val());if(u){i={type:"MaxEquipLimit"};i.value=u,i.condition="Global",i.cal="Abs",i.rarity=4,a.push(i)}var f=Number($("#input-cal-activity-5-limit").val());if(f){i={type:"MaxEquipLimit"};i.value=f,i.condition="Global",i.cal="Abs",i.rarity=5,a.push(i)}var h=Number($("#input-cal-activity-stirfry-price").val());if(h){i={type:"UseStirfry"};i.value=h,i.condition="Global",i.cal="Percent",a.push(i)}var m=Number($("#input-cal-activity-boil-price").val());if(m){i={type:"UseBoil"};i.value=m,i.condition="Global",i.cal="Percent",a.push(i)}var v=Number($("#input-cal-activity-knife-price").val());if(v){i={type:"UseKnife"};i.value=v,i.condition="Global",i.cal="Percent",a.push(i)}var b=Number($("#input-cal-activity-fry-price").val());if(b){i={type:"UseFry"};i.value=b,i.condition="Global",i.cal="Percent",a.push(i)}var g=Number($("#input-cal-activity-bake-price").val());if(g){i={type:"UseBake"};i.value=g,i.condition="Global",i.cal="Percent",a.push(i)}var k=Number($("#input-cal-activity-steam-price").val());if(k){i={type:"UseSteam"};i.value=k,i.condition="Global",i.cal="Percent",a.push(i)}var y=Number($("#input-cal-activity-vegetable-price").val());if(y){i={type:"UseVegetable"};i.value=y,i.condition="Global",i.cal="Percent",a.push(i)}var D=Number($("#input-cal-activity-meat-price").val());if(D){i={type:"UseMeat"};i.value=D,i.condition="Global",i.cal="Percent",a.push(i)}var x=Number($("#input-cal-activity-creation-price").val());if(x){i={type:"UseCreation"};i.value=x,i.condition="Global",i.cal="Percent",a.push(i)}var w=Number($("#input-cal-activity-fish-price").val());if(w){i={type:"UseFish"};i.value=w,i.condition="Global",i.cal="Percent",a.push(i)}var T=Number($("#input-cal-activity-sweet-price").val());if(T){i={type:"UseSweet"};i.value=T,i.condition="Global",i.cal="Percent",a.push(i)}var q=Number($("#input-cal-activity-sour-price").val());if(q){i={type:"UseSour"};i.value=q,i.condition="Global",i.cal="Percent",a.push(i)}var S=Number($("#input-cal-activity-spicy-price").val());if(S){i={type:"UseSpicy"};i.value=S,i.condition="Global",i.cal="Percent",a.push(i)}var C=Number($("#input-cal-activity-salty-price").val());if(C){i={type:"UseSalty"};i.value=C,i.condition="Global",i.cal="Percent",a.push(i)}var R=Number($("#input-cal-activity-bitter-price").val());if(R){i={type:"UseBitter"};i.value=R,i.condition="Global",i.cal="Percent",a.push(i)}var E=Number($("#input-cal-activity-tasty-price").val());if(E){i={type:"UseTasty"};i.value=E,i.condition="Global",i.cal="Percent",a.push(i)}var I=Number($("#input-cal-activity-gold-price").val());if(I){i={type:"Gold_Gain"};i.value=I,i.condition="Global",i.cal="Percent",a.push(i)}}return a}function loadRule(e,a){a.DisableDecorationEffect?$("#input-cal-decoration").prop("disabled",!0):$("#input-cal-decoration").prop("disabled",!1),a.IsActivity?$("#cal-activity").show():$("#cal-activity").hide();var t=JSON.parse(JSON.stringify(e.recipes)),i=JSON.parse(JSON.stringify(e.chefs)),l=JSON.parse(JSON.stringify(e.equips)),c=JSON.parse(JSON.stringify(e.materials));for(var r in a.MaterialsEffect)for(var s in c)if(c[s].materialId==a.MaterialsEffect[r].MaterialID){c[s].addition=+(Number(c[s].addition)+a.MaterialsEffect[r].Effect).toFixed(2);break}var n=[];if(a.hasOwnProperty("MaterialsNum")){for(var r in a.MaterialsNum)for(var s in c)if(c[s].materialId==a.MaterialsNum[r].MaterialID){1!=a.MaterialsNum[r].Num&&(c[s].quantity=a.MaterialsNum[r].Num),n.push(c[s]);break}}else for(var r in c)n.push(c[r]);var o=[];for(var r in t)if(!(t[r].hide||a.hasOwnProperty("CookbookRarityLimit")&&t[r].rarity>a.CookbookRarityLimit)){var p=getRecipeQuantity(t[r],n,a);if(0!=p){if(a.hasOwnProperty("RecipesTagsEffect"))for(var s in t[r].tags)for(var d in a.RecipesTagsEffect)t[r].tags[s]==a.RecipesTagsEffect[d].TagID&&(t[r].addition=+(Number(t[r].addition)+a.RecipesTagsEffect[d].Effect).toFixed(2));for(var d in a.RecipesEffect)t[r].recipeId==a.RecipesEffect[d].RecipeID&&(t[r].addition=+(Number(t[r].addition)+a.RecipesEffect[d].Effect).toFixed(2));for(var d in a.RecipesSkillsEffect)("stirfry"==a.RecipesSkillsEffect[d].Skill&&t[r].stirfry>0||"boil"==a.RecipesSkillsEffect[d].Skill&&t[r].boil>0||"knife"==a.RecipesSkillsEffect[d].Skill&&t[r].knife>0||"fry"==a.RecipesSkillsEffect[d].Skill&&t[r].fry>0||"bake"==a.RecipesSkillsEffect[d].Skill&&t[r].bake>0||"steam"==a.RecipesSkillsEffect[d].Skill&&t[r].steam>0)&&(t[r].addition=+(Number(t[r].addition)+a.RecipesSkillsEffect[d].Effect).toFixed(2));o.push(t[r])}}var u=[];for(var r in i)if(!(i[r].hide||a.hasOwnProperty("ChefRarityLimit")&&i[r].rarity>a.ChefRarityLimit)){var f=!1;if(a.hasOwnProperty("EnableChefTags")){for(var s in a.EnableChefTags)if(i[r].tags.indexOf(a.EnableChefTags[s])>=0){f=!0;break}}else f=!0;if(f){if(a.hasOwnProperty("ChefsTagsEffect"))for(var s in i[r].tags)for(var d in a.ChefsTagsEffect)i[r].tags[s]==a.ChefsTagsEffect[d].TagID&&(i[r].addition=+(Number(i[r].addition)+a.ChefsTagsEffect[d].Effect).toFixed(2));u.push(i[r])}}var h=[];for(var r in l)l[r].hide||h.push(l[r]);a.recipes=o,a.chefs=u,a.equips=h,a.materials=n,a.rest=n;var m=[];for(var s in a.recipes){p=getRecipeQuantity(a.recipes[s],a.materials,a);var v=getRecipeResult(null,null,a.recipes[s],p,p,a.materials,a,a.decorationEffect,null,!1,buildRecipeMenu(a.recipes[s]),null);v.available=p,v.availableScore=v.totalScore/v.max*p;var b={};b.recipe=v,m.push(b)}a.menus=m,a.hasOwnProperty("MaterialsEffect")||a.hasOwnProperty("ChefsTagsEffect")||a.hasOwnProperty("RecipesTagsEffect")||a.hasOwnProperty("RecipesSkillsEffect")||a.hasOwnProperty("RecipesEffect")?a.hasRuleAddition=!0:a.hasRuleAddition=!1,"正常营业"==a.Title?(a.showTime=!0,a.showEff=!0,$('#select-cal-order option[value="分数"]').siblings().removeAttr("disabled")):(a.showTime=!1,a.showEff=!1,$("#select-cal-order").val("分数"),$('#select-cal-order option[value="分数"]').siblings().attr("disabled","disabled")),initCustomData(),calCustomResults(e),sortRecipesResult(),$("#cal-recipes-table").DataTable().clear().rows.add(m).draw(),initCalRecipesShow($("#cal-recipes-table").DataTable()),private&&($("#cal-chefs-table").DataTable().clear().rows.add(u).draw(),$("#btn-cal-chefs-deselect-all").click(),$("#cal-equips-table").DataTable().clear().rows.add(h).draw(),$("#btn-cal-equips-deselect-all").click(),$("#cal-materials-table").DataTable().clear().rows.add(n).draw(),$("#btn-cal-materials-select-all").click())}function initCustomData(){customData=[];for(var e=0;e<3;e++){for(var a={chef:{},equip:{},condiment:{},recipes:[]},t=0;t<3;t++){var i={};a.recipes.push(i)}customData.push(a)}}function setCustomChef(e,a){if(a){for(var t in currentRule.chefs)if(currentRule.chefs[t].chefId==a){customData[e].chef=JSON.parse(JSON.stringify(currentRule.chefs[t]));break}}else customData[e].chef={}}function setCustomEquip(e,a){customData[e].equip=a?getEquipInfo(a,currentRule.equips):{}}function setCustomCondiment(e,a,t){customData[e].condiment=a?getCondimentInfo(a,t.condiments):{}}function setCustomRecipe(e,a,t){if(customData[e].recipes[a]={},t)for(var i in currentRule.menus)if(currentRule.menus[i].recipe.data.recipeId==t){var l=currentRule.menus[i].recipe.available,c={};c.data=currentRule.menus[i].recipe.data,c.quantity=l,customData[e].recipes[a]=c;break}}function updateCustomRecipeCondiment(e,a,t){var i=$(".selected-item:eq("+e+") .recipe-box:eq("+a+") .recipe-condiment input");t?i.bootstrapToggle("on"):i.bootstrapToggle("off")}function calCustomResults(e){var a=[];for(var t in customData)customData[t].chef.chefId&&a.indexOf(customData[t].chef.chefId)<0&&currentRule.calPartialChefIds.indexOf(customData[t].chef.chefId)>=0&&a.push(customData[t].chef.chefId);var i=getPartialUltimateData(e.chefs,e.partialSkill,!0,a);for(var t in customData){for(var l in customData[t].recipes)if(customData[t].recipes[l].data)for(var c in currentRule.menus)if(currentRule.menus[c].recipe.data.recipeId==customData[t].recipes[l].data.recipeId){customData[t].recipes[l].data=currentRule.menus[c].recipe.data,customData[t].recipes[l].max=currentRule.menus[c].recipe.max;break}if(customData[t].chef.chefId)for(var c in setDataForChef(customData[t].chef,customData[t].equip,!0,currentRule.calGlobalUltimateData,i,i,currentRule.calSelfUltimateData,currentRule.calActivityUltimateData,!0,currentRule),i)customData[t].chef.chefId==i[c].chefId&&updateConditionMatch(i[c].effect,customData[t].chef,null,null,customData[t].recipes)}var r=0,s=0,n=0,o=0,p=1;currentRule&&currentRule.hasOwnProperty("scoreMultiply")&&(p=currentRule.scoreMultiply);var d=1;currentRule&&currentRule.hasOwnProperty("scorePow")&&(d=currentRule.scorePow);var u=0;for(var t in currentRule.hasOwnProperty("scoreAdd")&&(u=currentRule.scoreAdd),customData)for(var l in customData[t].recipes)if(customData[t].recipes[l].data){var f=$(".selected-item:eq("+t+") .recipe-box:eq("+l+") .recipe-condiment input").prop("checked"),h=getRecipeResult(customData[t].chef,customData[t].equip,customData[t].recipes[l].data,customData[t].recipes[l].quantity,customData[t].recipes[l].max,currentRule.materials,currentRule,currentRule.decorationEffect,f?customData[t].condiment:null,!0,customData[t].recipes,i);if(customData[t].recipes[l]=h,o+=h.totalTime,r+=h.totalPrice,s+=h.totalBonusScore,n+=Math.ceil(+(h.totalScore*(1+h.data.activityAddition/100)).toFixed(2)),0==h.rankVal){var m=getSkillDiff(customData[t].chef,customData[t].recipes[l].data,1);customData[t].recipes[l].skillDiff=m.disp}}r=Math.ceil(+(Math.pow(r,d)*p).toFixed(2)),n=Math.ceil(+(Math.pow(n,d)*p).toFixed(2)),r&&(r+=u,n+=u);var v=checkMaterials(currentRule.materials);for(var t in customData)for(var l in customData[t].recipes)if(customData[t].recipes[l].data){var b=getRecipeQuantity(customData[t].recipes[l].data,v.materials,currentRule),g=customData[t].recipes[l].max-customData[t].recipes[l].quantity;b>g&&(b=g),customData[t].recipes[l].available=b;var k=$(".selected-item:eq("+t+") .recipe-box:eq("+l+") .recipe-quantity");k.find("input").attr("max",customData[t].recipes[l].max).val(customData[t].recipes[l].quantity),k.find(".max").html(customData[t].recipes[l].max),currentRule.hasOwnProperty("MaterialsNum")&&k.find(".available").html(b>0?"("+b+")":"")}for(var t in currentRule.rest=v.materials,updateCalMenus(),customData){var y="";y=customData[t].chef.chefId?customData[t].chef.disp:"+ 厨师",$(".selected-item:eq("+t+") .chef-box .content").html(y);var D="";D=customData[t].equip.equipId?customData[t].equip.disp:"+ 厨具",$(".selected-item:eq("+t+") .equip-box .content").html(D);var x=0;for(var l in customData[t].recipes){k=$(".selected-item:eq("+t+") .recipe-box:eq("+l+")");if(customData[t].recipes[l].data){var w=customData[t].recipes[l];k.find(".recipe-name").html(w.data.name);var T="<div>"+w.score+"*"+w.quantity+"=<span class='score'>"+w.totalScore+"</span></div>";T+=w.skillDiff?"<div class='red'>"+w.skillDiff+"</div>":"",currentRule.showTime&&(T+="<div>"+w.totalTimeDisp+"</div>"),k.find(".recipe-result").html(T);var q="<div class='skill'>";q+="<span>"+w.data.condimentDisp+"</span>",q+=w.data.skillDisp,q+="</div>",q+="<div class='material'>",q+=w.data.calMaterialsDisp,q+="</div>",q+="<div class='rank'>"+(w.rankDisp?w.rankDisp:"<span class='red'>—</span>")+(w.rankAdditionDisp?w.rankAdditionDisp:"")+"</div>",q+="<div class='add'>",q+="<span>技能"+(w.chefSkillAdditionDisp?w.chefSkillAdditionDisp:"")+"</span>",q+="<span>厨具"+(w.equipSkillAdditionDisp?w.equipSkillAdditionDisp:"")+"</span>",currentRule.hasOwnProperty("DisableCondimentEffect")&&0!=currentRule.DisableCondimentEffect||(q+="<span>调料"+w.condimentSkillAdditionDisp+"</span>"),q+="<span>规则"+w.bonusAdditionDisp+"</span>",q+="<span>修炼"+w.data.ultimateAdditionDisp+"</span>",currentRule.hasOwnProperty("DisableDecorationEffect")&&0!=currentRule.DisableDecorationEffect?currentRule.calActivityUltimateData.length>0&&(q+="<span>奇珍"+w.data.activityAdditionDisp+"</span>"):q+="<span>装饰"+w.decorationAdditionDisp+"</span>",q+="<span>基础"+w.basicAdditionDisp+"</span>",q+="<span>在场"+w.partialAdditionDisp+"</span>",q+="</div>",k.find(".recipe-box-2").html(q),k.find(".recipe-placeholder").addClass("hidden"),w.useCondiment&&(x+=w.data.rarity*w.quantity)}else k.find(".recipe-placeholder").html("+ 菜谱").removeClass("hidden")}var S="";if(customData[t].condiment.condimentId){if(S=customData[t].condiment.calDisp,x){var C=S.indexOf("</small>");S=S.substring(0,C)+"*"+x+S.substring(C,S.length)}}else S="+ 调料";$(".selected-item:eq("+t+") .condiment-box .content").html(S)}var R="原售价："+r;if(currentRule.hasRuleAddition&&!currentRule.hasOwnProperty("scoreMultiply")&&(R+=" 规则分："+s),R+=" 总得分："+n,currentRule.showTime){var E=0;for(var t in customData)if(customData[t].chef.chefId&&(currentRule&&currentRule.hasOwnProperty("DisableChefSkillEffect")&&0!=currentRule.DisableChefSkillEffect||(E+=getTimeAddition(customData[t].chef.specialSkillEffect)),(!currentRule||!currentRule.hasOwnProperty("DisableEquipSkillEffect")||0==currentRule.DisableEquipSkillEffect)&&customData[t].equip&&customData[t].equip.effect)){var I=updateEquipmentEffect(customData[t].equip.effect,customData[t].chef.selfUltimateEffect);E+=getTimeAddition(I)}for(var t in i)E+=getTimeAddition(i[t].effect);0!=+E.toFixed(2)&&(R+=" 原时间："+(secondsToTime(o)||0));var N=Math.ceil(+(o*(1+E/100)).toFixed(2));R+=" 总时间："+(secondsToTime(N)||0);var M=0;N>0&&(M=Math.floor(3600*n/N)),R+=" 总效率："+M+"金币/小时"}if(v.lackIds.length)for(var t in R+=" ("+v.message+")",v.lackIds)$("#pane-cal-custom .selected-item .recipe-box-2 .material span[data-id='"+v.lackIds[t]+"']").addClass("red");$("#pane-cal-custom .selected-sum").html(R)}function getCustomChefsOptions(e,a){var t=$("#chk-cal-got").prop("checked"),i=$("#chk-cal-use-equip").prop("checked"),l=!1;for(var c in customData[e].recipes)if(customData[e].recipes[c].data){l=!0;break}var r=JSON.parse(JSON.stringify(customData)),s=[];for(var n in r)n!=e&&r[n].chef.chefId&&s.indexOf(r[n].chef.chefId)<0&&currentRule.calPartialChefIds.indexOf(r[n].chef.chefId)>=0&&s.push(r[n].chef.chefId);var o=[],p=JSON.parse(JSON.stringify(currentRule.chefs));for(var n in p)if(!t||p[n].got){r[e].chef=p[n];var d={};if(d.display=p[n].name,d.value=p[n].chefId,d.content="<span class='name'>"+p[n].name+"</span>",l){var u=JSON.parse(JSON.stringify(s));u.indexOf(p[n].chefId)<0&&currentRule.calPartialChefIds.indexOf(p[n].chefId)>=0&&u.push(p[n].chefId);var f=getPartialUltimateData(a.chefs,a.partialSkill,!0,u);i&&(r[e].equip=p[n].equip),setDataForChef(r[e].chef,r[e].equip,!0,currentRule.calGlobalUltimateData,f,f,currentRule.calSelfUltimateData,currentRule.calActivityUltimateData,!0,currentRule);var h=JSON.parse(JSON.stringify(r[e].chef));for(var c in r[e].recipes)r[e].recipes[c].data&&addCheffSkillDiff(h,r[e].recipes[c].data);var m=getChefSillDiff(h,r[e].chef);for(var v in""!=m&&(d.content+="<span class='skill'>"+m+"</span>",d.class="warning-skill"),r[e].chef=h,r)for(var b in f)r[v].chef.chefId==f[b].chefId&&updateConditionMatch(f[b].effect,r[v].chef,null,null,r[v].recipes);var g=0;for(var v in r)for(var b in r[v].recipes)if(r[v].recipes[b].data){var k=getRecipeResult(r[v].chef,r[v].equip,r[v].recipes[b].data,r[v].recipes[b].quantity,r[v].recipes[b].max,currentRule.materials,currentRule,currentRule.decorationEffect,r[v].recipes[b].useCondiment?r[v].condiment:null,!0,r[v].recipes,f);g+=k.totalScore}d.content+="<span class='score'>"+g+"</span>",d.order=g}else d.order=p[n].rarity;for(var b in customData)if(customData[b].chef.chefId==p[n].chefId){d.disabled=!0;break}customData[e].chef.chefId==p[n].chefId&&(d.selected=!0),o.push(d)}
o.sort(function(e,a){return a.order-e.order});d={display:"选择厨师",value:"",class:"hidden"};return o.unshift(d),o}function getCustomEquipsOptions(e,a,t){var i=!1;for(var l in customData[e].recipes)if(customData[e].recipes[l].data){i=!0;break}var c=JSON.parse(JSON.stringify(customData)),r=[];for(var s in c)c[s].chef.chefId&&r.indexOf(c[s].chef.chefId)<0&&currentRule.calPartialChefIds.indexOf(c[s].chef.chefId)>=0&&r.push(c[s].chef.chefId);var n=getPartialUltimateData(t.chefs,t.partialSkill,!0,r),o=[];for(var s in a){var p=a[s].skillDisp.replace(/<br>/g," "),d={};if(d.display=a[s].name,d.value=a[s].equipId,d.content="<span class='name'>"+a[s].name+"</span>",d.tokens=a[s].name+p,c[e].chef.chefId&&i){c[e].equip=a[s],setDataForChef(c[e].chef,c[e].equip,!0,currentRule.calGlobalUltimateData,n,n,currentRule.calSelfUltimateData,currentRule.calActivityUltimateData,!0,currentRule);var u=JSON.parse(JSON.stringify(c[e].chef));for(var l in c[e].recipes)c[e].recipes[l].data&&addCheffSkillDiff(u,c[e].recipes[l].data);var f=getChefSillDiff(u,c[e].chef);for(var h in""!=f&&(d.content+="<span class='skill'>"+f+"</span>",d.class="warning-skill"),c[e].chef=u,c)for(var m in n)c[h].chef.chefId==n[m].chefId&&updateConditionMatch(n[m].effect,c[h].chef,null,null,c[h].recipes);var v=0;for(var h in c)for(var m in c[h].recipes)if(c[h].recipes[m].data){var b=getRecipeResult(c[h].chef,c[h].equip,c[h].recipes[m].data,c[h].recipes[m].quantity,c[h].recipes[m].max,currentRule.materials,currentRule,currentRule.decorationEffect,c[h].recipes[m].useCondiment?c[h].condiment:null,!0,c[h].recipes,n);v+=b.totalScore}d.content+="<span class='score'>"+v+"</span>",d.order=v}d.content+="<span class='subtext'>"+p+"</span>",customData[e].equip.equipId==a[s].equipId&&(d.selected=!0),o.push(d)}o.sort(function(e,a){return a.order-e.order});d={display:"无厨具",value:"",class:"hidden"};return o.unshift(d),o}function getCustomCondimentsOptions(e,a,t){var i=!1;for(var l in customData[e].recipes)if(customData[e].recipes[l].useCondiment){i=!0;break}var c=JSON.parse(JSON.stringify(customData)),r=[];for(var s in c)c[s].chef.chefId&&r.indexOf(c[s].chef.chefId)<0&&currentRule.calPartialChefIds.indexOf(c[s].chef.chefId)>=0&&r.push(c[s].chef.chefId);var n=getPartialUltimateData(t.chefs,t.partialSkill,!0,r);for(var o in c)for(var p in n)c[o].chef.chefId==n[p].chefId&&updateConditionMatch(n[p].effect,c[o].chef,null,null,c[o].recipes);var d=[];for(var s in a){var u=a[s].skillDisp.replace(/<br>/g," "),f={};if(f.display=a[s].name,f.value=a[s].condimentId,f.content="<span class='name'>"+a[s].name+"</span>",f.content+="<span class='subtext'>"+a[s].rarityDisp+"</span>",f.tokens=a[s].name+u,i){c[e].condiment=a[s];var h=0;for(var o in c)for(var p in c[o].recipes)if(c[o].recipes[p].data){var m=getRecipeResult(c[o].chef,c[o].equip,c[o].recipes[p].data,c[o].recipes[p].quantity,c[o].recipes[p].max,currentRule.materials,currentRule,currentRule.decorationEffect,c[o].recipes[p].useCondiment?c[o].condiment:null,!0,c[o].recipes,n);h+=m.totalScore}f.content+="<span class='score'>"+h+"</span>",f.order=h}f.content+="<span class='subtext'>"+u+"</span>",customData[e].condiment.condimentId==a[s].condimentId&&(f.selected=!0),d.push(f)}i&&d.sort(function(e,a){return a.order-e.order});f={display:"无调料",value:"",class:"hidden"};return d.unshift(f),d}function getCustomRecipesOptions(e,a,t){var i=$("#select-cal-order").val(),l=$("#chk-cal-got").prop("checked"),c=$(".selected-item:eq("+e+") .recipe-box:eq("+a+") .recipe-condiment input").prop("checked"),r=JSON.parse(JSON.stringify(customData)),s=[];for(var n in r)r[n].chef.chefId&&s.indexOf(r[n].chef.chefId)<0&&currentRule.calPartialChefIds.indexOf(r[n].chef.chefId)>=0&&s.push(r[n].chef.chefId);var o=getPartialUltimateData(t.chefs,t.partialSkill,!0,s),p=[];for(var d in currentRule.menus){var u=currentRule.menus[d].recipe;if(!l||u.data.got){var f={};for(var h in f.display=u.data.name,f.value=u.data.recipeId,f.content="<span class='name'>"+u.data.name+"</span>",r[e].recipes[a]=u,r[e].recipes[a].useCondiment=c,r[e].recipes[a].quantity=u.available,r)for(var m in o)r[h].chef.chefId==o[m].chefId&&updateConditionMatch(o[m].effect,r[h].chef,null,null,r[h].recipes);var v=0,b=u.totalScore,g=u.efficiency,k="";for(var h in r)for(var m in r[h].recipes)if(r[h].recipes[m].data){var y=getRecipeResult(r[h].chef,r[h].equip,r[h].recipes[m].data,r[h].recipes[m].quantity,r[h].recipes[m].max,currentRule.materials,currentRule,currentRule.decorationEffect,r[h].recipes[m].useCondiment?r[h].condiment:null,!0,r[h].recipes,o);if(v+=y.totalScore,h==e&&m==a&&(y=getRecipeResult(r[h].chef,r[h].equip,r[h].recipes[m].data,r[h].recipes[m].max,r[h].recipes[m].max,currentRule.materials,currentRule,currentRule.decorationEffect,r[h].recipes[m].useCondiment?r[h].condiment:null,!0,r[h].recipes,o),b=y.totalScore,g=y.efficiency,0==y.rankVal)){var D=getSkillDiff(r[e].chef,u.data,1);k=D.disp}}if(f.class="",""!=k&&(f.content+="<span class='skill'>"+k+"</span>",f.class+="warning-skill"),currentRule.hasOwnProperty("MaterialsNum")){var x=b/u.max*u.available;u.available<u.max?f.content+="<span class='available'>"+u.available+"/"+u.max+" "+x+"/"+b+"</span><span class='total'>"+v+"</span>":f.content+="<span class='subtext'>"+u.available+"/"+u.max+" "+x+"</span><span class='total'>"+v+"</span>",f.order=v}else"分数"==i?(f.content+="<span class='score'>"+b+"</span><span class='total'>"+v+"</span>",f.order=v):"时间"==i?(f.content+="<span class='score'>"+u.data.totalTimeDisp+"</span>",f.order=u.data.totalTime):"效率"==i&&(f.content+="<span class='score'>"+g+"</span>",f.order=g);for(var m in f.content+="<span class='skilltext'>"+getSkillDisp(u.data)+"</span><span class='subtext'>"+u.data.condimentDisp+"</span><span class='subtext'>"+u.data.materialsDisp.replace(/\*/g,"")+"</span>",customData)for(var h in customData[m].recipes)if(customData[m].recipes[h].data&&customData[m].recipes[h].data.recipeId==u.data.recipeId){f.disabled=!0;break}customData[e].recipes[a].data&&customData[e].recipes[a].data.recipeId==u.data.recipeId&&(f.selected=!0),p.push(f)}}p.sort(function(e,a){return a.order-e.order});f={display:"无菜谱",value:"",class:"hidden"};return p.unshift(f),p}function updateCalMenus(){for(var e in currentRule.menus){var a=getRecipeQuantity(currentRule.menus[e].recipe.data,currentRule.rest,currentRule);for(var t in customData)for(var i in customData[t].recipes)if(customData[t].recipes[i].data&&currentRule.menus[e].recipe.data.recipeId==customData[t].recipes[i].data.recipeId){var l=currentRule.menus[e].recipe.max-customData[t].recipes[i].quantity;a>l&&(a=l)}currentRule.menus[e].recipe.available=a,currentRule.menus[e].recipe.availableScore=Math.ceil(+(currentRule.menus[e].recipe.totalScore/currentRule.menus[e].recipe.max*a).toFixed(2))}}function calRecipesResults(){var e=$("#cal-recipes-table").DataTable(),a=e.rows({order:"applied"}).data().toArray(),t=e.rows({selected:!0}).data().toArray();updateCalMenus(),e.clear().rows.add(a),$("#chk-cal-results-lock-order").prop("checked")&&e.order([]),e.rows(function(e,a,i){for(var l in t)if(a.recipe.data.recipeId==t[l].recipe.data.recipeId)return!0;return!1}).select(),e.draw()}function sortRecipesResult(){var e=7,a=$("#select-cal-order").val();"分数"==a?e=7:"时间"==a?e=9:"效率"==a&&(e=10);var t=!1,i=$("#cal-recipes-table").DataTable(),l=i.order();for(var c in l)if(l[c][0]==e&&"desc"==l[c][1]){t=!0;break}t||i.order([e,"desc"]).draw()}function checkMaterials(e){var a=JSON.parse(JSON.stringify(e));for(var t in customData)for(var i in customData[t].recipes){var l=customData[t].recipes[i];if(l.data)for(var c in l.data.materials)for(var r in a)l.data.materials[c].material==a[r].materialId&&Number.isInteger(parseInt(a[r].quantity))&&(a[r].quantity-=l.data.materials[c].quantity*l.quantity)}var s=[],n="";for(var r in a)a[r].quantity<0&&(s.push(a[r].materialId),n+=a[r].name+a[r].quantity);return{materials:a,lackIds:s,message:n}}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"name",width:"81px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:"gender",width:"30px"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"all",orderSequence:["desc","asc"],width:"38px"},{data:{_:"equipId",display:"equipDisp"},className:"cal-td-select-equip nodetails all",width:"101px"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#cal-chefs-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var c=5;c<=10;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-chefs-table"))+">"+i+"</div>"}}}});$("#pane-cal-chefs div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 性别">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;var c=$.trim($("#pane-cal-chefs .search-box input").val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.gender,c)||!!commaSeparatedMatch(i.tagsDisp,c))});var s=getEquipsOptions(e.equips,e.skills);r.MakeCellsEditable({columns:[16],inputTypes:[{column:16,type:"list",search:!0,clear:!0,done:!0,options:s}],onUpdate:function(a,t,i,l){if(16==i.index().column){var c=t.data(),s=null,n="";if(c.equipId)for(var o in e.equips)if(c.equipId==e.equips[o].equipId){s=e.equips[o],n=e.equips[o].disp;break}c.equip=s,c.equipDisp=n,t.data(c),r.draw(!1)}}}),$("#chk-cal-chefs-show").on("changed.bs.select",function(){initCalChefsShow(r)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?r.rows(".rarity-"+e).select():r.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){r.rows().every(function(e,a,t){var i=this.data();i.equip=null,i.equipId="",i.equipDisp="",this.data(i)})}),$("#pane-cal-chefs .search-box input").on("input",function(){r.draw(),changeInputStyle(this)}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),r.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),r.rows().deselect()}),$("#btn-cal-chefs-export").click(function(){var e=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),a={calChefs:[]};for(var t in e)a.calChefs.push(e[t].chefId);$("#input-export-import").val(JSON.stringify(a))}),initTableResponsiveDisplayEvent(r),initTableScrollEvent("#pane-cal-chefs"),initCalChefsShow(r)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"name",width:"80px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:"skillDisp"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#cal-equips-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[5,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-equips-table"))+">"+i+"</div>"}}}});$("#pane-cal-equips div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;var c=$.trim($("#pane-cal-equips .search-box input").val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.skillDisp,c)||!!commaSeparatedMatch(i.origin,c))}),$("#chk-cal-equips-show").on("changed.bs.select",function(){initCalEquipsShow(r)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?r.rows(".rarity-"+e).select():r.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").on("input",function(){r.draw(),changeInputStyle(this)}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-rarity input[type="checkbox"]').prop("checked",!0),r.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-rarity input[type="checkbox"]').prop("checked",!1),r.rows().deselect()}),$("#btn-cal-equips-export").click(function(){var e=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),a={calEquips:[]};for(var t in e)a.calEquips.push(e[t].equipId);$("#input-export-import").val(JSON.stringify(a))}),initTableResponsiveDisplayEvent(r),initTableScrollEvent("#pane-cal-equips"),initCalEquipsShow(r)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"materialId",width:"1px"},{data:"name",className:"all"},{data:"origin"},{data:"quantity",className:"all",orderSequence:["desc","asc"],width:"50px"},{data:"addition",className:"all",orderSequence:["desc","asc"],width:"50px"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var c="td:not(.nodetails)";expendBtn&&(c=".td-expend");var r=$("#cal-materials-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("origin-"+a.originVal)},responsive:{details:{type:"column",target:c,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-materials-table"))+">"+i+"</div>"}}}});$("#pane-cal-materials div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;var c=$.trim($("#pane-cal-materials .search-box input").val());return!!commaSeparatedMatch(i.name,c)||!!commaSeparatedMatch(i.origin,c)}),$("#chk-cal-materials-show").on("changed.bs.select",function(){initCalMaterialsShow(r)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?r.rows(".origin-"+e).select():r.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").on("input",function(){r.draw(),changeInputStyle(this)}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),r.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),r.rows().deselect()}),initTableResponsiveDisplayEvent(r),initTableScrollEvent("#pane-cal-materials"),initCalMaterialsShow(r)}function initCalCustomTable(e){var a=$(".selected-item .recipe-box")[0].outerHTML;$(".selected-item").append(a).append(a);var t=$(".selected-item")[0].outerHTML;if($(".selected-item-wrapper").append(t).append(t),$(".selected-item-wrapper .select-picker select").on("show.bs.select",function(e){$(this).closest(".selected-box").addClass("editing")}),$(".selected-item-wrapper .select-picker select").on("hide.bs.select",function(e){$(this).closest(".selected-box").removeClass("editing")}),$(".chef-box").click(function(){var a=$(this).closest(".selected-item").index(".selected-item"),t=getCustomChefsOptions(a,e);$(this).find("select.select-picker-chef").html(getOptionsString(t)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-chef").on("changed.bs.select",function(a,t,i,l){var c=$(this).closest(".selected-item").index(".selected-item"),r=$(this).val();if(setCustomChef(c,r),$("#chk-cal-use-equip").prop("checked")&&r)for(var s in currentRule.chefs)if(currentRule.chefs[s].chefId==r){setCustomEquip(c,currentRule.chefs[s].equipId);break}calCustomResults(e)}),$(".equip-box").click(function(){var a=$(this).closest(".selected-item").index(".selected-item"),t=getCustomEquipsOptions(a,currentRule.equips,e);$(this).find("select.select-picker-equip").html(getOptionsString(t)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-equip").on("changed.bs.select",function(a,t,i,l){var c=$(this).closest(".selected-item").index(".selected-item"),r=$(this).val();setCustomEquip(c,r),calCustomResults(e)}),$(".condiment-box").click(function(){var a=$(this).closest(".selected-item").index(".selected-item"),t=getCustomCondimentsOptions(a,e.condiments,e);$(this).find("select.select-picker-condiment").html(getOptionsString(t)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-condiment").on("changed.bs.select",function(a,t,i,l){var c=$(this).closest(".selected-item").index(".selected-item"),r=$(this).val();setCustomCondiment(c,r,e),calCustomResults(e)}),$(".recipe-box .recipe-placeholder, .recipe-box .recipe-name, .recipe-box .recipe-result, .recipe-box .recipe-box-2").click(function(){var a=$(this).closest(".selected-item").index(".selected-item"),t=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),i=getCustomRecipesOptions(a,t,e);$(this).closest(".recipe-box").find("select.select-picker-recipe").html(getOptionsString(i)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-recipe").on("changed.bs.select",function(a,t,i,l){var c=$(this).closest(".selected-item").index(".selected-item"),r=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),s=$(this).val();setCustomRecipe(c,r,s),calCustomResults(e),currentRule.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}),$(".recipe-box .recipe-quantity").click(function(){$(this).find("input").focus()}),$(".recipe-box .recipe-quantity input").on("input",function(){var a=$(this).closest(".selected-item").index(".selected-item"),t=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),i=$(this).val();customData[a].recipes[t].quantity=i,calCustomResults(e),currentRule.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}),$(".recipe-box .recipe-condiment input").bootstrapToggle(),$(".recipe-box .recipe-condiment input").change(function(){calCustomResults(e)}),private){var i,l,c;try{var r=localStorage.getItem("cal");i=JSON.parse(r)}catch(e){}for(var s in i||(i=[]),i)$("#select-cal-save").append("<option value='"+i[s].key+"'>"+i[s].key+"</option>").selectpicker("refresh");$(".btn-cal-results-cal").click(function(){c=[];var a=$("#pane-cal-optimal-results");if(void 0!==l&&(l.terminate(),l=void 0),$("#cal-save-result").addClass("hidden"),$("#select-cal-save").selectpicker("val",""),$(this).hasClass("stop"))return a.find(".cal-results-progress").addClass("hidden"),a.find(".btn-cal-results-cal.start").prop("disabled",!1),void a.find(".btn-cal-results-cal.stop").prop("disabled",!0);a.find(".optimal-result").html(""),a.find(".btn-cal-results-cal.start").prop("disabled",!0),a.find(".btn-cal-results-cal.stop").prop("disabled",!1),a.find(".cal-results-progress .progress-bar").css("width","0%"),a.find(".cal-results-progress .progress-bar span").text("预处理中"),a.find(".cal-results-progress").removeClass("hidden"),l=new Worker("others/js/cal.js?v="+(new Date).getTime()),l.onmessage=function(t){t.data.progress?(a.find(".cal-results-progress .progress-bar").css("width",t.data.progress.value+"%"),a.find(".cal-results-progress .progress-bar span").text(t.data.progress.display)):t.data.menu?(c=t.data.menu,showCalOptimalResult(c,e)):t.data.done?(a.find(".btn-cal-results-cal.stop").prop("disabled",!0),a.find(".btn-cal-results-cal.start").prop("disabled",!1),a.find(".cal-results-progress").addClass("hidden"),c.length&&$("#cal-save-result").removeClass("hidden")):t.data.error&&bootbox.alert({size:"small",message:"<div class='text-center'>"+t.data.error+"</div>"})};var t=$("#cal-recipes-table").DataTable().rows({selected:!0}).data().toArray(),i=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),r=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),s=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),n=$("#chk-cal-results-no-equips").prop("checked"),o=$("#chk-cal-results-add-equips").prop("checked"),p=$("#chk-cal-results-change-equips").prop("checked"),d=$("#chk-cal-results-filter-equip-condiment").prop("checked"),u=$("#chk-cal-results-use-condiment").prop("checked"),f=Number($("#input-cal-min-score").val()),h=Number($("#input-cal-thread").val()),m=$("#select-cal-type").val();l.postMessage({mode:m,rule:currentRule,custom:customData,recipes:t,chefs:i,equips:r,materials:s,odata:e,noEquips:n,addEquips:o,changeEquips:p,filterEquipCondiment:d,useCondiment:u,minScore:f,thread:h})}),$("#btn-cal-save").click(function(){var e=escapeHtml($("#input-cal-save-name").val());if(e.length){$("#cal-save-result").addClass("hidden"),$("#select-cal-save").append("<option value='"+e+"'>"+e+"</option>").selectpicker("refresh"),$("#select-cal-save").selectpicker("val",e);var a={};a.key=e,a.val=c,i.push(a);try{localStorage.setItem("cal",JSON.stringify(i))}catch(e){}$("#input-cal-save-name").val("")}else $("#input-cal-save-name").focus()}),$("#select-cal-save").change(function(){var a=$(this).val();for(var t in i)if(i[t].key==a){c=i[t].val,showCalOptimalResult(c,e),$("#cal-save-result").addClass("hidden");break}}),$("#btn-cal-save-clear").click(function(){bootbox.confirm({size:"small",message:"<div class='text-center'>确定清空保存?</div>",locale:"zh_CN",callback:function(e){if(e){$("#select-cal-save").html("").append("<option></option>").selectpicker("refresh"),i=[];try{localStorage.setItem("cal","")}catch(e){}}}})})}}function showCalOptimalResult(e,a){var t="<table class='table table-condensed'>";for(var i in t+="<tr><td>厨师</td><td>厨具</td><td>调料</td><td>菜谱</td></tr>",e){var l=e[i].menu;for(var c in l){for(var r in t+="<tr>",t+="<td>"+l[c].chef.name+"</td>",t+="<td>"+(l[c].equip.name?l[c].equip.name:"")+"</td>",t+="<td>"+(l[c].condiment.name?l[c].condiment.name:"")+"</td>",t+="<td>",l[c].recipes)t+=l[c].recipes[r].data.name+"["+l[c].recipes[r].data.condimentDisp+"]*"+l[c].recipes[r].quantity+" ";t+="</td>",t+="</tr>"}t+="<tr class='active'><td colspan='4'>",t+="分数: "+e[i].score,t+="<button data-id='"+i+"' class='btn btn-default btn-sm btn-cal-set-custom' type='button'>选择当前菜谱</button></td><tr>",t+="</td></tr>"}t+="</table>",$("#pane-cal-optimal-results").find(".optimal-result").html(t),$(".btn-cal-set-custom").click(function(){var t=Number($(this).attr("data-id")),i=JSON.parse(JSON.stringify(e[t].menu));for(var l in initCustomData(),i)for(var c in customData[l].chef=i[l].chef,customData[l].equip=i[l].equip,customData[l].condiment=i[l].condiment,i[l].recipes)customData[l].recipes[c]=i[l].recipes[c],updateCustomRecipeCondiment(l,c,customData[l].recipes[c].useCondiment);calCustomResults(a),currentRule.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")})}function initCalRecipesTable(){var e=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"recipe.data.galleryId",width:"1px"},{data:"recipe.data.icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"recipe.data.name",width:"86px",className:"all"},{data:"recipe.available",className:"all",orderSequence:["desc","asc"]},{data:"recipe.max",className:"all",orderSequence:["desc","asc"]},{data:"recipe.availableScore",className:"all",orderSequence:["desc","asc"]},{data:"recipe.totalScore",orderSequence:["desc","asc"]},{data:{_:"recipe.totalTime",display:"recipe.totalTimeDisp"}},{data:"recipe.efficiency",orderSequence:["desc","asc"]},{data:"recipe.bonusAdditionDisp",orderSequence:["desc","asc"]},{data:"recipe.data.ultimateAdditionDisp",orderSequence:["desc","asc"]},{data:"recipe.decorationAdditionDisp",orderSequence:["desc","asc"]},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"recipe.data.condiment",display:"recipe.data.condimentDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.stirfry",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.boil",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.knife",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.fry",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.bake",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.steam",width:"20px",orderSequence:["desc","asc"]},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"}},{data:{_:"recipe.data.price",display:"recipe.data.priceDisp"},width:"30px",orderSequence:["desc","asc"]},{data:"recipe.data.exPrice",orderSequence:["desc","asc"]},{data:{_:"recipe.data.time",display:"recipe.data.timeDisp"}},{data:"recipe.data.origin"},{data:"recipe.data.tagsDisp",defaultContent:"",visible:private,className:"none"}],a=!0,t=!1,i=!1;isMobile&&(a=!1,t=!0,i={left:[0,4]});var l="td:not(.nodetails)";expendBtn&&(l=".td-expend");var c=$("#cal-recipes-table").DataTable({data:[],columns:e,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[],deferRender:!1,autoWidth:!1,fixedHeader:a,scrollX:t,fixedColumns:i,responsive:{details:{type:"column",target:l,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;if(l>16&&l<=21)continue;if(16==l){i+="<div class='col-lg-3 col-xs-6'>";for(var c=16;c<=21;c++)t[c].data&&(i+="<span class='child-key'>"+t[c].title+"</span><span class='child-value'>"+t[c].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<4?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-recipes-table"))+">"+i+"</div>"}}}});$("#pane-cal-recipes div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 菜名 材料">'),$("#pane-cal-recipes .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;var c=$.trim($("#pane-cal-recipes .search-box input").val());return!!commaSeparatedMatch(i.recipe.data.name,c)||(!!commaSeparatedMatch(i.recipe.data.materialsVal,c)||!!commaSeparatedMatch(i.recipe.data.tagsDisp,c))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;var c=$("#chk-cal-got").prop("checked");return!!(!c||c&&i.recipe.data.got)}),$("#btn-cal-recipes-select-all").click(function(){c.rows().select()}),$("#btn-cal-recipes-deselect-all").click(function(){c.rows().deselect()}),$("#chk-cal-recipes-show").on("changed.bs.select",function(){initCalRecipesShow(c)}),initTableResponsiveDisplayEvent(c),initTableScrollEvent("#pane-cal-recipes"),initCalRecipesShow(c)}function generateData(e,a,t){var i={};if(a){for(var l in a.equips)a.equips[l].hide=!0;for(var l in a.decorations)a.decorations[l].hide=!0;for(var l in a.recipes)a.recipes[l].hide=!0;for(var l in a.chefs)a.chefs[l].hide=!0;e.guests=e.guests.concat(a.guests),e.equips=e.equips.concat(a.equips),e.decorations=e.decorations.concat(a.decorations),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs),e.skills=e.skills.concat(a.skills),e.maps=e.maps.concat(a.maps),e.rules=e.rules.concat(a.rules),e.activities=e.activities.concat(a.activities),i.ranks=a.ranks}i.maps=e.maps,i.activities=e.activities,i.guests=e.guests,i.history=e.history,i.skills=e.skills;var c=[];for(var l in e.skills){var r=!1;for(var s in e.skills[l].effect)if("Partial"==e.skills[l].effect[s].condition){r=!0;break}r&&c.push(e.skills[l])}i.partialSkill=c,i.rules=e.rules,i.decorationEffect=0,t&&t.decorationEffect&&(i.decorationEffect=t.decorationEffect),e.materials.sort(function(e,a){return e.origin.localeCompare(a.origin)});var n=[];for(var l in e.materials){
var o=e.materials[l];o.originVal=getOriginVal(e.materials[l].origin),o.addition="",o.quantity="",n.push(o)}i.materials=n;var p=[];for(var l in e.condiments){var d=e.condiments[l];d.rarityDisp=getRarityDisp(e.condiments[l].rarity);var u=getSkillInfo(e.skills,e.condiments[l].skill);d.skillDisp=u.skillDisp,d.skillSort=0,d.effect=u.skillEffect,d.icon="<div class='icon-condiment condiment_"+e.condiments[l].condimentId+"'></div>",d.calDisp="<span class='name'>"+e.condiments[l].name+"<small> "+d.rarityDisp+"</small></span><br><small>"+u.skillDisp+"</small>",p.push(d)}i.condiments=p;var f=[];for(var l in e.equips)if(e.equips[l].name){var h=e.equips[l];h.rarityDisp=getRarityDisp(e.equips[l].rarity);u=getSkillInfo(e.skills,e.equips[l].skill);h.skillDisp=u.skillDisp,h.skillSort=0,h.effect=u.skillEffect,h.disp="<span class='name'>"+e.equips[l].name+"</span><br><small>"+u.skillDisp+"</small>",e.equips[l].hide?h.icon="<div class='icon-equip2 equip_"+e.equips[l].equipId+"'></div>":h.icon="<div class='icon-equip equip_"+e.equips[l].equipId+"'></div>",f.push(h)}i.equips=f;var m=[],v=[];for(var l in e.decorations){var b=e.decorations[l];if(b.tipMin=b.tipMin||"-",b.tipMax=b.tipMax||"-",b.tipTimeDisp=secondsToTime(b.tipTime)||"-",b.tipTime&&(b.minEff=+(3600*b.tipMin*24/b.tipTime).toFixed(1),b.maxEff=+(3600*b.tipMax*24/b.tipTime).toFixed(1),b.avgEff=+((b.tipMin+b.tipMax)/2*3600*24/b.tipTime).toFixed(1)),b.goldDisp=getPercentDisp(+(100*b.gold).toFixed(2))||"-",b.suitDisp=b.suit||"-",b.suitGoldDisp=getPercentDisp(+(100*b.suitGold).toFixed(2))||"-",e.decorations[l].hide?b.icon="<div class='icon-decoration2 decoration_"+b.icon+"'></div>":b.icon="<div class='icon-decoration decoration_"+b.icon+"'></div>",v.push(b),b.suit){var g=!1;for(var s in m)if(m[s].name==b.suit){m[s].decorations.push(b.id),g=!0;break}if(!g){var k={};k.name=b.suit,k.gold=b.suitGold,k.decorations=[],k.decorations.push(b.id),m.push(k)}}}i.decorations=v,i.suits=m;var y=[];for(var l in e.quests)if(e.quests[l].goal){var D=e.quests[l];D.questIdDisp=e.quests[l].questIdDisp?e.quests[l].questIdDisp:e.quests[l].questId;var x="",w="";for(var s in e.quests[l].rewards)x+=e.quests[l].rewards[s].name,e.quests[l].rewards[s].quantity&&(x+="*"+e.quests[l].rewards[s].quantity),x+=" ",w+=e.quests[l].rewards[s].name;D.rewardsVal=w,D.rewardsDisp=x,y.push(D)}i.quests=y;var T=t&&t.setting&&t.setting.final,q=$("#chk-chef-apply-equips").prop("checked"),S=$("#chk-chef-apply-ultimate").prop("checked"),C=$("#chk-chef-apply-ultimate-person").prop("checked"),R=getUltimateData(e.chefs,t,e.skills,S,C);i.ultimateData=R;var E=[];for(var l in e.chefs)if(e.chefs[l].name){var I=e.chefs[l];I.addition="",I.rarityDisp=getRarityDisp(e.chefs[l].rarity),e.chefs[l].hide?I.icon="<div class='icon-chef2 chef_"+e.chefs[l].chefId+"'></div>":I.icon="<div class='icon-chef chef_"+e.chefs[l].chefId+"'></div>";u=getSkillInfo(e.skills,e.chefs[l].skill);if(I.specialSkillDisp=u.skillDisp,I.specialSkillEffect=u.skillEffect,I.tags=e.chefs[l].tags||[],I.tagsDisp="",a)for(var s in a.chefsTags)if(a.chefsTags[s].chefId==e.chefs[l].chefId){I.tags=a.chefsTags[s].tags,I.tagsDisp=getTagsDisp(a.chefsTags[s].tags,a.tags);break}I.gender=getGender(I.tags);var N="";for(var s in e.chefs[l].ultimateGoal)for(var M in e.quests)if(e.chefs[l].ultimateGoal[s]==e.quests[M].questId){N+=e.quests[M].goal+"<br>";break}I.ultimateGoalDisp=N;var A=getSkillInfo(e.skills,e.chefs[l].ultimateSkill);if(I.ultimateSkillDisp=A.skillDisp,I.ultimateSkillEffect=A.skillEffect,I.got="",I.ultimate="",I.equip=null,I.equipId="",I.equipDisp="",t)for(var s in t.chefs)if(e.chefs[l].chefId==t.chefs[s].id){if(t.chefs[s].hasOwnProperty("got")&&(I.got=t.chefs[s].got),t.chefs[s].hasOwnProperty("ult")&&(I.ultimate=t.chefs[s].ult),t.chefs[s].hasOwnProperty("equip"))for(var M in f)if(t.chefs[s].equip==f[M].equipId){I.equip=f[M],I.equipId=f[M].equipId,I.equipDisp=f[M].disp;break}break}setDataForChef(I,I.equip,q,R.global,R.partial,null,R.self,null,T,null),E.push(I)}i.chefs=E;var O=[];for(var l in e.recipes)if(e.recipes[l].name){var G={};if(G=e.recipes[l],G.stirfry=e.recipes[l].stirfry||"",G.boil=e.recipes[l].boil||"",G.knife=e.recipes[l].knife||"",G.fry=e.recipes[l].fry||"",G.bake=e.recipes[l].bake||"",G.steam=e.recipes[l].steam||"",G.addition="",G.skillDisp=getSkillDisp(e.recipes[l]),G.timeDisp=secondsToTime(e.recipes[l].time),G.rarityDisp=getRarityDisp(e.recipes[l].rarity),e.recipes[l].hide?G.icon="<div class='icon-recipe2 recipe_"+e.recipes[l].recipeId+"'></div>":G.icon="<div class='icon-recipe recipe_"+e.recipes[l].recipeId+"'></div>",G.tags=e.recipes[l].tags||{},G.tagsDisp="",G.exTime=0,G.exTimeDisp="",a)for(var s in a.recipesTags)if(a.recipesTags[s].recipeId==e.recipes[l].recipeId){G.tags=a.recipesTags[s].tags,G.tagsDisp=getTagsDisp(a.recipesTags[s].tags,a.tags),G.exTime=a.recipesTags[s].experienceTime,G.exTimeDisp=getExTimeDisp(a.recipesTags[s].experienceTime,e.recipes[l].time);break}if(G.rank="",G.rankSort=1,G.ex="",G.got="",t)for(var s in t.recipes)if(e.recipes[l].recipeId==t.recipes[s].id){t.recipes[s].hasOwnProperty("rank")&&(G.rank=t.recipes[s].rank,G.rankSort=getRankSortValue(t.recipes[s].rank)),t.recipes[s].hasOwnProperty("ex")&&(G.ex=t.recipes[s].ex),t.recipes[s].hasOwnProperty("got")&&(G.got=t.recipes[s].got);break}G.oPrice=e.recipes[l].price;var P=ifUseEx(G);setDataForRecipe(G,R.global,P,null,T,null),G.efficiency=Math.floor(3600*e.recipes[l].price/e.recipes[l].time);var V=getMaterialsInfo(e.recipes[l],e.materials);G.materialsVal=V.materialsVal,G.materialsDisp=V.materialsDisp,G.calMaterialsDisp=V.calMaterialsDisp,G.veg=V.veg,G.meat=V.meat,G.creation=V.creation,G.fish=V.fish;var _=0,F=0;e.recipes[l].time>0&&(_=3600*V.materialsCount/e.recipes[l].time,F=3600*e.recipes[l].rarity/e.recipes[l].time),G.allMaterialsEff=_?Math.floor(_):"",G.condimentEff=F?Math.floor(F):"";var B="";for(var L in e.combos)for(var U in e.combos[L].recipes)if(e.combos[L].recipes[U]==e.recipes[l].recipeId){for(var H in e.recipes)if(e.recipes[H].recipeId==e.combos[L].recipeId){B=e.recipes[H].name;break}break}G.comboVal=B,G.comboDisp=B||"-";var J=getRankGuestInfo(e.recipes[l],G.rank);G.rankGuestsVal=J.rankGuestsVal,G.rankGuestsDisp=J.rankGuestsDisp;var j=getRankGiftInfo(e.recipes[l],G.rank);G.rankGiftVal=j.rankGiftVal,G.rankGiftDisp=j.rankGiftDisp;var Q="",X="";for(var L in e.guests)for(var U in e.guests[L].gifts)if(e.recipes[l].name==e.guests[L].gifts[U].recipe){Q+=" "+e.guests[L].name+" "+e.guests[L].gifts[U].antique+" ",X+=e.guests[L].name+"-"+e.guests[L].gifts[U].antique+"<br>";break}G.guestsVal=Q,G.guestsDisp=X||"-",G.condimentDisp=getCondimentDisp(e.recipes[l].condiment),O.push(G)}return i.recipes=O,i.selectedQuests=[],i.questMaterials=[],i.allSelectedMaterials=[],i.recipeColNum=$("#recipe-table-header th").length,i.recipeAddColNum=0,i.recipeAddColNumMax=15,i.chefColNum=$("#chef-table-header th").length,i.chefAddColNum=0,i.chefAddColNumMax=15,i}function updateRecipeChefTable(e){$(".loading").removeClass("hidden"),setTimeout(function(){e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),$("#recipe-table").DataTable().draw(!1),$("#chef-table").DataTable().draw(!1),$(".loading").addClass("hidden")},0),$("#btn-chef-recal").closest(".inline-wrapper").addClass("hidden"),$("#btn-recipe-recal").closest(".inline-wrapper").addClass("hidden")}function getUpdateData(e){var a;try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}var i=$("#chk-setting-show-final").prop("checked"),l=$("#chk-chef-apply-equips").prop("checked"),c=$("#chk-chef-apply-ultimate").prop("checked"),r=$("#chk-chef-apply-ultimate-person").prop("checked"),s=getUltimateData(e.chefs,a,e.skills,c,r);e.ultimateData=s;var n=$("#chk-chef-partial-ultimate").val(),o=getPartialUltimateData(e.chefs,e.partialSkill,c,n);for(var p in e.chefs)setDataForChef(e.chefs[p],e.chefs[p].equip,l,s.global,s.partial,o,s.self,null,i,null);for(var p in e.recipes){var d=ifUseEx(e.recipes[p]);setDataForRecipe(e.recipes[p],s.global,d,null,i,null)}return updateRecipesChefsData(e),updateChefsRecipesData(e),e}function getQuestsData(e,a){var t=[];for(var i in e)e[i].type==a&&t.push(e[i]);return t}function getMaterialsData(e,a){if(!a){var t=$("#select-material-origin").val();for(var i in e.maps)if(t==e.maps[i].name){a=e.maps[i];break}}var l=a.materials,c=[],r=$("#chk-material-season").prop("checked"),s=Number($("#input-material-addition").val()),n=$("#input-material-skill").val();for(var i in l){var o={};for(var p in o.name=l[i].name,o.skill=l[i].skill,o.time=[],l[i].quantity){var d=0,u=0;(""==n||Number(n)>=l[i].skill)&&(d=l[i].quantity[p][0],u=l[i].quantity[p][1],r&&(d+=l[i].season[p],u+=l[i].season[p]),s&&(d=Math.ceil(+(d*(1+s/100)).toFixed(2)),u=Math.ceil(+(u*(1+s/100)).toFixed(2)))),o.time.push([d,u])}c.push(o)}var f={name:"总计",time:[]};for(var i in a.time){d=0,u=0;for(var p in c)d+=c[p].time[i][0],u+=c[p].time[i][1];f.time.push([d,u])}return c.push(f),c}function getMaterialsInfo(e,a){var t={},i="",l="",c="",r=0,s=!1,n=!1,o=!1,p=!1;for(var d in e.materials)for(var u in a)if(e.materials[d].material==a[u].materialId){i+=a[u].name+"*"+e.materials[d].quantity+" ",l+="<span data-id='"+a[u].materialId+"'>"+a[u].name+e.materials[d].quantity+"</span>",c+=a[u].name+" ",r+=e.materials[d].quantity,e.materials[d].origin=a[u].origin,"菜棚"==a[u].origin||"菜地"==a[u].origin||"森林"==a[u].origin?s=!0:"鸡舍"==a[u].origin||"猪圈"==a[u].origin||"牧场"==a[u].origin?n=!0:"作坊"==a[u].origin?o=!0:"池塘"==a[u].origin&&(p=!0);break}return t.materialsDisp=i,t.calMaterialsDisp=l,t.materialsVal=c,t.materialsCount=r,t.veg=s,t.meat=n,t.creation=o,t.fish=p,t}function getGender(e){return e.indexOf(1)>=0?"男":e.indexOf(2)>=0?"女":""}function getTagsDisp(e,a){var t="";for(var i in e)for(var l in a)if(e[i]==a[l].Id){t+=a[l].name+" ";break}return t}function getExTimeDisp(e,a){var t=e/1.5,i=e/2,l=e/2.5,c=e/3,r="可-"+Math.ceil(e/a)+"-"+secondsToTime(e)+"<br>优-"+Math.ceil(t/a)+"-"+secondsToTime(t)+"<br>特-"+Math.ceil(i/a)+"-"+secondsToTime(i)+"<br>神-"+Math.ceil(l/a)+"-"+secondsToTime(l)+"<br>传-"+Math.ceil(c/a)+"-"+secondsToTime(c);return r}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"池塘"==e?a=8:console.log("cannot find origin: "+a),a}function getRankSortValue(e){return"传"==e?5:"神"==e?4:"特"==e?3:"优"==e?2:1}function getRankGuestInfo(e,a){var t="",i="",l=$("#chk-recipe-filter-guest").prop("checked"),c=$("#chk-setting-done-mark").prop("checked");for(var r in e.guests){var s=!1;("优"==a&&0==r||"特"==a&&2!=r||"神"==a||"传"==a)&&(s=!0);var n="";0==r?n="优":1==r?n="特":2==r&&(n="神"),t+=(s&&c?"<span class='rank-done'>":"")+n+"-"+(e.guests[r].guest?e.guests[r].guest:"未知")+(s&&c?"</span>":"")+"<br>",(!l||l&&!s)&&(i+=" "+e.guests[r].guest+" ")}var o={};return o.rankGuestsDisp=t,o.rankGuestsVal=i,o}function getRankGiftInfo(e,a){var t=e.gift,i="",l=$("#chk-recipe-filter-antique").prop("checked"),c=$("#chk-setting-done-mark").prop("checked");"神"!=a&&"传"!=a||!c||(t="<span class='rank-done'>"+t+"</span>"),(!l||l&&"神"!=a&&"传"!=a)&&(i=e.gift);var r={};return r.rankGiftDisp=t,r.rankGiftVal=i,r}function ifUseEx(e){var a=$("#chk-recipe-apply-ex").prop("checked"),t=$("#chk-recipe-apply-ex-person").prop("checked");return!(!a||(!t||"是"!=e.ex)&&t)}function getUltimateData(e,a,t,i,l){var c=[],r=[],s=[];for(var n in e)if(i&&e[n].ultimateSkill){var o=!1;if(l){if(a)for(var p in a.chefs)if(e[n].chefId==a.chefs[p].id&&"是"==a.chefs[p].ult){o=!0;break}}else e[n].hide||(o=!0);if(o)for(var d in t)if(e[n].ultimateSkill==t[d].skillId){var u=[],f=[];for(var h in t[d].effect)if("Partial"==t[d].effect[h].condition)u.push(t[d].effect[h]);else if("Global"==t[d].effect[h].condition){var m=!1;for(var v in c)if(!(c[v].type!=t[d].effect[h].type||c[v].cal!=t[d].effect[h].cal&&(c[v].cal||t[d].effect[h].cal)||c[v].tag!=t[d].effect[h].tag&&(c[v].tag||t[d].effect[h].tag)||c[v].rarity!=t[d].effect[h].rarity&&(c[v].rarity||t[d].effect[h].rarity))){c[v].value=+(c[v].value+t[d].effect[h].value).toFixed(2),m=!0;break}m||c.push(JSON.parse(JSON.stringify(t[d].effect[h])))}else"Self"==t[d].effect[h].condition&&f.push(t[d].effect[h]);if(u.length){var b={};b.chefId=e[n].chefId,b.effect=u,r.push(b)}if(f.length){var g={};g.chefId=e[n].chefId,g.effect=f,s.push(g)}break}}var k={};return k.global=c,k.partial=r,k.self=s,k}function setPartialUltimateOptions(e,a){var t=[];for(var i in e)if(e[i].ultimateSkill)for(var l in a)if(e[i].ultimateSkill==a[l].skillId)for(var c in a[l].effect)if("Partial"==a[l].effect[c].condition){var r=getSkillInfo(a,a[l].skillId),s={};s.skill=r,s.chef=e[i],t.push(s);break}for(var i in t.sort(function(e,a){return e.skill.skillDisp.localeCompare(a.skill.skillDisp)}),t){var n="<option value='"+t[i].chef.chefId+"' data-subtext='"+t[i].skill.skillDisp.replace(/<br>/g," ")+"'>"+t[i].chef.name+"</option>",o=!1;for(var p in t[i].skill.skillEffect)if("Partial"==t[i].skill.skillEffect[p].condition&&("Bake"==t[i].skill.skillEffect[p].type||"Steam"==t[i].skill.skillEffect[p].type||"Boil"==t[i].skill.skillEffect[p].type||"Fry"==t[i].skill.skillEffect[p].type||"Knife"==t[i].skill.skillEffect[p].type||"Stirfry"==t[i].skill.skillEffect[p].type)){o=!0;break}o&&$("#chk-chef-partial-ultimate").append(n),$("#chk-cal-partial-ultimate").append(n)}}function setSelfUltimateOptions(e,a){for(var t in e)if(e[t].ultimateSkill)for(var i in a)if(e[t].ultimateSkill==a[i].skillId)for(var l in a[i].effect)if("Self"==a[i].effect[l].condition&&"Material_Gain"!=a[i].effect[l].type&&"GuestDropCount"!=a[i].effect[l].type){var c=getSkillInfo(a,a[i].skillId),r="<option value='"+e[t].chefId+"' data-subtext='"+c.skillDisp.replace(/<br>/g," ")+"'>"+e[t].name+"</option>";$("#chk-cal-self-ultimate").append(r);break}}function setExOptions(e){for(var a in e){var t="<option value='"+e[a].recipeId+"' data-subtext='+"+e[a].exPrice+"'>"+e[a].name+"</option>";$("#chk-cal-ex").append(t)}}function setDataForRecipe(e,a,t,i,l,c){if(e.limitVal=e.limit,e.ultimateAddition=0,!c||!c.hasOwnProperty("DisableChefSkillEffect")||0==c.DisableChefSkillEffect){for(var r in a)"MaxEquipLimit"==a[r].type&&a[r].rarity==e.rarity&&(e.limitVal+=a[r].value);e.ultimateAddition=getRecipeSkillAddition(a,e,null,!1)}for(var r in i)"MaxEquipLimit"==i[r].type&&i[r].rarity==e.rarity&&(e.limitVal+=i[r].value);e.limitDisp=getAtrributeDisp(e.limitVal,e.limit,l),e.ultimateAdditionDisp=getPercentDisp(e.ultimateAddition),e.activityAddition=getRecipeSkillAddition(i,e,null,!1),e.activityAdditionDisp=getPercentDisp(e.activityAddition),e.price=e.oPrice,t&&(e.price+=e.exPrice),e.priceDisp=getAtrributeDisp(e.price,e.oPrice,l),e.totalPrice=e.price*e.limitVal,e.totalTime=e.time*e.limitVal,e.totalTimeDisp=secondsToTime(e.totalTime)}function getRankOptions(){var e=[],a={display:"",value:""};return e.push(a),a={},a.display="优",a.value="优",e.push(a),a={},a.display="特",a.value="特",e.push(a),a={},a.display="神",a.value="神",e.push(a),a={},a.display="传",a.value="传",e.push(a),e}function getCondimentDisp(e){return"Sweet"==e?"甜":"Sour"==e?"酸":"Spicy"==e?"辣":"Salty"==e?"咸":"Bitter"==e?"苦":"Tasty"==e?"鲜":""}function getGotOptions(){var e=[],a={display:"否",value:""};return e.push(a),a={},a.display="是",a.value="是",e.push(a),e}function getEquipsOptions(e,a){var t=[],i={display:"无厨具",subtext:"",tokens:"",value:"",class:"hidden"};for(var l in t.push(i),e){var c=e[l].skillDisp.replace(/<br>/g," ");i={};i.display=e[l].name,i.subtext=c,i.tokens=e[l].name+c,i.value=e[l].equipId,t.push(i)}return t}function getOptionsString(e){var a="";return $.each(e,function(e,t){a=a+"<option value='"+t.value+"'",t.tokens&&(a+=" data-tokens='"+t.tokens+"'"),t.subtext&&(a+=" data-subtext='"+t.subtext+"'"),t.content&&(a+=' data-content="'+t.content+'"'),t.class&&(a+=" class='"+t.class+"'"),t.disabled&&(a+=" disabled"),t.selected&&(a+=" selected"),a+=">"+t.display+"</option>"}),a}function getSkillInfo(e,a){var t={},i="",l=[],c=[];for(var r in a.constructor===Array?c=a:a&&c.push(a),c){var s=!1;for(var n in e)if(e[n].skillId==c[r]){i+=e[n].desc+"<br>",l=l.concat(e[n].effect),s=!0;break}s||console.log(c[r])}return t.skillDisp=i,t.skillEffect=l,t}function getSkillDisp(e){var a="";return e.stirfry&&(a+="<span>炒"+e.stirfry+"</span>"),e.boil&&(a+="<span>煮"+e.boil+"</span>"),e.knife&&(a+="<span>切"+e.knife+"</span>"),e.fry&&(a+="<span>炸"+e.fry+"</span>"),e.bake&&(a+="<span>烤"+e.bake+"</span>"),e.steam&&(a+="<span>蒸"+e.steam+"</span>"),a}function getMaxLimit(e,a){var t=0;for(var i in 1==a?t=40:2==a?t=30:3==a?t=25:4==a?t=20:5==a&&(t=15),e.ultimateData.global)if(e.ultimateData.global[i].rarity==a&&"MaxEquipLimit"==e.ultimateData.global[i].type){t+=e.ultimateData.global[i].value;break}return t}function monitorStyle(){$("select.monitor-none").on("changed.bs.select",function(){changeSelectStyle(this)}),$("input[type=text].monitor-none, input[type=number].monitor-none").on("input",function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").click(function(){changeCheckStyle(this)})}function changeSelectStyle(e){0==$(e).val().length?$(e).selectpicker("setStyle","btn-info","remove"):$(e).selectpicker("setStyle","btn-info","add")}function changeInputStyle(e){$.trim($(e).val()).length>0?$(e).addClass("btn-info"):$(e).removeClass("btn-info")}function changeCheckStyle(e){$(e).prop("checked")?$(e).closest(".btn").addClass("btn-info"):$(e).closest(".btn").removeClass("btn-info")}function checkMonitorStyle(){$("input[type=text].monitor-none, input[type=number].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=search].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").each(function(){changeCheckStyle(this)})}function arraysEqual(e,a){if(e.length!=a.length)return!1;for(var t=0;t<e.length;t++)if(a.indexOf(e[t])<0)return!1;return!0}function changeTableHeaderClass(e,a,t){t?$(e.column(a).header()).removeClass("none never").addClass("all"):$(e.column(a).header()).removeClass("all never").addClass("none")}function resetExpendColumn(e,a){var t=$(a).val(),i=a+" option",l=$(i+":first").val(),c=t.indexOf(l);c>=0&&t.splice(c,1),t.length==$(i).length-1&&changeTableHeaderClass(e,Number(l),!1)}function initRecipeShow(){var e=$("#recipe-table").DataTable();$("#chk-recipe-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-recipe-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-recipe-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initChefShow(){var e=$("#chef-table").DataTable();$("#chk-chef-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-chef-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);var i=$("#chk-chef-show option[value=12]").is(":selected");for(t=13;t<=15;t++)changeTableHeaderClass(e,t,i);for(i=$("#chk-chef-show option[value=17]").is(":selected"),t=18;t<=22;t++)changeTableHeaderClass(e,t,i);resetExpendColumn(e,"#chk-chef-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initEquipShow(){var e=$("#equip-table").DataTable();$("#chk-equip-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-equip-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCondimentShow(){var e=$("#condiment-table").DataTable();$("#chk-condiment-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-condiment-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initDecorationShow(){var e=$("#decoration-table").DataTable();$("#chk-decoration-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-decoration-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initQuestShow(e){e.column(1).visible("支线任务"==$("#select-quest-type").val(),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){$("#chk-cal-chefs-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-cal-chefs-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-cal-chefs-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){$("#chk-cal-equips-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-cal-equips-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){$("#chk-cal-materials-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-cal-materials-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalRecipesShow(e){$("#chk-cal-recipes-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-cal-recipes-show option[value=16]").is(":selected"),t=17;t<=21;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-cal-recipes-show"),private||e.column(0).visible(!1,!1),currentRule&&currentRule.hasOwnProperty("MaterialsNum")?e.column(5).visible(!0,!1):e.column(5).visible(!1,!1),currentRule&&currentRule.showTime&&e.column(9).visible(!0,!1),currentRule&&currentRule.showEff&&e.column(10).visible(!0,!1),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var t=historyTemplate(e);$("#data-history").html(t)},pageSize:5,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a='<table class="table table-condensed history-table">';return $.each(e,function(e,t){a+='<tr><td class="history-dt">'+t.date+"</td><td>"+t.content+"<td></tr>"}),a+="</table>",a}function initVersionTip(e){$(".alert-version").each(function(){if("true"==$(this).attr("data-show")){var a=$(this).attr("data-id"),t=Number($(this).attr("data-version")),i=!0;e&&e[a]&&Number(e[a])==t&&(i=!1),i&&$(this).removeClass("hidden"),$(this).on("closed.bs.alert",function(){updateLocalData(a,t),isMobile&&updateScrollHeight()})}})}function getInputHtml(e,a,t,i,l){var c,r,s;switch(s={type:"input",html:null,settings:null},t.inputTypes&&$.each(t.inputTypes,function(e,t){t.column==a&&(c=t,r=c.type.toLowerCase())}),s.settings=c,r){case"list":var n="data-live-search='false'";c.search&&(n="data-live-search='true'");var o,p=" ";c.clear&&(p=" data-actions-box='true' data-deselect-all-text='清空'"),c.done&&(p+=" data-done-button='true' data-done-button-text='关闭'"),s.html="<div class='table-select-picker' style='left:"+l.clientX+"px;top:"+l.clientY+"px'><select "+n+p+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",o=c.optionsp?c.options[e]:c.options,$.each(o,function(e,a){s.html=s.html+"<option value='"+a.value+"'",a.tokens&&(s.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(s.html+=" data-subtext='"+a.subtext+"'"),a.class&&(s.html+=" class='"+a.class+"'"),i==a.value&&(s.html+=" selected"),s.html+=">"+a.display+"</option>"}),s.html=s.html+"</select></div>",s.type=r;break;default:s.html="<input class='form-control' value='"+i+"'></input>"}return s}function sanitizeCellValue(e){return null==e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function UpdateQueryString(e,a,t){t||(t=window.location.href);var i,l=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(l.test(t))return null!=a?t.replace(l,"$1"+e+"="+a+"$2$3"):(i=t.split("#"),t=i[0].replace(l,"$1$3").replace(/(&|\?)$/,""),void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t);if(null!=a){var c=-1!==t.indexOf("?")?"&":"?";return i=t.split("#"),t=i[0]+c+e+"="+a,void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t}return t}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var currentRule,customData,private=!1,isMobile=!1,expendBtn=!0;$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var t=$(e).closest("table").DataTable().table(),i=t.row($(e).parents("tr")),l=t.cell($(e).closest("td")),c=$(e),r=l.data(),s=c.val();l.data(s),a.onUpdate&&a.onUpdate(t,i,l,r)}}),"destroy"===e&&($(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(t){if(!$(this).hasClass("child")&&!$(this).hasClass("dataTables_empty")){var i=a.cell(this).index().row,l=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(l)>-1||!e.columns){var c=a.cell(this).node(),r=a.cell(this).data();if(r=sanitizeCellValue(r),!$(c).find("input").length&&!$(c).find("select").length){var s=getInputHtml(i,l,e,r,t);$(c).html($(c).html()+s.html),"input"==s.type?$(c).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==s.type&&($(a.cells().nodes()).removeClass("editing"),$(c).addClass("editing"),$(c).find("select").selectpicker("hide").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e),$(c).removeClass("editing")}),$(c).find("select").on("show.bs.select",function(e){var a=$(c).find(".dropdown-menu"),i=a.outerWidth(),l=t.clientX;if(a.hasClass("dropdown-menu-right")){var r=i-l;r>0&&(l+=r,$(c).find(".table-select-picker").css("left",l))}else{r=i-$(window).width()+l;r>0&&(l-=r,$(c).find(".table-select-picker").css("left",l))}}),setTimeout(function(){$(c).find("select").selectpicker("show").selectpicker("toggle")},0))}}}})});