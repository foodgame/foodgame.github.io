function commaSeparatedMatch(e,a){if(0===a.length)return!0;for(var i=a.split(/[,\s]/),t=0;t<i.length;t++)if(0!==i[t].length&&-1!==e.indexOf(i[t]))return!0;return!1}function init(e){var a;initFunction();try{var i=localStorage.getItem("data");a=JSON.parse(i)}catch(e){}if(private)$.ajax({cache:!1,success:function(i){$.ajax({cache:!1,success:function(t){i=$.extend(i,t);var c=generateData(e,i,a);initTables(c,a)},error:function(){var t=generateData(e,i,a);initTables(t,a)},url:"others/data/data3.json"})},error:function(){var i=generateData(e,null,a);initTables(i,a)},url:"others/data/data2.json"});else{var t=generateData(e,null,a);initTables(t,a)}}function initFunction(){var e=getParameterByName("a");e&&"cb8f8a72f7e4924a75cb75a4a59c0b8d61e70c0cb84f84edf7ede4c8"==lcode(e)&&(private=!0,cal=!0);var a=getParameterByName("c");a&&"519526da9fa86daa1536b8e280527306eda91dec4a0c56e2c9f64444"==lcode(a)&&(cal=!0),private&&$("head").append('<link rel="stylesheet" type="text/css" href="others/css/image.css">')}function initTables(e,a){updateMenu(a),setPartialUltimateOptions(e.chefs,e.partialSkill),initRecipeTable(e),initChefTable(e),initEquipTable(e),initDecorationTable(e),initMaterialTable(e),initQuestTable(e),initImportExport(e),initCalTables(e),cal&&($("#chk-recipe-show-tags").parent(".btn").removeClass("hidden"),$("#chk-chef-show-tags").parent(".btn").removeClass("hidden")),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})},initInfo(e),initVersionTip(a),initTooltip(a),$('.main-nav a[data-toggle="tab"]').on("shown.bs.tab",function(e){reInitFixedHeader()}),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden"),reInitFixedHeader()}function reInitFixedHeader(){$("#recipe-table").DataTable().fixedHeader.adjust(),$("#chef-table").DataTable().fixedHeader.adjust(),$("#equip-table").DataTable().fixedHeader.adjust(),$("#decoration-table").DataTable().fixedHeader.adjust(),$("#quest-table").DataTable().fixedHeader.adjust()}function initTooltip(e){e&&0==e.help&&$("#chk-show-help").bootstrapToggle("off"),$('.tooltip-pin[data-toggle="tooltip"]').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$("#chk-show-help").change(function(){updateLocalData("help",$(this).prop("checked")),updateTooltip()}),updateTooltip()}function updateTooltip(){$("#chk-show-help").prop("checked")?($('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$('[data-toggle="tooltip"]').on("show.bs.tooltip",function(){$('[data-toggle="tooltip"]').not(this).tooltip("hide")})):$('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip("destroy")}function initRecipeTable(e){for(var a in reInitRecipeTable(e),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=$("#chk-recipe-rarity-1").prop("checked"),c=$("#chk-recipe-rarity-2").prop("checked"),r=$("#chk-recipe-rarity-3").prop("checked"),l=$("#chk-recipe-rarity-4").prop("checked"),s=$("#chk-recipe-rarity-5").prop("checked"),o=Math.floor(a[3])||0;return!!(t&&1==o||c&&2==o||r&&3==o||l&&4==o||s&&5==o)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){return e.nTable!=document.getElementById("recipe-table")||!!($("#chk-recipe-skill-stirfry").prop("checked")&&(Math.floor(a[4])||0)>0||$("#chk-recipe-skill-boil").prop("checked")&&(Math.floor(a[5])||0)>0||$("#chk-recipe-skill-knife").prop("checked")&&(Math.floor(a[6])||0)>0||$("#chk-recipe-skill-fry").prop("checked")&&(Math.floor(a[7])||0)>0||$("#chk-recipe-skill-bake").prop("checked")&&(Math.floor(a[8])||0)>0||$("#chk-recipe-skill-steam").prop("checked")&&(Math.floor(a[9])||0)>0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){return e.nTable!=document.getElementById("recipe-table")||!!($("#chk-recipe-category-veg").prop("checked")&&t.veg||$("#chk-recipe-category-meat").prop("checked")&&t.meat||$("#chk-recipe-category-creation").prop("checked")&&t.creation||$("#chk-recipe-category-fish").prop("checked")&&t.fish)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=Math.floor($("#input-recipe-price").val()),c=Math.floor(a[11])||0;return""==$("#input-recipe-price").val()||t<c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=$("#chk-recipe-guest").prop("checked"),c=a[24];return!!(!t||t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=$("#chk-recipe-no-origin").prop("checked"),c=a[20];return!!(t||!t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=$("#chk-recipe-combo").prop("checked"),c=a[22];return!!(!t||t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var t=$.trim($("#input-recipe-guest-antique").val()),c=[25,26],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("recipe-table"))return!0;var r=a[28];return!!($("#chk-recipe-ex-yes").prop("checked")&&r||$("#chk-recipe-ex-no").prop("checked")&&!r)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;var t=$("#chk-recipe-got").prop("checked"),c=a[29];return!!(!t||t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("recipe-table"))return!0;for(var t=$.trim($("#pane-recipes .search-box input").val()),c=[0,2,10,20,23,24],r=0,l=c.length;r<l;r++)if(0==c[r]){if(a[c[r]]==t)return!0}else if(20==c[r]){if(commaSeparatedMatch(a[c[r]],t)&&-1==a[c[r]].indexOf("神级"))return!0}else if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("recipe-table"))return!0;var r=$("#chk-recipe-show-material").val();if(r.length>0){for(var l in r)for(var s in t.materials)if(t.materials[s].material==r[l])return!0;return!1}return!0}),e.materials)$("#chk-recipe-show-material").append("<option value='"+e.materials[a].materialId+"'>"+e.materials[a].name+"</option>");for(var a in e.chefs)$("#chk-recipe-show-chef").append("<option value='"+e.chefs[a].chefId+"'>"+e.chefs[a].name+"</option>");$("#chk-recipe-show-material").selectpicker().on("changed.bs.select",function(){updateRecipesMaterialsData(e),reInitRecipeTable(e),initRecipeShow()}),$("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(){updateRecipesChefsData(e),reInitRecipeTable(e),initRecipeShow()}),$("#chk-recipe-show-skill-diff").click(function(){$("#chk-recipe-show-chef").val().length&&(updateRecipesChefsData(e),reInitRecipeTable(e),initRecipeShow())}),$(".chk-recipe-show").click(function(){initRecipeShow(),updateMenuLocalData()}),$("#chk-recipe-show-all").click(function(){$(".btn:not(.hidden) .chk-recipe-show:checked").length==$(".btn:not(.hidden) .chk-recipe-show").length?$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!1):$(".btn:not(.hidden) .chk-recipe-show").prop("checked",!0),initRecipeShow(),updateMenuLocalData()}),$('.chk-recipe-rarity input[type="checkbox"]').click(function(){$("#recipe-table").DataTable().draw()}),$(".chk-recipe-skill").click(function(){$(this).prop("checked")&&$("#chk-recipe-single-skill").prop("checked")&&$(".chk-recipe-skill").not(this).prop("checked",!1),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-single-skill").change(function(){$(this).prop("checked")&&$(".chk-recipe-skill:checked").length>1&&($(".chk-recipe-skill").prop("checked",!1),$("#recipe-table").DataTable().draw())}),$("#chk-recipe-skill-all").click(function(){$("#chk-recipe-single-skill").prop("checked")&&$("#chk-recipe-single-skill").bootstrapToggle("off"),$(".chk-recipe-skill").prop("checked",!0),$("#recipe-table").DataTable().draw()}),$('.chk-recipe-category input[type="checkbox"]').click(function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-price").keyup(function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-guest-antique").keyup(function(){$("#chk-recipe-show-rank-guest").prop("checked")||($("#chk-recipe-show-rank-guest").prop("checked",!0),initRecipeShow()),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-guest").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-guest").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,i){var t=this.data(),c=getRankGuestInfo(t,t.rank);t.rankGuestsVal=c.rankGuestsVal,t.rankGuestsDisp=c.rankGuestsDisp,this.data(t)}),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-combo").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-ex-yes, #chk-recipe-ex-no").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-got").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-no-origin").click(function(){$("#recipe-table").DataTable().draw()}),$("#btn-recipe-reset").click(function(){$('.chk-recipe-rarity input[type="checkbox"]').prop("checked",!0),$("#chk-recipe-single-skill").prop("checked")&&$("#chk-recipe-single-skill").bootstrapToggle("off"),$(".chk-recipe-skill").prop("checked",!0),$('.chk-recipe-category input[type="checkbox"]').prop("checked",!0),$("#chk-recipe-guest").prop("checked",!1),$("#chk-recipe-combo").prop("checked",!1),$("#chk-recipe-ex-yes, #chk-recipe-ex-no").prop("checked",!0),$("#chk-recipe-got").prop("checked",!1),$("#input-recipe-price").val(""),$("#input-recipe-guest-antique").val(""),$("#chk-recipe-show-material").selectpicker("deselectAll"),$("#pane-recipes .search-box input").val(""),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-show-final").change(function(){updateRecipeChefTable(e)}),$("#chk-recipe-apply-ex").change(function(){$(this).prop("checked")?$(".recipe-apply-ex").show():$(".recipe-apply-ex").hide(),updateRecipeChefTable(e)}),$("#chk-recipe-apply-ex-person").change(function(){updateRecipeChefTable(e)}),$("#btn-recipe-recal").click(function(){updateRecipeChefTable(e)}),private&&($("#chk-recipe-show-ex-time").closest(".btn").removeClass("hidden"),$("#chk-recipe-no-origin").closest(".box").removeClass("hidden")),initRecipeShow()}function reInitRecipeTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"name"},{data:{_:"rarity",display:"rarityDisp"},orderSequence:["desc","asc"]},{data:"stirfry",orderSequence:["desc","asc"]},{data:"boil",orderSequence:["desc","asc"]},{data:"knife",orderSequence:["desc","asc"]},{data:"fry",orderSequence:["desc","asc"]},{data:"bake",orderSequence:["desc","asc"]},{data:"steam",orderSequence:["desc","asc"]},{data:{_:"materialsVal",display:"materialsDisp"}},{data:{_:"price",display:"priceDisp"},orderSequence:["desc","asc"]},{data:"exPrice",orderSequence:["desc","asc"]},{data:{_:"exTime",display:"exTimeDisp"}},{data:{_:"time",display:"timeDisp"}},{data:{_:"limitVal",display:"limitDisp"},orderSequence:["desc","asc"]},{data:"totalPrice",orderSequence:["desc","asc"]},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency",orderSequence:["desc","asc"]},{data:"allMaterialsEff",orderSequence:["desc","asc"]},{data:"origin"},{data:"unlock"},{data:"combo"},{data:"tagsDisp",defaultContent:""},{data:"guestsDisp"},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:"gift"},{data:"rank",width:"31px"},{data:"ex",width:"31px"},{data:"got",width:"31px"}],i=20,t="",c=[];$.fn.DataTable.isDataTable("#recipe-table")&&(t=$("#pane-recipes .search-box input").val(),c=getTableOrder($("#recipe-table").DataTable(),a.length),$("#recipe-table").DataTable().MakeCellsEditable("destroy"),$("#recipe-table").DataTable().destroy()),$("#recipe-table").html($("#recipe-table-header").html());var r=$("#chk-recipe-show-material").val();for(var l in r)for(j in e.materials)if(r[l]==e.materials[j].materialId){$("#recipe-table thead tr").append("<th>"+e.materials[j].name+"/小时</th>"),a.push({data:"materialsEff."+l,orderSequence:["desc","asc"]});break}var s=$("#chk-recipe-show-skill-diff").prop("checked"),o=$("#chk-recipe-show-chef").val();for(var l in o)for(j in e.chefs)if(o[l]==e.chefs[j].chefId){$("#recipe-table thead tr").append("<th>"+e.chefs[j].name+"</th>"),s&&$("#recipe-table thead tr").append("<th>神差值</th>"),$("#recipe-table thead tr").append("<th>效率</th>"),a.push({data:{_:"chefs."+l+".rankVal",display:"chefs."+l+".rankDisp"},orderSequence:["desc","asc"]}),s&&a.push({data:{_:"chefs."+l+".skillDiffVal",display:"chefs."+l+".skillDiffDisp"}}),a.push({data:"chefs."+l+".efficiency",orderSequence:["desc","asc"]});break}var n=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[5,10,20,50,100,-1],[5,10,20,50,100,"所有"]],pageLength:i,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:c,autoWidth:!1,fixedHeader:!0});$("#pane-recipes div.search-box").html('<label data-toggle="tooltip" title="该搜索不含升阶贵客和神级符文">查找:<input type="search" value="'+t+'" class="form-control input-sm" placeholder="菜名 材料 贵客 符文 来源"></label>');var p=getRankOptions(),d=getGotOptions();n.MakeCellsEditable({columns:[27,28,29],inputTypes:[{column:27,type:"list",options:p},{column:28,type:"list",options:d},{column:29,type:"list",options:d}],onUpdate:function(e,a,i,t){var c=a.data(),r=getRankGuestInfo(c,c.rank);c.rankGuestsVal=r.rankGuestsVal,c.rankGuestsDisp=r.rankGuestsDisp,$(e.cell(a.index(),25).node()).html(c.rankGuestsDisp),28==i.index().column&&i.data()!=t&&$("#btn-recipe-recal").closest(".box").removeClass("hidden"),updateRecipesLocalData()}}),$("#pane-recipes .search-box input").keyup(function(){n.draw()}),updateTooltip()}function updateRecipesMaterialsData(e){var a=$("#chk-recipe-show-material").val();if(a.length>0)for(var i in e.recipes)for(var t in e.recipes[i].materialsEff=[],a)for(var c in e.materials)if(a[t]==e.materials[c].materialId){var r=0;for(var l in e.recipes[i].materials)if(e.recipes[i].materials[l].material==e.materials[c].materialId){r=e.recipes[i].materials[l].quantity;break}var s=0;e.recipes[i].time>0&&(s=3600*r/e.recipes[i].time);var o=s?Math.floor(s):"";e.recipes[i].materialsEff.push(o);break}}function updateRecipesChefsData(e){var a=$("#chk-chef-apply-equips").prop("checked"),i=$("#chk-recipe-show-skill-diff").prop("checked"),t=$("#chk-recipe-show-chef").val();if(t.length>0)for(var c in e.recipes)for(var r in e.recipes[c].chefs=[],t)for(var l in e.chefs)if(t[r]==e.chefs[l].chefId){var s=null;a&&(s=e.chefs[l].equip);var o=getRecipeResult(e.chefs[l],s,e.recipes[c],1,1,e.materials,null,0),n={};if(n.rankVal=o.rankVal,n.rankDisp=o.rankDisp,n.efficiency=o.chefEff||"",i){var p=getSkillDiff(e.chefs[l],e.recipes[c],4);n.skillDiffDisp=p.disp,n.skillDiffVal=p.value}e.recipes[c].chefs.push(n);break}}function getSkillDiff(e,a,i){var t=e.stirfryVal-a.stirfry*i,c=e.boilVal-a.boil*i,r=e.knifeVal-a.knife*i,l=e.fryVal-a.fry*i,s=e.bakeVal-a.bake*i,o=e.steamVal-a.steam*i,n="",p=0;t<0&&a.stirfry>0&&(n+="炒"+t+" ",p+=t),c<0&&a.boil>0&&(n+="煮"+c+" ",p+=c),r<0&&a.knife>0&&(n+="切"+r+" ",p+=r),l<0&&a.fry>0&&(n+="炸"+l+" ",p+=l),s<0&&a.bake>0&&(n+="烤"+s+" ",p+=s),o<0&&a.steam>0&&(n+="蒸"+o+" ",p+=o);var d={};return d.disp=n,d.value=-p,d}function updateChefsRecipesData(e){var a=$("#chk-chef-apply-equips").prop("checked"),i=$("#chk-chef-show-skill-diff").prop("checked"),t=$("#chk-chef-show-recipe").val();if(t.length>0)for(var c in e.chefs)for(var r in e.chefs[c].recipes=[],t)for(var l in e.recipes)if(t[r]==e.recipes[l].recipeId){var s=null;a&&(s=e.chefs[c].equip);var o=getRecipeResult(e.chefs[c],s,e.recipes[l],1,1,e.materials,null,0),n={};if(n.rankVal=o.rankVal,n.rankDisp=o.rankDisp,n.efficiency=o.chefEff||"",i){var p=getSkillDiff(e.chefs[c],e.recipes[l],4);n.skillDiffDisp=p.disp,n.skillDiffVal=p.value}e.chefs[c].recipes.push(n)}}function getTableOrder(e,a){var i=[],t=e.order();for(var c in t){var r=t[c][0];r<a&&i.push(t[c])}return i}function initChefTable(e){for(var a in reInitChefTable(e),e.recipes)$("#chk-chef-show-recipe").append("<option value='"+e.recipes[a].recipeId+"'>"+e.recipes[a].name+"</option>");$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;var t=$("#chk-chef-rarity-1").prop("checked"),c=$("#chk-chef-rarity-2").prop("checked"),r=$("#chk-chef-rarity-3").prop("checked"),l=$("#chk-chef-rarity-4").prop("checked"),s=$("#chk-chef-rarity-5").prop("checked"),o=Math.floor(a[3])||0;return!!(t&&1==o||c&&2==o||r&&3==o||l&&4==o||s&&5==o)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;var t=isNumeric($("#input-chef-stirfry").val())?$("#input-chef-stirfry").val():Number.NEGATIVE_INFINITY,c=Math.floor(a[4])||0,r=isNumeric($("#input-chef-boil").val())?$("#input-chef-boil").val():Number.NEGATIVE_INFINITY,l=Math.floor(a[5])||0,s=isNumeric($("#input-chef-knife").val())?$("#input-chef-knife").val():Number.NEGATIVE_INFINITY,o=Math.floor(a[6])||0,n=isNumeric($("#input-chef-fry").val())?$("#input-chef-fry").val():Number.NEGATIVE_INFINITY,p=Math.floor(a[7])||0,d=isNumeric($("#input-chef-bake").val())?$("#input-chef-bake").val():Number.NEGATIVE_INFINITY,h=Math.floor(a[8])||0,u=isNumeric($("#input-chef-steam").val())?$("#input-chef-steam").val():Number.NEGATIVE_INFINITY,f=Math.floor(a[9])||0;return t<=c&&r<=l&&s<=o&&n<=p&&d<=h&&u<=f}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;var t=$("#chk-chef-gender-male").prop("checked"),c=$("#chk-chef-gender-female").prop("checked"),r=a[15];return!!(t&&"男"==r||c&&"女"==r||t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;var t=$("#chk-chef-no-origin").prop("checked"),c=a[16];return!!(t||!t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;var t=$("#chk-chef-got").prop("checked"),c=a[22];return!!(!t||t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("chef-table"))return!0;for(var t=$.trim($("#pane-chefs .search-box input").val()),c=[2,10,16,17,20],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(){updateChefsRecipesData(e),reInitChefTable(e),initChefShow()}),$("#chk-chef-show-skill-diff").click(function(){$("#chk-chef-show-recipe").val().length&&(updateChefsRecipesData(e),reInitChefTable(e),initChefShow())}),$(".chk-chef-show").click(function(){initChefShow(),updateMenuLocalData()}),$("#chk-chef-show-all").click(function(){$(".chk-chef-show:checked").length==$(".chk-chef-show").length?$(".chk-chef-show").prop("checked",!1):$(".chk-chef-show").prop("checked",!0),initChefShow(),updateMenuLocalData()}),$('.chk-chef-rarity input[type="checkbox"]').click(function(){$("#chef-table").DataTable().draw()}),$(".input-chef-skill").keyup(function(){$("#chef-table").DataTable().draw()}),$("#btn-chef-skill-clear").click(function(){$(".input-chef-skill").val(""),$("#chef-table").DataTable().draw()}),$('.chk-chef-gender input[type="checkbox"]').click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-got").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-no-origin").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-show-final").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate").change(function(){$(this).prop("checked")?($(".chef-apply-ultimate").show(),$("#chk-chef-partial-ultimate").val().length?$(".partial-warning").removeClass("hidden"):$(".partial-warning").addClass("hidden")):($(".chef-apply-ultimate").hide(),$(".partial-warning").addClass("hidden")),updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate-person").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-partial-ultimate").selectpicker().on("changed.bs.select",function(){$(this).val().length?$(".partial-warning").removeClass("hidden"):$(".partial-warning").addClass("hidden"),updateRecipeChefTable(e)}),$("#chk-chef-apply-equips").change(function(){updateRecipeChefTable(e)}),$("#btn-chef-recal").click(function(){updateRecipeChefTable(e)}),private&&$("#chk-chef-no-origin").closest(".box").removeClass("hidden"),initChefShow()}function reInitChefTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-chef-icon",orderable:!1,searchable:!1},{data:"name"},{data:{_:"rarity",display:"rarityDisp"},orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:{_:"meatVal",display:"meatDisp"},orderSequence:["desc","asc"]},{data:{_:"creationVal",display:"creationDisp"},orderSequence:["desc","asc"]},{data:{_:"vegVal",display:"vegDisp"},orderSequence:["desc","asc"]},{data:{_:"fishVal",display:"fishDisp"},orderSequence:["desc","asc"]},{data:"gender"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:{_:"equipName",display:"equipDisp"}},{data:"ultimateGoal"},{data:"ultimateSkillDisp"},{data:"ultimate",width:"31px"},{data:"got",width:"31px"}],i=20,t="",c=[];$.fn.DataTable.isDataTable("#chef-table")&&(t=$("#pane-chefs .search-box input").val(),c=getTableOrder($("#chef-table").DataTable(),a.length),$("#chef-table").DataTable().MakeCellsEditable("destroy"),$("#chef-table").DataTable().destroy()),$("#chef-table").html($("#chef-table-header").html());var r=$("#chk-chef-show-skill-diff").prop("checked"),l=$("#chk-chef-show-recipe").val();for(var s in l)for(var o in e.recipes)if(l[s]==e.recipes[o].recipeId){$("#chef-table thead tr").append("<th title='"+e.recipes[o].skillDisp+"'>"+e.recipes[o].name+"</th>"),r&&$("#chef-table thead tr").append("<th>神差值</th>"),$("#chef-table thead tr").append("<th>效率</th>"),a.push({data:{_:"recipes."+s+".rankVal",display:"recipes."+s+".rankDisp"},orderSequence:["desc","asc"]}),r&&a.push({data:{_:"recipes."+s+".skillDiffVal",display:"recipes."+s+".skillDiffDisp"}}),a.push({data:"recipes."+s+".efficiency",orderSequence:["desc","asc"]});break}var n=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨师",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨师中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:i,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:c,autoWidth:!1,fixedHeader:!0});$("#pane-chefs div.search-box").html('<label>查找:<input type="search" value="'+t+'" class="form-control input-sm" placeholder="名字 技能 来源"></label>');var p=getGotOptions(),d=getEquipsOptions(e.equips,e.skills);n.MakeCellsEditable({columns:[18,21,22],inputTypes:[{column:18,type:"list",search:!0,clear:!0,options:d},{column:21,type:"list",options:p},{column:22,type:"list",options:p}],onUpdate:function(a,i,t,c){if(18==t.index().column){var r=i.data(),l=null,s="";if(r.equipName)for(var o in e.equips)if(r.equipName==e.equips[o].name){l=e.equips[o],s=e.equips[o].name+"<br>"+e.equips[o].skillDisp;break}r.equip=l,r.equipDisp=s,$(t.node()).html(s)}18!=t.index().column&&21!=t.index().column||t.data()==c||$("#btn-chef-recal").closest(".box").removeClass("hidden"),updateChefsLocalData()}}),$("#pane-chefs .search-box input").keyup(function(){n.draw()})}function initEquipTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name"},{data:{_:"rarity",display:"rarityDisp"},orderSequence:["desc","asc"]},{data:"skillDisp"},{data:"origin"}],i=$("#equip-table").DataTable({data:e.equips,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨具",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨具中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,autoWidth:!1,fixedHeader:!0});$("#pane-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("equip-table"))return!0;var r=t.skillFilter;return!!($("#chk-equip-skill-stirfry-price").prop("checked")&&r.indexOf("UseStirfry")>=0||$("#chk-equip-skill-boil-price").prop("checked")&&r.indexOf("UseBoil")>=0||$("#chk-equip-skill-knife-price").prop("checked")&&r.indexOf("UseKnife")>=0||$("#chk-equip-skill-fry-price").prop("checked")&&r.indexOf("UseFry")>=0||$("#chk-equip-skill-bake-price").prop("checked")&&r.indexOf("UseBake")>=0||$("#chk-equip-skill-steam-price").prop("checked")&&r.indexOf("UseSteam")>=0||$("#chk-equip-skill-meat-price").prop("checked")&&r.indexOf("UseMeat")>=0||$("#chk-equip-skill-creation-price").prop("checked")&&r.indexOf("UseCreation")>=0||$("#chk-equip-skill-veg-price").prop("checked")&&r.indexOf("UseVegetable")>=0||$("#chk-equip-skill-fish-price").prop("checked")&&r.indexOf("UseFish")>=0||$("#chk-equip-skill-sell-price").prop("checked")&&r.indexOf("Gold_Gain")>=0||$("#chk-equip-skill-stirfry-skill").prop("checked")&&r.indexOf("Stirfry")>=0||$("#chk-equip-skill-boil-skill").prop("checked")&&r.indexOf("Boil")>=0||$("#chk-equip-skill-knife-skill").prop("checked")&&r.indexOf("Knife")>=0||$("#chk-equip-skill-fry-skill").prop("checked")&&r.indexOf("Fry")>=0||$("#chk-equip-skill-bake-skill").prop("checked")&&r.indexOf("Bake")>=0||$("#chk-equip-skill-steam-skill").prop("checked")&&r.indexOf("Steam")>=0||$("#chk-equip-skill-all-skill").prop("checked")&&r.indexOf("Stirfry")>=0&&r.indexOf("Boil")>=0&&r.indexOf("Knife")>=0&&r.indexOf("Fry")>=0&&r.indexOf("Bake")>=0&&r.indexOf("Steam")>=0||$("#chk-equip-skill-guest").prop("checked")&&r.indexOf("GuestApearRate")>=0||$("#chk-equip-skill-time").prop("checked")&&r.indexOf("OpenTime")>=0||$("#chk-equip-skill-material-get").prop("checked")&&r.indexOf("Material_Gain")>=0||$("#chk-equip-skill-meat-skill").prop("checked")&&r.indexOf("Meat")>=0||$("#chk-equip-skill-creation-skill").prop("checked")&&r.indexOf("Creation")>=0||$("#chk-equip-skill-veg-skill").prop("checked")&&r.indexOf("Vegetable")>=0||$("#chk-equip-skill-fish-skill").prop("checked")&&r.indexOf("Fish")>=0||$("#chk-equip-skill-material-skill").prop("checked")&&r.indexOf("Meat")>=0&&r.indexOf("Creation")>=0&&r.indexOf("Vegetable")>=0&&r.indexOf("Fish")>=0)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("equip-table"))return!0;var t=$("#chk-equip-no-origin").prop("checked"),c=a[5];return!!(t||!t&&c)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("equip-table"))return!0;for(var t=$.trim($("#pane-equips .search-box input").val()),c=[2,4,5],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$(".chk-equip-show").click(function(){initEquipShow(),updateMenuLocalData()}),$("#chk-equip-show-all").click(function(){$(".chk-equip-show:checked").length==$(".chk-equip-show").length?$(".chk-equip-show").prop("checked",!1):$(".chk-equip-show").prop("checked",!0),initEquipShow(),updateMenuLocalData()}),$(".chk-equip-skill").click(function(){$(this).prop("checked")&&$("#chk-equip-single-skill").prop("checked")&&$(".chk-equip-skill").not(this).prop("checked",!1),i.draw()}),$("#chk-equip-single-skill").change(function(){$(this).prop("checked")&&$(".chk-equip-skill:checked").length>1&&($(".chk-equip-skill").prop("checked",!1),i.draw())}),$("#chk-equip-skill-all").click(function(){$("#chk-equip-single-skill").prop("checked")&&$("#chk-equip-single-skill").bootstrapToggle("off"),$(".chk-equip-skill").prop("checked",!0),i.draw()}),$("#chk-equip-no-origin").click(function(){i.draw()}),$("#pane-equips .search-box input").keyup(function(){i.draw()}),private&&$("#chk-equip-no-origin").closest(".box").removeClass("hidden"),initEquipShow()}function initDecorationTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"id",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name"},{data:{_:"gold",display:"goldDisp"},orderSequence:["desc","asc"]},{data:"tipMin",orderSequence:["desc","asc"]},{data:"tipMax",orderSequence:["desc","asc"]},{data:{_:"tipTime",display:"tipTimeDisp"},orderSequence:["desc","asc"]},{data:"minEff",defaultContent:"",orderSequence:["desc","asc"]},{data:"maxEff",defaultContent:"",orderSequence:["desc","asc"]},{data:"avgEff",defaultContent:"",orderSequence:["desc","asc"]},{data:"position"},{data:"suit",orderSequence:["desc","asc"]},{data:{_:"suitGold",display:"suitGoldDisp"},orderSequence:["desc","asc"]},{data:"origin"}],i=$("#decoration-table").DataTable({data:e.decorations,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个装饰",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个装饰中过滤)",select:{rows:{_:"选择了 %d 个装饰",0:"",1:"选择了 %d 个装饰"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[0,"desc"],[10,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:!0});$("#pane-decorations div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 套装 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("decoration-table"))return!0;var r=t.position;return!!($("#chk-decoration-position-1").prop("checked")&&"1大桌"==r||$("#chk-decoration-position-2").prop("checked")&&"1小桌"==r||$("#chk-decoration-position-3").prop("checked")&&"2大桌"==r||$("#chk-decoration-position-4").prop("checked")&&"2小桌"==r||$("#chk-decoration-position-5").prop("checked")&&"3大桌"==r||$("#chk-decoration-position-6").prop("checked")&&"3小桌"==r||$("#chk-decoration-position-7").prop("checked")&&"1窗"==r||$("#chk-decoration-position-8").prop("checked")&&"1装饰"==r||$("#chk-decoration-position-9").prop("checked")&&"1门"==r||$("#chk-decoration-position-10").prop("checked")&&"1灯"==r||$("#chk-decoration-position-11").prop("checked")&&"2装饰"==r||$("#chk-decoration-position-12").prop("checked")&&"2门"==r||$("#chk-decoration-position-13").prop("checked")&&"2窗"==r||$("#chk-decoration-position-14").prop("checked")&&"2屏风"==r||$("#chk-decoration-position-15").prop("checked")&&"3灯"==r||$("#chk-decoration-position-16").prop("checked")&&"3包间"==r)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("decoration-table"))return!0;var r=t.origin,l=$("#chk-decoration-no-origin").prop("checked");return!!(l||!l&&r)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("decoration-table"))return!0;for(var t=$.trim($("#pane-decorations .search-box input").val()),c=[3,12,14],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0
;return!1}),$(".chk-decoration-show").click(function(){initDecorationShow(),updateMenuLocalData()}),$("#chk-decoration-show-all").click(function(){$(".chk-decoration-show:checked").length==$(".chk-decoration-show").length?$(".chk-decoration-show").prop("checked",!1):$(".chk-decoration-show").prop("checked",!0),initDecorationShow(),updateMenuLocalData()}),$(".chk-decoration-position").click(function(){$(this).prop("checked")&&$("#chk-decoration-single-position").prop("checked")&&$(".chk-decoration-position").not(this).prop("checked",!1),i.draw()}),$("#chk-decoration-single-position").change(function(){$(this).prop("checked")&&$(".chk-decoration-position:checked").length>1&&($(".chk-decoration-position").prop("checked",!1),i.draw())}),$("#chk-decoration-position-all").click(function(){$("#chk-decoration-single-position").prop("checked")&&$("#chk-decoration-single-position").bootstrapToggle("off"),$(".chk-decoration-position").prop("checked",!0),i.draw()}),$("#chk-decoration-no-origin").click(function(){i.draw()}),$("#pane-decorations .search-box input").keyup(function(){i.draw()});var t="<option></option>";for(var c in e.suits)t+="<option value='"+e.suits[c].name+"'>"+e.suits[c].name+"</option>";$("#select-decoration-suit").append(t).selectpicker("refresh").change(function(){var e=$("#select-decoration-suit").val();$("#select-decoration-suit").selectpicker("val",""),i.rows().deselect(),i.rows().every(function(a,i,t){this.data().suit==e&&this.select()}),i.draw()}),$("#btn-decoration-deselect-all").click(function(){$("#select-decoration-suit").selectpicker("val",""),i.rows().deselect()}),i.on("user-select",function(e,a,t,c,r){var l=c.index().row,s=i.rows(l).data()[0];i.rows({selected:!0}).every(function(e,a,i){this.data().position==s.position&&this.data().id!=s.id&&this.deselect()})}),i.on("select",function(a,i,t,c){updateDecorationSum(e)}),i.on("deselect",function(a,i,t,c){updateDecorationSum(e)}),private&&$("#chk-decoration-no-origin").closest(".box").removeClass("hidden"),initDecorationShow()}function updateDecorationSum(e){var a=$("#decoration-table").DataTable().rows({selected:!0}).data().toArray(),i=0,t=0,c=[];for(var r in a)a[r].suit&&c.indexOf(a[r].suit)<0&&c.push(a[r].suit),a[r].avgEff&&(i+=a[r].avgEff),t+=a[r].gold;var l=0;for(var r in c)l+=getSuitGold(e,a,c[r]);var s="";a.length&&(s="平均玉璧/天:"+ +i.toFixed(1)+" 收入加成: "+getPercentDisp(+(100*(t+l)).toFixed(2))),$("#decoration-sum").html(s)}function getSuitGold(e,a,i){for(var t in e.suits)if(e.suits[t].name==i){for(var c in e.suits[t].decorations){var r=!1;for(var l in a)if(e.suits[t].decorations[c]==a[l].id){r=!0;break}if(!r)return 0}return e.suits[t].gold}return 0}function initMaterialTable(e){for(var a in e.maps)$("#select-material-origin").append("<option value='"+e.maps[a].name+"'>"+e.maps[a].name+"</option>");reInitMaterialTable(e),$("#select-material-origin").change(function(){reInitMaterialTable(e)}),$("#chk-material-season").click(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()}),$("#input-material-addition, #input-material-skill").keyup(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()})}function reInitMaterialTable(e){var a=[{data:"name"},{data:"skill",defaultContent:""}];$.fn.DataTable.isDataTable("#material-table")&&$("#material-table").DataTable().destroy();var i,t=$("#select-material-origin").val();for(var c in e.maps)if(t==e.maps[c].name){i=e.maps[c];break}for(var c in $("#material-table thead tr").first().html("").append("<th rowspan='2'>食材</th><th rowspan='2'>点数</th>"),$("#material-table thead tr").last().html(""),i.time)$("#material-table thead tr").first().append("<th colspan='2'>"+secondsToTime(i.time[c])+"</th>"),$("#material-table thead tr").last().append("<th>最小</th><th>最大</th>"),a.push({data:"time."+c+".0"}),a.push({data:"time."+c+".1"});var r=getMaterialsData(e,i),l=$("#material-table").DataTable({data:r,columns:a,dom:"<'row'<'col-sm-12'tr>>",paging:!1,ordering:!1,info:!1,deferRender:!0,autoWidth:!1});l.draw()}function initQuestTable(e){for(var a in e.activities)$("#select-quest-type").append("<option>"+e.activities[a].name+"</option>");var i=[{data:"questId",width:"1px"},{data:"preId",defaultContent:"",orderable:!1,width:"30px"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],t=getQuestsData(e.quests,$("#select-quest-type").val()),c=$("#quest-table").DataTable({data:t,columns:i,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个任务",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个任务中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,autoWidth:!1,fixedHeader:!0});$("#pane-quest div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="编号 任务 奖励"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("quest-table"))return!0;for(var t=$.trim($("#pane-quest .search-box input").val()),c=[0,2,3],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$("#pane-quest .search-box input").keyup(function(){c.draw()}),$("#select-quest-type").change(function(){var a=getQuestsData(e.quests,$(this).val());c.clear().rows.add(a).draw(),initQuestShow(c)}),initQuestShow(c)}function initImportExport(e){$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$("#import-msg-2").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=importData(e,$("#input-export-import").val());a?($("#input-export-import").val(""),$("#import-msg-2").html("导入成功 !")):$("#import-msg-2").html("导入失败 !")},500)}),$("#btn-export-download").click(function(){var e=new Blob([generateExportData()],{type:"text/plain;charset=utf-8"});saveAs(e,"food.txt")}),$("#file-import").change(function(){$("#import-msg").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=document.getElementById("file-import").files[0],i=new FileReader;i.onload=function(a){var i=importData(e,a.target.result);i?$("#import-msg").html("导入成功 !"):$("#import-msg").html("导入失败 !")},i.readAsText(a,"UTF-8"),$(this).val("")},500)})}function importData(e,a){var i;try{i=JSON.parse(a)}catch(e){return!1}for(var t in e.recipes){for(var c in i.recipes)if(e.recipes[t].recipeId==i.recipes[c].id){if(i.recipes[c].hasOwnProperty("rank")){e.recipes[t].rank=i.recipes[c].rank;var r=getRankGuestInfo(e.recipes[t],e.recipes[t].rank);e.recipes[t].rankGuestsVal=r.rankGuestsVal,e.recipes[t].rankGuestsDisp=r.rankGuestsDisp}i.recipes[c].hasOwnProperty("ex")&&(e.recipes[t].ex=i.recipes[c].ex),i.recipes[c].hasOwnProperty("got")&&(e.recipes[t].got=i.recipes[c].got);break}for(var c in i.recipesTags)if(e.recipes[t].recipeId==i.recipesTags[c].recipeId){e.recipes[t].tags=i.recipesTags[c].tags,e.recipes[t].tagsDisp=getTagsDisp(i.recipesTags[c].tags,i.tags),e.recipes[t].exTime=i.recipesTags[c].experienceTime,e.recipes[t].exTimeDisp=getExTimeDisp(i.recipesTags[c].experienceTime,e.recipes[t].time);break}}for(var t in e.chefs){for(var c in i.chefs)if(e.chefs[t].chefId==i.chefs[c].id){if(i.chefs[c].hasOwnProperty("got")&&(e.chefs[t].got=i.chefs[c].got),i.chefs[c].hasOwnProperty("ult")&&(e.chefs[t].ultimate=i.chefs[c].ult),i.chefs[c].hasOwnProperty("equip")){for(var l in e.equips)if(i.chefs[c].equip==e.equips[l].equipId){e.chefs[t].equip=e.equips[l],e.chefs[t].equipName=e.equips[l].name,e.chefs[t].equipDisp=e.equips[l].name+"<br>"+e.equips[l].skillDisp;break}}else e.chefs[t].equip=null;break}for(var c in i.chefsTags)if(e.chefs[t].chefId==i.chefsTags[c].chefId){e.chefs[t].tags=i.chefsTags[c].tags,e.chefs[t].tagsDisp=getTagsDisp(i.chefsTags[c].tags,i.tags);break}}var s="";for(var t in i.rules){var o=!1;for(var c in e.rules)if(i.rules[t].Id==e.rules[c].Id){e.rules[c]=i.rules[t],o=!0;break}o||(e.rules.push(i.rules[t]),s+="<option value='"+i.rules[t].Id+"'>"+i.rules[t].Title+"</option>")}$("#select-cal-rule").append(s).selectpicker("refresh"),i.calEquips&&($("#cal-equips-table").DataTable().rows().deselect(),$("#cal-equips-table").DataTable().rows(function(e,a,t){for(var c in i.calEquips)if(a.equipId==i.calEquips[c])return!0;return!1}).select()),updateMenu(i),i.decorationEffect&&(e.decorationEffect=i.decorationEffect,$("#input-cal-decoration").val(i.decorationEffect||""));try{localStorage.setItem("data",generateExportData())}catch(e){}return e=getUpdateData(e),$("#recipe-table").DataTable().clear().rows.add(e.recipes).draw(),$("#chef-table").DataTable().clear().rows.add(e.chefs).draw(),initRecipeShow(),initChefShow(),initEquipShow(),!0}function updateRecipesLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.recipes=generateRecipesExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateChefsLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.chefs=generateChefsExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateMenuLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.menu=generateMenuExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateDecorationLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.decorationEffect=Number($("#input-cal-decoration").val());try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateLocalData(e,a){var i;try{var t=localStorage.getItem("data");i=JSON.parse(t)}catch(e){}i||(i={}),i[e]=a;try{localStorage.setItem("data",JSON.stringify(i))}catch(e){}}function generateExportData(){var e={};return e.recipes=generateRecipesExportData(),e.chefs=generateChefsExportData(),e.menu=generateMenuExportData(),e.decorationEffect=Number($("#input-cal-decoration").val()),JSON.stringify(e)}function generateRecipesExportData(){var e=[],a=$("#recipe-table").DataTable().data().toArray();for(var i in a){var t={};t.id=a[i].recipeId,t.rank=a[i].rank,t.ex=a[i].ex,t.got=a[i].got,e.push(t)}return e}function generateChefsExportData(){var e=[],a=$("#chef-table").DataTable().data().toArray();for(var i in a){var t={};t.id=a[i].chefId,t.got=a[i].got,t.ult=a[i].ultimate,a[i].equip&&(t.equip=a[i].equip.equipId),e.push(t)}return e}function generateMenuExportData(){var e={},a={};a.id=$("#chk-recipe-show-id").prop("checked"),a.icon=$("#chk-recipe-show-icon").prop("checked"),a.rarity=$("#chk-recipe-show-rarity").prop("checked"),a.skill=$("#chk-recipe-show-skill").prop("checked"),a.materials=$("#chk-recipe-show-materials").prop("checked"),a.price=$("#chk-recipe-show-price").prop("checked"),a.exPrice=$("#chk-recipe-show-ex-price").prop("checked"),a.exTime=$("#chk-recipe-show-ex-time").prop("checked"),a.time=$("#chk-recipe-show-time").prop("checked"),a.limit=$("#chk-recipe-show-limit").prop("checked"),a.totalPrice=$("#chk-recipe-show-total-price").prop("checked"),a.totalTime=$("#chk-recipe-show-total-time").prop("checked"),a.efficiency=$("#chk-recipe-show-efficiency").prop("checked"),a.materialsEfficiency=$("#chk-recipe-show-materials-efficiency").prop("checked"),a.origin=$("#chk-recipe-show-origin").prop("checked"),a.unlock=$("#chk-recipe-show-unlock").prop("checked"),a.combo=$("#chk-recipe-show-combo").prop("checked"),a.tags=$("#chk-recipe-show-tags").prop("checked"),a.guest=$("#chk-recipe-show-guest").prop("checked"),a.rankGuest=$("#chk-recipe-show-rank-guest").prop("checked"),a.rankAntique=$("#chk-recipe-show-rank-antique").prop("checked"),a.rank=$("#chk-recipe-show-rank").prop("checked"),a.ex=$("#chk-recipe-show-ex").prop("checked"),a.got=$("#chk-recipe-show-got").prop("checked"),e.recipe=a;var i={};i.id=$("#chk-chef-show-id").prop("checked"),i.icon=$("#chk-chef-show-icon").prop("checked"),i.rarity=$("#chk-chef-show-rarity").prop("checked"),i.skill=$("#chk-chef-show-skill").prop("checked"),i.chefSkill=$("#chk-chef-show-chef-skill").prop("checked"),i.explore=$("#chk-chef-show-explore").prop("checked"),i.gender=$("#chk-chef-show-gender").prop("checked"),i.origin=$("#chk-chef-show-origin").prop("checked"),i.tags=$("#chk-chef-show-tags").prop("checked"),i.equip=$("#chk-chef-show-equip").prop("checked"),i.ultimateGoal=$("#chk-chef-show-ultimate-goal").prop("checked"),i.ultimateSkill=$("#chk-chef-show-ultimate-skill").prop("checked"),i.ultimate=$("#chk-chef-show-ultimate").prop("checked"),i.got=$("#chk-chef-show-got").prop("checked"),e.chef=i;var t={};t.id=$("#chk-equip-show-id").prop("checked"),t.icon=$("#chk-equip-show-icon").prop("checked"),t.rarity=$("#chk-equip-show-rarity").prop("checked"),t.skill=$("#chk-equip-show-skill").prop("checked"),t.origin=$("#chk-equip-show-origin").prop("checked"),e.equip=t;var c={};return c.id=$("#chk-decoration-show-id").prop("checked"),c.icon=$("#chk-decoration-show-icon").prop("checked"),c.minEff=$("#chk-decoration-show-min-eff").prop("checked"),c.maxEff=$("#chk-decoration-show-max-eff").prop("checked"),c.avgEff=$("#chk-decoration-show-avg-eff").prop("checked"),c.position=$("#chk-decoration-show-position").prop("checked"),c.suit=$("#chk-decoration-show-suit").prop("checked"),c.suitGold=$("#chk-decoration-show-suit-gold").prop("checked"),c.origin=$("#chk-decoration-show-origin").prop("checked"),e.decoration=c,e}function updateMenu(e){if(e&&e.menu){var a=e.menu.recipe;a&&($("#chk-recipe-show-id").prop("checked",a.id||!1),$("#chk-recipe-show-icon").prop("checked",a.icon||!1),$("#chk-recipe-show-rarity").prop("checked",a.rarity||!1),$("#chk-recipe-show-skill").prop("checked",a.skill||!1),$("#chk-recipe-show-materials").prop("checked",a.materials||!1),$("#chk-recipe-show-price").prop("checked",a.price||!1),$("#chk-recipe-show-ex-price").prop("checked",a.exPrice||!1),$("#chk-recipe-show-ex-time").prop("checked",a.exTime||!1),$("#chk-recipe-show-time").prop("checked",a.time||!1),$("#chk-recipe-show-limit").prop("checked",a.limit||!1),$("#chk-recipe-show-total-price").prop("checked",a.totalPrice||!1),$("#chk-recipe-show-total-time").prop("checked",a.totalTime||!1),$("#chk-recipe-show-efficiency").prop("checked",a.efficiency||!1),$("#chk-recipe-show-materials-efficiency").prop("checked",a.materialsEfficiency||!1),$("#chk-recipe-show-origin").prop("checked",a.origin||!1),$("#chk-recipe-show-unlock").prop("checked",a.unlock||!1),$("#chk-recipe-show-combo").prop("checked",a.combo||!1),$("#chk-recipe-show-tags").prop("checked",a.tags||!1),$("#chk-recipe-show-guest").prop("checked",a.guest||!1),$("#chk-recipe-show-rank-guest").prop("checked",a.rankGuest||!1),$("#chk-recipe-show-rank-antique").prop("checked",a.rankAntique||!1),$("#chk-recipe-show-rank").prop("checked",a.rank||!1),$("#chk-recipe-show-ex").prop("checked",a.ex||!1),$("#chk-recipe-show-got").prop("checked",a.got||!1));var i=e.menu.chef;i&&($("#chk-chef-show-id").prop("checked",i.id||!1),$("#chk-chef-show-icon").prop("checked",i.icon||!1),$("#chk-chef-show-rarity").prop("checked",i.rarity||!1),$("#chk-chef-show-skill").prop("checked",i.skill||!1),$("#chk-chef-show-chef-skill").prop("checked",i.chefSkill||!1),$("#chk-chef-show-explore").prop("checked",i.explore||!1),$("#chk-chef-show-gender").prop("checked",i.gender||!1),$("#chk-chef-show-origin").prop("checked",i.origin||!1),$("#chk-chef-show-tags").prop("checked",i.tags||!1),$("#chk-chef-show-equip").prop("checked",i.equip||!1),$("#chk-chef-show-ultimate-goal").prop("checked",i.ultimateGoal||!1),$("#chk-chef-show-ultimate-skill").prop("checked",i.ultimateSkill||!1),$("#chk-chef-show-ultimate").prop("checked",i.ultimate||!1),$("#chk-chef-show-got").prop("checked",i.got||!1));var t=e.menu.equip;t&&($("#chk-equip-show-id").prop("checked",t.id||!1),$("#chk-equip-show-icon").prop("checked",t.icon||!1),$("#chk-equip-show-rarity").prop("checked",t.rarity||!1),$("#chk-equip-show-skill").prop("checked",t.skill||!1),$("#chk-equip-show-origin").prop("checked",t.origin||!1));var c=e.menu.decoration;c&&($("#chk-decoration-show-id").prop("checked",c.id||!1),$("#chk-decoration-show-icon").prop("checked",c.icon||!1),$("#chk-decoration-show-min-eff").prop("checked",c.minEff||!1),$("#chk-decoration-show-max-eff").prop("checked",c.maxEff||!1),$("#chk-decoration-show-avg-eff").prop("checked",c.avgEff||!1),$("#chk-decoration-show-position").prop("checked",c.position||!1),$("#chk-decoration-show-suit").prop("checked",c.suit||!1),$("#chk-decoration-show-suit-gold").prop("checked",c.suitGold||!1),$("#chk-decoration-show-origin").prop("checked",c.origin||!1))}}function initCalTables(e){setSelfUltimateOptions(e.chefs,e.skills),setExOptions(e.recipes),initCalResultsTable(e),initCalRules(e),private&&($("#pane-cal").addClass("admin"),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),$("#input-cal-thread").val(navigator.hardwareConcurrency))}function initCalRules(e){var a="";for(var i in e.rules)a+="<option value='"+e.rules[i].Id+"'>"+e.rules[i].Title+"</option>";$("#select-cal-rule").append(a).selectpicker("refresh").change(function(){$("#btn-cal-rule-load").removeClass("btn-default").addClass("btn-danger")}),$("#input-cal-decoration").val(e.decorationEffect||""),loadUltimate(e,!0),$("#btn-cal-rule-load").click(function(){var a=Math.floor($("#select-cal-rule").val());for(var i in e.rules)if(e.rules[i].Id==a){currentRule=e.rules[i];break}currentRule&&($("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){loadRule(e,currentRule),setCalConfigData(currentRule,e),initCalCustomOptions(currentRule,e),$(".loading").addClass("hidden"),$(".cal-menu").removeClass("hidden"),$("#pane-cal-self-select .cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results .cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1).removeClass("btn-danger").addClass("btn-default")},500))}),$("#btn-cal-update").click(function(){$("#btn-cal-decoration").prop("disabled",!0),$("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){setCalConfigData(currentRule,e),calCustomResults(currentRule,e),$(".loading").addClass("hidden"),$("#pane-cal-self-select .cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results .cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1)},500)}),$("#input-cal-decoration").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),updateDecorationLocalData()}),$("#cal-ultimate input").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-partial-ultimate").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-self-ultimate").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-ex").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#btn-cal-load-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!0)}),$("#btn-cal-load-all-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!1)}),$("#btn-cal-clear-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),$("#chk-cal-partial-ultimate").selectpicker("deselectAll"),$("#chk-cal-self-ultimate").selectpicker("deselectAll"),$("#chk-cal-ex").selectpicker("deselectAll")}),$("#chk-cal-got").click(function(){$("#cal-recipes-results-table").DataTable().draw(),initCalCustomOptions(currentRule,e)}),$("#chk-cal-no-origin").click(function(){$("#cal-recipes-results-table").DataTable().draw(),initCalCustomOptions(currentRule,e)}),$("#select-cal-order").change(function(){initCalCustomOptions(currentRule,e),sortRecipesResult()}),$("#btn-cal-clear-custom").click(function(){var a=$("#cal-self-select-table").DataTable(),i=a.data().toArray();for(var t in i)i[t].chef.name="",i[t].equip.name="",i[t].recipe.data.name="";calCustomResults(currentRule,e)}),cal&&$("#chk-cal-no-origin").prop("checked",!0),private&&$("#chk-cal-no-origin").closest(".box").removeClass("hidden")}function loadUltimate(e,a){var i;try{var t=localStorage.getItem("data");i=JSON.parse(t)}catch(e){}var c=getUltimateData(e.chefs,i,e.skills,!0,a),r=c.global;for(var l in r)"Stirfry"!=r[l].type||r[l].tag?"Boil"!=r[l].type||r[l].tag?"Knife"!=r[l].type||r[l].tag?"Fry"!=r[l].type||r[l].tag?"Bake"!=r[l].type||r[l].tag?"Steam"!=r[l].type||r[l].tag?1!=r[l].tag?2!=r[l].tag?"MaxEquipLimit"!=r[l].type||1!=r[l].rarity?"MaxEquipLimit"!=r[l].type||2!=r[l].rarity?"MaxEquipLimit"!=r[l].type||3!=r[l].rarity?"MaxEquipLimit"!=r[l].type||4!=r[l].rarity?"MaxEquipLimit"!=r[l].type||5!=r[l].rarity?"UseAll"!=r[l].type||2!=r[l].rarity?"UseAll"!=r[l].type||3!=r[l].rarity?"UseAll"!=r[l].type||4!=r[l].rarity?"UseAll"!=r[l].type||5!=r[l].rarity?"Material_Gain"!=r[l].type&&console.log(r[l].type):$("#input-cal-ultimate-5-price").val(r[l].value):$("#input-cal-ultimate-4-price").val(r[l].value):$("#input-cal-ultimate-3-price").val(r[l].value):$("#input-cal-ultimate-2-price").val(r[l].value):$("#input-cal-ultimate-5-limit").val(r[l].value):$("#input-cal-ultimate-4-limit").val(r[l].value):$("#input-cal-ultimate-3-limit").val(r[l].value):$("#input-cal-ultimate-2-limit").val(r[l].value):$("#input-cal-ultimate-1-limit").val(r[l].value):$("#input-cal-ultimate-female-skill").val(r[l].value):$("#input-cal-ultimate-male-skill").val(r[l].value):$("#input-cal-ultimate-steam").val(r[l].value):$("#input-cal-ultimate-bake").val(r[l].value):$("#input-cal-ultimate-fry").val(r[l].value):$("#input-cal-ultimate-knife").val(r[l].value):$("#input-cal-ultimate-boil").val(r[l].value):$("#input-cal-ultimate-stirfry").val(r[l].value);var s=c.partial,o=[];for(var l in s)o.push(s[l].chefId);$("#chk-cal-partial-ultimate").selectpicker("val",o);var n=c.self,p=[];for(var l in n)p.push(n[l].chefId);$("#chk-cal-self-ultimate").selectpicker("val",p);var d=[];for(var l in e.recipes)(a&&"是"==e.recipes[l].ex||!a)&&d.push(e.recipes[l].recipeId);$("#chk-cal-ex").selectpicker("val",d)}function setCalConfigData(e,a){$("#btn-cal-update").removeClass("btn-danger").addClass("btn-default"),e.decorationEffect=Number($("#input-cal-decoration").val());var i=[],t=Number($("#input-cal-ultimate-stirfry").val());if(t){var c={type:"Stirfry"};c.value=t,c.condition="Global",c.cal="Abs",i.push(c)}var r=Number($("#input-cal-ultimate-boil").val());if(r){c={type:"Boil"};c.value=r,c.condition="Global",c.cal="Abs",i.push(c)}var l=Number($("#input-cal-ultimate-knife").val());if(l){c={type:"Knife"};c.value=l,c.condition="Global",c.cal="Abs",i.push(c)}var s=Number($("#input-cal-ultimate-fry").val());if(s){c={type:"Fry"};c.value=s,c.condition="Global",c.cal="Abs",i.push(c)}var o=Number($("#input-cal-ultimate-bake").val());if(o){c={type:"Bake"};c.value=o,c.condition="Global",c.cal="Abs",i.push(c)}var n=Number($("#input-cal-ultimate-steam").val());if(n){c={type:"Steam"};c.value=n,c.condition="Global",c.cal="Abs",i.push(c)}var p=Number($("#input-cal-ultimate-male-skill").val());if(p){var d={type:"Stirfry"};d.value=p,d.condition="Global",d.cal="Abs",d.tag=1,i.push(d);var h={type:"Boil"};h.value=p,h.condition="Global",h.cal="Abs",h.tag=1,i.push(h);var u={type:"Knife"};u.value=p,u.condition="Global",u.cal="Abs",u.tag=1,i.push(u);var f={type:"Fry"};f.value=p,f.condition="Global",f.cal="Abs",f.tag=1,i.push(f);var k={type:"Bake"};k.value=p,k.condition="Global",k.cal="Abs",k.tag=1,i.push(k);var m={type:"Steam"};m.value=p,m.condition="Global",m.cal="Abs",m.tag=1,i.push(m)}var b=Number($("#input-cal-ultimate-female-skill").val());if(b){d={type:"Stirfry"};d.value=b,d.condition="Global",d.cal="Abs",d.tag=2,i.push(d);h={type:"Boil"};h.value=b,h.condition="Global",h.cal="Abs",h.tag=2,i.push(h);u={type:"Knife"};u.value=b,u.condition="Global",u.cal="Abs",u.tag=2,i.push(u);f={type:"Fry"};f.value=b,f.condition="Global",f.cal="Abs",f.tag=2,i.push(f);k={type:"Bake"};k.value=b,k.condition="Global",k.cal="Abs",k.tag=2,i.push(k);m={type:"Steam"};m.value=b,m.condition="Global",m.cal="Abs",m.tag=2,i.push(m)}var v=Number($("#input-cal-ultimate-1-limit").val());if(v){c={type:"MaxEquipLimit"};c.value=v,c.condition="Global",c.cal="Abs",c.rarity=1,i.push(c)}var g=Number($("#input-cal-ultimate-2-limit").val());if(g){c={type:"MaxEquipLimit"};c.value=g,c.condition="Global",c.cal="Abs",c.rarity=2,i.push(c)}var y=Number($("#input-cal-ultimate-3-limit").val());if(y){c={type:"MaxEquipLimit"};c.value=y,c.condition="Global",c.cal="Abs",c.rarity=3,i.push(c)}var w=Number($("#input-cal-ultimate-4-limit").val());if(w){c={type:"MaxEquipLimit"};c.value=w,c.condition="Global",c.cal="Abs",c.rarity=4,i.push(c)}var x=Number($("#input-cal-ultimate-5-limit").val());if(x){c={type:"MaxEquipLimit"};c.value=x,c.condition="Global",c.cal="Abs",c.rarity=5,i.push(c)}var T=Number($("#input-cal-ultimate-2-price").val());if(T){c={type:"UseAll"};c.value=T,c.condition="Global",c.cal="Percent",c.rarity=2,i.push(c)}var q=Number($("#input-cal-ultimate-3-price").val());if(q){c={type:"UseAll"};c.value=q,c.condition="Global",c.cal="Percent",c.rarity=3,i.push(c)}var D=Number($("#input-cal-ultimate-4-price").val());if(D){c={type:"UseAll"};c.value=D,c.condition="Global",c.cal="Percent",c.rarity=4,i.push(c)}var S=Number($("#input-cal-ultimate-5-price").val());if(S){c={type:"UseAll"};c.value=S,c.condition="Global",c.cal="Percent",c.rarity=5,i.push(c)}var C=$("#chk-cal-partial-ultimate").val();for(var E in C)C[E]=Number(C[E]);var I=getPartialUltimateData(a.chefs,a.partialSkill,!0,C),R=$("#chk-cal-self-ultimate").val();for(var E in R)R[E]=Number(R[E]);var M=getSelfUltimateData(a.chefs,a.skills,!0,R);e.calGlobalUltimateData=i,e.calPartialChefIds=C,e.calSelfUltimateData=M;var N=$("#chk-cal-ex").val();for(var E in N)N[E]=Number(N[E]);for(var E in e.menus){var O=N.indexOf(e.menus[E].recipe.data.recipeId)>=0;setDataForRecipe(e.menus[E].recipe.data,i,O,!1);var _=getRecipeQuantity(e.menus[E].recipe.data,e.materials,e),A=getRecipeResult(null,null,e.menus[E].recipe.data,_,_,e.materials,e,e.decorationEffect);A.available=_,A.availableScore=A.totalScore/A.max*_,e.menus[E].recipe=A}for(var E in e.chefs)setDataForChef(e.chefs[E],null,!1,i,I,null,M,!1)}function loadRule(e,a){a.DisableDecorationEffect?($("#input-cal-decoration").prop("disabled",!0),$("#btn-cal-decoration").prop("disabled",!0)):($("#input-cal-decoration").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1));var i=JSON.parse(JSON.stringify(e.recipes)),t=JSON.parse(JSON.stringify(e.chefs)),c=JSON.parse(JSON.stringify(e.equips)),r=JSON.parse(JSON.stringify(e.materials));for(var l in a.MaterialsEffect)for(var s in r)if(r[s].materialId==a.MaterialsEffect[l].MaterialID){r[s].addition=+(Number(r[s].addition)+a.MaterialsEffect[l].Effect).toFixed(2);break}var o=[];if(a.hasOwnProperty("MaterialsNum")){for(var l in a.MaterialsNum)for(var s in r)if(r[s].materialId==a.MaterialsNum[l].MaterialID){1!=a.MaterialsNum[l].Num&&(r[s].quantity=a.MaterialsNum[l].Num),o.push(r[s]);break}}else for(var l in r)o.push(r[l]);var n=[];for(var l in i)if(!(i[l].hide||a.hasOwnProperty("CookbookRarityLimit")&&i[l].rarity>a.CookbookRarityLimit)){var p=getRecipeQuantity(i[l],o,a);if(0!=p){if(a.hasOwnProperty("RecipesTagsEffect"))for(var s in i[l].tags)for(var d in a.RecipesTagsEffect)i[l].tags[s]==a.RecipesTagsEffect[d].TagID&&(i[l].addition=+(Number(i[l].addition)+a.RecipesTagsEffect[d].Effect).toFixed(2));for(var d in a.RecipesEffect)i[l].recipeId==a.RecipesEffect[d].RecipeID&&(i[l].addition=+(Number(i[l].addition)+a.RecipesEffect[d].Effect).toFixed(2));for(var d in a.RecipesSkillsEffect)("stirfry"==a.RecipesSkillsEffect[d].Skill&&i[l].stirfry>0||"boil"==a.RecipesSkillsEffect[d].Skill&&i[l].boil>0||"knife"==a.RecipesSkillsEffect[d].Skill&&i[l].knife>0||"fry"==a.RecipesSkillsEffect[d].Skill&&i[l].fry>0||"bake"==a.RecipesSkillsEffect[d].Skill&&i[l].bake>0||"steam"==a.RecipesSkillsEffect[d].Skill&&i[l].steam>0)&&(i[l].addition=+(Number(i[l].addition)+a.RecipesSkillsEffect[d].Effect).toFixed(2));n.push(i[l])}}var h=[];for(var l in t)if(!(t[l].hide||a.hasOwnProperty("ChefRarityLimit")&&t[l].rarity>a.ChefRarityLimit)){var u=!1;if(a.hasOwnProperty("EnableChefTags")){for(var s in a.EnableChefTags)if(t[l].tags.indexOf(a.EnableChefTags[s])>=0){u=!0;break}}else u=!0;if(u){if(a.hasOwnProperty("ChefsTagsEffect"))for(var s in t[l].tags)for(var d in a.ChefsTagsEffect)t[l].tags[s]==a.ChefsTagsEffect[d].TagID&&(t[l].addition=+(Number(t[l].addition)+a.ChefsTagsEffect[d].Effect).toFixed(2));h.push(t[l])}}var f=[];for(var l in c)c[l].hide||f.push(c[l]);a.recipes=n,a.chefs=h,a.equips=f,a.materials=o,a.rest=o;var k=[];for(var s in a.recipes){p=getRecipeQuantity(a.recipes[s],a.materials,a);var m=getRecipeResult(null,null,a.recipes[s],p,p,a.materials,a,a.decorationEffect);m.available=p,m.availableScore=m.totalScore/m.max*p;var b={};b.recipe=m,k.push(b)}a.menus=k;var v=[];for(l=0;l<9;l++){var g={};g.group=Math.floor(l/3),g.chef={},g.recipe={},g.recipe.data={},g.equip={},v.push(g)}a.hasOwnProperty("MaterialsEffect")||a.hasOwnProperty("ChefsTagsEffect")||a.hasOwnProperty("RecipesTagsEffect")||a.hasOwnProperty("RecipesSkillsEffect")||a.hasOwnProperty("RecipesEffect")?a.hasRuleAddition=!0:a.hasRuleAddition=!1,"正常营业"==a.Title?(a.showTime=!0,a.showEff=!0,$('#select-cal-order option[value="分数"]').siblings().removeAttr("disabled")):(a.showTime=!1,a.showEff=!1,$("#select-cal-order").val("分数"),$('#select-cal-order option[value="分数"]').siblings().attr("disabled","disabled")),sortRecipesResult(),a.showTime?$(".chk-cal-results-show-total-time").prop("checked",!0):$(".chk-cal-results-show-total-time").prop("checked",!1),a.showEff?$(".chk-cal-results-show-efficiency").prop("checked",!0):$(".chk-cal-results-show-efficiency").prop("checked",!1),$("#cal-recipes-results-table").DataTable().clear().rows.add(k).draw(),initCalResultsShow("recipes",$("#cal-recipes-results-table").DataTable(),$("#pane-cal-recipes-results")),$("#cal-self-select-table").DataTable().clear().rows.add(v),initCalResultsShow("self-select",$("#cal-self-select-table").DataTable(),$("#pane-cal-self-select")),$("#pane-cal-self-select .selected-sum").html("请选择"),$("#pane-cal-self-select .selected-sum-2").html(""),private&&($("#cal-chefs-table").DataTable().clear().rows.add(h).draw(),$("#btn-cal-chefs-select-all").click(),$("#cal-materials-table").DataTable().clear().rows.add(o).draw(),$("#btn-cal-materials-select-all").click(),$("#cal-equips-table").DataTable().clear().rows.add(f).draw(),$("#btn-cal-equips-select-all").click())}function initCalCustomOptions(e,a){var i=getChefsOptions(e.chefs),t=getRecipesOptions(e),c=getEquipsOptions(e.equips,a.skills);$("#cal-self-select-table").DataTable().MakeCellsEditable("destroy"),$("#cal-self-select-table").DataTable().MakeCellsEditable({columns:[2,3,5,15],inputTypes:[{column:2,type:"list",search:!0,clear:!0,options:i},{column:3,type:"list",search:!0,clear:!0,options:c},{column:5,type:"list",search:!0,clear:!0,options:t,optionsp:!0}],onUpdate:function(i,t,c,r){var l=t.data().group;if($(c.node()).hasClass("cal-td-chef-name")){var s=c.data(),o="";if($("#chk-cal-use-equip").prop("checked")&&s)for(var n in e.chefs)if(e.chefs[n].name==s){o=e.chefs[n].equipName;break}for(var p=0;p<3;p++)i.data()[3*l+p].chef.name=s,$("#chk-cal-use-equip").prop("checked")&&(i.data()[3*l+p].equip.name=o)
}else if($(c.node()).hasClass("cal-td-equip-name"))for(p=0;p<3;p++)i.data()[3*l+p].equip.name=c.data();else $(c.node()).hasClass("cal-td-recipe-name")&&c.data()!=r&&(t.data().recipe.quantity=0,t.data().recipe.setQuantity=!0);calCustomResults(e,a),$(i.body()).removeClass("processing")},waitUpdate:!0})}function calCustomResults(e,a){var i=$("#cal-self-select-table").DataTable(),t=i.data().toArray(),c=[];for(var r in t){var l={},s=t[r].chef.name||"";if(s)for(var o in l.name=s,e.chefs)if(e.chefs[o].name==s){l=JSON.parse(JSON.stringify(e.chefs[o]));break}var n=getEquipInfo(t[r].equip.name,e.equips);t[r].equip=n||{},l.chefId&&c.indexOf(l.chefId)<0&&e.calPartialChefIds.indexOf(l.chefId)>=0&&c.push(l.chefId),t[r].chef=l;var p={data:{}},d=t[r].recipe.data.name?t[r].recipe.data.name:"";if(d)for(var o in p.data.name=d,p.disp=d,e.menus)if(e.menus[o].recipe.data.name==d){p.data=JSON.parse(JSON.stringify(e.menus[o].recipe.data));var h=t[r].recipe.quantity;h||(h=0);var u=e.menus[o].recipe.max;h>u&&(h=u),p.quantity=h,p.max=u,p.setQuantity=t[r].recipe.setQuantity;break}t[r].recipe=p}var f=checkMaterials2(t,e.materials);for(var r in t)if(t[r].recipe.data.recipeId&&t[r].recipe.setQuantity){var k=getRecipeQuantity(t[r].recipe.data,f.materials,e),m=t[r].recipe.max-t[r].recipe.quantity;k>m&&(k=m),t[r].recipe.quantity=k,t[r].recipe.setQuantity=!1}var b=getPartialUltimateData(a.chefs,a.partialSkill,!0,c),v=0,g=0,y=0,w=0,x=0,T="",q="",D="",S="",C="";for(var r in t){if(t[r].chef.chefId&&(setDataForChef(t[r].chef,t[r].equip,!0,e.calGlobalUltimateData,b,b,e.calSelfUltimateData,!1),r%3==0&&(e&&e.hasOwnProperty("DisableChefSkillEffect")&&0!=e.DisableChefSkillEffect||(x+=getTimeAddition(t[r].chef.specialSkillEffect)),(!e||!e.hasOwnProperty("DisableEquipSkillEffect")||0==e.DisableEquipSkillEffect)&&t[r].equip&&t[r].equip.effect))){var E=updateEquipmentEffect(t[r].equip.effect,t[r].chef.selfUltimateEffect);x+=getTimeAddition(E)}if(t[r].recipe.data.recipeId&&(t[r].recipe.totalTime=t[r].recipe.data.time*t[r].recipe.quantity,t[r].recipe.totalTimeDisp=secondsToTime(t[r].recipe.totalTime),w+=t[r].recipe.totalTime),t[r].recipe.data.recipeId&&t[r].chef.chefId){var I=getRecipeResult(t[r].chef,t[r].equip,t[r].recipe.data,t[r].recipe.quantity,t[r].recipe.max,e.materials,e,e.decorationEffect);if(I.rankVal>0)t[r].recipe=I,v+=I.totalPrice,g+=I.totalBonusScore,y+=I.totalScore,I.data.ultimateAdditionDisp&&I.quantity>0&&(1==I.data.rarity?T=I.data.ultimateAdditionDisp:2==I.data.rarity?q=I.data.ultimateAdditionDisp:3==I.data.rarity?D=I.data.ultimateAdditionDisp:4==I.data.rarity?S=I.data.ultimateAdditionDisp:5==I.data.rarity&&(C=I.data.ultimateAdditionDisp));else{var R=getSkillDiff(t[r].chef,t[r].recipe.data,1);t[r].recipe.disp+="<br><small>"+R.disp+"</small>"}}}for(var r in f=checkMaterials2(t,e.materials),t)if(t[r].recipe.data.recipeId){k=getRecipeQuantity(t[r].recipe.data,f.materials,e),m=t[r].recipe.max-t[r].recipe.quantity;k>m&&(k=m),t[r].recipe.available=k}if(i.clear().rows.add(t).draw(),$("#pane-cal-self-select .selected-sum").html("").append("原售价："+v),e.hasRuleAddition&&$("#pane-cal-self-select .selected-sum").append(" 规则分："+g),$("#pane-cal-self-select .selected-sum").append(" 总得分："+y),e.showTime){for(var r in b)x+=getTimeAddition(b[r].effect);0!=+x.toFixed(2)&&$("#pane-cal-self-select .selected-sum").append(" 原时间："+(secondsToTime(w)||0));var M=Math.ceil(+(w*(1+x/100)).toFixed(2));$("#pane-cal-self-select .selected-sum").append(" 总时间："+(secondsToTime(M)||0));var N=0;M>0&&(N=Math.floor(3600*y/M)),$("#pane-cal-self-select .selected-sum").append(" 总效率："+N+"金币/小时")}f.message&&$("#pane-cal-self-select .selected-sum").append(" ("+f.message+")"),$("#pane-cal-self-select .selected-sum-2").html("当前菜谱使用菜谱售价修炼加成："),T||q||D||S||C?(T&&$("#pane-cal-self-select .selected-sum-2").append("1星"+T+" "),q&&$("#pane-cal-self-select .selected-sum-2").append("2星"+q+" "),D&&$("#pane-cal-self-select .selected-sum-2").append("3星"+D+" "),S&&$("#pane-cal-self-select .selected-sum-2").append("4星"+S+" "),C&&$("#pane-cal-self-select .selected-sum-2").append("5星"+C+" ")):$("#pane-cal-self-select .selected-sum-2").append("无"),e.rest=f.materials,calRecipesResults(e),initCalCustomOptions(e,a)}function getRecipesOptions(e){var a={},i=$("#cal-self-select-table").DataTable().data().toArray(),t=$("#select-cal-order").val(),c=$("#chk-cal-got").prop("checked"),r=$("#chk-cal-no-origin").prop("checked");for(var l in i)if(l%3!=0)a[l]=a[l-1];else{var s=[];for(var o in e.menus)if((!c||e.menus[o].recipe.data.got)&&(r||e.menus[o].recipe.data.origin)){var n={};n.display=e.menus[o].recipe.data.name,n.value=e.menus[o].recipe.data.name;var p=e.menus[o].recipe.totalScore,d=e.menus[o].recipe.efficiency,h="";if(i[l].chef.chefId){var u=getRecipeResult(i[l].chef,i[l].equip,e.menus[o].recipe.data,e.menus[o].recipe.max,e.menus[o].recipe.max,e.materials,e,e.decorationEffect);if(u.rankVal>0)p=u.totalScore,d=u.efficiency;else{var f=getSkillDiff(i[l].chef,e.menus[o].recipe.data,1);h=" "+f.disp}}var k=!1;if(e.hasOwnProperty("MaterialsNum")){var m=p/e.menus[o].recipe.max*e.menus[o].recipe.available;n.subtext=e.menus[o].recipe.available+"/"+e.menus[o].recipe.max+" "+m+"/"+p,n.order=m,e.menus[o].recipe.available<e.menus[o].recipe.max&&(k=!0)}else"分数"==t?(n.subtext=p,n.order=p):"时间"==t?(n.subtext=e.menus[o].recipe.data.totalTimeDisp,n.order=e.menus[o].recipe.data.totalTime):"效率"==t&&(n.subtext=d,n.order=d);n.class="",""!=h&&(n.subtext+=" "+h,n.class+="option-warning"),k&&(n.class+=" option-sub-warning"),s.push(n)}s.sort(function(e,a){return a.order-e.order});n={display:"无菜谱",value:"",class:"hidden"};s.unshift(n),a[l]=s}return a}function calRecipesResults(e){var a=$("#cal-recipes-results-table").DataTable(),i=a.rows({order:"applied"}).data().toArray(),t=a.rows({selected:!0}).data().toArray(),c=$("#cal-self-select-table").DataTable().data().toArray();for(var r in i){var l=getRecipeQuantity(i[r].recipe.data,e.rest,e);for(var s in c)if(i[r].recipe.data.recipeId==c[s].recipe.data.recipeId){var o=i[r].recipe.max-c[s].recipe.quantity;l>o&&(l=o)}i[r].recipe.available=l,i[r].recipe.availableScore=i[r].recipe.totalScore/i[r].recipe.max*l}a.clear().rows.add(i),$("#pane-cal-recipes-results .chk-cal-results-lock-order").prop("checked")&&a.order([]),a.rows(function(e,a,i){for(var c in t)if(a.recipe.data.recipeId==t[c].recipe.data.recipeId)return!0;return!1}).select(),a.draw()}function sortRecipesResult(){var e=30,a=$("#select-cal-order").val();"分数"==a?e=30:"时间"==a?e=31:"效率"==a&&(e=32);var i=!1,t=$("#cal-recipes-results-table").DataTable(),c=t.order();for(var r in c)if(c[r][0]==e&&"desc"==c[r][1]){i=!0;break}i||t.order([e,"desc"]).draw()}function checkMaterials2(e,a){var i=JSON.parse(JSON.stringify(a));for(var t in e){var c=e[t].recipe;if(c.data.recipeId)for(var r in c.data.materials)for(var l in i)c.data.materials[r].material==i[l].materialId&&Number.isInteger(parseInt(i[l].quantity))&&(i[l].quantity-=c.data.materials[r].quantity*c.quantity)}var s="";for(var l in i)i[l].quantity<0&&(s+=i[l].name+i[l].quantity);return{materials:i,message:s}}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"galleryId",width:"1px"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"},orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:"gender"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition",orderSequence:["desc","asc"],width:"38px"},{data:"equipName",className:"cal-td-select-equip",width:"101px"}],i=$("#cal-chefs-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨师",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,i){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 性别"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;for(var t=$.trim($("#pane-cal-chefs .search-box input").val()),c=[2,11,13],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1});var t=getEquipsOptions(e.equips,e.skills);i.MakeCellsEditable({columns:[14,15],inputTypes:[{column:15,type:"list",search:!0,clear:!0,options:t}]}),$(".chk-cal-chefs-show").click(function(){initCalChefsShow(i)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?i.rows(".rarity-"+e).select():i.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){i.rows().every(function(e,a,i){this.cell(e,".cal-td-select-equip").data("")})}),$("#pane-cal-chefs .search-box input").keyup(function(){i.draw()}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),i.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),i.rows().deselect()}),initCalChefsShow(i)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"galleryId",width:"1px"},{data:"name"},{data:{_:"rarity",display:"rarityDisp"},orderSequence:["desc","asc"]},{data:"skillDisp"},{data:"origin"}],i=$("#cal-equips-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨具",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,i){$(e).addClass("rarity-"+a.rarity)}});$("#pane-cal-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;for(var t=$.trim($("#pane-cal-equips .search-box input").val()),c=[2,4,5],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$(".chk-cal-equips-show").click(function(){initCalEquipsShow(i)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?i.rows(".rarity-"+e).select():i.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").keyup(function(){i.draw()}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!0),i.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!1),i.rows().deselect()}),$("#btn-cal-equips-export").click(function(){var e=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),a={calEquips:[]};for(var i in e)a.calEquips.push(e[i].equipId);$("#input-export-import").val(JSON.stringify(a))}),initCalEquipsShow(i)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"materialId",width:"1px"},{data:"name"},{data:"origin"},{data:"quantity",className:"cal-td-input-quantity",orderSequence:["desc","asc"],width:"38px"},{data:"addition",className:"cal-td-input-addition",orderSequence:["desc","asc"],width:"38px"}],i=$("#cal-materials-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个食材",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[3,"desc"]],autoWidth:!1,createdRow:function(e,a,i){$(e).addClass("origin-"+a.originVal)}});$("#pane-cal-materials div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="名字 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;for(var t=$.trim($("#pane-cal-materials .search-box input").val()),c=[2,3],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),i.MakeCellsEditable({columns:[4,5]}),$(".chk-cal-materials-show").click(function(){initCalMaterialsShow(i)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?i.rows(".origin-"+e).select():i.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").keyup(function(){i.draw()}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),i.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),i.rows().deselect()}),initCalMaterialsShow(i)}function initCalResultsTable(e){var a;($("#pane-cal-self-select").html($("#pane-cal-results-common").html()),$("#pane-cal-self-select .cal-results-table").prop("id","cal-self-select-table"),initCalResultTableCommon("self-select",$("#pane-cal-self-select"),e),$("#pane-cal-recipes-results").html($("#pane-cal-results-common").html()),$("#pane-cal-recipes-results .cal-results-table").prop("id","cal-recipes-results-table"),initCalResultTableCommon("recipes",$("#pane-cal-recipes-results"),e),private)&&($("#cal-optimal-results-place").html($("#pane-cal-results-common").html()),$("#cal-optimal-results-place .cal-results-table").prop("id","cal-optimal-results-table"),initCalResultTableCommon("optimal",$("#pane-cal-optimal-results"),e),$(".btn-cal-results-cal").click(function(){if(currentRule){var i=$("#pane-cal-optimal-results");if(void 0!==a&&(a.terminate(),a=void 0),$(this).hasClass("stop"))return i.find(".cal-results-progress").addClass("hidden"),i.find(".btn-cal-results-cal.start").prop("disabled",!1),void i.find(".btn-cal-results-cal.stop").prop("disabled",!0);i.find(".btn-cal-results-cal.start").prop("disabled",!0),i.find(".btn-cal-results-cal.stop").prop("disabled",!1),i.find(".cal-results-wrapper").addClass("hidden"),i.find(".cal-results-progress .progress-bar").css("width","0%"),i.find(".cal-results-progress .progress-bar span").text("预处理中"),i.find(".cal-results-progress").removeClass("hidden"),a=new Worker("others/js/cal.js?v="+(new Date).getTime()),a.onmessage=function(e){e.data.progress?(i.find(".cal-results-progress .progress-bar").css("width",e.data.progress.value+"%"),i.find(".cal-results-progress .progress-bar span").text(e.data.progress.display)):e.data.menu?(e.data.message?i.find(".selected-sum").html(e.data.message):i.find(".selected-sum").html(""),$("#cal-optimal-results-table").DataTable().clear().rows.add(e.data.menu).draw(),i.find(".cal-results-wrapper").removeClass("hidden")):e.data.done?(i.find(".btn-cal-results-cal.stop").prop("disabled",!0),i.find(".btn-cal-results-cal.start").prop("disabled",!1),i.find(".cal-results-progress").addClass("hidden")):e.data.error&&alert(e.data.error)};var t=$("#cal-self-select-table").DataTable().data().toArray(),c=$("#cal-recipes-results-table").DataTable().rows({selected:!0}).data().toArray(),r=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),l=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),s=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),o=$("#chk-cal-results-no-equips").prop("checked"),n=$("#chk-cal-results-add-equips").prop("checked"),p=$("#chk-cal-results-change-equips").prop("checked"),d=$("#chk-cal-results-fix-equips").prop("checked"),h=Number($("#input-cal-min-score").val()),u=Number($("#input-cal-thread").val()),f=$("#select-cal-type").val();a.postMessage({mode:f,rule:currentRule,custom:t,recipes:c,chefs:r,equips:l,materials:s,odata:e,noEquips:o,addEquips:n,changeEquips:p,fixEquips:d,minScore:h,thread:u})}else alert("请加载规则")}),$("#btn-cal-set-custom").click(function(){if(currentRule){var a=JSON.parse(JSON.stringify($("#cal-optimal-results-table").DataTable().data()));9==a.length&&($("#cal-self-select-table").DataTable().clear().rows.add(a),calCustomResults(currentRule,e))}else alert("请加载规则")}));$("#pane-cal-results-common").remove()}function initCalResultTableCommon(e,a,i){var t=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"group",defaultContent:""},{data:{_:"chef.name",display:"chef.disp"},className:"cal-td-chef-name",defaultContent:""},{data:{_:"equip.name",display:"equip.disp"},className:"cal-td-equip-name",defaultContent:""},{data:"recipe.data.galleryId",defaultContent:"",width:"1px"},{data:{_:"recipe.data.name",display:"recipe.disp"},className:"cal-td-recipe-name",defaultContent:"",width:"140px"},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.data.stirfry",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:"recipe.data.boil",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:"recipe.data.knife",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:"recipe.data.fry",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:"recipe.data.bake",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:"recipe.data.steam",defaultContent:"",orderSequence:["desc","asc"],width:"25px"},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"},defaultContent:"",width:"230px"},{data:"recipe.data.origin",defaultContent:"",width:"115px"},{data:"recipe.quantity",className:"cal-td-quantity",defaultContent:"",orderSequence:["desc","asc"],width:"38px"},{data:"recipe.available",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.availableScore",defaultContent:"",orderSequence:["desc","asc"],width:"80px"},{data:"recipe.max",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:{_:"recipe.data.price",display:"recipe.data.priceDisp"},defaultContent:"",orderSequence:["desc","asc"],width:"32px"},{data:{_:"recipe.rankVal",display:"recipe.rankDisp"},defaultContent:"",orderSequence:["desc","asc"],width:"30px"},{data:"recipe.rankAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.chefSkillAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.equipSkillAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.bonusAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.data.ultimateAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.decorationAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.totalPrice",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalRealPrice",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalBonusScore",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalScore",defaultContent:"",orderSequence:["desc","asc"]},{data:{_:"recipe.totalTime",display:"recipe.totalTimeDisp"},defaultContent:""},{data:"recipe.efficiency",defaultContent:"",orderSequence:["desc","asc"]}],c=!0,r=!0,l=!0;"optimal"!=e&&"self-select"!=e||(c=!1,r=!1,l=!1);var s=a.find(".cal-results-table").DataTable({data:[],columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"共 _TOTAL_ 条",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条中过滤)",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},paging:c,pagingType:"numbers",lengthMenu:[[5,10,20,50,100,-1],[5,10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-12'<'selected-sum'>>><'row'<'col-sm-12'<'selected-sum-2'>>><'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,info:r,ordering:l,order:[],rowsGroup:[1,2,3]});return"recipes"==e&&(a.find("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm" placeholder="菜名 材料"></label>'),a.find(".search-box input").keyup(function(){s.draw()}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;for(var t=$.trim($("#pane-cal-recipes-results .search-box input").val()),c=[5,13],r=0,l=c.length;r<l;r++)if(commaSeparatedMatch(a[c[r]],t))return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;var r=$("#chk-cal-got").prop("checked");return!!(!r||r&&t.recipe.data.got)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,i,t,c){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;var r=$("#chk-cal-no-origin").prop("checked");return!!(r||!r&&t.recipe.data.origin)}),a.find(".btn-cal-recipes-select-all").off("click").click(function(){s.rows().select()}),a.find(".btn-cal-recipes-deselect-all").off("click").click(function(){s.rows().deselect()})),a.find(".chk-cal-results-show").off("click").click(function(){initCalResultsShow(e,s,a)}),initCalResultsShow(e,s,a),s}function generateData(e,a,i){var t={};if(a){for(var c in a.equips)a.equips[c].hide=!0;for(var c in a.decorations)a.decorations[c].hide=!0;for(var c in a.recipes)a.recipes[c].hide=!0;for(var c in a.chefs)a.chefs[c].hide=!0;e.guests=e.guests.concat(a.guests),e.equips=e.equips.concat(a.equips),e.decorations=e.decorations.concat(a.decorations),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs),e.skills=e.skills.concat(a.skills),e.rules=e.rules.concat(a.rules),e.activities=e.activities.concat(a.activities),t.ranks=a.ranks}t.maps=e.maps,t.activities=e.activities,t.guests=e.guests,t.history=e.history,t.skills=e.skills;var r=[];for(var c in e.skills){var l=!1;for(var s in e.skills[c].effect)if("Partial"==e.skills[c].effect[s].condition){l=!0;break}l&&r.push(e.skills[c])}t.partialSkill=r,t.rules=e.rules,t.decorationEffect=0,i&&i.decorationEffect&&(t.decorationEffect=i.decorationEffect),e.materials.sort(function(e,a){return e.origin.localeCompare(a.origin)});var o=[];for(var c in e.materials){var n=e.materials[c];n.originVal=getOriginVal(e.materials[c].origin),n.addition="",n.quantity="",o.push(n)}t.materials=o;var p=[];for(var c in e.equips)if(e.equips[c].name){var d=e.equips[c];d.rarityDisp=getRarityDisp(e.equips[c].rarity);var h=getSkillInfo(e.skills,e.equips[c].skill);d.skillDisp=h.skillDisp,d.effect=h.skillEffect;var u=[];for(var s in h.skillEffect)u.push(h.skillEffect[s].type);d.skillFilter=u,e.equips[c].hide?d.icon="<div class='icon-equip2 equip_"+e.equips[c].equipId+"'></div>":d.icon="<div class='icon-equip equip_"+e.equips[c].equipId+"'></div>",p.push(d)}t.equips=p;var f=[],k=[];for(var c in e.decorations){var m=e.decorations[c];if(m.tipMin=m.tipMin||"",m.tipMax=m.tipMax||"",m.tipTimeDisp=secondsToTime(m.tipTime),m.tipTime&&(m.minEff=+(3600*m.tipMin*24/m.tipTime).toFixed(1),m.maxEff=+(3600*m.tipMax*24/m.tipTime).toFixed(1),m.avgEff=+((m.tipMin+m.tipMax)/2*3600*24/m.tipTime).toFixed(1)),m.goldDisp=getPercentDisp(+(100*m.gold).toFixed(2)),m.suitGoldDisp=getPercentDisp(+(100*m.suitGold).toFixed(2)),e.decorations[c].hide?m.icon="<div class='icon-decoration2 decoration_"+m.icon+"'></div>":m.icon="<div class='icon-decoration decoration_"+m.icon+"'></div>",k.push(m),m.suit){var b=!1;for(var s in f)if(f[s].name==m.suit){f[s].decorations.push(m.id),b=!0;break}if(!b){var v={};v.name=m.suit,v.gold=m.suitGold,v.decorations=[],v.decorations.push(m.id),f.push(v)}}}t.decorations=k,t.suits=f;var g=[];for(var c in e.quests)if(e.quests[c].goal){var y=e.quests[c],w="",x="";for(var s in e.quests[c].rewards)w+=e.quests[c].rewards[s].name,e.quests[c].rewards[s].quantity&&(w+="*"+e.quests[c].rewards[s].quantity),w+=" ",x+=e.quests[c].rewards[s].name;y.rewardsVal=x,y.rewardsDisp=w,g.push(y)}t.quests=g;var T=$("#chk-chef-show-final").prop("checked"),q=$("#chk-chef-apply-equips").prop("checked"),D=$("#chk-chef-apply-ultimate").prop("checked"),S=$("#chk-chef-apply-ultimate-person").prop("checked"),C=getUltimateData(e.chefs,i,e.skills,D,S),E=[];for(var c in e.chefs)if(e.chefs[c].name){var I=e.chefs[c];I.addition="",I.rarityDisp=getRarityDisp(e.chefs[c].rarity),e.chefs[c].hide?I.icon="<div class='icon-chef2 chef_"+e.chefs[c].chefId+"'></div>":I.icon="<div class='icon-chef chef_"+e.chefs[c].chefId+"'></div>";h=getSkillInfo(e.skills,e.chefs[c].skill);if(I.specialSkillDisp=h.skillDisp,I.specialSkillEffect=h.skillEffect,I.tags=e.chefs[c].tags||[],I.tagsDisp="",a)for(var s in a.chefsTags)if(a.chefsTags[s].chefId==e.chefs[c].chefId){I.tags=a.chefsTags[s].tags,I.tagsDisp=getTagsDisp(a.chefsTags[s].tags,a.tags);break}I.gender=getGender(I.tags);var R="";for(var s in e.chefs[c].ultimateGoal)R+=e.chefs[c].ultimateGoal[s]+"<br>";var M=getSkillInfo(e.skills,e.chefs[c].ultimateSkill),N=M.skillDisp;if(I.ultimateGoal=R,I.ultimateSkillDisp=N,I.got="",I.ultimate="",I.equip=null,I.equipName="",I.equipDisp="",i)for(var s in i.chefs)if(e.chefs[c].chefId==i.chefs[s].id){if(i.chefs[s].hasOwnProperty("got")&&(I.got=i.chefs[s].got),i.chefs[s].hasOwnProperty("ult")&&(I.ultimate=i.chefs[s].ult),i.chefs[s].hasOwnProperty("equip"))for(var O in p)if(i.chefs[s].equip==p[O].equipId){I.equip=p[O],I.equipName=p[O].name,I.equipDisp=p[O].name+"<br><small>"+p[O].skillDisp+"</small>";break}break}setDataForChef(I,I.equip,q,C.global,C.partial,null,C.self,T),E.push(I)}t.chefs=E;var _=$("#chk-recipe-show-final").prop("checked"),A=[];for(var c in e.recipes)if(e.recipes[c].name){var G={};if(G=e.recipes[c],G.stirfry=e.recipes[c].stirfry||"",G.boil=e.recipes[c].boil||"",G.knife=e.recipes[c].knife||"",G.fry=e.recipes[c].fry||"",G.bake=e.recipes[c].bake||"",G.steam=e.recipes[c].steam||"",G.addition="",G.skillDisp=getSkillDisp(e.recipes[c]),G.timeDisp=secondsToTime(e.recipes[c].time),G.rarityDisp=getRarityDisp(e.recipes[c].rarity),e.recipes[c].hide?G.icon="<div class='icon-recipe2 recipe_"+e.recipes[c].recipeId+"'></div>":G.icon="<div class='icon-recipe recipe_"+e.recipes[c].recipeId+"'></div>",G.tags=e.recipes[c].tags||{},G.tagsDisp="",G.exTime=0,G.exTimeDisp="",a)for(var s in a.recipesTags)if(a.recipesTags[s].recipeId==e.recipes[c].recipeId){G.tags=a.recipesTags[s].tags,G.tagsDisp=getTagsDisp(a.recipesTags[s].tags,a.tags),G.exTime=a.recipesTags[s].experienceTime,G.exTimeDisp=getExTimeDisp(a.recipesTags[s].experienceTime,e.recipes[c].time);break}if(G.rank="",G.ex="",G.got="",i)for(var s in i.recipes)if(e.recipes[c].recipeId==i.recipes[s].id){i.recipes[s].hasOwnProperty("rank")&&(G.rank=i.recipes[s].rank),i.recipes[s].hasOwnProperty("ex")&&(G.ex=i.recipes[s].ex),i.recipes[s].hasOwnProperty("got")&&(G.got=i.recipes[s].got);break}G.oPrice=e.recipes[c].price;var F=ifUseEx(G);setDataForRecipe(G,C.global,F,_),G.efficiency=Math.floor(3600*e.recipes[c].price/e.recipes[c].time);var P=getMaterialsInfo(e.recipes[c],e.materials);G.materialsVal=P.materialsVal,G.materialsDisp=P.materialsDisp,G.veg=P.veg,G.meat=P.meat,G.creation=P.creation,G.fish=P.fish;var V=0;for(var U in e.recipes[c].time>0&&(V=3600*P.materialsCount/e.recipes[c].time),G.allMaterialsEff=V?Math.floor(V):"",G.combo="",e.combos)for(var B in e.combos[U].recipes)if(e.combos[U].recipes[B]==e.recipes[c].recipeId){for(var L in e.recipes)if(e.recipes[L].recipeId==e.combos[U].recipeId){G.combo=e.recipes[L].name;break}5004==e.combos[U].recipeId&&(G.combo="港式早茶");break}var J=getRankGuestInfo(e.recipes[c],G.rank);G.rankGuestsVal=J.rankGuestsVal,G.rankGuestsDisp=J.rankGuestsDisp;var j="";for(var U in e.guests)for(var B in e.guests[U].gifts)if(e.recipes[c].name==e.guests[U].gifts[B].recipe){j+=e.guests[U].name+"-"+e.guests[U].gifts[B].antique+"<br>";break}G.guestsDisp=j,A.push(G)}return t.recipes=A,t}function updateRecipeChefTable(e){$(".loading").removeClass("hidden"),setTimeout(function(){e=getUpdateData(e),$("#recipe-table").DataTable().clear().rows.add(e.recipes).draw(!1),$("#chef-table").DataTable().clear().rows.add(e.chefs).draw(!1),$(".loading").addClass("hidden")},500),$("#btn-chef-recal").closest(".box").addClass("hidden"),$("#btn-recipe-recal").closest(".box").addClass("hidden")}function getUpdateData(e){var a;try{var i=localStorage.getItem("data");a=JSON.parse(i)}catch(e){}var t=$("#chk-chef-show-final").prop("checked"),c=$("#chk-chef-apply-equips").prop("checked"),r=$("#chk-chef-apply-ultimate").prop("checked"),l=$("#chk-chef-apply-ultimate-person").prop("checked"),s=getUltimateData(e.chefs,a,e.skills,r,l),o=$("#chk-chef-partial-ultimate").val(),n=getPartialUltimateData(e.chefs,e.partialSkill,r,o);for(var p in e.chefs)setDataForChef(e.chefs[p],e.chefs[p].equip,c,s.global,s.partial,n,s.self,t);var d=$("#chk-recipe-show-final").prop("checked");for(var p in e.recipes){var h=ifUseEx(e.recipes[p]);setDataForRecipe(e.recipes[p],s.global,h,d)}return updateRecipesChefsData(e),updateChefsRecipesData(e),e}function getQuestsData(e,a){var i=[];for(var t in e)e[t].type==a&&i.push(e[t]);return i}function getMaterialsData(e,a){if(!a){var i=$("#select-material-origin").val();for(var t in e.maps)if(i==e.maps[t].name){a=e.maps[t];break}}var c=a.materials,r=[],l=$("#chk-material-season").prop("checked"),s=Number($("#input-material-addition").val()),o=$("#input-material-skill").val();for(var t in c){var n={};for(var p in n.name=c[t].name,n.skill=c[t].skill,n.time=[],c[t].quantity){var d=0,h=0;(""==o||Number(o)>=c[t].skill)&&(d=c[t].quantity[p][0],h=c[t].quantity[p][1],l&&(d+=c[t].season[p],h+=c[t].season[p]),s&&(d=Math.ceil(+(d*(1+s/100)).toFixed(2)),h=Math.ceil(+(h*(1+s/100)).toFixed(2)))),n.time.push([d,h])}r.push(n)}var u={name:"总计",time:[]};for(var t in a.time){d=0,h=0;for(var p in r)d+=r[p].time[t][0],h+=r[p].time[t][1];u.time.push([d,h])}return r.push(u),r}function getMaterialsInfo(e,a){var i={},t="",c="",r=0,l=!1,s=!1,o=!1,n=!1;for(var p in e.materials)for(var d in a)if(e.materials[p].material==a[d].materialId){t+=a[d].name+"*"+e.materials[p].quantity+" ",c+=a[d].name+" ",r+=e.materials[p].quantity,e.materials[p].origin=a[d].origin,"菜棚"==a[d].origin||"菜地"==a[d].origin||"森林"==a[d].origin?l=!0:"鸡舍"==a[d].origin||"猪圈"==a[d].origin||"牧场"==a[d].origin?s=!0:"作坊"==a[d].origin?o=!0:"池塘"==a[d].origin&&(n=!0);break}return i.materialsDisp=t,i.materialsVal=c,i.materialsCount=r,i.veg=l,i.meat=s,i.creation=o,i.fish=n,i}function getRarityDisp(e){for(var a="",i=0;i<e;i++)a+="&#x2605;";return a}function getGender(e){return e.indexOf(1)>=0?"男":e.indexOf(2)>=0?"女":""}function getTagsDisp(e,a){var i="";for(var t in e)for(var c in a)if(e[t]==a[c].Id){i+=a[c].name+" ";break}return i}function getExTimeDisp(e,a){
var i=e/1.5,t=e/2,c=e/2.5,r="可-"+Math.ceil(e/a)+"-"+secondsToTime(e)+"<br>优-"+Math.ceil(i/a)+"-"+secondsToTime(i)+"<br>特-"+Math.ceil(t/a)+"-"+secondsToTime(t)+"<br>神-"+Math.ceil(c/a)+"-"+secondsToTime(c);return r}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"池塘"==e?a=8:console.log("cannot find origin: "+a),a}function getRankGuestInfo(e,a){var i="",t="",c=$("#chk-recipe-filter-guest").prop("checked");for(var r in e.guests)if(!c||!("优"==a&&0==r||"特"==a&&2!=r||"神"==a)){var l="";0==r?l="优":1==r?l="特":2==r&&(l="神"),i+=l+"-"+e.guests[r].guest+"<br>",t+=e.guests[r].guest+" "}var s={};return s.rankGuestsVal=t,s.rankGuestsDisp=i,s}function ifUseEx(e){var a=$("#chk-recipe-apply-ex").prop("checked"),i=$("#chk-recipe-apply-ex-person").prop("checked");return!(!a||(!i||"是"!=e.ex)&&i)}function getUltimateData(e,a,i,t,c){var r=[],l=[],s=[];for(var o in e)if(t&&e[o].ultimateSkill){var n=!1;if(c){if(a)for(var p in a.chefs)if(e[o].chefId==a.chefs[p].id&&"是"==a.chefs[p].ult){n=!0;break}}else e[o].hide||(n=!0);if(n)for(var d in i)if(e[o].ultimateSkill==i[d].skillId){var h=[],u=[];for(var f in i[d].effect)if("Partial"==i[d].effect[f].condition)h.push(i[d].effect[f]);else if("Global"==i[d].effect[f].condition){var k=!1;for(var m in r)if(!(r[m].type!=i[d].effect[f].type||r[m].cal!=i[d].effect[f].cal&&(r[m].cal||i[d].effect[f].cal)||r[m].tag!=i[d].effect[f].tag&&(r[m].tag||i[d].effect[f].tag)||r[m].rarity!=i[d].effect[f].rarity&&(r[m].rarity||i[d].effect[f].rarity))){r[m].value=+(r[m].value+i[d].effect[f].value).toFixed(2),k=!0;break}k||r.push(JSON.parse(JSON.stringify(i[d].effect[f])))}else"Self"==i[d].effect[f].condition&&u.push(i[d].effect[f]);if(h.length){var b={};b.chefId=e[o].chefId,b.effect=h,l.push(b)}if(u.length){var v={};v.chefId=e[o].chefId,v.effect=u,s.push(v)}break}}var $={};return $.global=r,$.partial=l,$.self=s,$}function setPartialUltimateOptions(e,a){var i=[];for(var t in e)if(e[t].ultimateSkill)for(var c in a)if(e[t].ultimateSkill==a[c].skillId)for(var r in a[c].effect)if("Partial"==a[c].effect[r].condition){var l=getSkillInfo(a,a[c].skillId),s={};s.skill=l,s.chef=e[t],i.push(s)}for(var t in i.sort(function(e,a){return e.skill.skillDisp.localeCompare(a.skill.skillDisp)}),i){var o="<option value='"+i[t].chef.chefId+"' data-subtext='"+i[t].skill.skillDisp+"'>"+i[t].chef.name+"</option>",n=!1;for(var p in i[t].skill.skillEffect)"OpenTime"!=i[t].skill.skillEffect[p].type&&(n=!0);n&&$("#chk-chef-partial-ultimate").append(o),$("#chk-cal-partial-ultimate").append(o)}}function setSelfUltimateOptions(e,a){for(var i in e)if(e[i].ultimateSkill)for(var t in a)if(e[i].ultimateSkill==a[t].skillId)for(var c in a[t].effect)if("Self"==a[t].effect[c].condition&&"Material_Gain"!=a[t].effect[c].type&&"GuestDropCount"!=a[t].effect[c].type){var r=getSkillInfo(a,a[t].skillId),l="<option value='"+e[i].chefId+"' data-subtext='"+r.skillDisp+"'>"+e[i].name+"</option>";$("#chk-cal-self-ultimate").append(l);break}}function setExOptions(e){for(var a in e){var i="<option value='"+e[a].recipeId+"' data-subtext='+"+e[a].exPrice+"'>"+e[a].name+"</option>";$("#chk-cal-ex").append(i)}}function setDataForRecipe(e,a,i,t){for(var c in e.limitVal=e.limit,e.ultimateAddition=0,a)"MaxEquipLimit"==a[c].type&&a[c].rarity==e.rarity&&(e.limitVal+=a[c].value),"UseAll"==a[c].type&&a[c].rarity==e.rarity&&(e.ultimateAddition=+(e.ultimateAddition+a[c].value).toFixed(2));e.limitDisp=getAtrributeDisp(e.limitVal,e.limit,t),e.ultimateAdditionDisp=getPercentDisp(e.ultimateAddition),e.price=e.oPrice,i&&(e.price+=e.exPrice),e.priceDisp=getAtrributeDisp(e.price,e.oPrice,t),e.totalPrice=e.price*e.limitVal,e.totalTime=e.time*e.limitVal,e.totalTimeDisp=secondsToTime(e.totalTime)}function getRankOptions(){var e=[],a={display:"",value:""};return e.push(a),a={},a.display="优",a.value="优",e.push(a),a={},a.display="特",a.value="特",e.push(a),a={},a.display="神",a.value="神",e.push(a),e}function getGotOptions(){var e=[],a={display:"否",value:""};return e.push(a),a={},a.display="是",a.value="是",e.push(a),e}function getEquipsOptions(e,a){var i=[],t={display:"无厨具",subtext:"",tokens:"",value:"",class:"hidden"};for(var c in i.push(t),e){var r=getSkillInfo(a,e[c].skill),l=r.skillDisp.replace(/<br>/g," ");t={};t.display=e[c].name,t.subtext=l,t.tokens=e[c].name+l,t.value=e[c].name,i.push(t)}return i}function getChefsOptions(e){var a=[],i={display:"无厨师",value:"",class:"hidden"};a.push(i),e.sort(function(e,a){return a.rarity-e.rarity});var t=$("#chk-cal-got").prop("checked"),c=$("#chk-cal-no-origin").prop("checked");for(var r in e)if((!t||e[r].got)&&(c||e[r].origin)){i={};i.display=e[r].name,i.value=e[r].name,a.push(i)}return a}function getSkillInfo(e,a){var i={},t="",c=[],r=[];for(var l in a.constructor===Array?r=a:a&&r.push(a),r){var s=!1;for(var o in e)if(e[o].skillId==r[l]){t+=e[o].desc+"<br>",c=c.concat(e[o].effect),s=!0;break}s||console.log(r[l])}return i.skillDisp=t,i.skillEffect=c,i}function getSkillDisp(e){var a="";return e.stirfry&&(a+="炒"+e.stirfry),e.boil&&(a+="煮"+e.boil),e.knife&&(a+="切"+e.knife),e.fry&&(a+="炸"+e.fry),e.bake&&(a+="烤"+e.bake),e.steam&&(a+="蒸"+e.steam),a}function initRecipeShow(){var e=$("#recipe-table").DataTable();e.fixedHeader.disable(),e.column(0).visible($("#chk-recipe-show-id").prop("checked"),!1),e.column(1).visible($("#chk-recipe-show-icon").prop("checked"),!1),e.column(3).visible($("#chk-recipe-show-rarity").prop("checked"),!1);var a=$("#chk-recipe-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-recipe-show-materials").prop("checked"),!1),e.column(11).visible($("#chk-recipe-show-price").prop("checked"),!1),e.column(12).visible($("#chk-recipe-show-ex-price").prop("checked"),!1),e.column(13).visible($("#chk-recipe-show-ex-time").prop("checked"),!1),e.column(14).visible($("#chk-recipe-show-time").prop("checked"),!1),e.column(15).visible($("#chk-recipe-show-limit").prop("checked"),!1),e.column(16).visible($("#chk-recipe-show-total-price").prop("checked"),!1),e.column(17).visible($("#chk-recipe-show-total-time").prop("checked"),!1),e.column(18).visible($("#chk-recipe-show-efficiency").prop("checked"),!1),e.column(19).visible($("#chk-recipe-show-materials-efficiency").prop("checked"),!1),e.column(20).visible($("#chk-recipe-show-origin").prop("checked"),!1),e.column(21).visible($("#chk-recipe-show-unlock").prop("checked"),!1),e.column(22).visible($("#chk-recipe-show-combo").prop("checked"),!1),cal?e.column(23).visible($("#chk-recipe-show-tags").prop("checked"),!1):e.column(23).visible(!1,!1),e.column(24).visible($("#chk-recipe-show-guest").prop("checked"),!1),e.column(25).visible($("#chk-recipe-show-rank-guest").prop("checked"),!1),e.column(26).visible($("#chk-recipe-show-rank-antique").prop("checked"),!1),e.column(27).visible($("#chk-recipe-show-rank").prop("checked"),!1),e.column(28).visible($("#chk-recipe-show-ex").prop("checked"),!1),e.column(29).visible($("#chk-recipe-show-got").prop("checked"),!1),e.columns.adjust().draw(!1),e.fixedHeader.enable()}function initChefShow(){var e=$("#chef-table").DataTable();e.fixedHeader.disable(),e.column(0).visible($("#chk-chef-show-id").prop("checked"),!1),e.column(1).visible($("#chk-chef-show-icon").prop("checked"),!1),e.column(3).visible($("#chk-chef-show-rarity").prop("checked"),!1);var a=$("#chk-chef-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-chef-show-chef-skill").prop("checked"),!1);var i=$("#chk-chef-show-explore").prop("checked");e.column(11).visible(i,!1),e.column(12).visible(i,!1),e.column(13).visible(i,!1),e.column(14).visible(i,!1),e.column(15).visible($("#chk-chef-show-gender").prop("checked"),!1),e.column(16).visible($("#chk-chef-show-origin").prop("checked"),!1),cal?e.column(17).visible($("#chk-chef-show-tags").prop("checked"),!1):e.column(17).visible(!1,!1),e.column(18).visible($("#chk-chef-show-equip").prop("checked"),!1),e.column(19).visible($("#chk-chef-show-ultimate-goal").prop("checked"),!1),e.column(20).visible($("#chk-chef-show-ultimate-skill").prop("checked"),!1),e.column(21).visible($("#chk-chef-show-ultimate").prop("checked"),!1),e.column(22).visible($("#chk-chef-show-got").prop("checked"),!1),e.columns.adjust().draw(!1),e.fixedHeader.enable()}function initEquipShow(){var e=$("#equip-table").DataTable();e.fixedHeader.disable(),e.column(0).visible($("#chk-equip-show-id").prop("checked"),!1),e.column(1).visible($("#chk-equip-show-icon").prop("checked"),!1),e.column(3).visible($("#chk-equip-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-equip-show-skill").prop("checked"),!1),e.column(5).visible($("#chk-equip-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1),e.fixedHeader.enable()}function initDecorationShow(){var e=$("#decoration-table").DataTable();e.fixedHeader.disable(),e.column(0).visible($("#chk-decoration-show-select").prop("checked"),!1),e.column(1).visible($("#chk-decoration-show-id").prop("checked"),!1),e.column(2).visible($("#chk-decoration-show-icon").prop("checked"),!1),e.column(8).visible($("#chk-decoration-show-min-eff").prop("checked"),!1),e.column(9).visible($("#chk-decoration-show-max-eff").prop("checked"),!1),e.column(10).visible($("#chk-decoration-show-avg-eff").prop("checked"),!1),e.column(11).visible($("#chk-decoration-show-position").prop("checked"),!1),e.column(12).visible($("#chk-decoration-show-suit").prop("checked"),!1),e.column(13).visible($("#chk-decoration-show-suit-gold").prop("checked"),!1),e.column(14).visible($("#chk-decoration-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1),e.fixedHeader.enable()}function initQuestShow(e){e.fixedHeader.disable(),e.column(1).visible("支线任务"==$("#select-quest-type").val(),!1),e.columns.adjust().draw(!1),e.fixedHeader.enable()}function initCalChefsShow(e){e.column(1).visible($("#chk-cal-chefs-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-chefs-show-rarity").prop("checked"),!1);var a=$("#chk-cal-chefs-show-skill").prop("checked");e.column(4).visible(a,!1),e.column(5).visible(a,!1),e.column(6).visible(a,!1),e.column(7).visible(a,!1),e.column(8).visible(a,!1),e.column(9).visible(a,!1),e.column(10).visible($("#chk-cal-chefs-show-chef-skill").prop("checked"),!1),e.column(11).visible($("#chk-cal-chefs-show-gender").prop("checked"),!1),e.column(12).visible($("#chk-cal-chefs-show-origin").prop("checked"),!1),e.column(13).visible($("#chk-cal-chefs-show-tags").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){e.column(1).visible($("#chk-cal-equips-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-equips-show-rarity").prop("checked"),!1),e.column(4).visible($("#chk-cal-equips-show-skill").prop("checked"),!1),e.column(5).visible($("#chk-cal-equips-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){e.column(1).visible($("#chk-cal-materials-show-id").prop("checked"),!1),e.column(3).visible($("#chk-cal-materials-show-origin").prop("checked"),!1),e.columns.adjust().draw(!1)}function initCalResultsShow(e,a,i){a.column(1).visible(!1,!1),"recipes"==e?(i.find(".chk-cal-results-show-recipe-rank").prop("checked",!1).closest(".btn").addClass("hidden"),i.find(".chk-cal-results-show-recipe-rank-addition").prop("checked",!1).closest(".btn").addClass("hidden"),i.find(".chk-cal-results-show-chef-skill-addition").prop("checked",!1).closest(".btn").addClass("hidden"),i.find(".chk-cal-results-show-chef-equip-addition").prop("checked",!1).closest(".btn").addClass("hidden"),i.find(".chk-cal-results-show-recipe-real-total-price").prop("checked",!1).closest(".btn").addClass("hidden"),private?(i.find(".chk-cal-results-lock-order").closest(".box").removeClass("hidden"),i.find(".btn-cal-recipes-select-all").closest(".box").removeClass("hidden")):a.column(0).visible(!1,!1),a.column(2).visible(!1,!1),a.column(3).visible(!1,!1),a.column(15).visible(!1,!1),currentRule&&currentRule.hasOwnProperty("MaterialsNum")?(a.column(16).visible(!0,!1),a.column(17).visible(!0,!1)):(a.column(16).visible(!1,!1),a.column(17).visible(!1,!1))):"optimal"==e?(a.column(0).visible(!1,!1),a.column(16).visible(!1,!1),a.column(17).visible(!1,!1),a.column(18).visible(!1,!1)):"self-select"==e&&(i.find(".chk-cal-results-show-recipe-id").prop("checked",!1).closest(".btn").addClass("hidden"),a.column(0).visible(!1,!1),a.column(17).visible(!1,!1)),a.column(4).visible(i.find(".chk-cal-results-show-recipe-id").prop("checked"),!1),a.column(6).visible(i.find(".chk-cal-results-show-recipe-rarity").prop("checked"),!1);var t=i.find(".chk-cal-results-show-recipe-skill").prop("checked");a.column(7).visible(t,!1),a.column(8).visible(t,!1),a.column(9).visible(t,!1),a.column(10).visible(t,!1),a.column(11).visible(t,!1),a.column(12).visible(t,!1),a.column(13).visible(i.find(".chk-cal-results-show-recipe-material").prop("checked"),!1),a.column(14).visible(i.find(".chk-cal-results-show-recipe-origin").prop("checked"),!1),a.column(19).visible(i.find(".chk-cal-results-show-recipe-price").prop("checked"),!1),a.column(20).visible(i.find(".chk-cal-results-show-recipe-rank").prop("checked"),!1),a.column(21).visible(i.find(".chk-cal-results-show-recipe-rank-addition").prop("checked"),!1),a.column(22).visible(i.find(".chk-cal-results-show-chef-skill-addition").prop("checked"),!1),a.column(23).visible(i.find(".chk-cal-results-show-chef-equip-addition").prop("checked"),!1),a.column(24).visible(i.find(".chk-cal-results-show-bonus-addition").prop("checked"),!1),a.column(25).visible(i.find(".chk-cal-results-show-ultimate-addition").prop("checked"),!1),a.column(26).visible(i.find(".chk-cal-results-show-decoration-addition").prop("checked"),!1),a.column(27).visible(i.find(".chk-cal-results-show-recipe-total-price").prop("checked"),!1),a.column(28).visible(i.find(".chk-cal-results-show-recipe-real-total-price").prop("checked"),!1),a.column(29).visible(i.find(".chk-cal-results-show-bonus-score").prop("checked"),!1),a.column(31).visible(i.find(".chk-cal-results-show-total-time").prop("checked"),!1),a.column(32).visible(i.find(".chk-cal-results-show-efficiency").prop("checked"),!1),a.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var i=historyTemplate(e);$("#data-history").html(i)},pageSize:10,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a='<table class="table table-condensed history-table">';return $.each(e,function(e,i){a+='<tr><td class="history-dt">'+i.date+"</td><td>"+i.content+"<td></tr>"}),a+="</table>",a}function initVersionTip(e){$(".alert-version").each(function(){if("true"==$(this).attr("data-show")){var a=$(this).attr("data-id"),i=Number($(this).attr("data-version")),t=!0;e&&e[a]&&Number(e[a])==i&&(t=!1),t&&$(this).removeClass("hidden"),$(this).on("close.bs.alert",function(){updateLocalData(a,i)})}})}function getInputHtml(e,a,i,t){var c,r,l;switch(l={type:"input",html:null,settings:null},i.inputTypes&&$.each(i.inputTypes,function(e,i){i.column==a&&(c=i,r=c.type.toLowerCase())}),l.settings=c,r){case"list":var s,o="data-live-search='false'";c.search&&(o="data-live-search='true'"),l.html="<select "+o+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",s=c.optionsp?c.options[e]:c.options,$.each(s,function(e,a){l.html=l.html+"<option value='"+a.value+"'",a.tokens&&(l.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(l.html+=" data-subtext='"+a.subtext+"'"),a.class&&(l.html+=" class='"+a.class+"'"),t==a.value&&(l.html+=" selected"),l.html+=">"+a.display+"</option>"}),l.html=l.html+"</select>",l.type=r;break;default:l.html="<input class='form-control' value='"+t+"'></input>"}return l}function sanitizeCellValue(e){return null==e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),t=i.exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}function UpdateQueryString(e,a,i){i||(i=window.location.href);var t,c=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(c.test(i))return null!=a?i.replace(c,"$1"+e+"="+a+"$2$3"):(t=i.split("#"),i=t[0].replace(c,"$1$3").replace(/(&|\?)$/,""),void 0!==t[1]&&null!==t[1]&&(i+="#"+t[1]),i);if(null!=a){var r=-1!==i.indexOf("?")?"&":"?";return t=i.split("#"),i=t[0]+r+e+"="+a,void 0!==t[1]&&null!==t[1]&&(i+="#"+t[1]),i}return i}$(function(){$.ajax({cache:!1,success:function(e){init(e)},url:"data/data.min.json"})});var currentRule,private=!1,cal=!1;$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var i=$(e).closest("table").DataTable().table(),t=i.row($(e).parents("tr")),c=i.cell($(e).closest("td")),r=$(e),l=c.data(),s=r.val();c.data(s),a.onUpdate&&a.onUpdate(i,t,c,l)}}),"destroy"===e&&($(a.body()).removeClass("processing"),$(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(){if(!$(a.body()).hasClass("processing")){var i=a.cell(this).index().row,t=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(t)>-1||!e.columns){var c=a.cell(this).node(),r=a.cell(this).data();if(r=sanitizeCellValue(r),!$(c).find("input").length&&!$(c).find("select").length){e.waitUpdate&&$(a.body()).addClass("processing");var l=getInputHtml(i,t,e,r);$(c).html(l.html),"input"==l.type?$(c).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==l.type&&($(c).find("select").selectpicker("hide").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e)}),setTimeout(function(){$(c).find("select").selectpicker("toggle").selectpicker("show")},0),l.settings.clear&&($("<div class='bs-actionsbox'><div class='btn-group btn-group-sm btn-block'><button type='button' class='btn btn-default btn-bs-clear'>清空</button></div></div>").insertBefore($(c).find("ul.dropdown-menu")),$(c).find(".btn-bs-clear").click(function(){$(c).find("select").selectpicker("val",""),$(c).find("select").selectpicker("hide"),$(this).updateEditableCell(this,e)})))}}}})});