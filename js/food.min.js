function commaSeparatedMatch(e,a){if(0===a.length)return!0;for(var t=a.split(/[,\s]/),i=0;i<t.length;i++)if(0!==t[i].length&&-1!==e.indexOf(t[i]))return!0;return!1}function init(e){initFunction();var a=getLocalData();if(private)$.ajax({cache:!1,success:function(t){$.ajax({cache:!1,success:function(i){t=$.extend(t,i);var l=generateData(e,t,a);initTables(l,a)},error:function(){var i=generateData(e,t,a);initTables(i,a)},url:"others/data/data3.json"})},error:function(){var t=generateData(e,null,a);initTables(t,a)},url:"others/data/data2.json"});else{var t=generateData(e,null,a);initTables(t,a)}}function initFunction(){var e=getParameterByName("a");e&&"cb8f8a72f7e4924a75cb75a4a59c0b8d61e70c0cb84f84edf7ede4c8"==lcode(e)&&(private=!0,$("head").append('<link rel="stylesheet" type="text/css" href="others/css/image.css">'),$("#chk-recipe-no-origin").closest(".btn").removeClass("hidden"),$("#chk-chef-no-origin").closest(".btn").removeClass("hidden"),$("#chk-equip-no-origin").closest(".btn").removeClass("hidden"),$("#chk-decoration-no-origin").closest(".btn").removeClass("hidden"),$("#chk-cal-results-lock-order").closest(".btn").removeClass("hidden"),$("#btn-cal-recipes-select-all").removeClass("hidden"),$("#btn-cal-recipes-deselect-all").removeClass("hidden"))}function initTables(e,a){var t;$.fn.selectpicker.Constructor.DEFAULTS.liveSearchStyle="commaSplitContains",$(window).width()<767&&($("#chk-setting-desktop").bootstrapToggle("off"),isMobile=!0),a&&(a.desktop?($("#chk-setting-desktop").bootstrapToggle("on"),isMobile=!1):0==a.desktop&&($("#chk-setting-desktop").bootstrapToggle("off"),isMobile=!0)),updateSetting(a),isMobile&&($(".mobile-setting").hide(),expendBtn=!1),initSetting(e),updateMenu(a),setPartialUltimateOptions(e.chefs,e.partialSkill),initRecipeTable(e),initChefTable(e),initEquipTable(e),initAmberTable(e),initDecorationTable(e),initMaterialTable(e),initCondimentTable(e),initQuestTable(e),initImportExport(e),initCalTables(e,a),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})},initInfo(e),initVersionTip(a),initTooltip(),$('.main-nav a[data-toggle="tab"]').on("show.bs.tab",function(e){".pane-recipes"==$(e.target).attr("href")?$("#select-partial-ultimate").appendTo("#select-partial-ultimate-recipe"):".pane-chefs"==$(e.target).attr("href")&&$("#select-partial-ultimate").appendTo("#select-partial-ultimate-chef")}),$('.main-nav a[data-toggle="tab"]').on("shown.bs.tab",function(e){isMobile?($(".dataTables_scrollBody:visible table.dataTable").DataTable().draw(!1),"true"!=$(this).attr("data-init")&&updateScrollHeight()):reInitFixedHeader()}),isMobile&&$(".dataTables_scrollBody table.dataTable").on("page.dt",function(){$(this).closest(".dataTables_scrollBody").scrollTop(0)}),$(".select-wrapper").hover(function(){if(!t){var e=$(this).find(".bootstrap-select");t=setTimeout(function(){e.hasClass("open")||(t=null,e.find("select").selectpicker("toggle"))},200)}},function(){t&&(window.clearTimeout(t),t=null);var e=$(this).find(".bootstrap-select");e.hasClass("open")&&e.find("select").selectpicker("toggle")}),monitorStyle(),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden"),isMobile||reInitFixedHeader(),initLayout()}function reInitFixedHeader(){$("#recipe-table").DataTable().fixedHeader.adjust(),$("#chef-table").DataTable().fixedHeader.adjust(),$("#equip-table").DataTable().fixedHeader.adjust(),$("#amber-table").DataTable().fixedHeader.adjust(),$("#decoration-table").DataTable().fixedHeader.adjust(),$("#quest-table").DataTable().fixedHeader.adjust(),$("#condiment-table").DataTable().fixedHeader.adjust(),$("#cal-recipes-table").DataTable().fixedHeader.adjust(),private&&($("#cal-chefs-table").DataTable().fixedHeader.adjust(),$("#cal-equips-table").DataTable().fixedHeader.adjust(),$("#cal-materials-table").DataTable().fixedHeader.adjust())}function updateScrollHeight(){var e=$(".dataTables_scrollBody:visible");if(e.length){var a=$("body").height()-e.height(),t=$(window).height()-a-5+"px",i="height";e.closest(".pane-materials").length>0&&(i="max-height"),e.css(i)!=t&&(e.css(i,t),e.find("table.dataTable").DataTable().columns.adjust().draw(!1),$('.nav-tabs li.active a[data-toggle="tab"]').attr("data-init","true"))}}function initTableResponsiveDisplayEvent(e){e.on("responsive-display",function(e,a,t,i,l){if(i){var s=$(t.node()).next("tr");if(s.length)if(isMobile){var c=$(this).closest(".dataTables_scrollBody"),r=s.offset().top-c.offset().top+s.outerHeight()-c.height();r>=0&&c.scrollTop(r+c.scrollTop()+10)}else{r=s.offset().top+s.outerHeight()-$(window).height();r>=$(window).scrollTop()&&$(window).scrollTop(r+10)}}})}function initTableScrollEvent(e){isMobile&&$(e).find(".dataTables_scrollBody").on("scroll",function(e){$(this).find(".child-inner").css("margin-left",$(this).scrollLeft()+"px")})}function getResponsiveStyle(e){var a="";if(isMobile){var t=e.closest(".dataTables_scroll").find(".dataTables_scrollBody");a=" style='max-width:"+(t.width()-20)+"px;margin-left:"+t.scrollLeft()+"px'"}return a}function initTooltip(){$('.tooltip-pin[data-toggle="tooltip"]').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$("body").on("click",function(e){$('[data-toggle="tooltip"]').each(function(){$(this).is(e.target)||0!=$(this).has(e.target).length||$(this).tooltip("hide")})}),updateTooltip()}function updateTooltip(){$("#chk-setting-show-help").prop("checked")?($('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$('[data-toggle="tooltip"]').on("show.bs.tooltip",function(){$('[data-toggle="tooltip"]').not(this).tooltip("hide")})):$('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip("destroy")}function initSetting(e){$("#chk-setting-desktop").change(function(){updateLocalData("desktop",$("#chk-setting-desktop").prop("checked")),window.location.reload()}),$("#chk-setting-show-help").change(function(){updateTooltip(),updateSettingLocalData()}),$("#chk-setting-expand-btn").change(function(){updateSettingLocalData(),window.location.reload()}),$("#chk-setting-auto-update").change(function(){updateSettingLocalData()}),$("#chk-setting-show-final").change(function(){updateRecipeChefTable(e),updateSettingLocalData()}),$("#chk-setting-done-mark").change(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp;var s=getRankGiftInfo(i,i.rank);i.rankGiftVal=s.rankGiftVal,i.rankGiftDisp=s.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw(!1),updateSettingLocalData()}),$("#select-setting-page-length").on("changed.bs.select",function(){var e=$(this).val();$("#recipe-table").DataTable().page.len(e).draw(),$("#chef-table").DataTable().page.len(e).draw(),$("#equip-table").DataTable().page.len(e).draw(),$("#amber-table").DataTable().page.len(e).draw(),$("#decoration-table").DataTable().page.len(e).draw(),$("#quest-table").DataTable().page.len(e).draw(),$("#condiment-table").DataTable().page.len(e).draw(),$("#cal-recipes-table").DataTable().page.len(e).draw(),private&&($("#cal-chefs-table").DataTable().page.len(e).draw(),$("#cal-equips-table").DataTable().page.len(e).draw(),$("#cal-materials-table").DataTable().page.len(e).draw()),updateSettingLocalData()})}function initLayout(){isMobile?($("#top-menu").appendTo("#menu-modal .modal-body"),$("#mobile-menu-btn").removeClass("hidden"),document.getElementById("viewport").setAttribute("content","width=device-width"),updateScrollHeight()):($("#top-menu").appendTo("#desktop-menu"),$("#mobile-menu-btn").addClass("hidden"),document.getElementById("viewport").setAttribute("content",""))}function initRecipeTable(e){reInitRecipeTable(e),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-rarity").val();return 0==s.length||!!$('#chk-recipe-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-skill").val();if(0==s.length)return!0;var c=$("#chk-recipe-multiple-skill").prop("checked");for(var r in s)if(i[""+s[r]]>0){if(!c)return!0}else if(c)return!1;return!!c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-category").val();if(0==s.length)return!0;var c=$("#chk-recipe-multiple-category").prop("checked");for(var r in s)if(i[""+s[r]]){if(!c)return!0}else if(c)return!1;return!!c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-condiment").val();if(0==s.length)return!0;for(var c in s)if(i.condiment==s[c])return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=Number($("#input-recipe-price").val());return i.price>=s}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-guest").val();if(0==s.length)return!0;for(var c in s){if(i.guestsVal.indexOf(" "+s[c]+" ")>=0)return!0;if($("#chk-recipe-rank-guest").prop("checked")&&i.rankGuestsVal.indexOf(" "+s[c]+" ")>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-antique").val();if(0==s.length)return!0;for(var c in s){if(i.guestsVal.indexOf(s[c])>=0)return!0;if($("#chk-recipe-rank-antique").prop("checked")&&i.rankGiftVal.indexOf(s[c])>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-invitation-guest").val();if(0==s.length)return!0;for(var c in s)if(i.invitationGuestsVal.indexOf(" "+s[c]+" ")>=0)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-amber").val();if(0==s.length)return!0;for(var c in s)if(i.invitationGuestsVal.indexOf(s[c])>=0)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-combo").prop("checked");return!!(!s||s&&i.comboVal)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-ex-no").prop("checked");return!(s&&(!s||i.ex))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-got").prop("checked");return!!(!s||s&&i.got)});var a=$(".pane-recipes .search-box input");for(var t in $.fn.dataTableExt.afnFiltering.push(function(e,t,i,l,s){if(e.nTable!=document.getElementById("recipe-table"))return!0;var c=$.trim(a.val());return!!commaSeparatedMatch(l.name,c)||(!!commaSeparatedMatch(l.materialsVal,c)||(!(!commaSeparatedMatch(l.origin,c)||-1!=l.origin.indexOf("神级"))||(!!commaSeparatedMatch(l.tagsDisp,c)||!!commaSeparatedMatch(l.guestsDisp,c))))}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.allSelectedMaterials.length)return!0;var c=$("#chk-recipe-multiple-material").prop("checked");for(var r in e.allSelectedMaterials){var n=!1;for(var o in l.materials)if(l.materials[o].material==e.allSelectedMaterials[r]){n=!0;break}if(n){if(!c)return!0}else if(c)return!1}return!!c}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.selectedQuests.length)return!0;for(var c in e.selectedQuests)if("修炼任务"==e.selectedQuests[c].type){var r=e.selectedQuests[c].conditions;for(var n in r)if(r[n].num){var o=getMaxLimit(e,r[n].rarity),p=getMaxLimit(e,l.rarity);return 2*o+p>=r[n].num}break}return!0}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(e.selectedQuests.length){for(var c in e.selectedQuests){var r=e.selectedQuests[c].conditions,n=!1;for(var o in r){var p=!0;if(r[o].recipeId&&r[o].recipeId!=l.recipeId&&(p=!1),r[o].materialId){var d=!1;for(var u in l.materials)if(l.materials[u].material==r[o].materialId){d=!0;break}d||(p=!1)}if(r[o].guest&&l.guestsVal.indexOf(r[o].guest)<0&&(!$("#chk-recipe-rank-guest").prop("checked")||l.rankGuestsVal.indexOf(r[o].guest)<0)&&(p=!1),(r[o].anyGuest||r[o].newGuest)&&(l.guestsVal||$("#chk-recipe-rank-guest").prop("checked")&&l.rankGuestsVal||(p=!1)),r[o].skill&&0==l[""+r[o].skill]&&(p=!1),r[o].rarity&&l.rarity<r[o].rarity&&(p=!1),r[o].price&&l.price<r[o].price&&(p=!1),r[o].category&&(l[""+r[o].category]||(p=!1)),r[o].condiment&&l.condiment!=r[o].condiment&&(p=!1),p){n=!0;break}}if(!n)return!1}return!0}return!0}),e.materials)$("#chk-recipe-show-material").append("<option value='"+e.materials[t].materialId+"'>"+e.materials[t].name+"</option>");for(var t in $("#chk-recipe-show-material").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeTableData(e),$(this).val().length&&$("#recipe-table").DataTable().order([34,"desc"]),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-material").click(function(){$("#recipe-table").DataTable().draw()}),e.chefs)$("#chk-recipe-show-chef").append("<option value='"+e.chefs[t].chefId+"'>"+e.chefs[t].name+"</option>");for(var t in $("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(a,t,i,l){if($("#select-recipe-chef-quest").find('option:not([value=""])').remove(),1==$(this).val().length){var s=$(this).val()[0];for(var c in e.chefs)if(e.chefs[c].chefId==s){for(var r in e.chefs[c].ultimateGoal)for(var n in e.quests)if(e.chefs[c].ultimateGoal[r]==e.quests[n].questId){e.quests[n].hasOwnProperty("conditions")&&$("#select-recipe-chef-quest").append("<option value='"+e.quests[n].questId+"'>"+e.quests[n].goal+"</option>");break}break}}$("#select-recipe-chef-quest").selectpicker("refresh"),changeSelectStyle("#select-recipe-chef-quest"),updateRecipesChefsData(e),updateRecipeQuest(e,!0)}),$("#select-recipe-chef-quest").on("changed.bs.select",function(a,t,i,l){var s=!1;""!=l&&""!=$(this).val()||(updateRecipesChefsData(e),s=!0),l!=$(this).val()&&updateRecipeQuest(e,s)}),e.guests)$("#chk-recipe-guest").append("<option value='"+e.guests[t].name+"'>"+e.guests[t].name+"</option>");for(var t in $("#chk-recipe-guest").selectpicker().on("changed.bs.select",function(e,a,t,i){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),$("#chk-recipe-rank-guest").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-guest").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-antique").selectpicker().on("changed.bs.select",function(){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),$("#chk-recipe-rank-antique").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-antique").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGiftInfo(i,i.rank);i.rankGiftVal=l.rankGiftVal,i.rankGiftDisp=l.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),e.invitationGuests)$("#chk-recipe-invitation-guest").append("<option value='"+e.invitationGuests[t].name+"'>"+e.invitationGuests[t].name+"</option>");for(var i in $("#chk-recipe-invitation-guest").selectpicker().on("changed.bs.select",function(e,a,t,i){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),$("#chk-recipe-amber").selectpicker().on("changed.bs.select",function(){$("#recipe-table").DataTable().order([16,"asc"]).draw()}),e.activities){var l=e.activities[i].endTime,s=e.activities[i].name;l&&(new Date).getTime()/1e3<l?$("#select-recipe-quest").prepend("<optgroup label='"+s+"'></optgroup>"):$("#select-recipe-quest").append("<optgroup label='"+s+"'></optgroup>")}for(var t in e.quests)if(e.quests[t].hasOwnProperty("conditions")){var c="<option value='"+e.quests[t].questId+"' data-tokens='"+e.quests[t].type+"'>"+e.quests[t].questIdDisp+". "+e.quests[t].goal+"</option>";"修炼任务"!=e.quests[t].type&&$("#select-recipe-quest optgroup[label='"+e.quests[t].type+"']").append(c)}$("#select-recipe-quest").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeQuest(e)}),$("#chk-recipe-show").on("changed.bs.select",function(){initRecipeShow(),updateMenuLocalData()}),$("#chk-recipe-rarity").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-skill").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-skill").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-category").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-category").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-condiment").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-price").on("input",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-combo").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-ex-no").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-got").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-no-origin").click(function(){$("#recipe-table").DataTable().draw()}),$("#btn-recipe-reset").click(function(){$("#chk-recipe-rarity").selectpicker("deselectAll"),$("#chk-recipe-skill").selectpicker("deselectAll"),$("#chk-recipe-multiple-skill").prop("checked",!1),$("#chk-recipe-category").selectpicker("deselectAll"),$("#chk-recipe-multiple-category").prop("checked",!1),$("#chk-recipe-condiment").selectpicker("deselectAll"),$("#chk-recipe-combo").prop("checked",!1),$("#chk-recipe-ex-no").prop("checked",!1),$("#chk-recipe-got").prop("checked",!1),$("#chk-recipe-no-origin").prop("checked",!0),$("#input-recipe-price").val(""),$("#chk-recipe-guest").selectpicker("deselectAll"),$("#chk-recipe-rank-guest").prop("checked",!0),$("#chk-recipe-antique").selectpicker("deselectAll"),$("#chk-recipe-invitation-guest").selectpicker("deselectAll"),$("#chk-recipe-amber").selectpicker("deselectAll"),$("#chk-recipe-show-material").selectpicker("deselectAll"),$("#chk-recipe-multiple-material").prop("checked",!1),$(".pane-recipes .search-box input").val(""),$("#chk-recipe-show-chef").selectpicker("deselectAll"),$("#select-recipe-chef-quest").selectpicker("val",""),$("#select-recipe-quest").selectpicker("deselectAll"),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-apply-ex").change(function(){$(this).prop("checked")?$(".recipe-apply-ex").show():$(".recipe-apply-ex").hide(),updateRecipeChefTable(e)}),$("#chk-recipe-apply-ex-person").change(function(){updateRecipeChefTable(e)}),$("#btn-recipe-recal").click(function(){updateRecipeChefTable(e)}),initRecipeShow()}function updateRecipeQuest(e,a){$(".quest-warning").empty();var t=[],i=[],l=!1,s=[],c=!1,r=$("#select-recipe-quest").val(),n=$("#select-recipe-chef-quest").val();if(n.length&&r.push(n),r.length){var o="";for(var p in r)for(var d in e.quests)if(r[p]==e.quests[d].questId){for(var u in t.push(e.quests[d]),o+="["+e.quests[d].type+"] ","修炼任务"!=e.quests[d].type&&(o+=e.quests[d].questIdDisp+". "),o+=e.quests[d].goal+"<br>",e.quests[d].conditions){if(e.quests[d].conditions[u].newGuest&&(o=o.replace(/(新的)/g,"<span class='text-danger'>$1</span>")),2==e.quests[d].conditions[u].rank?o=o.replace(/(优级)/g,"<span class='text-danger'>$1</span>"):3==e.quests[d].conditions[u].rank?o=o.replace(/(特级)/g,"<span class='text-danger'>$1</span>"):4==e.quests[d].conditions[u].rank&&(o=o.replace(/(神级)/g,"<span class='text-danger'>$1</span>")),e.quests[d].conditions[u].num){o=o.replace(/(一次)/g,"<span class='text-danger'>$1</span>");var f=new RegExp("("+e.quests[d].conditions[u].num+"份)","g");o=o.replace(f,"<span class='text-danger'>$1</span>")}"修炼任务"==e.quests[d].type&&(4==e.quests[d].conditions[u].rank?c=!0:s=[16,"asc"]),e.quests[d].conditions[u].materialId&&e.quests[d].conditions[u].materialEff?(i.push(e.quests[d].conditions[u].materialId),s=[34,"desc"]):s=e.quests[d].conditions[u].materialEff?[21,"desc"]:e.quests[d].conditions[u].condimentEff?[22,"desc"]:e.quests[d].conditions[u].goldEff?[20,"desc"]:[16,"asc"]}break}$(".quest-warning").append(o),$(".quest-warning").removeClass("hidden")}else $(".quest-warning").addClass("hidden");e.selectedQuests=t,arraysEqual(e.questMaterials,i)||(e.questMaterials=i,l=!0),(l||a)&&updateRecipeTableData(e),c&&(s=[[e.recipeColNum+e.recipeAddColNum-2,"asc"],[16,"asc"]]),$("#recipe-table").DataTable().order(s).draw()}function reInitRecipeTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"name",width:"86px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:"stirfry",width:"20px",orderSequence:["desc","asc"]},{data:"boil",width:"20px",orderSequence:["desc","asc"]},{data:"knife",width:"20px",orderSequence:["desc","asc"]},{data:"fry",width:"20px",orderSequence:["desc","asc"]},{data:"bake",width:"20px",orderSequence:["desc","asc"]},{data:"steam",width:"20px",orderSequence:["desc","asc"]},{data:{_:"condiment",display:"condimentDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"materialsVal",display:"materialsDisp"}},{data:{_:"price",display:"priceDisp"},width:"30px",orderSequence:["desc","asc"]},{data:"exPrice",orderSequence:["desc","asc"]},{data:{_:"exTime",display:"exTimeDisp"},visible:private,className:"none"},{data:{_:"time",display:"timeDisp"}},{data:{_:"limitVal",display:"limitDisp"},orderSequence:["desc","asc"]},{data:"totalPrice",orderSequence:["desc","asc"]},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency",orderSequence:["desc","asc"]},{data:"allMaterialsEff",orderSequence:["desc","asc"]},{data:"condimentEff",orderSequence:["desc","asc"]},{data:"origin"},{data:"unlock"},{data:{_:"comboVal",display:"comboDisp"}},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"guestsVal",display:"guestsDisp"}},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:{_:"rankGiftVal",display:"rankGiftDisp"}},{data:{_:"invitationGuestsVal",display:"invitationGuestsDisp"}},{data:{_:"rank",sort:"rankSort"},className:"nodetails",width:"41px"},{data:"ex",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t="",i=[];$.fn.DataTable.isDataTable("#recipe-table")&&(t=$(".pane-recipes .search-box input").val(),i=getTableOrder($("#recipe-table").DataTable(),a.length),$("#recipe-table").DataTable().MakeCellsEditable("destroy"),$("#recipe-table").DataTable().destroy()),$("#recipe-table").html($("#recipe-table-header").html());for(var l=0;l<e.recipeAddColNumMax;l++)a.push({data:{_:"custom."+l+".value",display:"custom."+l+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#recipe-table thead tr").append("<th></th>");var s=!0,c=!1,r=!1;isMobile&&(s=!1,c=!0,r={left:[3]});var n="td:not(.nodetails)";expendBtn&&(n=".td-expend");var o=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:i,autoWidth:!1,fixedHeader:s,scrollX:c,fixedColumns:r,responsive:{details:{type:"column",target:n,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var s=5;s<=10;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:31==l?"无":32==l||33==l?"否":"")+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#recipe-table"))+">"+i+"</div>"}}}});$(".pane-recipes div.search-box").html('<input type="search" value="'+t+'" class="form-control input-sm monitor-none" placeholder="查找 菜名 材料 来源">');var p=getRankOptions(),d=getGotOptions();o.MakeCellsEditable({columns:[31,32,33],inputTypes:[{column:31,type:"list",options:p},{column:32,type:"list",options:d},{column:33,type:"list",options:d}],onUpdate:function(a,t,i,l){if(31==i.index().column){var s=t.data();s.rankSort=getRankSortValue(s.rank);var c=getRankGuestInfo(s,s.rank);s.rankGuestsVal=c.rankGuestsVal,s.rankGuestsDisp=c.rankGuestsDisp;var r=getRankGiftInfo(s,s.rank);s.rankGiftVal=r.rankGiftVal,s.rankGiftDisp=r.rankGiftDisp,t.data(s),o.draw(!1)}32==i.index().column&&i.data()!=l&&($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-recipe-recal").closest(".inline-wrapper").removeClass("hidden")),updateRecipesLocalData()}}),$(".pane-recipes .search-box input").on("input",function(){o.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(o),initTableScrollEvent(".pane-recipes")}function updateRecipeTableData(e){e.allSelectedMaterials=[];var a=$("#chk-recipe-show-material").val();for(var t in a)e.allSelectedMaterials.push(Number(a[t]));for(var t in e.questMaterials)e.allSelectedMaterials.indexOf(e.questMaterials[t])<0&&e.allSelectedMaterials.push(e.questMaterials[t]);var i=$("#select-recipe-chef-quest").val(),l=$("#chk-recipe-show-chef").val();e.recipeAddColNum=2*l.length+(i.length>0?1:0)+e.allSelectedMaterials.length,e.recipeAddColNum>e.recipeAddColNumMax&&(e.recipeAddColNumMax=e.recipeAddColNum,reInitRecipeTable(e),initRecipeShow(),isMobile&&updateScrollHeight());for(t=0;t<e.recipeAddColNumMax;t++)$($("#recipe-table").DataTable().column(e.recipeColNum+t).header()).removeClass("all").addClass("never");for(var t in e.recipes){for(var s in e.recipes[t].custom=[],e.allSelectedMaterials){var c=0;for(var r in e.recipes[t].materials)if(e.recipes[t].materials[r].material==e.allSelectedMaterials[s]){c=e.recipes[t].materials[r].quantity;break}var n=0;e.recipes[t].time>0&&(n=3600*c/e.recipes[t].time);var o=n?Math.floor(n):"";e.recipes[t].custom.push({display:o,value:n})}for(var p=0;p<l.length;p++)e.recipes[t].custom.push({display:e.recipes[t].chefs[p].rankDisp,value:e.recipes[t].chefs[p].rankVal}),i.length&&e.recipes[t].custom.push({display:e.recipes[t].chefs[p].skillDiffDisp,value:e.recipes[t].chefs[p].skillDiffVal}),e.recipes[t].custom.push({display:e.recipes[t].chefs[p].efficiency,value:e.recipes[t].chefs[p].efficiency})}var d=0;for(var s in e.allSelectedMaterials)for(j in e.materials)if(e.allSelectedMaterials[s]==e.materials[j].materialId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.materials[j].name+"/h").removeClass("never").addClass("all"),d++;break}for(var t in l)for(j in e.chefs)if(l[t]==e.chefs[j].chefId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.chefs[j].name).removeClass("never").addClass("all"),d++,i.length&&($($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("神差值").removeClass("never").addClass("all"),d++),$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("效率").removeClass("never").addClass("all"),d++;break}$("#recipe-table").DataTable().clear().rows.add(e.recipes),$("#recipe-table").DataTable().responsive.rebuild(),$("#recipe-table").DataTable().responsive.recalc()}function updateRecipesChefsData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#select-recipe-chef-quest").val(),i=$("#chk-recipe-show-chef").val(),l=$("#chk-chef-apply-ultimate").prop("checked"),s=$("#chk-chef-partial-ultimate").val();if(i.length>0)for(var c in e.recipes)for(var r in e.recipes[c].chefs=[],i)for(var n in e.chefs)if(i[r]==e.chefs[n].chefId){var o=null;a&&(o=e.chefs[n].equip);var p=JSON.parse(JSON.stringify(e.chefs[n])),d=s;for(var u in e.ultimateData.partial)if(e.ultimateData.partial[u].chefId==p.chefId){s.indexOf(p.chefId.toString())<0&&(d=s.concat(p.chefId));break}var f=getPartialChefAddsByIds(e.chefs,e.partialSkill,l,d);setDataForChef(p,o,a,e.ultimateData.global,f,e.ultimateData.self,null,!0,null,l);var h=getRecipeResult(p,o,e.recipes[c],e.recipes[c].limit,e.recipes[c].limit,e.materials,null,0,null,!1,buildRecipeMenu(e.recipes[c]),null,null),m={};if(m.rankVal=h.rankVal,m.rankDisp=h.rankDisp,m.efficiency=h.chefEff||"",t.length){var v=getSkillDiff(p,e.recipes[c],4);m.skillDiffDisp=v.disp,m.skillDiffVal=v.value}e.recipes[c].chefs.push(m);break}}function getChefSillDiff(e,a){var t="",i=e.stirfryVal-a.stirfryVal;i>0&&(t+="炒-"+i+" ");var l=e.boilVal-a.boilVal;l>0&&(t+="煮-"+l+" ");var s=e.knifeVal-a.knifeVal;s>0&&(t+="切-"+s+" ");var c=e.fryVal-a.fryVal;c>0&&(t+="炸-"+c+" ");var r=e.bakeVal-a.bakeVal;r>0&&(t+="烤-"+r+" ");var n=e.steamVal-a.steamVal;return n>0&&(t+="蒸-"+n+" "),""!=t&&(t=t.slice(0,-1)),t}function addCheffSkillDiff(e,a){if(a.stirfry>0){var t=a.stirfry-e.stirfryVal;t>0&&(e.stirfryVal+=t)}if(a.boil>0){var i=a.boil-e.boilVal;i>0&&(e.boilVal+=i)}if(a.knife>0){var l=a.knife-e.knifeVal;l>0&&(e.knifeVal+=l)}if(a.fry>0){var s=a.fry-e.fryVal;s>0&&(e.fryVal+=s)}if(a.bake>0){var c=a.bake-e.bakeVal;c>0&&(e.bakeVal+=c)}if(a.steam>0){var r=a.steam-e.steamVal;r>0&&(e.steamVal+=r)}}function getSkillDiff(e,a,t){var i=e.stirfryVal-a.stirfry*t,l=e.boilVal-a.boil*t,s=e.knifeVal-a.knife*t,c=e.fryVal-a.fry*t,r=e.bakeVal-a.bake*t,n=e.steamVal-a.steam*t,o="",p=0;i<0&&a.stirfry>0&&(o+="炒"+i+" ",p+=i),l<0&&a.boil>0&&(o+="煮"+l+" ",p+=l),s<0&&a.knife>0&&(o+="切"+s+" ",p+=s),c<0&&a.fry>0&&(o+="炸"+c+" ",p+=c),r<0&&a.bake>0&&(o+="烤"+r+" ",p+=r),n<0&&a.steam>0&&(o+="蒸"+n+" ",p+=n),""!=o&&(o=o.slice(0,-1));var d={};return d.disp=o,d.value=-p,d}function updateChefTableData(e){var a=Number($("#chk-chef-show-skill-diff").val()),t=$("#chk-chef-show-recipe").val();e.chefAddColNum=t.length*(2+(a?1:0)),e.chefAddColNum>e.chefAddColNumMax&&(e.chefAddColNumMax=e.chefAddColNum,reInitChefTable(e),initChefShow(),isMobile&&updateScrollHeight());for(var i=0;i<e.chefAddColNumMax;i++)$($("#chef-table").DataTable().column(e.chefColNum+i).header()).removeClass("all").addClass("never");for(var i in e.chefs){e.chefs[i].custom=[];for(var l=0;l<t.length;l++)e.chefs[i].custom.push({display:e.chefs[i].recipes[l].rankDisp,value:e.chefs[i].recipes[l].rankVal}),a&&e.chefs[i].custom.push({display:e.chefs[i].recipes[l].skillDiffDisp,value:e.chefs[i].recipes[l].skillDiffVal}),e.chefs[i].custom.push({display:e.chefs[i].recipes[l].efficiency,value:e.chefs[i].recipes[l].efficiency})}var s=0;for(var i in t)for(j in e.recipes)if(t[i]==e.recipes[j].recipeId){$($("#chef-table").DataTable().column(e.chefColNum+s).header()).text(e.recipes[j].name).removeClass("never").addClass("all"),s++,a&&($($("#chef-table").DataTable().column(e.chefColNum+s).header()).text(getSkillDiffText(a)).removeClass("never").addClass("all"),s++),$($("#chef-table").DataTable().column(e.chefColNum+s).header()).text("效率").removeClass("never").addClass("all"),s++;break}
t.length&&(order=a?[[e.chefColNum+1,"asc"],[e.chefColNum+2,"desc"]]:[e.chefColNum+1,"desc"],$("#chef-table").DataTable().order(order)),$("#chef-table").DataTable().clear().rows.add(e.chefs),$("#chef-table").DataTable().responsive.rebuild(),$("#chef-table").DataTable().responsive.recalc()}function getSkillDiffText(e){return 5==e?"传差值":4==e?"神差值":3==e?"特差值":2==e?"优差值":""}function updateChefsRecipesData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=Number($("#chk-chef-show-skill-diff").val()),i=$("#chk-chef-show-recipe").val(),l=$("#chk-chef-apply-ultimate").prop("checked"),s=$("#chk-chef-partial-ultimate").val();if(i.length>0)for(var c in e.chefs)for(var r in e.chefs[c].recipes=[],i)for(var n in e.recipes)if(i[r]==e.recipes[n].recipeId){var o=null;a&&(o=e.chefs[c].equip);var p=JSON.parse(JSON.stringify(e.chefs[c])),d=s;for(var u in e.ultimateData.partial)if(e.ultimateData.partial[u].chefId==p.chefId){s.indexOf(p.chefId.toString())<0&&(d=s.concat(p.chefId));break}var f=getPartialChefAddsByIds(e.chefs,e.partialSkill,l,d);setDataForChef(p,o,a,e.ultimateData.global,f,e.ultimateData.self,null,!0,null,l);var h=getRecipeResult(p,o,e.recipes[n],e.recipes[n].limit,e.recipes[n].limit,e.materials,null,0,null,!1,buildRecipeMenu(e.recipes[n]),null,null),m={};if(m.rankVal=h.rankVal,m.rankDisp=h.rankDisp,m.efficiency=h.chefEff||"",t){var v=getSkillDiff(p,e.recipes[n],t);m.skillDiffDisp=v.disp,m.skillDiffVal=v.value}e.chefs[c].recipes.push(m)}}function getTableOrder(e,a){var t=[],i=e.order();for(var l in i){var s=i[l][0];s<a&&t.push(i[l])}return t}function initChefTable(e){for(var a in reInitChefTable(e),e.recipes)$("#chk-chef-show-recipe").append("<option value='"+e.recipes[a].recipeId+"'>"+e.recipes[a].name+"</option>");var t=getAmbersOptions(e.ambers,null,!1);$("#chk-chef-amber").html(getOptionsString(t)).selectpicker();var i=getEquipsOptions(e.equips,!1);$("#chk-chef-equip").html(getOptionsString(i)).selectpicker(),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-rarity").val();return 0==s.length||!!$('#chk-chef-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-gender").val();return 0==s.length||!!$('#chk-chef-gender option[value="'+i.gender+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-category").val();if(0==s.length)return!0;var c=$("#chk-chef-category-equip-amber").prop("checked"),r=i.specialSkillEffect.concat(i.ultimateSkillEffect);if(c)for(var n in i.equip&&(r=r.concat(i.equip.effect)),i.disk.ambers){var o=i.disk.ambers[n].data;o&&(r=r.concat(o.allEffect[i.disk.level-1]))}for(var n in s)for(var p in r)if(r[p].type==s[n]){if("OpenTime"!=r[p].type)return!0;if(r[p].value<0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-condiment").val();if(0==s.length)return!0;for(var c in s)if(i[s[c]+"Val"]>0)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-disk").val();if(0==s.length)return!0;var c=$("#chk-chef-multiple-disk").prop("checked"),r=i.disk.ambers;for(var n in s){var o=s[n].split("_"),p=Number(o[0]),d=Number(o[1]),u=0;for(var f in r)r[f].type==p&&u++;if(u>=d){if(!c)return!0}else if(c)return!1}return!!c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-amber").val();if(0==s.length)return!0;var c=i.disk.ambers;for(var r in s)for(var n in c)if(c[n].data&&c[n].data.amberId==s[r])return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-equip").val();if(0==s.length)return!0;for(var c in s)if(i.equipId==s[c])return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-ultimate-no").prop("checked");return!(s&&(!s||i.ultimate))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-got").prop("checked");return!!(!s||s&&i.got)});var l=$(".pane-chefs .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,s){if(e.nTable!=document.getElementById("chef-table"))return!0;var c=$.trim(l.val());return!!commaSeparatedMatch(i.name,c)||(!!commaSeparatedMatch(i.specialSkillDisp,c)||(!!commaSeparatedMatch(i.origin,c)||(!!commaSeparatedMatch(i.ultimateSkillDisp,c)||!!commaSeparatedMatch(i.tagsDisp,c))))}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(a,t,i,l){updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw()}),$("#chk-chef-show-skill-diff").on("changed.bs.select",function(){$("#chk-chef-show-recipe").val().length&&(updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw())}),$("#chk-chef-show").on("changed.bs.select",function(){initChefShow(),updateMenuLocalData()}),$("#chk-chef-rarity").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-gender").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category-equip-amber").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-condiment").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-disk").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-multiple-disk").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-amber").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-equip").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-ultimate-no").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-got").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-no-origin").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-apply-ultimate").change(function(){$(this).prop("checked")?$(".chef-apply-ultimate").show():$(".chef-apply-ultimate").hide(),updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate-person").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-partial-ultimate").selectpicker().on("changed.bs.select",function(){updateRecipeChefTable(e)}),$("#chk-chef-apply-equips").change(function(){updateRecipeChefTable(e)}),$("#btn-chef-recal").click(function(){updateRecipeChefTable(e)}),$("#btn-chef-reset").click(function(){$("#chk-chef-rarity").selectpicker("deselectAll"),$("#chk-chef-gender").selectpicker("deselectAll"),$("#chk-chef-category").selectpicker("deselectAll"),$("#chk-chef-condiment").selectpicker("deselectAll"),$("#chk-chef-disk").selectpicker("deselectAll"),$("#chk-chef-multiple-disk").prop("checked",!1),$("#chk-chef-amber").selectpicker("deselectAll"),$("#chk-chef-equip").selectpicker("deselectAll"),$("#chk-chef-ultimate-no").prop("checked",!1),$("#chk-chef-got").prop("checked",!1),$("#chk-chef-no-origin").prop("checked",!0),$("#chk-chef-show-recipe").selectpicker("deselectAll"),$(".pane-chefs .search-box input").val(""),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#chef-table").DataTable().draw()}),initChefShow()}function reInitChefTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-chef-icon",orderable:!1,searchable:!1},{data:"name",width:"81px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:{_:"meatVal",display:"meatDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"creationVal",display:"creationDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"vegVal",display:"vegDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fishVal",display:"fishDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"gender",width:"30px"},{data:{_:"sweetVal",display:"sweetDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"sourVal",display:"sourDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"spicyVal",display:"spicyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"saltyVal",display:"saltyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bitterVal",display:"bitterDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"tastyVal",display:"tastyDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"origin"},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"diskId",display:"diskDisp"},className:"nodetails td-disk"},{data:{_:"equipId",display:"equipDisp"},className:"nodetails"},{data:"ultimateGoalDisp"},{data:"ultimateSkillDisp"},{data:"ultimate",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t="",i=[];$.fn.DataTable.isDataTable("#chef-table")&&(t=$(".pane-chefs .search-box input").val(),i=getTableOrder($("#chef-table").DataTable(),a.length),$("#chef-table").DataTable().MakeCellsEditable("destroy"),$("#chef-table").DataTable().destroy()),$("#chef-table").html($("#chef-table-header").html());for(var l=0;l<e.chefAddColNumMax;l++)a.push({data:{_:"custom."+l+".value",display:"custom."+l+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#chef-table thead tr").append("<th></th>");var s=!0,c=!1,r=!1;isMobile&&(s=!1,c=!0,r={left:[0,3]});var n="td:not(.nodetails)";expendBtn&&(n=".td-expend");var o=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:i,autoWidth:!1,fixedHeader:s,scrollX:c,fixedColumns:r,responsive:{details:{type:"column",target:n,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var s=5;s<=10;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else{if(l>12&&l<=15)continue;if(12==l){i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>采集：</span>";for(s=12;s<=15;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else{if(l>17&&l<=22)continue;if(17==l){i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>调料：</span>";for(s=17;s<=22;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:19==l?"无":22==l||23==l?"否":"")+"</span></div>"}}}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#chef-table"))+">"+i+"</div>"}}}});$(".pane-chefs div.search-box").html('<input type="search" value="'+t+'" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">');var p=getGotOptions(),d=getEquipsOptions(e.equips,!0);o.MakeCellsEditable({columns:[26,29,30],inputTypes:[{column:26,type:"list",search:!0,clear:!0,done:!0,options:d},{column:29,type:"list",options:p},{column:30,type:"list",options:p}],onUpdate:function(a,t,i,l){if(26==i.index().column){var s=t.data(),c=null,r="",n=getEquipInfo(s.equipId,e.equips);n&&(c=n,r=n.disp),s.equip=c,s.equipDisp=r,t.data(s),o.draw(!1)}26!=i.index().column&&29!=i.index().column||i.data()==l||($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-chef-recal").closest(".inline-wrapper").removeClass("hidden")),updateChefsLocalData()}}),$(o.body()).on("click","td.td-disk",function(){var a=$("#chef-table").DataTable().table().row($(this).parents("tr")),t=a.data();$("#disk-modal .chef-name").html(t.name);var i=$("#disk-modal select.select-chef-disk-level"),l=getDiskLevelsOptions(t.disk);i.html(getOptionsString(l)).selectpicker("refresh"),i.off("changed.bs.select").on("changed.bs.select",function(i,l,s,c){t.disk.level=Number($(this).val()),t.diskDisp=GetDiskDisp(t.disk),a.data(t),o.draw(!1);for(var r=0;r<t.disk.ambers.length;r++)updateModalAmberDisplay(r,t.disk.ambers[r].data,t.disk.level);$("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-chef-recal").closest(".inline-wrapper").removeClass("hidden"),updateChefsLocalData()});for(var s=0;s<t.disk.ambers.length;s++){var c=t.disk.ambers[s],r=$("#disk-modal select.select-chef-amber:eq("+s+")");r.closest(".amber-box").removeClass("hidden").find(".dropdown-toggle").removeClass("btn-primary btn-success btn-danger btn-default").addClass(getAmberBtnClass(c.type));var n=getAmbersOptions(e.ambers,c,!0);r.html(getOptionsString(n)).selectpicker("refresh"),r.off("changed.bs.select").on("changed.bs.select",function(i,l,s,c){var r=Number($(this).val()),n=$("#disk-modal").find(".amber-box").index($(this).closest(".amber-box")),p=getAmberInfo(r,e.ambers);t.disk.ambers[n].data=p,t.diskDisp=GetDiskDisp(t.disk),a.data(t),o.draw(!1),updateModalAmberDisplay(n,p,t.disk.level),$("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-chef-recal").closest(".inline-wrapper").removeClass("hidden"),updateChefsLocalData()}),updateModalAmberDisplay(s,c.data,t.disk.level)}for(s=t.disk.ambers.length;s<3;s++)$("#disk-modal .amber-box:eq("+s+")").addClass("hidden");$("#disk-modal").modal()}),$(".pane-chefs .search-box input").on("input",function(){o.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(o),initTableScrollEvent(".pane-chefs")}function initEquipTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#equip-table").DataTable({data:e.equips,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#equip-table"))+">"+i+"</div>"}}}});$(".pane-equips div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$("#chk-equip-skill").val();if(0==s.length)return!0;var c=i.effect,r=$("#chk-equip-multiple-skill").prop("checked"),n=!1;for(var o in(1==s.length||r)&&(n=$("#chk-equip-filter-negative-skill").prop("checked")),s){var p=!0,d=s[o].split(",");for(var u in d){var f=!1;for(var h in c)if(c[h].type==d[u]){if(n&&c[h].value<0)return!1;f=!0;break}if(!f){if(r)return!1;p=!1;break}}if(!r&&p)return!0}return!!r}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$("#chk-equip-filter-all-skill").prop("checked");if(!s)return!0;var c=i.effect,r="Stirfry,Boil,Knife,Fry,Bake,Steam",n=r.split(",");for(var o in n){var p=!1;for(var d in c)if(c[d].type==n[o]){p=!0;break}if(!p)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$("#chk-equip-no-origin").prop("checked");return!!(s||!s&&i.origin)});var r=$(".pane-equips .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$.trim(r.val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-equip-show").on("changed.bs.select",function(){initEquipShow(),updateMenuLocalData()}),$("#chk-equip-skill").selectpicker().on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],c.order([5,"desc"]).order([3,"desc"])),c.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var s in l.effect)if((l.effect[s].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[s].type)&&(l.skillSort=l.effect[s].value,"Percent"==l.effect[s].cal)){l.skillSort*=1e4;break}this.data(l)}),c.draw()}),$("#chk-equip-no-origin").click(function(){c.draw()}),$("#chk-equip-multiple-skill").click(function(){c.draw()}),$("#chk-equip-filter-negative-skill").click(function(){c.draw()}),$("#chk-equip-filter-all-skill").click(function(){c.draw()}),$(".pane-equips .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-equip-reset").click(function(){$("#chk-equip-skill").selectpicker("deselectAll"),$("#chk-equip-multiple-skill").prop("checked",!1),$("#chk-equip-filter-negative-skill").prop("checked",!1),$("#chk-equip-filter-all-skill").prop("checked",!1),$("#chk-equip-no-origin").prop("checked",!0),$(".pane-equips .search-box input").val(""),checkMonitorStyle(),c.draw()}),initTableResponsiveDisplayEvent(c),initTableScrollEvent(".pane-equips"),initEquipShow()}function initAmberTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"amberId",width:"1px"},{data:"icon",className:"td-amber-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"type",display:"typeDisp"},width:"35px"},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"allDesc"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#amber-table").DataTable({data:e.ambers,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#amber-table"))+">"+i+"</div>"}}}});$(".pane-ambers div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("amber-table"))return!0;var s=$("#chk-amber-origin").val();if(0==s.length)return!0;for(var c in s)if(s[c]==i.origin)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("amber-table"))return!0;var s=$("#chk-amber-skill").val();if(0==s.length)return!0;var c=i.effect;for(var r in s){var n=!0,o=s[r].split(",");for(var p in o){var d=!1;for(var u in c)if(c[u].type==o[p]){d=!0;break}if(!d){n=!1;break}}if(n)return!0}return!1});var r=$(".pane-ambers .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("amber-table"))return!0;var s=$.trim(r.val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||(!!commaSeparatedMatch(i.allDesc,s)||!!commaSeparatedMatch(i.origin,s)))}),$("#chk-amber-show").on("changed.bs.select",function(){initAmberShow(),updateMenuLocalData()}),$("#chk-amber-origin").on("changed.bs.select",function(){c.draw()}),$("#chk-amber-skill").selectpicker().on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],c.order([6,"desc"])),c.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var s in l.effect)if((l.effect[s].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[s].type)&&(l.skillSort=l.effect[s].value,"Percent"==l.effect[s].cal)){l.skillSort*=1e4;break}this.data(l)}),c.draw()}),$(".pane-ambers .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-amber-reset").click(function(){$("#chk-amber-origin").selectpicker("deselectAll"),$("#chk-amber-skill").selectpicker("deselectAll"),$(".pane-ambers .search-box input").val(""),checkMonitorStyle(),c.draw()}),initTableResponsiveDisplayEvent(c),initTableScrollEvent(".pane-ambers"),initAmberShow()}function initDecorationTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"id",width:"1px"},{data:"icon",className:"td-decoration-icon",orderable:!1,searchable:!1},{data:"name",width:"145px",className:"all fixedcolumn"},{data:{_:"gold",display:"goldDisp"},orderSequence:["desc","asc"]},{data:"tipMin",orderSequence:["desc","asc"]},{data:"tipMax",orderSequence:["desc","asc"]},{data:{_:"tipTime",display:"tipTimeDisp"},orderSequence:["desc","asc"]},{data:"minEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"maxEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:{_:"tAvgEff",display:"avgEffDisp"},defaultContent:"-",orderSequence:["desc","asc"]},{data:"position"},{data:{_:"suit",display:"suitDisp"},orderSequence:["desc","asc"]},{data:{_:"suitGold",display:"suitGoldDisp"},orderSequence:["desc","asc"]},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,4]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#decoration-table").DataTable({data:e.decorations,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个装饰",0:"",1:"选择了 %d 个装饰"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[0,"desc"],[11,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<4?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#decoration-table"))+">"+i+"</div>"}}}});$(".pane-decorations div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 套装 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=$("#chk-decoration-position").val();if(0==s.length)return!0;var c=i.position;return!!$('#chk-decoration-position option[value="'+c+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=$("#chk-decoration-no-origin").prop("checked");return!!(s||!s&&i.origin)});var r=$(".pane-decorations .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=$.trim(r.val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.suit,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-decoration-show").on("changed.bs.select",function(){initDecorationShow(),updateMenuLocalData()}),$("#chk-decoration-position").on("changed.bs.select",function(){c.draw()}),$("#chk-decoration-no-origin").click(function(){c.draw()}),$(".pane-decorations .search-box input").on("input",function(){c.draw(),changeInputStyle(this)});var n="<option></option>";for(var o in e.suits)n+="<option value='"+e.suits[o].name+"'>"+e.suits[o].name+"</option>";$("#select-decoration-suit").append(n).selectpicker().change(function(){var e=$("#select-decoration-suit").val();$("#select-decoration-suit").selectpicker("val",""),c.rows().deselect(),c.rows().every(function(a,t,i){this.data().suit==e&&this.select()}),c.draw()}),$("#btn-decoration-deselect-all").click(function(){$("#chk-decoration-position").selectpicker("deselectAll"),$("#select-decoration-suit").selectpicker("val",""),c.rows().deselect()}),c.on("user-select",function(e,a,t,i,l){var s=i.index().row,r=c.rows(s).data()[0];c.rows({selected:!0}).every(function(e,a,t){this.data().position==r.position&&this.data().id!=r.id&&this.deselect()})}),c.on("select",function(a,t,i,l){updateDecorationSum(e)}),c.on("deselect",function(a,t,i,l){updateDecorationSum(e)}),initTableResponsiveDisplayEvent(c),initTableScrollEvent(".pane-decorations"),initDecorationShow()}function updateDecorationSum(e){var a=$("#decoration-table").DataTable().rows({selected:!0}).data().toArray(),t=0,i=0,l=0,s=[];for(var c in a)a[c].suit&&s.indexOf(a[c].suit)<0&&s.push(a[c].suit),a[c].tAvgEff&&(t+=a[c].tAvgEff),a[c].rAvgEff&&(i+=a[c].rAvgEff),l+=a[c].gold;var r=0;for(var c in s)r+=getSuitGold(e,a,s[c]);var n="";a.length&&(n="平均玉璧/天: "+getDecorationAvgEffDisp(t,i)+" 收入加成: "+getPercentDisp(+(100*(l+r)).toFixed(2))),$("#decoration-sum").html(n)}function getSuitGold(e,a,t){for(var i in e.suits)if(e.suits[i].name==t){for(var l in e.suits[i].decorations){var s=!1;for(var c in a)if(e.suits[i].decorations[l]==a[c].id){s=!0;break}if(!s)return 0}return e.suits[i].gold}return 0}function initMaterialTable(e){for(var a in e.maps)$("#select-material-origin").append("<option value='"+e.maps[a].name+"'>"+e.maps[a].name+"</option>");reInitMaterialTable(e),$("#select-material-origin").selectpicker().change(function(){reInitMaterialTable(e)}),$("#chk-material-season").click(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()}),$("#input-material-addition, #input-material-skill").on("input",function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()})}function reInitMaterialTable(e){var a=[{data:"name",className:"fixedcolumn"},{data:"skill",defaultContent:""}];$.fn.DataTable.isDataTable("#material-table")&&$("#material-table").DataTable().destroy();var t,i=$("#select-material-origin").val();for(var l in e.maps)if(i==e.maps[l].name){t=e.maps[l];break}for(var l in $("#material-table thead tr").first().html("").append("<th rowspan='2'>食材</th><th rowspan='2'>点数</th>"),$("#material-table thead tr").last().html(""),t.time)$("#material-table thead tr").first().append("<th colspan='2'>"+secondsToTime(t.time[l])+"</th>"),$("#material-table thead tr").last().append("<th>最小</th><th>最大</th>"),a.push({data:"time."+l+".0"}),a.push({data:"time."+l+".1"});var s=getMaterialsData(e,t),c=!1,r=!1;isMobile&&(c=!0,r={left:[0]});var n=$("#material-table").DataTable({data:s,columns:a,dom:"<'row'<'col-sm-12'tr>>",paging:!1,ordering:!1,info:!1,deferRender:!0,autoWidth:!1,scrollX:c,fixedColumns:r});initTableScrollEvent(".pane-materials"),n.draw()}function initCondimentTable(e){var a=[{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"condimentId",width:"1px"},{data:"icon",className:"td-condiment-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#condiment-table").DataTable({data:e.condiments,columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(0==l)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#condiment-table"))+">"+i+"</div>"}}}});$(".pane-condiments div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var s=$("#chk-condiment-origin").val();if(0==s.length)return!0;for(var c in s)if(s[c]==i.origin)return!0;return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var s=$("#chk-condiment-skill").val();if(0==s.length)return!0;var c=$("#chk-condiment-multiple-skill").prop("checked"),r=i.effect;for(var n in s){var o=!0,p=s[n].split(",");for(var d in p){var u=!1;for(var f in r)if(r[f].type==p[d]){u=!0;break}if(!u){if(c)return!1;o=!1;break}}if(!c&&o)return!0}return!!c});var r=$(".pane-condiments .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("condiment-table"))return!0;var s=$.trim(r.val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-condiment-show").on("changed.bs.select",function(){initCondimentShow(),updateMenuLocalData()}),$("#chk-condiment-origin").on("changed.bs.select",function(){c.draw()}),
$("#chk-condiment-skill").selectpicker().on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],c.order([5,"desc"])),c.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var s in l.effect)if((l.effect[s].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[s].type)&&(l.skillSort=l.effect[s].value,"Percent"==l.effect[s].cal)){l.skillSort*=1e4;break}this.data(l)}),c.draw()}),$("#chk-condiment-multiple-skill").click(function(){c.draw()}),$(".pane-condiments .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-condiment-reset").click(function(){$("#chk-condiment-origin").selectpicker("deselectAll"),$("#chk-condiment-skill").selectpicker("deselectAll"),$("#chk-condiment-multiple-skill").prop("checked",!1),$(".pane-condiments .search-box input").val(""),checkMonitorStyle(),c.draw()}),initTableResponsiveDisplayEvent(c),initTableScrollEvent(".pane-condiments"),initCondimentShow()}function initQuestTable(e){for(var a in e.activities){var t=e.activities[a].endTime,i=e.activities[a].name;t&&(new Date).getTime()/1e3<t?$("#select-quest-type").prepend("<option value='"+i+"' selected>"+i+"</option>"):$("#select-quest-type").append("<option value='"+i+"'>"+i+"</option>")}var l=[{data:"questIdDisp",width:"25px",className:"fixedcolumn"},{data:"preId",defaultContent:"",orderable:!1,width:"35px"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],s=getQuestsData(e.quests,$("#select-quest-type").val()),c=!0,r=!1,n=!1;isMobile&&(c=!1,r=!0,n={leftColumns:[0]});var o=$("#quest-table").DataTable({data:s,columns:l,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_"},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:[],autoWidth:!1,fixedHeader:c,scrollX:r,fixedColumns:n});$(".pane-quest div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 编号 任务 奖励">');var p=$(".pane-quest .search-box input");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("quest-table"))return!0;var s=$.trim(p.val());return!!commaSeparatedMatch(i.questIdDisp.toString(),s)||(!!commaSeparatedMatch(i.goal,s)||!!commaSeparatedMatch(i.rewardsVal,s))}),$(".pane-quest .search-box input").on("input",function(){o.draw(),changeInputStyle(this)}),$("#select-quest-type").selectpicker().change(function(){var a=getQuestsData(e.quests,$(this).val());o.clear().rows.add(a).draw(),initQuestShow(o)}),initTableScrollEvent(".pane-quest"),initQuestShow(o)}function initImportExport(e){$("#btn-import-data").click(function(){$("#input-import-data").val()?($.popupmsg({message:"导入中...",fade:!1}),$.ajax({cache:!1,success:function(a){var t=JSON.parse(a);if("S"==t.ret){var i=importData(e,JSON.stringify(t.msg));i?($("#input-import-data").val(""),$.popupmsg({message:"导入成功 !"})):$.popupmsg({message:"导入失败 !",type:"alert-danger"})}else $.popupmsg({message:t.msg,type:"alert-danger"})},error:function(){$.popupmsg({message:"获取失败 !",type:"alert-danger"})},url:"https://yx518.com/api/archive.do?token="+$("#input-import-data").val()})):$("#input-import-data").focus()}),$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$("#import-msg-2").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=importData(e,$("#input-export-import").val());a?($("#input-export-import").val(""),$("#import-msg-2").html("导入成功 !")):$("#import-msg-2").html("导入失败 !")},0)}),$("#btn-export-download").click(function(){var e=new Blob([generateExportData()],{type:"text/plain;charset=utf-8"});saveAs(e,"food.txt")}),$("#file-import").change(function(){$("#import-msg").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=document.getElementById("file-import").files[0],t=new FileReader;t.onload=function(a){var t=importData(e,a.target.result);t?$("#import-msg").html("导入成功 !"):$("#import-msg").html("导入失败 !")},t.readAsText(a,"UTF-8"),$("#file-import").val("")},0)}),$("#btn-import-bcjh-cloud").click(function(){$("#import-msg-bcjh-cloud").html("导入中...").removeClass("hidden"),$("#input-import-bcjh-cloud").val()?setTimeout(function(){$.ajax({cache:!1,success:function(e){if(e.result){var a=importDataBcjh(e.data);a?$("#import-msg-bcjh-cloud").html("导入成功 !"):$("#import-msg-bcjh-cloud").html("导入失败 !")}else $("#import-msg-bcjh-cloud").html(e.msg)},error:function(){$("#import-msg-bcjh-cloud").html("获取失败 !")},url:"https://bcjh.xyz/api/download_data?id="+$("#input-import-bcjh-cloud").val()})},0):$("#import-msg-bcjh-cloud").html("输入数据ID !")}),$("#btn-import-bcjh-text").click(function(){$("#import-msg-bcjh-text").html("导入中...").removeClass("hidden"),setTimeout(function(){var e=importDataBcjh($("#input-import-bcjh-text").val());e?$("#import-msg-bcjh-text").html("导入成功 !"):$("#import-msg-bcjh-text").html("导入失败 !")},0)}),$("#file-import-bcjh").change(function(){$("#import-msg-bcjh-file").html("导入中...").removeClass("hidden"),setTimeout(function(){var e=document.getElementById("file-import-bcjh").files[0],a=new FileReader;a.onload=function(e){var a=importDataBcjh(e.target.result);a?$("#import-msg-bcjh-file").html("导入成功 !"):$("#import-msg-bcjh-file").html("导入失败 !")},a.readAsText(e,"UTF-8"),$("#file-import-bcjh").val("")},0)})}function importDataBcjh(e){var a;try{a=JSON.parse(e)}catch(e){return!1}var t=a.userUltimate,i=a.repGot,l=a.chefGot;if(!t||!i||!l)return!1;$("#input-cal-decoration").val(t.decoBuff),$("#input-cal-ultimate-stirfry").val(t.Stirfry),$("#input-cal-ultimate-boil").val(t.Boil),$("#input-cal-ultimate-knife").val(t.Knife),$("#input-cal-ultimate-fry").val(t.Fry),$("#input-cal-ultimate-bake").val(t.Bake),$("#input-cal-ultimate-steam").val(t.Steam),$("#input-cal-ultimate-male-skill").val(Number(t.Male)+Number(t.All)||""),$("#input-cal-ultimate-female-skill").val(Number(t.Female)+Number(t.All)||""),$("#input-cal-ultimate-1-limit").val(t.MaxLimit_1),$("#input-cal-ultimate-2-limit").val(t.MaxLimit_2),$("#input-cal-ultimate-3-limit").val(t.MaxLimit_3),$("#input-cal-ultimate-4-limit").val(t.MaxLimit_4),$("#input-cal-ultimate-5-limit").val(t.MaxLimit_5),$("#input-cal-ultimate-1-price").val(t.PriceBuff_1),$("#input-cal-ultimate-2-price").val(t.PriceBuff_2),$("#input-cal-ultimate-3-price").val(t.PriceBuff_3),$("#input-cal-ultimate-4-price").val(t.PriceBuff_4),$("#input-cal-ultimate-5-price").val(t.PriceBuff_5);var s=[];for(var c in t.Partial.id)s.push(t.Partial.id[c].split(",")[0]);$("#chk-cal-partial-ultimate").selectpicker("val",s);var r=[];for(var c in t.Self.id)r.push(t.Self.id[c].split(",")[0]);for(var n in $("#chk-cal-self-ultimate").selectpicker("val",r),calCustomRule.rules){var o=calCustomRule.rules[n];for(var c in o.recipes)for(var p in i)if(p==o.recipes[c].recipeId){o.recipes[c].got=i[p];break}for(var c in o.chefs)for(var p in l)if(p==o.chefs[c].chefId){o.chefs[c].got=l[p];break}}return $("#cal-recipes-table").DataTable().draw(),!0}function importRunResult(e){for(var a=$("#input-import-run").val(),t="厨师：",i=/-|\r\n|\r|\n/g,l="菜谱：",s="]",c=/；|;|\r\n|\r|\n/g,r=/\(/g,n=0;n<calCustomRule.rules.length;n++){var o=calCustomRule.rules[n],p=o.custom;for(var d in p){var u=a.indexOf(t);if(u>=0){a=a.substring(u+t.length);var f="",h=a.search(i);h>=0&&(f=a.substring(0,h),a=a.substring(h+1));var m=getCustomChefIdByName(o.chefs,$.trim(f));if(!m)break;setCustomChef(n,d,m)}var v=a.indexOf(l);if(v>=0)for(var b in a=a.substring(v+l.length),p[d].recipes){var g=a.indexOf(s);g>=0&&(a=a.substring(g+1));f=a;var k=a.search(c);k>=0&&(f=a.substring(0,k),a=a.substring(k+1));var y=f.search(r);y>=0&&(f=f.substring(0,y));var x=getCustomRecipeIdByName(o.menus,$.trim(f));if(!x)break;setCustomRecipe(n,d,b,x)}}}calCustomResults(e),$("#input-import-run").val(""),$.popupmsg({message:"导入完毕 !"}),$("#import-run-modal").modal("hide")}function getCustomChefIdByName(e,a){for(var t in e)if(e[t].name==a)return e[t].chefId;return null}function getCustomRecipeIdByName(e,a){for(var t in e)if(e[t].recipe.data.name==a)return e[t].recipe.data.recipeId;return null}function importData(e,a){var t;try{t=JSON.parse(a)}catch(e){return!1}for(var i in e.recipes){for(var l in t.recipes)if(e.recipes[i].recipeId==t.recipes[l].id){if(t.recipes[l].hasOwnProperty("rank")){e.recipes[i].rank=t.recipes[l].rank,e.recipes[i].rankSort=getRankSortValue(t.recipes[l].rank);var s=getRankGuestInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGuestsVal=s.rankGuestsVal,e.recipes[i].rankGuestsDisp=s.rankGuestsDisp;var c=getRankGiftInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGiftVal=c.rankGiftVal,e.recipes[i].rankGiftDisp=c.rankGiftDisp}t.recipes[l].hasOwnProperty("ex")&&(e.recipes[i].ex=t.recipes[l].ex),t.recipes[l].hasOwnProperty("got")&&(e.recipes[i].got=t.recipes[l].got);break}for(var l in t.recipesTags)if(e.recipes[i].recipeId==t.recipesTags[l].recipeId){e.recipes[i].tags=t.recipesTags[l].tags,e.recipes[i].tagsDisp=getTagsDisp(t.recipesTags[l].tags,t.tags),e.recipes[i].exTime=t.recipesTags[l].experienceTime,e.recipes[i].exTimeDisp=getExTimeDisp(t.recipesTags[l].experienceTime,e.recipes[i].time);break}}for(var i in e.chefs)for(var l in updateChefByLocalData(e.chefs[i],t,e.equips,e.ambers),t.chefsTags)if(e.chefs[i].chefId==t.chefsTags[l].chefId){e.chefs[i].tags=t.chefsTags[l].tags,e.chefs[i].tagsDisp=getTagsDisp(t.chefsTags[l].tags,t.tags);break}var r="";for(var i in t.rules){var n=!1;for(var l in e.rules)if(t.rules[i].Id==e.rules[l].Id){e.rules[l]=t.rules[i],n=!0;break}n||(e.rules.push(t.rules[i]),r+="<option value='"+t.rules[i].Id+"'>"+t.rules[i].Title+"</option>")}$("#select-cal-rule").append(r).selectpicker("destroy").selectpicker(),t.calChefs&&($("#cal-chefs-table").DataTable().rows().deselect(),$("#cal-chefs-table").DataTable().rows(function(e,a,i){for(var l in t.calChefs)if(a.chefId==t.calChefs[l])return!0;return!1}).select()),t.calEquips&&($("#cal-equips-table").DataTable().rows().deselect(),$("#cal-equips-table").DataTable().rows(function(e,a,i){for(var l in t.calEquips)if(a.equipId==t.calEquips[l])return!0;return!1}).select());var o=getLocalData();for(var i in o.cal||(o.cal=[]),t.cal){var p="",d=!1;for(var l in o.cal)if(t.cal[i].id==o.cal[l].id){for(var u in t.cal[i].data){var f=!1;for(var h in o.cal[l].data)if(t.cal[i].data[u].score==o.cal[l].data[h].score){o.cal[l].data[h].menu=t.cal[i].data[u].menu,f=!0;break}f||(o.cal[l].data.push(t.cal[i].data[u]),t.cal[i].id==calCustomRule.id&&(p+="<option value='"+t.cal[i].data[u].score+"'>"+t.cal[i].data[u].score+"</option>"))}d=!0;break}if(!d&&(o.cal.push(t.cal[i]),t.cal[i].id==calCustomRule.id))for(var u in t.cal[i].data)p+="<option value='"+t.cal[i].data[u].score+"'>"+t.cal[i].data[u].score+"</option>";p&&$("#select-cal-custom").append(p).selectpicker("destroy").selectpicker()}updateCalLocalData(o.cal),updateMenu(t),updateSetting(t),t.decorationEffect&&(e.decorationEffect=t.decorationEffect,$("#input-cal-decoration").val(t.decorationEffect||""));try{localStorage.setItem("data",generateExportData())}catch(e){}return e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),initRecipeShow(),initChefShow(),initEquipShow(),initAmberShow(),initDecorationShow(),initCondimentShow(),!0}function updateChefByLocalData(e,a,t,i){for(var l in a.chefs)if(e.chefId==a.chefs[l].id){if(a.chefs[l].hasOwnProperty("got")&&(e.got=a.chefs[l].got),a.chefs[l].hasOwnProperty("ult")&&(e.ultimate=a.chefs[l].ult),a.chefs[l].hasOwnProperty("equip")){var s=getEquipInfo(a.chefs[l].equip,t);s&&(e.equip=s,e.equipId=s.equipId,e.equipDisp=s.disp)}else e.equip=null,e.equipId="",e.equipDisp="";if(a.chefs[l].hasOwnProperty("dlv")){var c=a.chefs[l].dlv;Number.isInteger(c)&&c>0&&c<=e.disk.maxLevel&&(e.disk.level=c)}else e.disk.level=1;if(a.chefs[l].hasOwnProperty("ambers")){var r=JSON.parse(JSON.stringify(a.chefs[l].ambers));for(var n in e.disk.ambers){var o=!1;for(var p in r){if(0==r[p]){r.splice(p,1);break}var d=getAmberInfo(r[p],i);if(d&&e.disk.ambers[n].type==d.type){e.disk.ambers[n].data=d,r.splice(p,1),o=!0;break}}o||(e.disk.ambers[n].data=null)}}else for(var n in e.disk.ambers)e.disk.ambers[n].data=null;e.diskDisp=GetDiskDisp(e.disk);break}}function updateCalLocalData(e){updateLocalData("cal",e)}function updateRecipesLocalData(){updateLocalData("recipes",generateRecipesExportData())}function updateChefsLocalData(){updateLocalData("chefs",generateChefsExportData())}function updateMenuLocalData(){var e=getLocalData();updateLocalData("menu",generateMenuExportData(e.menu))}function updateSettingLocalData(){updateLocalData("setting",generateSettingExportData())}function updateDecorationLocalData(){updateLocalData("decorationEffect",Number($("#input-cal-decoration").val()))}function updateActivityLocalData(){var e=getLocalData();e.cal||(e.cal=[]);var a=generateActivityExportData(),t=!1;for(var i in e.cal)if(e.cal[i].id==calCustomRule.id){e.cal[i].activity=a,t=!0;break}if(!t){var l={};l.id=calCustomRule.id,l.activity=a,l.data=[],e.cal.push(l)}updateCalLocalData(e.cal)}function updateLocalData(e,a){var t=getLocalData();t[e]=a;try{localStorage.setItem("data",JSON.stringify(t))}catch(e){}}function getLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}return e||(e={}),e}function generateExportData(){var e=getLocalData(),a={};return a.recipes=generateRecipesExportData(),a.chefs=generateChefsExportData(),a.menu=generateMenuExportData(e.menu),a.setting=generateSettingExportData(),a.decorationEffect=Number($("#input-cal-decoration").val()),a.cal=e.cal,JSON.stringify(a)}function generateRecipesExportData(){var e=[],a=$("#recipe-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].recipeId,i.rank=a[t].rank,i.ex=a[t].ex,i.got=a[t].got,e.push(i)}return e}function generateChefsExportData(){var e=[],a=$("#chef-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].chefId,i.got=a[t].got,i.ult=a[t].ultimate,a[t].equip&&(i.equip=a[t].equip.equipId),1!=a[t].disk.level&&(i.dlv=a[t].disk.level);var l=!1,s=[];for(var c in a[t].disk.ambers){var r=a[t].disk.ambers[c].data;r?(s.push(r.amberId),l=!0):s.push(0)}l&&(i.ambers=s),e.push(i)}return e}function generateMenuExportData(e){var a={version:5};return a.recipe=$("#chk-recipe-show").val(),a.chef=$("#chk-chef-show").val(),a.equip=$("#chk-equip-show").val(),a.amber=$("#chk-amber-show").val(),a.decoration=$("#chk-decoration-show").val(),a.condiment=$("#chk-condiment-show").val(),a.caldd=$("#chk-cal-dd-show").val(),isMobile?(a.calmui=$("#chk-cal-ui-show").val(),e&&e.calui&&(a.calui=e.calui)):(a.calui=$("#chk-cal-ui-show").val(),e&&e.calmui&&(a.calmui=e.calmui)),a}function updateMenu(e){e&&e.menu&&(2==e.menu.version&&(updateMenuForNewVersion(e.menu.recipe,0,"0"),updateMenuForNewVersion(e.menu.chef,0,"0"),updateMenuForNewVersion(e.menu.equip,0,"0"),updateMenuForNewVersion(e.menu.decoration,0,"1"),updateMenuForNewVersion(e.menu.condiment,0,"0")),e.menu.version<4&&updateMenuForNewVersion(e.menu.recipe,22,null),4==e.menu.version&&(updateMenuForNewVersion(e.menu.recipe,30,"30"),updateMenuForNewVersion(e.menu.chef,25,"25")),$("#chk-recipe-show").selectpicker("val",e.menu.recipe),$("#chk-chef-show").selectpicker("val",e.menu.chef),$("#chk-equip-show").selectpicker("val",e.menu.equip),$("#chk-amber-show").selectpicker("val",e.menu.amber),$("#chk-decoration-show").selectpicker("val",e.menu.decoration),$("#chk-condiment-show").selectpicker("val",e.menu.condiment),e.menu.caldd&&$("#chk-cal-dd-show").selectpicker("val",e.menu.caldd),isMobile?e.menu.calmui&&$("#chk-cal-ui-show").selectpicker("val",e.menu.calmui):e.menu.calui&&$("#chk-cal-ui-show").selectpicker("val",e.menu.calui))}function updateMenuForNewVersion(e,a,t){if(a)for(var i in e)Number(e[i])>=a&&(e[i]=(Number(e[i])+1).toString());t&&e.push(t)}function generateSettingExportData(){var e={};return e.help=$("#chk-setting-show-help").prop("checked"),e.expandbtn=$("#chk-setting-expand-btn").prop("checked"),e.auto=$("#chk-setting-auto-update").prop("checked"),e.final=$("#chk-setting-show-final").prop("checked"),e.mark=$("#chk-setting-done-mark").prop("checked"),e.pagelen=Number($("#select-setting-page-length").val()),e}function updateSetting(e){e&&e.setting&&($("#chk-setting-show-help").prop("checked")!=e.setting.help&&(e.setting.help?$("#chk-setting-show-help").bootstrapToggle("on"):$("#chk-setting-show-help").bootstrapToggle("off")),$("#chk-setting-expand-btn").prop("checked")!=e.setting.expandbtn&&(e.setting.expandbtn?$("#chk-setting-expand-btn").bootstrapToggle("on"):($("#chk-setting-expand-btn").bootstrapToggle("off"),expendBtn=!1)),$("#chk-setting-auto-update").prop("checked")!=e.setting.auto&&(e.setting.auto?$("#chk-setting-auto-update").bootstrapToggle("on"):$("#chk-setting-auto-update").bootstrapToggle("off")),$("#chk-setting-show-final").prop("checked")!=e.setting.final&&(e.setting.final?$("#chk-setting-show-final").bootstrapToggle("on"):$("#chk-setting-show-final").bootstrapToggle("off")),$("#chk-setting-done-mark").prop("checked")!=e.setting.mark&&(e.setting.mark?$("#chk-setting-done-mark").bootstrapToggle("on"):$("#chk-setting-done-mark").bootstrapToggle("off")),Number($("#select-setting-page-length").val())!=e.setting.pagelen&&e.setting.pagelen&&$("#select-setting-page-length").selectpicker("val",e.setting.pagelen))}function generateActivityExportData(){var e={};return e.stirfryPrice=$("#input-cal-activity-stirfry-price").val(),e.bakePrice=$("#input-cal-activity-bake-price").val(),e.steamPrice=$("#input-cal-activity-steam-price").val(),e.boilPrice=$("#input-cal-activity-boil-price").val(),e.fryPrice=$("#input-cal-activity-fry-price").val(),e.knifePrice=$("#input-cal-activity-knife-price").val(),e.sourPrice=$("#input-cal-activity-sour-price").val(),e.sweetPrice=$("#input-cal-activity-sweet-price").val(),e.bitterPrice=$("#input-cal-activity-bitter-price").val(),e.spicyPrice=$("#input-cal-activity-spicy-price").val(),e.saltyPrice=$("#input-cal-activity-salty-price").val(),e.tastyPrice=$("#input-cal-activity-tasty-price").val(),e.vegetablePrice=$("#input-cal-activity-vegetable-price").val(),e.creationPrice=$("#input-cal-activity-creation-price").val(),e.fishPrice=$("#input-cal-activity-fish-price").val(),e.meatPrice=$("#input-cal-activity-meat-price").val(),e.goldPrice=$("#input-cal-activity-gold-price").val(),e.stirfry=$("#input-cal-activity-stirfry").val(),e.bake=$("#input-cal-activity-bake").val(),e.steam=$("#input-cal-activity-steam").val(),e.boil=$("#input-cal-activity-boil").val(),e.fry=$("#input-cal-activity-fry").val(),e.knife=$("#input-cal-activity-knife").val(),e.limit1=$("#input-cal-activity-1-limit").val(),e.limit2=$("#input-cal-activity-2-limit").val(),e.limit3=$("#input-cal-activity-3-limit").val(),e.limit4=$("#input-cal-activity-4-limit").val(),e.limit5=$("#input-cal-activity-5-limit").val(),e}function updateActivity(e){e&&($("#input-cal-activity-stirfry-price").val(e.stirfryPrice),$("#input-cal-activity-bake-price").val(e.bakePrice),$("#input-cal-activity-steam-price").val(e.steamPrice),$("#input-cal-activity-boil-price").val(e.boilPrice),$("#input-cal-activity-fry-price").val(e.fryPrice),$("#input-cal-activity-knife-price").val(e.knifePrice),$("#input-cal-activity-sour-price").val(e.sourPrice),$("#input-cal-activity-sweet-price").val(e.sweetPrice),$("#input-cal-activity-bitter-price").val(e.bitterPrice),$("#input-cal-activity-spicy-price").val(e.spicyPrice),$("#input-cal-activity-salty-price").val(e.saltyPrice),$("#input-cal-activity-tasty-price").val(e.tastyPrice),$("#input-cal-activity-vegetable-price").val(e.vegetablePrice),$("#input-cal-activity-creation-price").val(e.creationPrice),$("#input-cal-activity-fish-price").val(e.fishPrice),$("#input-cal-activity-meat-price").val(e.meatPrice),$("#input-cal-activity-gold-price").val(e.goldPrice),$("#input-cal-activity-stirfry").val(e.stirfry),$("#input-cal-activity-bake").val(e.bake),$("#input-cal-activity-steam").val(e.steam),$("#input-cal-activity-boil").val(e.boil),$("#input-cal-activity-fry").val(e.fry),$("#input-cal-activity-knife").val(e.knife),$("#input-cal-activity-1-limit").val(e.limit1),$("#input-cal-activity-2-limit").val(e.limit2),$("#input-cal-activity-3-limit").val(e.limit3),$("#input-cal-activity-4-limit").val(e.limit4),$("#input-cal-activity-5-limit").val(e.limit5))}function initCalTables(e,a){calCustomRule={},calCustomRule.id=0,calCustomRule.score=0,calCustomRule.rules=[],setSelfUltimateOptions(e.chefs,e.skills),setExOptions(e.recipes),initCalRecipesTable(),initCalCustomTable(e),initCalRules(e,a),private?($(".pane-cal").addClass("admin"),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),$("#input-cal-thread").val(navigator.hardwareConcurrency)):$(".admin-only").remove()}function showCalSubPane(){$(".pane-cal-sub").addClass("hidden");var e=$("input[name='rad-cal-pane-options']:checked");".pane-cal-recipes"==e.attr("data-pane")&&"false"==$("#pane-cal-recipes").attr("data-cal")&&($("#pane-cal-recipes").attr("data-cal","true"),calRecipesResults()),$(e.attr("data-pane")).removeClass("hidden"),".pane-cal-rules"==e.attr("data-pane")&&resizeCalCustomTable(),isMobile?($(".dataTables_scrollBody:visible table.dataTable").DataTable().draw(!1),"true"!=$(e).attr("data-init")&&($(e).attr("data-init","true"),updateScrollHeight())):reInitFixedHeader()}function initCalRules(e,a){for(var t in e.rules)if(!e.rules[t].Hide&&e.rules[t].Id){var i=e.rules[t].StartTime,l=e.rules[t].EndTime,s=(new Date).getTime()/1e3;if(!(i&&s<i||l&&s>l)){var c=e.rules[t].Title,r="<option value='"+e.rules[t].Id+"'>"+c+"</option>",n=!1;$("#select-cal-rule optgroup").each(function(){c.indexOf($(this).attr("label"))>=0&&($(this).append(r),n=!0)}),n||(l?$("#select-cal-rule").prepend(r):$("#select-cal-rule").append(r))}}if($("#select-cal-rule").selectpicker().change(function(){$("#btn-cal-rule-load").addClass("btn-danger")}),$("#input-cal-decoration").val(e.decorationEffect||""),loadUltimate(e,!0),$("#btn-cal-rule-load").click(function(){$(this).hasClass("btn-danger")?loadCalRule(e):bootbox.confirm({size:"small",message:"<div class='text-center'>确定重新加载?</div>",locale:"zh_CN",callback:function(a){a&&loadCalRule(e)}})}),$("input[name='rad-cal-pane-options']").change(function(){showCalSubPane()}),$("#input-cal-decoration").on("input",function(){updateDecorationLocalData(),setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$(".cal-settings input").on("input",function(){setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#chk-cal-partial-ultimate").selectpicker().on("changed.bs.select",function(){setCalConfigData(e),calCustomResults(e)}),$("#chk-cal-self-ultimate").selectpicker().on("changed.bs.select",function(){setCalConfigData(e),calCustomResults(e)}),$("#chk-cal-ex").selectpicker().on("changed.bs.select",function(){setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-load-ultimate").click(function(){$("#cal-ultimate input").val(""),loadUltimate(e,!0),setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-load-all-ultimate").click(function(){$("#cal-ultimate input").val(""),loadUltimate(e,!1),setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-clear-ultimate").click(function(){$("#cal-ultimate input").val(""),$("#chk-cal-partial-ultimate").selectpicker("deselectAll").selectpicker("refresh"),$("#chk-cal-self-ultimate").selectpicker("deselectAll").selectpicker("refresh"),$("#chk-cal-ex").selectpicker("deselectAll").selectpicker("refresh"),setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#cal-activity input").on("input",function(){updateActivityLocalData()}),$("#btn-cal-clear-activity").click(function(){$("#cal-activity input").val(""),updateActivityLocalData(),setCalConfigData(e),calCustomResults(e),$("#pane-cal-recipes").attr("data-cal","false")}),$("#select-cal-order").change(function(){sortRecipesResult()}),$("#chk-cal-dd-show").on("changed.bs.select",function(){updateMenuLocalData()}),$("#chk-cal-ui-show").on("changed.bs.select",function(){initCalCustomShow(),updateMenuLocalData()}),$("#btn-cal-clear-custom").click(function(){initCustomData(),calCustomResults(e);var a=calCustomRule.rules[0];a.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}),$("#btn-cal-reset-custom").click(function(){$("#chk-cal-got").prop("checked",!1),$("#chk-cal-recipe-rarity").selectpicker("deselectAll"),$("#chk-cal-recipe-skill").selectpicker("deselectAll"),$("#chk-cal-recipe-multiple-skill").prop("checked",!1),$("#chk-cal-recipe-condiment").selectpicker("deselectAll"),checkMonitorStyle(),$("#cal-recipes-table").DataTable().draw()}),$("#btn-cal-custom-load").click(function(){var a=$("#select-cal-custom").val();if(a){var t=getLocalData();for(var i in t.cal)if(t.cal[i].id==calCustomRule.id){for(var l in t.cal[i].data)if(t.cal[i].data[l].score==a){var s=t.cal[i].data[l].menu;for(var c in s)for(var r in s[c]){var n=s[c][r];if(setCustomChef(c,r,n.chef),n.chef&&n.dlv)for(var o in setCustomDiskLevel(c,r,n.dlv),n.ambers)setCustomAmber(c,r,o,n.ambers[o]);for(var p in setCustomEquip(c,r,n.equip),setCustomCondiment(c,r,n.condiment,e),n.recipes){var d=n.recipes[p];setCustomRecipe(c,r,p,d.id),setCustomRecipeQuantity(c,r,p,d.qty),updateCustomRecipeCondiment(c,r,p,d.cdt)}}break}break}calCustomResults(e),calCustomRule.rules[0].hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}}),$("#btn-cal-custom-delete").click(function(){var e=$("#select-cal-custom").val();e&&bootbox.confirm({size:"small",message:"<div class='text-center'>确定删除?</div>",locale:"zh_CN",callback:function(a){if(a){var t=getLocalData();for(var i in t.cal)if(t.cal[i].id==calCustomRule.id){for(var l in t.cal[i].data)if(t.cal[i].data[l].score==e){t.cal[i].data.splice(l,1),$("#select-cal-custom option[value='"+e+"']").remove(),$("#select-cal-custom").selectpicker("destroy").selectpicker();break}break}updateCalLocalData(t.cal)}}})}),$("#btn-cal-custom-save").click(function(){if(calCustomRule.score){var e=getLocalData();e.cal||(e.cal=[]);var a={};for(var t in a.score=calCustomRule.score,a.menu=[],calCustomRule.rules){var i=[],l=calCustomRule.rules[t].custom;for(var s in l){var c={};if(c.chef=l[s].chef.chefId,l[s].chef.chefId)for(var r in c.dlv=l[s].chef.disk.level,c.ambers=[],l[s].chef.disk.ambers){var n=0;l[s].chef.disk.ambers[r].data&&(n=l[s].chef.disk.ambers[r].data.amberId),c.ambers.push(n)}for(var r in c.equip=l[s].equip.equipId,c.condiment=l[s].condiment.condimentId,c.recipes=[],l[s].recipes){n={};l[s].recipes[r].data&&(n.id=l[s].recipes[r].data.recipeId,n.qty=l[s].recipes[r].quantity,n.cdt=l[s].recipes[r].useCondiment),c.recipes.push(n)}i.push(c)}a.menu.push(i)}var o=!1,p=!1;for(var s in e.cal)if(e.cal[s].id==calCustomRule.id){var d=!1;for(var r in e.cal[s].data)if(e.cal[s].data[r].score==a.score){e.cal[s].data[r].menu=a.menu,d=!0;break}d||(e.cal[s].data.push(a),o=!0),p=!0;break}if(!p){var u={};u.id=calCustomRule.id,u.data=[],u.data.push(a),e.cal.push(u),o=!0}if(o){var f="<option value='"+a.score+"'>"+a.score+"</option>";$("#select-cal-custom").append(f).selectpicker("destroy").selectpicker("val",a.score)}updateCalLocalData(e.cal)}}),$("#btn-cal-import-run").click(function(){$("#import-run-modal").modal(),$("#menu-modal").modal("hide")}),$("#btn-import-run").click(function(){importRunResult(e)}),$("#chk-cal-lock").click(function(){$(this).prop("checked")?$(".selected-item").addClass("lock"):$(".selected-item").removeClass("lock")}),isMobile&&($("#chk-cal-lock").closest(".btn").addClass("hidden"),!a||!a.menu||!a.menu.calmui)){var o=[];o.push("chef_icon"),o.push("amber"),o.push("amber_icon"),o.push("amber_skill"),o.push("equip_icon"),o.push("equip_skill"),o.push("condiment"),o.push("condiment_icon"),o.push("condiment_skill"),o.push("recipe_icon"),$("#chk-cal-ui-show").selectpicker("val",o)}initCalCustomShow()}function loadCalRule(e){var a=Math.floor($("#select-cal-rule").val());for(var t in calCustomRule.rules=[],e.rules)if(e.rules[t].Id==a){if(calCustomRule.id=a,e.rules[t].Group){for(var i in e.rules[t].Group)for(var l in e.rules)if(e.rules[l].Id==e.rules[t].Group[i]){calCustomRule.rules.push(e.rules[l]);break}}else calCustomRule.rules.push(e.rules[t]);break}$("#input-cal-decoration").prop("disabled",!0),$("#cal-activity").hide(),$(".btn-resize").hide(),$(".cal-custom-item").hide(),$(".cal-custom-item .selected-item").hide();for(var s=0;s<calCustomRule.rules.length;s++){var c=calCustomRule.rules[s];$(".cal-custom-item:eq("+s+")").show();var r=$(".cal-custom-item:eq("+s+") .btn-resize");r.hasClass("glyphicon-resize-full")&&r.click(),calCustomRule.rules.length>1&&r.show(),c.DisableDecorationEffect||$("#input-cal-decoration").prop("disabled",!1),c.IsActivity&&$("#cal-activity").show();var n="";if(c.Satiety){for(t=0;t<c.IntentList.length;t++){for(var l in n+="<div class='item'>第"+(t+1)+"轮:",c.IntentList[t])for(var o in e.intents)if(c.IntentList[t][l]==e.intents[o].intentId){n+="<span class='intent-"+t+l+" label label-default'>"+e.intents[o].desc+"</span>";break}n+="</div>",$(".cal-custom-item:eq("+s+") .selected-item:eq("+t+")").show()}1==c.SatisfyRewardType&&(n+="<div class='item'><span class='intent-satiety label label-default'>饱腹感达到"+c.Satiety+"时总售价+"+c.SatisfyExtraValue+"%</span></div>"),$("#pane-cal-custom").addClass("banquet"),$("#btn-cal-import-run").show()}else $("#pane-cal-custom").removeClass("banquet"),$(".cal-custom-item:eq("+s+") .selected-item:nth-child(-n+3)").show(),$("#btn-cal-import-run").hide();$(".rule-desc:eq("+s+")").html(n)}$(".cal-custom-item .selected-item .recipe-box .recipe-condiment input").prop("checked",!0),calCustomRule.rules.length>1?$(".pane-cal-recipes").hide():$(".pane-cal-recipes").show();var p=getLocalData(),d="";for(var t in p.cal)if(p.cal[t].id==calCustomRule.id){for(var i in p.cal[t].data)d+="<option value='"+p.cal[t].data[i].score+"'>"+p.cal[t].data[i].score+"</option>";calCustomRule.rules[0].IsActivity&&updateActivity(p.cal[t].activity);break}$("#select-cal-custom").html(d).selectpicker("destroy").selectpicker(),$("#input-import-run").val(""),$("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),setTimeout(function(){loadRule(e,calCustomRule),setCalConfigData(e),$("#pane-cal-recipes").attr("data-cal","false"),$(".loading").addClass("hidden"),$(".cal-menu").removeClass("hidden"),showCalSubPane(),$("#btn-cal-rule-load").prop("disabled",!1).removeClass("btn-danger")},0)}function loadUltimate(e,a){var t=getLocalData(),i=getUltimateData(e.chefs,t,e.skills,!0,a),l=i.global
;for(var s in l)"Stirfry"!=l[s].type||l[s].tag?"Boil"!=l[s].type||l[s].tag?"Knife"!=l[s].type||l[s].tag?"Fry"!=l[s].type||l[s].tag?"Bake"!=l[s].type||l[s].tag?"Steam"!=l[s].type||l[s].tag?1!=l[s].tag?2!=l[s].tag?"MaxEquipLimit"!=l[s].type||1!=l[s].rarity?"MaxEquipLimit"!=l[s].type||2!=l[s].rarity?"MaxEquipLimit"!=l[s].type||3!=l[s].rarity?"MaxEquipLimit"!=l[s].type||4!=l[s].rarity?"MaxEquipLimit"!=l[s].type||5!=l[s].rarity?"UseAll"!=l[s].type||1!=l[s].rarity?"UseAll"!=l[s].type||2!=l[s].rarity?"UseAll"!=l[s].type||3!=l[s].rarity?"UseAll"!=l[s].type||4!=l[s].rarity?"UseAll"!=l[s].type||5!=l[s].rarity?"Material_Gain"!=l[s].type&&"Material_Vegetable"!=l[s].type&&"Material_Meat"!=l[s].type&&"Material_Fish"!=l[s].type&&"Material_Creation"!=l[s].type&&"ExperienceTimeRate"!=l[s].type&&console.log(l[s].type):$("#input-cal-ultimate-5-price").val(l[s].value):$("#input-cal-ultimate-4-price").val(l[s].value):$("#input-cal-ultimate-3-price").val(l[s].value):$("#input-cal-ultimate-2-price").val(l[s].value):$("#input-cal-ultimate-1-price").val(l[s].value):$("#input-cal-ultimate-5-limit").val(l[s].value):$("#input-cal-ultimate-4-limit").val(l[s].value):$("#input-cal-ultimate-3-limit").val(l[s].value):$("#input-cal-ultimate-2-limit").val(l[s].value):$("#input-cal-ultimate-1-limit").val(l[s].value):$("#input-cal-ultimate-female-skill").val(l[s].value):$("#input-cal-ultimate-male-skill").val(l[s].value):$("#input-cal-ultimate-steam").val(l[s].value):$("#input-cal-ultimate-bake").val(l[s].value):$("#input-cal-ultimate-fry").val(l[s].value):$("#input-cal-ultimate-knife").val(l[s].value):$("#input-cal-ultimate-boil").val(l[s].value):$("#input-cal-ultimate-stirfry").val(l[s].value);var c=i.partial,r=[];for(var s in c)r.push(c[s].chefId);$("#chk-cal-partial-ultimate").selectpicker("val",r);var n=i.self,o=[];for(var s in n)o.push(n[s].chefId);$("#chk-cal-self-ultimate").selectpicker("val",o);var p=[];for(var s in e.recipes)(a&&"是"==e.recipes[s].ex||!a)&&p.push(e.recipes[s].recipeId);$("#chk-cal-ex").selectpicker("val",p)}function setCalConfigData(e){for(var a in calCustomRule.rules){var t=calCustomRule.rules[a];t.decorationEffect=Number($("#input-cal-decoration").val());var i=[],l=Number($("#input-cal-ultimate-stirfry").val());if(l){var s={type:"Stirfry"};s.value=l,s.condition="Global",s.cal="Abs",i.push(s)}var c=Number($("#input-cal-ultimate-boil").val());if(c){s={type:"Boil"};s.value=c,s.condition="Global",s.cal="Abs",i.push(s)}var r=Number($("#input-cal-ultimate-knife").val());if(r){s={type:"Knife"};s.value=r,s.condition="Global",s.cal="Abs",i.push(s)}var n=Number($("#input-cal-ultimate-fry").val());if(n){s={type:"Fry"};s.value=n,s.condition="Global",s.cal="Abs",i.push(s)}var o=Number($("#input-cal-ultimate-bake").val());if(o){s={type:"Bake"};s.value=o,s.condition="Global",s.cal="Abs",i.push(s)}var p=Number($("#input-cal-ultimate-steam").val());if(p){s={type:"Steam"};s.value=p,s.condition="Global",s.cal="Abs",i.push(s)}var d=Number($("#input-cal-ultimate-male-skill").val());if(d){var u={type:"Stirfry"};u.value=d,u.condition="Global",u.cal="Abs",u.tag=1,i.push(u);var f={type:"Boil"};f.value=d,f.condition="Global",f.cal="Abs",f.tag=1,i.push(f);var h={type:"Knife"};h.value=d,h.condition="Global",h.cal="Abs",h.tag=1,i.push(h);var m={type:"Fry"};m.value=d,m.condition="Global",m.cal="Abs",m.tag=1,i.push(m);var v={type:"Bake"};v.value=d,v.condition="Global",v.cal="Abs",v.tag=1,i.push(v);var b={type:"Steam"};b.value=d,b.condition="Global",b.cal="Abs",b.tag=1,i.push(b)}var g=Number($("#input-cal-ultimate-female-skill").val());if(g){u={type:"Stirfry"};u.value=g,u.condition="Global",u.cal="Abs",u.tag=2,i.push(u);f={type:"Boil"};f.value=g,f.condition="Global",f.cal="Abs",f.tag=2,i.push(f);h={type:"Knife"};h.value=g,h.condition="Global",h.cal="Abs",h.tag=2,i.push(h);m={type:"Fry"};m.value=g,m.condition="Global",m.cal="Abs",m.tag=2,i.push(m);v={type:"Bake"};v.value=g,v.condition="Global",v.cal="Abs",v.tag=2,i.push(v);b={type:"Steam"};b.value=g,b.condition="Global",b.cal="Abs",b.tag=2,i.push(b)}var k=Number($("#input-cal-ultimate-1-limit").val());if(k){s={type:"MaxEquipLimit"};s.value=k,s.condition="Global",s.cal="Abs",s.rarity=1,i.push(s)}var y=Number($("#input-cal-ultimate-2-limit").val());if(y){s={type:"MaxEquipLimit"};s.value=y,s.condition="Global",s.cal="Abs",s.rarity=2,i.push(s)}var x=Number($("#input-cal-ultimate-3-limit").val());if(x){s={type:"MaxEquipLimit"};s.value=x,s.condition="Global",s.cal="Abs",s.rarity=3,i.push(s)}var D=Number($("#input-cal-ultimate-4-limit").val());if(D){s={type:"MaxEquipLimit"};s.value=D,s.condition="Global",s.cal="Abs",s.rarity=4,i.push(s)}var C=Number($("#input-cal-ultimate-5-limit").val());if(C){s={type:"MaxEquipLimit"};s.value=C,s.condition="Global",s.cal="Abs",s.rarity=5,i.push(s)}var w=Number($("#input-cal-ultimate-1-price").val());if(w){s={type:"UseAll"};s.value=w,s.condition="Global",s.cal="Percent",s.rarity=1,i.push(s)}var T=Number($("#input-cal-ultimate-2-price").val());if(T){s={type:"UseAll"};s.value=T,s.condition="Global",s.cal="Percent",s.rarity=2,i.push(s)}var S=Number($("#input-cal-ultimate-3-price").val());if(S){s={type:"UseAll"};s.value=S,s.condition="Global",s.cal="Percent",s.rarity=3,i.push(s)}var q=Number($("#input-cal-ultimate-4-price").val());if(q){s={type:"UseAll"};s.value=q,s.condition="Global",s.cal="Percent",s.rarity=4,i.push(s)}var E=Number($("#input-cal-ultimate-5-price").val());if(E){s={type:"UseAll"};s.value=E,s.condition="Global",s.cal="Percent",s.rarity=5,i.push(s)}var I=$("#chk-cal-partial-ultimate").val();for(var R in I)I[R]=Number(I[R]);var N=$("#chk-cal-self-ultimate").val();for(var R in N)N[R]=Number(N[R]);var M=getSelfUltimateData(e.chefs,e.skills,!0,N),A=getActivityConfigData(t);t.calGlobalUltimateData=i,t.calPartialChefIds=I,t.calSelfUltimateData=M,t.calActivityUltimateData=A;var O=$("#chk-cal-ex").val();for(var R in O)O[R]=Number(O[R]);for(var R in t.menus){var _=O.indexOf(t.menus[R].recipe.data.recipeId)>=0;setDataForRecipe(t.menus[R].recipe.data,i,_,A,!0,t);var G=getRecipeQuantity(t.menus[R].recipe.data,t.materials,t,null),P=getRecipeResult(null,null,t.menus[R].recipe.data,G,G,t.materials,t,t.decorationEffect,null,!1,buildRecipeMenu(t.menus[R].recipe.data),null,null);P.available=G,P.availableScore=Math.ceil(+(P.totalScore/P.max*G).toFixed(2)),t.menus[R].recipe=P}for(var R in t.chefs)setDataForChef(t.chefs[R],null,!1,i,null,M,A,!0,t,!0)}}function getActivityConfigData(e){var a=[];if(e.IsActivity){var t=Number($("#input-cal-activity-stirfry").val());if(t){var i={type:"Stirfry"};i.value=t,i.condition="Global",i.cal="Abs",a.push(i)}var l=Number($("#input-cal-activity-boil").val());if(l){i={type:"Boil"};i.value=l,i.condition="Global",i.cal="Abs",a.push(i)}var s=Number($("#input-cal-activity-knife").val());if(s){i={type:"Knife"};i.value=s,i.condition="Global",i.cal="Abs",a.push(i)}var c=Number($("#input-cal-activity-fry").val());if(c){i={type:"Fry"};i.value=c,i.condition="Global",i.cal="Abs",a.push(i)}var r=Number($("#input-cal-activity-bake").val());if(r){i={type:"Bake"};i.value=r,i.condition="Global",i.cal="Abs",a.push(i)}var n=Number($("#input-cal-activity-steam").val());if(n){i={type:"Steam"};i.value=n,i.condition="Global",i.cal="Abs",a.push(i)}var o=Number($("#input-cal-activity-1-limit").val());if(o){i={type:"MaxEquipLimit"};i.value=o,i.condition="Global",i.cal="Abs",i.rarity=1,a.push(i)}var p=Number($("#input-cal-activity-2-limit").val());if(p){i={type:"MaxEquipLimit"};i.value=p,i.condition="Global",i.cal="Abs",i.rarity=2,a.push(i)}var d=Number($("#input-cal-activity-3-limit").val());if(d){i={type:"MaxEquipLimit"};i.value=d,i.condition="Global",i.cal="Abs",i.rarity=3,a.push(i)}var u=Number($("#input-cal-activity-4-limit").val());if(u){i={type:"MaxEquipLimit"};i.value=u,i.condition="Global",i.cal="Abs",i.rarity=4,a.push(i)}var f=Number($("#input-cal-activity-5-limit").val());if(f){i={type:"MaxEquipLimit"};i.value=f,i.condition="Global",i.cal="Abs",i.rarity=5,a.push(i)}var h=Number($("#input-cal-activity-stirfry-price").val());if(h){i={type:"UseStirfry"};i.value=h,i.condition="Global",i.cal="Percent",a.push(i)}var m=Number($("#input-cal-activity-boil-price").val());if(m){i={type:"UseBoil"};i.value=m,i.condition="Global",i.cal="Percent",a.push(i)}var v=Number($("#input-cal-activity-knife-price").val());if(v){i={type:"UseKnife"};i.value=v,i.condition="Global",i.cal="Percent",a.push(i)}var b=Number($("#input-cal-activity-fry-price").val());if(b){i={type:"UseFry"};i.value=b,i.condition="Global",i.cal="Percent",a.push(i)}var g=Number($("#input-cal-activity-bake-price").val());if(g){i={type:"UseBake"};i.value=g,i.condition="Global",i.cal="Percent",a.push(i)}var k=Number($("#input-cal-activity-steam-price").val());if(k){i={type:"UseSteam"};i.value=k,i.condition="Global",i.cal="Percent",a.push(i)}var y=Number($("#input-cal-activity-vegetable-price").val());if(y){i={type:"UseVegetable"};i.value=y,i.condition="Global",i.cal="Percent",a.push(i)}var x=Number($("#input-cal-activity-meat-price").val());if(x){i={type:"UseMeat"};i.value=x,i.condition="Global",i.cal="Percent",a.push(i)}var D=Number($("#input-cal-activity-creation-price").val());if(D){i={type:"UseCreation"};i.value=D,i.condition="Global",i.cal="Percent",a.push(i)}var C=Number($("#input-cal-activity-fish-price").val());if(C){i={type:"UseFish"};i.value=C,i.condition="Global",i.cal="Percent",a.push(i)}var w=Number($("#input-cal-activity-sweet-price").val());if(w){i={type:"UseSweet"};i.value=w,i.condition="Global",i.cal="Percent",a.push(i)}var T=Number($("#input-cal-activity-sour-price").val());if(T){i={type:"UseSour"};i.value=T,i.condition="Global",i.cal="Percent",a.push(i)}var S=Number($("#input-cal-activity-spicy-price").val());if(S){i={type:"UseSpicy"};i.value=S,i.condition="Global",i.cal="Percent",a.push(i)}var q=Number($("#input-cal-activity-salty-price").val());if(q){i={type:"UseSalty"};i.value=q,i.condition="Global",i.cal="Percent",a.push(i)}var E=Number($("#input-cal-activity-bitter-price").val());if(E){i={type:"UseBitter"};i.value=E,i.condition="Global",i.cal="Percent",a.push(i)}var I=Number($("#input-cal-activity-tasty-price").val());if(I){i={type:"UseTasty"};i.value=I,i.condition="Global",i.cal="Percent",a.push(i)}var R=Number($("#input-cal-activity-gold-price").val());if(R){i={type:"CookbookPrice"};i.value=R,i.condition="Global",i.cal="Percent",a.push(i)}}return a}function loadRule(e,a){for(var t=0;t<a.rules.length;t++){var i=a.rules[t],l=JSON.parse(JSON.stringify(e.recipes)),s=JSON.parse(JSON.stringify(e.chefs)),c=JSON.parse(JSON.stringify(e.ambers)),r=JSON.parse(JSON.stringify(e.equips)),n=JSON.parse(JSON.stringify(e.materials));for(var o in i.MaterialsEffect)for(var p in n)if(n[p].materialId==i.MaterialsEffect[o].MaterialID){n[p].addition=+(Number(n[p].addition)+i.MaterialsEffect[o].Effect).toFixed(2);break}var d=[];if(i.hasOwnProperty("MaterialsNum")){for(var o in i.MaterialsNum)for(var p in n)if(n[p].materialId==i.MaterialsNum[o].MaterialID){1!=i.MaterialsNum[o].Num&&(n[p].quantity=i.MaterialsNum[o].Num),d.push(n[p]);break}}else for(var o in n)d.push(n[o]);var u=[];for(var o in l)if(!(l[o].hide||i.hasOwnProperty("CookbookRarityLimit")&&l[o].rarity>i.CookbookRarityLimit)){var f=getRecipeQuantity(l[o],d,i,null);if(0!=f){if(i.hasOwnProperty("RecipesTagsEffect"))for(var p in l[o].tags)for(var h in i.RecipesTagsEffect)l[o].tags[p]==i.RecipesTagsEffect[h].TagID&&(l[o].addition=+(Number(l[o].addition)+i.RecipesTagsEffect[h].Effect).toFixed(2));for(var h in i.RecipesEffect)l[o].recipeId==i.RecipesEffect[h].RecipeID&&(l[o].addition=+(Number(l[o].addition)+i.RecipesEffect[h].Effect).toFixed(2));for(var h in i.RecipesSkillsEffect)("stirfry"==i.RecipesSkillsEffect[h].Skill&&l[o].stirfry>0||"boil"==i.RecipesSkillsEffect[h].Skill&&l[o].boil>0||"knife"==i.RecipesSkillsEffect[h].Skill&&l[o].knife>0||"fry"==i.RecipesSkillsEffect[h].Skill&&l[o].fry>0||"bake"==i.RecipesSkillsEffect[h].Skill&&l[o].bake>0||"steam"==i.RecipesSkillsEffect[h].Skill&&l[o].steam>0)&&(l[o].addition=+(Number(l[o].addition)+i.RecipesSkillsEffect[h].Effect).toFixed(2));u.push(l[o])}}var m=[];for(var o in s)if(!(s[o].hide||i.hasOwnProperty("ChefRarityLimit")&&s[o].rarity>i.ChefRarityLimit)){var v=!1;if(i.hasOwnProperty("EnableChefTags")){for(var p in i.EnableChefTags)if(s[o].tags.indexOf(i.EnableChefTags[p])>=0){v=!0;break}}else v=!0;if(v){if(i.hasOwnProperty("ChefsTagsEffect"))for(var p in s[o].tags)for(var h in i.ChefsTagsEffect)s[o].tags[p]==i.ChefsTagsEffect[h].TagID&&(s[o].addition=+(Number(s[o].addition)+i.ChefsTagsEffect[h].Effect).toFixed(2));m.push(s[o])}}var b=[];for(var o in c)c[o].hide||b.push(c[o]);var g=[];for(var o in r)r[o].hide||g.push(r[o]);i.recipes=u,i.chefs=m,i.ambers=b,i.equips=g,i.materials=d,i.rest=d;var k=[];for(var p in i.recipes){f=getRecipeQuantity(i.recipes[p],i.materials,i,null);var y=getRecipeResult(null,null,i.recipes[p],f,f,i.materials,i,i.decorationEffect,null,!1,buildRecipeMenu(i.recipes[p]),null,null);y.available=f,y.availableScore=y.totalScore/y.max*f;var x={};x.recipe=y,k.push(x)}i.menus=k,i.hasOwnProperty("MaterialsEffect")||i.hasOwnProperty("ChefsTagsEffect")||i.hasOwnProperty("RecipesTagsEffect")||i.hasOwnProperty("RecipesSkillsEffect")||i.hasOwnProperty("RecipesEffect")?i.hasRuleAddition=!0:i.hasRuleAddition=!1,"正常营业"==i.Title?(i.showTime=!0,i.showEff=!0,$('#select-cal-order option[value="分数"]').siblings().removeAttr("disabled")):(i.showTime=!1,i.showEff=!1,$("#select-cal-order").val("分数"),$('#select-cal-order option[value="分数"]').siblings().attr("disabled","disabled")),1==a.rules.length&&(sortRecipesResult(),$("#cal-recipes-table").DataTable().clear().rows.add(k).draw(),initCalRecipesShow($("#cal-recipes-table").DataTable()),private&&($("#cal-chefs-table").DataTable().clear().rows.add(m).draw(),$("#btn-cal-chefs-deselect-all").click(),$("#cal-equips-table").DataTable().clear().rows.add(g).draw(),$("#btn-cal-equips-deselect-all").click(),$("#cal-materials-table").DataTable().clear().rows.add(d).draw(),$("#btn-cal-materials-select-all").click()))}initCustomData(),calCustomResults(e)}function initCustomData(){for(var e in calCustomRule.rules){var a=calCustomRule.rules[e];a.custom=[];for(var t=0;t<getCustomRound(a);t++){for(var i={chef:{},equip:{},condiment:{},recipes:[]},l=0;l<3;l++){var s={};i.recipes.push(s)}a.custom.push(i)}}}function setCustomChef(e,a,t){var i=calCustomRule.rules[e],l=i.custom;if(t){for(var s in i.chefs)if(i.chefs[s].chefId==t){if(l[a].chef=JSON.parse(JSON.stringify(i.chefs[s])),!$("#chk-cal-use-amber").prop("checked"))for(var c in i.chefs[s].disk.ambers)setCustomAmber(e,a,c,null);$("#chk-cal-use-equip").prop("checked")&&setCustomEquip(e,a,i.chefs[s].equipId);break}}else l[a].chef={}}function setCustomDiskLevel(e,a,t){var i=calCustomRule.rules[e],l=i.custom;l[a].chef.disk.level=t||1}function setCustomAmber(e,a,t,i){var l=calCustomRule.rules[e],s=l.custom;s[a].chef.disk.ambers[t].data=getAmberInfo(i,l.ambers)}function setCustomEquip(e,a,t){var i=calCustomRule.rules[e],l=i.custom;l[a].equip=t?getEquipInfo(t,i.equips):{}}function setCustomCondiment(e,a,t,i){var l=calCustomRule.rules[e].custom;l[a].condiment=t?getCondimentInfo(t,i.condiments):{}}function setCustomRecipe(e,a,t,i){var l=calCustomRule.rules[e],s=l.custom;s[a].recipes[t]={};var c=JSON.parse(JSON.stringify(l.materials));for(var r in s)for(var n in s[r].recipes)s[r].recipes[n].data&&updateMaterialsData(c,s[r].recipes[n],s[r].recipes[n].quantity,s[r].chef);if(i)for(var o in l.menus)if(l.menus[o].recipe.data.recipeId==i){var p=getRecipeQuantity(l.menus[o].recipe.data,c,l,s[a].chef),d={};d.data=l.menus[o].recipe.data,d.quantity=p,s[a].recipes[t]=d;break}}function setCustomRecipeQuantity(e,a,t,i){var l=calCustomRule.rules[e],s=l.custom;s[a].recipes[t].quantity=i||0}function updateCustomRecipeCondiment(e,a,t,i){var l=$(".cal-custom-item:eq("+e+") .selected-item:eq("+a+") .recipe-box:eq("+t+") .recipe-condiment input");i?l.prop("checked",!0):l.prop("checked",!1)}function calCustomResults(e){for(var a=0,t=0;t<calCustomRule.rules.length;t++){var i=calCustomRule.rules[t],l=i.custom,s=getPartialChefAdds(l,e.partialSkill,i);for(var c in l){for(var r in l[c].recipes)if(l[c].recipes[r].data)for(var n in i.menus)if(i.menus[n].recipe.data.recipeId==l[c].recipes[r].data.recipeId){l[c].recipes[r].data=i.menus[n].recipe.data,l[c].recipes[r].max=i.menus[n].recipe.max;break}l[c].chef.chefId&&setDataForChef(l[c].chef,l[c].equip,!0,i.calGlobalUltimateData,s[c],i.calSelfUltimateData,i.calActivityUltimateData,!0,i,!0)}var o=getPartialRecipeAdds(l,e.partialSkill,i),p=getIntentAdds(t,l,e,!0),d=0,u=0,f=0,h=1;i&&i.hasOwnProperty("scoreMultiply")&&(h=i.scoreMultiply);var m=1;i&&i.hasOwnProperty("scorePow")&&(m=i.scorePow);var v=0;for(var c in i.hasOwnProperty("scoreAdd")&&(v=i.scoreAdd),l)for(var r in l[c].recipes)if(l[c].recipes[r].data){var b=$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .recipe-box:eq("+r+") .recipe-condiment input").prop("checked"),g=getRecipeResult(l[c].chef,l[c].equip,l[c].recipes[r].data,l[c].recipes[r].quantity,l[c].recipes[r].max,i.materials,i,i.decorationEffect,b?l[c].condiment:null,!0,l[c].recipes,o[3*c+Number(r)],p[3*c+Number(r)]);if(l[c].recipes[r]=g,f+=g.totalTime,d+=g.totalBonusScore,u+=Math.ceil(+(g.totalScore*(1+g.data.activityAddition/100)).toFixed(2)),0==g.rankVal){var k=getSkillDiff(l[c].chef,l[c].recipes[r].data,1);l[c].recipes[r].skillDiff=k.disp}}u=+(Math.pow(u,m)*h).toFixed(2),u=i.IsActivity?Math.ceil(u):Math.floor(u),u&&(u+=v);var y=checkMaterials(l,i.materials);for(var c in l)for(var r in l[c].recipes)if(l[c].recipes[r].data){var x=getRecipeQuantity(l[c].recipes[r].data,y.materials,i,l[c].chef),D=getRecipeQuantity(l[c].recipes[r].data,i.materials,i,l[c].chef),C=D-l[c].recipes[r].quantity;x>C&&(x=C);var w=$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .recipe-box:eq("+r+") .recipe-quantity");w.find("input").attr("max",D).val(l[c].recipes[r].quantity),w.find(".max").html(D),i.hasOwnProperty("MaterialsNum")?w.find(".available").html(0!=x?"("+x+")":""):w.find(".available").html(C<0?"("+C+")":"")}for(var c in i.rest=y.materials,l){var T=$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .chef-box");if(l[c].chef.chefId){T.find(".chef-box-1 .content").html(getCalChefDisp(l[c].chef)),T.find(".chef-placeholder").addClass("hidden");var S=l[c].chef.disk;T.find(".disk-level-box .content").html("<div class='name'>心法盘等级 "+S.level+"</div>");for(n=0;n<S.ambers.length;n++){var q=S.ambers[n],E="";E=q.data?getCalAmberDisp(q.data,S.level):"<div class='disk-"+q.type+" name'>+ 遗玉</div>",T.find(".disk-box:eq("+n+")").removeClass("hidden").find(".content").html(E)}for(n=S.ambers.length;n<3;n++)T.find(".disk-box:eq("+n+")").addClass("hidden")}else T.find(".content").html(""),T.find(".chef-placeholder").html("+ 厨师").removeClass("hidden");var I="";I=l[c].equip.equipId?getCalEquipDisp(l[c].equip):"+ 厨具",$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .equip-box .content").html(I);var R=0;for(var r in l[c].recipes){w=$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .recipe-box:eq("+r+")");if(l[c].recipes[r].data){var N=l[c].recipes[r];w.find(".recipe-box-1 .content").html(getCalRecipeDisp(N));var M=$("#chk-cal-ex").val(),A=w.find(".recipe-ex input");M.indexOf(l[c].recipes[r].data.recipeId.toString())>=0?A.prop("checked",!0):A.prop("checked",!1),w.find(".recipe-result .content").html(getCalRecipeResultDisp(N,i)),w.find(".recipe-box-2 .content").html(getCalRecipeBox2Disp(N,i,l[c].chef)),w.find(".recipe-placeholder").addClass("hidden"),N.useCondiment&&(R+=N.data.rarity*N.quantity)}else w.find(".content").html(""),w.find(".recipe-placeholder").html("+ 菜谱").removeClass("hidden")}var O="";O=l[c].condiment.condimentId?getCalCondimentDisp(l[c].condiment,R):"+ 调料",$(".cal-custom-item:eq("+t+") .selected-item:eq("+c+") .condiment-box .content").html(O)}var _="";if(calCustomRule.rules.length>1&&(_+=i.Title+" "),i.Satiety){$(".cal-custom-item:eq("+t+") .intent-satiety").addClass("label-default").removeClass("label-info");var G=calSatiety(l,i);_+="饱腹："+G.total+"/"+i.Satiety,G.done&&(1==i.SatisfyRewardType&&G.total==i.Satiety&&$(".cal-custom-item:eq("+t+") .intent-satiety").addClass("label-info").removeClass("label-default"),_+=" 加成："+G.add+"%",u=calSatietyAdd(u,G.add))}if(i.hasRuleAddition&&!i.hasOwnProperty("scoreMultiply")&&(_+=" 规则分："+d),_+=" 总分："+u,calCustomRule.rules.length>1&&(_+=" 合计：<span class='total-score'></span>"),a+=u,i.showTime){var P=0;for(var c in l)if(l[c].chef.chefId&&(i&&i.hasOwnProperty("DisableChefSkillEffect")&&0!=i.DisableChefSkillEffect||(P+=getTimeAddition(l[c].chef.specialSkillEffect)),(!i||!i.hasOwnProperty("DisableEquipSkillEffect")||0==i.DisableEquipSkillEffect)&&l[c].equip&&l[c].equip.effect)){var V=updateEquipmentEffect(l[c].equip.effect,l[c].chef.selfUltimateEffect);P+=getTimeAddition(V)}for(var c in o[0]){var L=o[0][c].effect;"OpenTime"==L.type&&(P+=L.value)}0!=+P.toFixed(2)&&(_+=" 原时间："+(secondsToTime(f)||0));var B=Math.ceil(+(f*(1+P/100)).toFixed(2));_+=" 总时间："+(secondsToTime(B)||0);var F=0;B>0&&(F=Math.floor(3600*u/B)),_+=" 总效率："+F+"金币/小时"}if(y.lackIds.length)for(var c in _+=" ("+y.message+")",y.lackIds)$(".cal-custom-item:eq("+t+") .selected-item .recipe-box-2 .material span[data-id='"+y.lackIds[c]+"']").addClass("red");$(".cal-custom-item:eq("+t+") .selected-sum").html(_)}calCustomRule.rules.length>1&&$(".total-score").html(a),calCustomRule.score=a,resizeCalCustomTable()}function resizeCalCustomTable(){resizeCalCustomTableSub(".chef-box-1",0),resizeCalCustomTableSub(".chef-box",40),resizeCalCustomTableSub(".equip-box",40),resizeCalCustomTableSub(".condiment-box",40),resizeCalCustomTableSub(".recipe-box:nth-child(3n+1)",100),resizeCalCustomTableSub(".recipe-box:nth-child(3n+2)",100),resizeCalCustomTableSub(".recipe-box:nth-child(3n+3)",100)}function resizeCalCustomTableSub(e,a){$(".cal-custom-item").each(function(){var t=a;$(this).find(e).css("min-height",""),$(window).width()<1310&&($(this).find(e).css("min-height",t),$(this).find(e).each(function(){$(this).find(".content .name").length&&(t=Math.max(t,Math.ceil($(this).height())+1))}),$(this).find(e).css("min-height",t))})}function getCalChefDisp(e){var a="<div class='name'>"+e.name+"</div><div class='icon-box'>"+e.icon+"</div><div class='skill'>";return e.stirfryDisp&&(a+="<span>炒"+e.stirfryDisp+"</span>"),e.boilDisp&&(a+="<span>煮"+e.boilDisp+"</span>"),e.knifeDisp&&(a+="<span>切"+e.knifeDisp+"</span>"),e.fryDisp&&(a+="<span>炸"+e.fryDisp+"</span>"),e.bakeDisp&&(a+="<span>烤"+e.bakeDisp+"</span>"),e.steamDisp&&(a+="<span>蒸"+e.steamDisp+"</span>"),a+="</div>",a}function getCalAmberDisp(e,a){return"<div class='amber-in'><div class='icon-box'>"+e.icon+"</div><div class='disk-"+e.type+" name'>"+e.name+"</div></div><small>"+getAmberDisplayByLevel(e,a)+"</small>"}function getCalEquipDisp(e){return"<div class='equip-in'><div class='icon-box'>"+e.icon+"</div><div class='name'>"+e.name+"</div></div><small>"+e.skillDisp+"</small>"}function getCalCondimentDisp(e,a){return"<div class='condiment-in'><div class='icon-box'>"+e.icon+"</div><div class='name'>"+e.name+"<span class='rarity'> "+e.rarityDisp+(a?"*"+a:"")+"</span></div></div><small>"+e.skillDisp+"</small>"}function getCalRecipeDisp(e){var a=e.data;return"<div class='name'>"+a.name+"</div><div class='recipe-ric'><div class='rank'>"+(e.rankDisp?e.rankDisp:"")+"</div><div class='icon-box'>"+a.icon+"</div><div class='condiment'>"+a.condimentDisp+"</div></div>"}function getCalRecipeResultDisp(e,a){var t="<div>"+e.score+"*"+e.quantity+"=<span class='score'>"+e.totalScore+"</span></div>";return a.showTime&&(t+="<div class='time'>"+e.totalTimeDisp+"</div>"),t+=e.skillDiff?"<div class='red'>"+e.skillDiff+"</div>":"",t}function getCalMaterialsDisp(e,a,t){var i="";for(var l in e.materials)for(var s in a)if(e.materials[l].material==a[s].materialId){var c=calMaterialReduce(t,e.materials[l].material,e.materials[l].quantity);i+="<span data-id='"+a[s].materialId+"'>"+a[s].name+c+"</span>";break}return 1==e.materials.length?i+="<span></span><span></span>":2==e.materials.length&&(i+="<span></span>"),i}function getCalRecipeBox2Disp(e,a,t){var i="<div class='rarity'>"+e.data.rarityDisp+"</div>";return i+="<div class='skill'>",i+=e.data.skillDisp,i+="</div>",i+="<div class='material'>",i+=getCalMaterialsDisp(e.data,a.materials,t),i+="</div>",i+="<div class='add'>",e.rankAdditionDisp?i+="<span>品阶"+e.rankAdditionDisp+"</span>":i+="<span class='blank'>品阶</span>",e.chefSkillAdditionDisp?i+="<span>技能"+e.chefSkillAdditionDisp+"</span>":i+="<span class='blank'>技能</span>",e.equipSkillAdditionDisp?i+="<span>厨具"+e.equipSkillAdditionDisp+"</span>":i+="<span class='blank'>厨具</span>",a.hasOwnProperty("DisableCondimentEffect")&&0!=a.DisableCondimentEffect||(e.condimentSkillAdditionDisp?i+="<span>调料"+e.condimentSkillAdditionDisp+"</span>":i+="<span class='blank'>调料</span>"),e.bonusAdditionDisp?i+="<span>规则"+e.bonusAdditionDisp+"</span>":i+="<span class='blank'>规则</span>",e.data.ultimateAdditionDisp?i+="<span>修炼"+e.data.ultimateAdditionDisp+"</span>":i+="<span class='blank'>修炼</span>",a.hasOwnProperty("DisableDecorationEffect")&&0!=a.DisableDecorationEffect?a.calActivityUltimateData.length>0&&(e.data.activityAdditionDisp?i+="<span>奇珍"+e.data.activityAdditionDisp+"</span>":i+="<span class='blank'>奇珍</span>"):e.decorationAdditionDisp?i+="<span>装饰"+e.decorationAdditionDisp+"</span>":i+="<span class='blank'>装饰</span>",e.basicPercentDisp||e.basicAbsDisp?(i+="<span>基础",i+=e.basicPercentDisp?e.basicPercentDisp:e.basicAbsDisp,i+="</span>"):i+="<span class='blank'>基础</span>",e.basicPercentDisp&&e.basicAbsDisp&&(i+="<span>基础"+e.basicAbsDisp+"</span>"),e.partialAdditionDisp?i+="<span>在场"+e.partialAdditionDisp+"</span>":i+="<span class='blank'>在场</span>",i+="</div>",i}function getIntentAdds(e,a,t,i){var l=calCustomRule.rules[e],s=[];if(l.Satiety){for(var c=0;c<3*l.IntentList.length;c++)s.push([]);for(c=0;c<l.IntentList.length;c++)for(var r=0;r<l.IntentList[c].length;r++)for(var n in t.intents)if(l.IntentList[c][r]==t.intents[n].intentId){i&&$(".cal-custom-item:eq("+e+") .intent-"+c+r).addClass("label-default").removeClass("label-info");var o=!1,p=0,d=t.intents[n];if("Group"==d.conditionType)o=checkIntent(d,a[c].recipes,null,null);else for(var u in a[c].recipes)if(a[c].recipes[u].data&&(o=checkIntent(d,a[c].recipes,u,a[c].chef),o)){p=Number(u);break}if(o)if(i&&$(".cal-custom-item:eq("+e+") .intent-"+c+r).addClass("label-info").removeClass("label-default"),"CreateBuff"==d.effectType)for(var u in t.buffs){var f=t.buffs[u];if(f.buffId==d.effectValue){for(var h=1;h<=f.lastRounds;h++)for(var m=0;m<3;m++)checkIntent(f,a[h+c].recipes,m,a[h+c].chef)&&s[3*(h+c)+m].push(f);break}}else if("CreateIntent"==d.effectType&&p<2){for(var u in t.intents)if(t.intents[u].intentId==d.effectValue){checkIntent(t.intents[u],a[c].recipes,p+1,a[c].chef)&&s[3*c+p+1].push(t.intents[u]);break}}else checkIntent(d,a[c].recipes,p,a[c].chef)&&s[3*c+p].push(d);break}}return s}function checkIntent(e,a,t,i){if("Group"==e.conditionType){var l=0;for(var s in a){var c=a[s].data;c&&c[e.conditionValue.toLowerCase()]>0&&l++}if(3==l)return!0}else if("ChefStar"==e.conditionType){if(i.chefId&&i.rarity==e.conditionValue)return!0}else{c=a[t].data;if(c)if("Rank"==e.conditionType){if(i.chefId){var r=getRankInfo(c,i);if(r.rankVal>=e.conditionValue)return!0}}else if("CondimentSkill"==e.conditionType&&c.condiment==e.conditionValue||"CookSkill"==e.conditionType&&c[e.conditionValue.toLowerCase()]>0||"Rarity"==e.conditionType&&c.rarity==e.conditionValue||"Order"==e.conditionType&&Number(t)+1==e.conditionValue||!e.conditionType)return!0}return!1}function getSatietyPercent(e,a){return 1==a.SatisfyRewardType&&e==a.Satiety?a.SatisfyExtraValue:-a.SatisfyDeductValue*Math.abs(e-a.Satiety)}function calSatiety(e,a){var t={total:0,add:0,done:!1};if(a.Satiety){var i=0;for(var l in e)for(var s in e[l].recipes)e[l].recipes[s].data&&(t.total+=e[l].recipes[s].satiety,i++);3*a.IntentList.length==i&&(t.done=!0,t.add=getSatietyPercent(t.total,a))}return t}function calSatietyAdd(e,a){return Math.ceil(+(e*(1+.01*a)).toFixed(2))}function getCustomChefsOptions(e,a,t){var i=$("#chk-cal-got").prop("checked"),l=$("#chk-cal-use-equip").prop("checked"),s=$("#chk-cal-use-amber").prop("checked"),c=$("#chk-cal-dd-show").val(),r=calCustomRule.rules[e],n=r.custom,o=!1;for(var p in n[a].recipes)if(n[a].recipes[p].data){o=!0;break}var d=JSON.parse(JSON.stringify(n)),u=[],f=JSON.parse(JSON.stringify(r.chefs));for(var h in f)if(!i||f[h].got){d[a].chef=f[h];var m={};if(m.display=f[h].name,m.value=f[h].chefId,m.content="<span class='name'>"+f[h].name+"</span>",n[a].chef.chefId==f[h].chefId&&(m.selected=!0,d[a].chef.disk=n[a].chef.disk),o){var v=getPartialChefAdds(d,t.partialSkill,r);if(n[a].chef.chefId==f[h].chefId?d[a].equip=n[a].equip:l&&(d[a].equip=f[h].equip),!s&&n[a].chef.chefId!=f[h].chefId)for(var b in d[a].chef.disk.ambers)d[a].chef.disk.ambers[b].data=null;for(var g in d)d[g].chef.chefId&&(r.Satiety&&g!=a||setDataForChef(d[g].chef,d[g].equip,!0,r.calGlobalUltimateData,v[g],r.calSelfUltimateData,r.calActivityUltimateData,!0,r,!0));var k=JSON.parse(JSON.stringify(d[a].chef));for(var p in d[a].recipes)d[a].recipes[p].data&&addCheffSkillDiff(k,d[a].recipes[p].data);var y=getChefSillDiff(k,d[a].chef);""!=y&&(m.content+="<span class='skill'>"+y+"</span>",m.class="warning-skill"),d[a].chef=k;var x=getPartialRecipeAdds(d,t.partialSkill,r),D=getIntentAdds(e,d,t,!1),C=0;for(var g in d)for(var w in d[g].recipes)if(d[g].recipes[w].data){var T=getRecipeResult(d[g].chef,d[g].equip,d[g].recipes[w].data,d[g].recipes[w].quantity,d[g].recipes[w].max,r.materials,r,r.decorationEffect,d[g].recipes[w].useCondiment?d[g].condiment:null,!0,d[g].recipes,x[3*g+Number(w)],D[3*g+Number(w)]);d[g].recipes[w]=T,C+=T.totalScore}var S=calSatiety(d,r);r.Satiety&&(C=calSatietyAdd(C,S.add)),m.content+="<span class='score'>"+C+"</span>",m.order=C}else m.order=f[h].rarity;for(var q in c.indexOf("chef_rarity")>=0&&(m.content+="<span class='subtext'>"+f[h].rarityDisp+"</span>"),c.indexOf("chef_specialSkill")>=0&&(m.content+="<span class='skilltext'>"+f[h].specialSkillDisp.replace(/<br>/g," ")+"</span>"),c.indexOf("chef_ultimate")>=0&&(m.content+="<span class='skilltext'>"+f[h].ultimateCustomDisp+"</span>"),c.indexOf("chef_origin")>=0&&(m.content+="<span class='subtext'>"+f[h].origin.replace(/<br>/g," ")+"</span>"),calCustomRule.rules){var E=calCustomRule.rules[q].custom;for(var w in E)if(E[w].chef.chefId==f[h].chefId){m.disabled=!0;break}}u.push(m)}u.sort(function(e,a){return a.order-e.order});m={display:"选择厨师",value:"",class:"hidden"};return u.unshift(m),u}function getChefUltimateCustomDisp(e,a){var t=!1;if(e){for(var i in a)if(e==a[i].skillId){for(var l in a[i].effect){if("Partial"==a[i].effect[l].condition){t=!0;break}if("Self"==a[i].effect[l].condition){if("Material_Gain"!=a[i].effect[l].type){t=!0;break}}else if("Next"==a[i].effect[l].condition){t=!0;break}}break}if(t){var s=getSkillInfo(a,e);return s.skillDisp.replace(/<br>/g," ")}}return""}function getCustomDiskLevelsOptions(e,a,t){var i=calCustomRule.rules[e],l=i.custom,s=!1;for(var c in l[a].recipes)if(l[a].recipes[c].data){s=!0;break}for(var r=JSON.parse(JSON.stringify(l)),n=getPartialChefAdds(r,t.partialSkill,i),o=r[a].chef.disk.maxLevel,p=r[a].chef.disk.level,d=[],u=o;u>0;u--){var f={};if(f.display=u,f.value=u,f.content="<span class='name'>等级 "+u+"</span>",r[a].chef.chefId&&s){r[a].chef.disk.level=u,setDataForChef(r[a].chef,r[a].equip,!0,i.calGlobalUltimateData,n[a],i.calSelfUltimateData,i.calActivityUltimateData,!0,i,!0);var h=JSON.parse(JSON.stringify(r[a].chef));for(var c in r[a].recipes)r[a].recipes[c].data&&addCheffSkillDiff(h,r[a].recipes[c].data);var m=getChefSillDiff(h,r[a].chef);""!=m&&(f.content+="<span class='skill'>"+m+"</span>",f.class="warning-skill"),r[a].chef=h;var v=getPartialRecipeAdds(r,t.partialSkill,i),b=getIntentAdds(e,r,t,!1),g=0;for(var k in r)for(var $ in r[k].recipes)if(r[k].recipes[$].data){
var y=getRecipeResult(r[k].chef,r[k].equip,r[k].recipes[$].data,r[k].recipes[$].quantity,r[k].recipes[$].max,i.materials,i,i.decorationEffect,r[k].recipes[$].useCondiment?r[k].condiment:null,!0,r[k].recipes,v[3*k+Number($)],b[3*k+Number($)]);r[k].recipes[$]=y,g+=y.totalScore}var x=calSatiety(r,i);i.Satiety&&(g=calSatietyAdd(g,x.add)),f.content+="<span class='score'>"+g+"</span>",f.order=g}p==u&&(f.selected=!0),d.push(f)}return d}function getCustomAmbersOptions(e,a,t,i,l){var s=$("#chk-cal-dd-show").val(),c=calCustomRule.rules[e],r=c.custom,n=!1;for(var o in r[a].recipes)if(r[a].recipes[o].data){n=!0;break}var p=r[a].chef.disk,d=p.ambers[t],u=JSON.parse(JSON.stringify(r)),f=getPartialChefAdds(u,l.partialSkill,c),h=[];for(var m in i)if(i[m].type==d.type){var v=i[m].skillDisp.replace(/<br>/g," "),b={};if(b.display=i[m].name,b.value=i[m].amberId,b.content="<span class='name'>"+i[m].name+"</span>",b.tokens=i[m].name+v,u[a].chef.chefId&&n){u[a].chef.disk.ambers[t].data=i[m],setDataForChef(u[a].chef,u[a].equip,!0,c.calGlobalUltimateData,f[a],c.calSelfUltimateData,c.calActivityUltimateData,!0,c,!0);var g=JSON.parse(JSON.stringify(u[a].chef));for(var o in u[a].recipes)u[a].recipes[o].data&&addCheffSkillDiff(g,u[a].recipes[o].data);var k=getChefSillDiff(g,u[a].chef);""!=k&&(b.content+="<span class='skill'>"+k+"</span>",b.class="warning-skill"),u[a].chef=g;var y=getPartialRecipeAdds(u,l.partialSkill,c),x=getIntentAdds(e,u,l,!1),D=0;for(var C in u)for(var w in u[C].recipes)if(u[C].recipes[w].data){var T=getRecipeResult(u[C].chef,u[C].equip,u[C].recipes[w].data,u[C].recipes[w].quantity,u[C].recipes[w].max,c.materials,c,c.decorationEffect,u[C].recipes[w].useCondiment?u[C].condiment:null,!0,u[C].recipes,y[3*C+Number(w)],x[3*C+Number(w)]);u[C].recipes[w]=T,D+=T.totalScore}var S=calSatiety(u,c);c.Satiety&&(D=calSatietyAdd(D,S.add)),b.content+="<span class='score'>"+D+"</span>",b.order=D}s.indexOf("amber_rarity")>=0&&(b.content+="<span class='subtext'>"+i[m].rarityDisp+"</span>"),s.indexOf("amber_skill")>=0&&(b.content+="<span class='subtext'>"+v+"</span>"),s.indexOf("amber_final")>=0&&(b.content+="<span class='subtext'>["+getAmberDisplayByLevel(i[m],p.level)+"]</span>"),s.indexOf("amber_origin")>=0&&(b.content+="<span class='subtext'>"+i[m].origin.replace(/<br>/g," ")+"</span>"),d.data&&d.data.amberId==i[m].amberId&&(b.selected=!0),h.push(b)}h.sort(function(e,a){return a.order-e.order});b={display:"无遗玉",value:"",class:"hidden"};return h.unshift(b),h}function getCustomEquipsOptions(e,a,t,i){var l=$("#chk-cal-dd-show").val(),s=calCustomRule.rules[e],c=s.custom,r=!1;for(var n in c[a].recipes)if(c[a].recipes[n].data){r=!0;break}var o=JSON.parse(JSON.stringify(c)),p=getPartialChefAdds(o,i.partialSkill,s),d=[];for(var u in t){var f=t[u].skillDisp.replace(/<br>/g," "),h={};if(h.display=t[u].name,h.value=t[u].equipId,h.content="<span class='name'>"+t[u].name+"</span>",h.tokens=t[u].name+f,o[a].chef.chefId&&r){o[a].equip=t[u],setDataForChef(o[a].chef,o[a].equip,!0,s.calGlobalUltimateData,p[a],s.calSelfUltimateData,s.calActivityUltimateData,!0,s,!0);var m=JSON.parse(JSON.stringify(o[a].chef));for(var n in o[a].recipes)o[a].recipes[n].data&&addCheffSkillDiff(m,o[a].recipes[n].data);var v=getChefSillDiff(m,o[a].chef);""!=v&&(h.content+="<span class='skill'>"+v+"</span>",h.class="warning-skill"),o[a].chef=m;var b=getPartialRecipeAdds(o,i.partialSkill,s),g=getIntentAdds(e,o,i,!1),k=0;for(var y in o)for(var x in o[y].recipes)if(o[y].recipes[x].data){var D=getRecipeResult(o[y].chef,o[y].equip,o[y].recipes[x].data,o[y].recipes[x].quantity,o[y].recipes[x].max,s.materials,s,s.decorationEffect,o[y].recipes[x].useCondiment?o[y].condiment:null,!0,o[y].recipes,b[3*y+Number(x)],g[3*y+Number(x)]);o[y].recipes[x]=D,k+=D.totalScore}var C=calSatiety(o,s);s.Satiety&&(k=calSatietyAdd(k,C.add)),h.content+="<span class='score'>"+k+"</span>",h.order=k}l.indexOf("equip_rarity")>=0&&(h.content+="<span class='subtext'>"+t[u].rarityDisp+"</span>"),l.indexOf("equip_skill")>=0&&(h.content+="<span class='subtext'>"+f+"</span>"),l.indexOf("equip_origin")>=0&&(h.content+="<span class='subtext'>"+t[u].origin.replace(/<br>/g," ")+"</span>"),c[a].equip.equipId==t[u].equipId&&(h.selected=!0),d.push(h)}d.sort(function(e,a){return a.order-e.order});h={display:"无厨具",value:"",class:"hidden"};return d.unshift(h),d}function getCustomCondimentsOptions(e,a,t,i){var l=$("#chk-cal-dd-show").val(),s=calCustomRule.rules[e],c=s.custom,r=!1;for(var n in c[a].recipes)if(c[a].recipes[n].useCondiment){r=!0;break}var o=JSON.parse(JSON.stringify(c)),p=getPartialRecipeAdds(o,i.partialSkill,s),d=getIntentAdds(e,o,i,!1),u=calSatiety(o,s),f=[];for(var h in t){var m=t[h].skillDisp.replace(/<br>/g," "),v={};if(v.display=t[h].name,v.value=t[h].condimentId,v.content="<span class='name'>"+t[h].name+"</span>",v.tokens=t[h].name+m,r){o[a].condiment=t[h];var b=0;for(var g in o)for(var k in o[g].recipes)if(o[g].recipes[k].data){var y=getRecipeResult(o[g].chef,o[g].equip,o[g].recipes[k].data,o[g].recipes[k].quantity,o[g].recipes[k].max,s.materials,s,s.decorationEffect,o[g].recipes[k].useCondiment?o[g].condiment:null,!0,o[g].recipes,p[3*g+Number(k)],d[3*g+Number(k)]);o[g].recipes[k]=y,b+=y.totalScore}s.Satiety&&(b=calSatietyAdd(b,u.add)),v.content+="<span class='score'>"+b+"</span>",v.order=b}l.indexOf("condiment_rarity")>=0&&(v.content+="<span class='subtext'>"+t[h].rarityDisp+"</span>"),l.indexOf("condiment_skill")>=0&&(v.content+="<span class='subtext'>"+m+"</span>"),l.indexOf("condiment_origin")>=0&&(v.content+="<span class='subtext'>"+t[h].origin.replace(/<br>/g," ")+"</span>"),c[a].condiment.condimentId==t[h].condimentId&&(v.selected=!0),f.push(v)}r&&f.sort(function(e,a){return a.order-e.order});v={display:"无调料",value:"",class:"hidden"};return f.unshift(v),f}function getCustomRecipesOptions(e,a,t,i){var l=$("#chk-cal-got").prop("checked"),s=$("#chk-cal-recipe-rarity").val(),c=$("#chk-cal-recipe-skill").val(),r=$("#chk-cal-recipe-multiple-skill").prop("checked"),n=$("#chk-cal-recipe-condiment").val(),o=$("#select-cal-order").val(),p=$(".cal-custom-item:eq("+e+") .selected-item:eq("+a+") .recipe-box:eq("+t+") .recipe-condiment input").prop("checked"),d=$("#chk-cal-dd-show").val(),u=calCustomRule.rules[e],f=u.custom,h=JSON.parse(JSON.stringify(f));h[a].recipes[t]={};var m=JSON.parse(JSON.stringify(u.materials));for(var v in h)for(var b in h[v].recipes)h[v].recipes[b].data&&updateMaterialsData(m,h[v].recipes[b],h[v].recipes[b].quantity,h[v].chef);var g=[],k=u.menus;for(var y in k){var x=k[y].recipe;if((!l||x.data.got)&&!(s.length>0&&s.indexOf(x.data.rarity.toString())<0)){if(c.length>0){var D=!1;for(var C in c)if(x.data[""+c[C]]>0){if(D=!0,!r)break}else if(r){D=!1;break}if(!D)continue}if(!(n.length>0&&n.indexOf(x.data.condiment)<0)){var w={};w.display=x.data.name,w.value=x.data.recipeId,w.content="<span class='name'>"+x.data.name+"</span>";var T=getRecipeQuantity(x.data,m,u,h[a].chef),S=getRecipeQuantity(x.data,u.materials,u,h[a].chef);h[a].recipes[t]=x,h[a].recipes[t].useCondiment=p,h[a].recipes[t].quantity=T,h[a].recipes[t].max=S;var q=getPartialRecipeAdds(h,i.partialSkill,u),E=getIntentAdds(e,h,i,!1),I=0,R=x.totalScore,N=x.efficiency,M="";for(var b in h)for(var v in h[b].recipes)if(h[b].recipes[v].data){var A=getRecipeResult(h[b].chef,h[b].equip,h[b].recipes[v].data,h[b].recipes[v].quantity,h[b].recipes[v].max,u.materials,u,u.decorationEffect,h[b].recipes[v].useCondiment?h[b].condiment:null,!0,h[b].recipes,q[3*b+Number(v)],E[3*b+Number(v)]);if(I+=A.totalScore,b==a&&v==t&&(A=getRecipeResult(h[b].chef,h[b].equip,h[b].recipes[v].data,h[b].recipes[v].max,h[b].recipes[v].max,u.materials,u,u.decorationEffect,h[b].recipes[v].useCondiment?h[b].condiment:null,!0,h[b].recipes,q[3*b+Number(v)],E[3*b+Number(v)]),R=A.totalScore,N=A.efficiency,0==A.rankVal)){var O=getSkillDiff(h[a].chef,x.data,1);M=O.disp}h[b].recipes[v]=A}var _=calSatiety(h,u);for(var G in u.Satiety&&(I=calSatietyAdd(I,_.add)),calCustomRule.rules){var P=calCustomRule.rules[G].custom;for(var v in P)for(var b in P[v].recipes)if(P[v].recipes[b].data&&P[v].recipes[b].data.recipeId==x.data.recipeId){if(G==e&&v==a&&b==t)continue;w.disabled=!0,I=0}}if(w.class="",""!=M&&(w.content+="<span class='skill'>"+M+"</span>",w.class+="warning-skill"),d.indexOf("recipe_rank")>=0){var V=h[a].recipes[t].rankDisp;V&&"-"!=V&&(w.content+="<span class='subtext'>"+V+"</span>")}if(u.hasOwnProperty("MaterialsNum")){var L=R/x.max*T;T<x.max?w.content+="<span class='available'>"+T+"/"+x.max+" "+L+"/"+R+"</span><span class='total'>"+I+"</span>":w.content+="<span class='subtext'>"+T+"/"+x.max+" "+L+"</span><span class='total'>"+I+"</span>",w.order=I}else"分数"==o?(w.content+="<span class='score'>"+R+"</span><span class='total'>"+I+"</span>",w.order=I):"时间"==o?(w.content+="<span class='score'>"+x.data.totalTimeDisp+"</span>",w.order=x.data.totalTime):"效率"==o&&(w.content+="<span class='score'>"+N+"</span>",w.order=N);d.indexOf("recipe_condiment")>=0&&(w.content+="<span class='subtext'>"+x.data.condimentDisp+"</span>"),d.indexOf("recipe_rarity")>=0&&(w.content+="<span class='subtext'>"+x.data.rarityDisp+"</span>"),d.indexOf("recipe_skill")>=0&&(w.content+="<span class='skilltext'>"+x.data.skillDisp+"</span>"),d.indexOf("recipe_material")>=0&&(w.content+="<span class='subtext'>"+x.data.materialsDisp.replace(/\*/g,"")+"</span>"),d.indexOf("recipe_origin")>=0&&(w.content+="<span class='subtext'>"+x.data.origin.replace(/<br>/g," ")+"</span>"),f[a].recipes[t].data&&f[a].recipes[t].data.recipeId==x.data.recipeId&&(w.selected=!0),g.push(w)}}}g.sort(function(e,a){return a.order-e.order});w={display:"无菜谱",value:"",class:"hidden"};return g.unshift(w),g}function updateCalMenus(){var e=calCustomRule.rules[0],a=e.custom;for(var t in e.menus){var i=getRecipeQuantity(e.menus[t].recipe.data,e.rest,e,null);for(var l in a)for(var s in a[l].recipes)if(a[l].recipes[s].data&&e.menus[t].recipe.data.recipeId==a[l].recipes[s].data.recipeId){var c=e.menus[t].recipe.max-a[l].recipes[s].quantity;c<0?i=0:i>c&&(i=c)}e.menus[t].recipe.available=i,e.menus[t].recipe.availableScore=Math.ceil(+(e.menus[t].recipe.totalScore/e.menus[t].recipe.max*i).toFixed(2))}}function calRecipesResults(){var e=$("#cal-recipes-table").DataTable(),a=e.rows({order:"applied"}).data().toArray(),t=e.rows({selected:!0}).data().toArray();updateCalMenus(),e.clear().rows.add(a),$("#chk-cal-results-lock-order").prop("checked")&&e.order([]),e.rows(function(e,a,i){for(var l in t)if(a.recipe.data.recipeId==t[l].recipe.data.recipeId)return!0;return!1}).select(),e.draw()}function sortRecipesResult(){var e=7,a=$("#select-cal-order").val();"分数"==a?e=7:"时间"==a?e=9:"效率"==a&&(e=10);var t=!1,i=$("#cal-recipes-table").DataTable(),l=i.order();for(var s in l)if(l[s][0]==e&&"desc"==l[s][1]){t=!0;break}t||i.order([e,"desc"]).draw()}function checkMaterials(e,a){var t=JSON.parse(JSON.stringify(a));for(var i in e){var l=e[i].chef;for(var s in e[i].recipes){var c=e[i].recipes[s];if(c.data)for(var r in c.data.materials)for(var n in t)if(c.data.materials[r].material==t[n].materialId){if(Number.isInteger(parseInt(t[n].quantity))){var o=calMaterialReduce(l,c.data.materials[r].material,c.data.materials[r].quantity);t[n].quantity-=o*c.quantity}break}}}var p=[],d="";for(var n in t)t[n].quantity<0&&(p.push(t[n].materialId),d+=t[n].name+t[n].quantity);return{materials:t,lackIds:p,message:d}}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"name",width:"81px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:"gender",width:"30px"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"all",orderSequence:["desc","asc"],width:"38px"},{data:{_:"equipId",display:"equipDisp"},className:"cal-td-select-equip nodetails all",width:"101px"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#cal-chefs-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;if(l>5&&l<=10)continue;if(5==l){i+="<div class='col-lg-3 col-xs-6'>";for(var s=5;s<=10;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-chefs-table"))+">"+i+"</div>"}}}});$("#pane-cal-chefs div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 性别">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;var s=$.trim($("#pane-cal-chefs .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.gender,s)||!!commaSeparatedMatch(i.tagsDisp,s))});var r=getEquipsOptions(e.equips,!0);c.MakeCellsEditable({columns:[16],inputTypes:[{column:16,type:"list",search:!0,clear:!0,done:!0,options:r}],onUpdate:function(a,t,i,l){if(16==i.index().column){var s=t.data(),r=null,n="",o=getEquipInfo(s.equipId,e.equips);o&&(r=o,n=o.disp),s.equip=r,s.equipDisp=n,t.data(s),c.draw(!1)}}}),$("#chk-cal-chefs-show").on("changed.bs.select",function(){initCalChefsShow(c)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?c.rows(".rarity-"+e,{search:"applied"}).select():c.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){c.rows().every(function(e,a,t){var i=this.data();i.equip=null,i.equipId="",i.equipDisp="",this.data(i)})}),$("#pane-cal-chefs .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),c.rows({search:"applied"}).select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),c.rows().deselect()}),$("#btn-cal-chefs-export").click(function(){var e=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),a={calChefs:[]};for(var t in e)a.calChefs.push(e[t].chefId);$("#input-export-import").val(JSON.stringify(a))}),initTableResponsiveDisplayEvent(c),initTableScrollEvent("#pane-cal-chefs"),initCalChefsShow(c)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"galleryId",width:"1px"},{data:"name",width:"80px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:"skillDisp"},{data:"origin"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#cal-equips-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[5,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-equips-table"))+">"+i+"</div>"}}}});$("#pane-cal-equips div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 技能 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;var s=$.trim($("#pane-cal-equips .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-cal-equips-show").on("changed.bs.select",function(){initCalEquipsShow(c)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?c.rows(".rarity-"+e).select():c.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-rarity input[type="checkbox"]').prop("checked",!0),c.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-rarity input[type="checkbox"]').prop("checked",!1),c.rows().deselect()}),$("#btn-cal-equips-export").click(function(){var e=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),a={calEquips:[]};for(var t in e)a.calEquips.push(e[t].equipId);$("#input-export-import").val(JSON.stringify(a))}),initTableResponsiveDisplayEvent(c),initTableScrollEvent("#pane-cal-equips"),initCalEquipsShow(c)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"materialId",width:"1px"},{data:"name",className:"all"},{data:"origin"},{data:"quantity",className:"all",orderSequence:["desc","asc"],width:"50px"},{data:"addition",className:"all",orderSequence:["desc","asc"],width:"50px"}],t=!0,i=!1,l=!1;isMobile&&(t=!1,i=!0,l={left:[0,3]});var s="td:not(.nodetails)";expendBtn&&(s=".td-expend");var c=$("#cal-materials-table").DataTable({data:[],columns:a,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],deferRender:!1,autoWidth:!1,fixedHeader:t,scrollX:i,fixedColumns:l,createdRow:function(e,a,t){$(e).addClass("origin-"+a.originVal)},responsive:{details:{type:"column",target:s,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<3?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-materials-table"))+">"+i+"</div>"}}}});$("#pane-cal-materials div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 名字 来源">'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;var s=$.trim($("#pane-cal-materials .search-box input").val());return!!commaSeparatedMatch(i.name,s)||!!commaSeparatedMatch(i.origin,s)}),$("#chk-cal-materials-show").on("changed.bs.select",function(){initCalMaterialsShow(c)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?c.rows(".origin-"+e).select():c.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").on("input",function(){c.draw(),changeInputStyle(this)}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),c.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),c.rows().deselect()}),initTableResponsiveDisplayEvent(c),initTableScrollEvent("#pane-cal-materials"),initCalMaterialsShow(c)}function initCalCustomTable(e){var a=$(".selected-item .chef-box-2 .disk-box")[0].outerHTML;$(".selected-item .chef-box-2").append(a).append(a);var t=$(".selected-item .recipe-box")[0].outerHTML;$(".selected-item").append(t).append(t);var i=$(".selected-item")[0].outerHTML;$(".selected-item-wrapper").append(i).append(i).append(i);var l=$(".cal-custom-item")[0].outerHTML;if($("#pane-cal-custom").append(l).append(l),$(".selected-item-wrapper .select-picker select").on("show.bs.select",function(e){$(this).closest(".edit-box").addClass("editing"),$("body").addClass("m-no-scroll")}),$(".selected-item-wrapper .select-picker select").on("hide.bs.select",function(e){$(this).closest(".edit-box").removeClass("editing"),$("body").removeClass("m-no-scroll")}),$(".chef-box .chef-placeholder, .chef-box .chef-box-1").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=getCustomChefsOptions(a,t,e);$(this).closest(".chef-box").find("select.select-picker-chef").html(getOptionsString(i)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-chef").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=$(this).val();setCustomChef(s,c,r),calCustomResults(e)}),$(".disk-level-box").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=getCustomDiskLevelsOptions(a,t,e);$(this).find("select.select-picker-disk-level").html(getOptionsString(i)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-disk-level").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=Number($(this).val());setCustomDiskLevel(s,c,r),calCustomResults(e)}),$(".disk-box").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=$(this).closest(".chef-box").find(".disk-box").index($(this).closest(".disk-box")),l=calCustomRule.rules[a],s=getCustomAmbersOptions(a,t,i,l.ambers,e);$(this).find("select.select-picker-amber").html(getOptionsString(s)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-amber").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=$(this).closest(".chef-box").find(".disk-box").index($(this).closest(".disk-box")),n=$(this).val();setCustomAmber(s,c,r,n),calCustomResults(e)}),$(".equip-box").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=calCustomRule.rules[a],l=getCustomEquipsOptions(a,t,i.equips,e);$(this).find("select.select-picker-equip").html(getOptionsString(l)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-equip").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=$(this).val();setCustomEquip(s,c,r),calCustomResults(e)}),$(".condiment-box").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=getCustomCondimentsOptions(a,t,e.condiments,e);$(this).find("select.select-picker-condiment").html(getOptionsString(i)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-condiment").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=$(this).val();setCustomCondiment(s,c,r,e),calCustomResults(e)}),$(".recipe-box .recipe-placeholder, .recipe-box .content, .recipe-box .recipe-result, .recipe-box .recipe-box-2").click(function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),l=getCustomRecipesOptions(a,t,i,e);$(this).closest(".recipe-box").find("select.select-picker-recipe").html(getOptionsString(l)).selectpicker("refresh").selectpicker("toggle")}),$("select.select-picker-recipe").on("changed.bs.select",function(a,t,i,l){var s=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),c=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),r=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),n=$(this).val();setCustomRecipe(s,c,r,n),calCustomResults(e);var o=calCustomRule.rules[s];o.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}),$(".recipe-box .recipe-quantity").click(function(){$(this).find("input").focus()}),$(".recipe-box .recipe-quantity input").on("input",function(){var a=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),t=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),i=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),l=$(this).val();setCustomRecipeQuantity(a,t,i,l),calCustomResults(e);var s=calCustomRule.rules[a];s.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")}),$(".recipe-box .recipe-ex input").click(function(){var e=$(".cal-custom-item").index($(this).closest(".cal-custom-item")),a=$(this).closest(".cal-custom-item").find(".selected-item").index($(this).closest(".selected-item")),t=$(this).closest(".selected-item").find(".recipe-box").index($(this).closest(".recipe-box")),i=calCustomRule.rules[e],l=i.custom,s=l[a].recipes[t].data.recipeId.toString(),c=$("#chk-cal-ex").val(),r=c.indexOf(s);r<0?c.push(s):c.splice(r,1),$("#chk-cal-ex").selectpicker("val",c)}),$(".recipe-box .recipe-condiment input").click(function(){calCustomResults(e)}),$(".btn-resize").click(function(){$(this).hasClass("glyphicon-resize-small")?($(this).closest(".cal-custom-item").find(".rule-desc").hide(),$(this).closest(".cal-custom-item").find(".selected-item-wrapper").hide(),$(this).addClass("glyphicon-resize-full").removeClass("glyphicon-resize-small")):($(this).closest(".cal-custom-item").find(".rule-desc").show(),$(this).closest(".cal-custom-item").find(".selected-item-wrapper").show(),$(this).addClass("glyphicon-resize-small").removeClass("glyphicon-resize-full"))}),private){var s,c,r;try{var n=localStorage.getItem("cal");s=JSON.parse(n)}catch(e){}for(var o in s||(s=[]),s)$("#select-cal-save").append("<option value='"+s[o].key+"'>"+s[o].key+"</option>").selectpicker("refresh");$(".btn-cal-results-cal").click(function(){r=[];var a=$("#pane-cal-optimal-results");if(void 0!==c&&(c.terminate(),c=void 0),$("#cal-save-result").addClass("hidden"),$("#select-cal-save").selectpicker("val",""),$(this).hasClass("stop"))return a.find(".cal-results-progress").addClass("hidden"),a.find(".btn-cal-results-cal.start").prop("disabled",!1),void a.find(".btn-cal-results-cal.stop").prop("disabled",!0);a.find(".optimal-result").html(""),a.find(".btn-cal-results-cal.start").prop("disabled",!0),a.find(".btn-cal-results-cal.stop").prop("disabled",!1),a.find(".cal-results-progress .progress-bar").css("width","0%"),a.find(".cal-results-progress .progress-bar span").text("预处理中"),a.find(".cal-results-progress").removeClass("hidden"),c=new Worker("others/js/cal.js?v="+(new Date).getTime()),c.onmessage=function(t){t.data.progress?(a.find(".cal-results-progress .progress-bar").css("width",t.data.progress.value+"%"),a.find(".cal-results-progress .progress-bar span").text(t.data.progress.display)):t.data.menu?(r=t.data.menu,showCalOptimalResult(r,e)):t.data.done?(a.find(".btn-cal-results-cal.stop").prop("disabled",!0),a.find(".btn-cal-results-cal.start").prop("disabled",!1),a.find(".cal-results-progress").addClass("hidden"),r.length&&$("#cal-save-result").removeClass("hidden")):t.data.error&&bootbox.alert({size:"small",message:"<div class='text-center'>"+t.data.error+"</div>"})};var t=$("#cal-recipes-table").DataTable().rows({selected:!0}).data().toArray(),i=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),l=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),s=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),n=$("#chk-cal-results-no-equips").prop("checked"),o=$("#chk-cal-results-add-equips").prop("checked"),p=$("#chk-cal-results-change-equips").prop("checked"),d=$("#chk-cal-results-filter-equip-condiment").prop("checked"),u=$("#chk-cal-results-use-condiment").prop("checked"),f=Number($("#input-cal-min-score").val()),h=Number($("#input-cal-thread").val()),m=$("#select-cal-type").val(),v=calCustomRule.rules[0],b=v.custom;c.postMessage({mode:m,rule:v,custom:b,recipes:t,chefs:i,equips:l,materials:s,odata:e,noEquips:n,addEquips:o,changeEquips:p,filterEquipCondiment:d,useCondiment:u,minScore:f,thread:h})}),$("#btn-cal-save").click(function(){var e=escapeHtml($("#input-cal-save-name").val());if(e.length){$("#cal-save-result").addClass("hidden"),$("#select-cal-save").append("<option value='"+e+"'>"+e+"</option>").selectpicker("refresh"),$("#select-cal-save").selectpicker("val",e);var a={};a.key=e,a.val=r,s.push(a);try{localStorage.setItem("cal",JSON.stringify(s))}catch(e){}$("#input-cal-save-name").val("")}else $("#input-cal-save-name").focus()}),$("#select-cal-save").change(function(){var a=$(this).val();for(var t in s)if(s[t].key==a){r=s[t].val,showCalOptimalResult(r,e),
$("#cal-save-result").addClass("hidden");break}}),$("#btn-cal-save-clear").click(function(){bootbox.confirm({size:"small",message:"<div class='text-center'>确定清空保存?</div>",locale:"zh_CN",callback:function(e){if(e){$("#select-cal-save").html("").append("<option></option>").selectpicker("refresh"),s=[];try{localStorage.setItem("cal","")}catch(e){}}}})})}}function showCalOptimalResult(e,a){var t="<table class='table table-condensed'>";for(var i in t+="<tr><td>厨师</td><td>厨具</td><td>调料</td><td>菜谱</td></tr>",e){var l=e[i].menu;for(var s in l){for(var c in t+="<tr>",t+="<td>"+l[s].chef.name+"</td>",t+="<td>"+(l[s].equip.name?l[s].equip.name:"")+"</td>",t+="<td>"+(l[s].condiment.name?l[s].condiment.name:"")+"</td>",t+="<td>",l[s].recipes)t+=l[s].recipes[c].data.name+"["+l[s].recipes[c].data.condimentDisp+"]*"+l[s].recipes[c].quantity+" ";t+="</td>",t+="</tr>"}t+="<tr class='active'><td colspan='4'>",t+="分数: "+e[i].score,t+="<button data-id='"+i+"' class='btn btn-default btn-sm btn-cal-set-custom' type='button'>选择当前菜谱</button></td><tr>",t+="</td></tr>"}t+="</table>",$("#pane-cal-optimal-results").find(".optimal-result").html(t),$(".btn-cal-set-custom").click(function(){var t=Number($(this).attr("data-id")),i=JSON.parse(JSON.stringify(e[t].menu));initCustomData();var l=0,s=calCustomRule.rules[l],c=s.custom;for(var r in i)for(var n in c[r].chef=i[r].chef,c[r].equip=i[r].equip,c[r].condiment=i[r].condiment,i[r].recipes)c[r].recipes[n]=i[r].recipes[n],updateCustomRecipeCondiment(l,r,n,c[r].recipes[n].useCondiment);calCustomResults(a),s.hasOwnProperty("MaterialsNum")&&$("#pane-cal-recipes").attr("data-cal","false")})}function initCalRecipesTable(){var e=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:void 0,defaultContent:"<span class='glyphicon'></span>",className:"td-expend",orderable:!1,searchable:!1,visible:expendBtn,width:"1px"},{data:"recipe.data.galleryId",width:"1px"},{data:"recipe.data.icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"recipe.data.name",width:"86px",className:"all"},{data:"recipe.available",className:"all",orderSequence:["desc","asc"]},{data:"recipe.max",className:"all",orderSequence:["desc","asc"]},{data:"recipe.availableScore",className:"all",orderSequence:["desc","asc"]},{data:"recipe.totalScore",orderSequence:["desc","asc"]},{data:{_:"recipe.totalTime",display:"recipe.totalTimeDisp"}},{data:"recipe.efficiency",orderSequence:["desc","asc"]},{data:"recipe.bonusAdditionDisp",orderSequence:["desc","asc"]},{data:"recipe.data.ultimateAdditionDisp",orderSequence:["desc","asc"]},{data:"recipe.decorationAdditionDisp",orderSequence:["desc","asc"]},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"recipe.data.condiment",display:"recipe.data.condimentDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.stirfry",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.boil",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.knife",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.fry",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.bake",width:"20px",orderSequence:["desc","asc"]},{data:"recipe.data.steam",width:"20px",orderSequence:["desc","asc"]},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"}},{data:{_:"recipe.data.price",display:"recipe.data.priceDisp"},width:"30px",orderSequence:["desc","asc"]},{data:"recipe.data.exPrice",orderSequence:["desc","asc"]},{data:{_:"recipe.data.time",display:"recipe.data.timeDisp"}},{data:"recipe.data.origin"},{data:"recipe.data.tagsDisp",defaultContent:"",visible:private,className:"none"}],a=!0,t=!1,i=!1;isMobile&&(a=!1,t=!0,i={left:[0,4]});var l="td:not(.nodetails)";expendBtn&&(l=".td-expend");var s=$("#cal-recipes-table").DataTable({data:[],columns:e,language:{search:"查找:",zeroRecords:"没有找到",info:"_TOTAL_个",infoEmpty:"0",infoFiltered:"/ _MAX_",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},pagingType:"numbers",pageLength:Number($("#select-setting-page-length").val()),dom:"<'table-top clearfix'<'left'i><'right'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[],deferRender:!1,autoWidth:!1,fixedHeader:a,scrollX:t,fixedColumns:i,responsive:{details:{type:"column",target:l,renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l<2)continue;if(l>16&&l<=21)continue;if(16==l){i+="<div class='col-lg-3 col-xs-6'>";for(var s=16;s<=21;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-xs-6'><span class='child-key'>"+t[l].title+(l<4?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'"+getResponsiveStyle($("#cal-recipes-table"))+">"+i+"</div>"}}}});$("#pane-cal-recipes div.search-box").html('<input type="search" class="form-control input-sm monitor-none" placeholder="查找 菜名 材料">'),$("#pane-cal-recipes .search-box input").on("input",function(){s.draw(),changeInputStyle(this)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-table"))return!0;var s=$.trim($("#pane-cal-recipes .search-box input").val());return!!commaSeparatedMatch(i.recipe.data.name,s)||(!!commaSeparatedMatch(i.recipe.data.materialsVal,s)||!!commaSeparatedMatch(i.recipe.data.tagsDisp,s))}),$("#btn-cal-recipes-select-all").click(function(){s.rows({search:"applied"}).select()}),$("#btn-cal-recipes-deselect-all").click(function(){s.rows().deselect()}),$("#chk-cal-recipes-show").on("changed.bs.select",function(){initCalRecipesShow(s)}),initTableResponsiveDisplayEvent(s),initTableScrollEvent("#pane-cal-recipes"),initCalRecipesShow(s)}function generateData(e,a,t){var i={};if(a){for(var l in a.equips)a.equips[l].hide=!0;for(var l in a.decorations)a.decorations[l].hide=!0;for(var l in a.recipes)a.recipes[l].hide=!0;for(var l in a.chefs)a.chefs[l].hide=!0;for(var l in a.ambers)a.ambers[l].hide=!0;e.guests=e.guests.concat(a.guests),e.equips=e.equips.concat(a.equips),e.decorations=e.decorations.concat(a.decorations),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs),e.skills=e.skills.concat(a.skills),e.maps=e.maps.concat(a.maps),e.buffs=e.buffs.concat(a.buffs),e.intents=e.intents.concat(a.intents),e.rules=e.rules.concat(a.rules),e.activities=e.activities.concat(a.activities),i.ranks=a.ranks}i.maps=e.maps,i.activities=e.activities,i.guests=e.guests,i.invitationGuests=e.invitationGuests,i.history=e.history,i.skills=e.skills;var s=[];for(var l in e.skills)for(var c in e.skills[l].effect)if("Partial"==e.skills[l].effect[c].condition||"Next"==e.skills[l].effect[c].condition){s.push(e.skills[l]);break}i.partialSkill=s,i.rules=e.rules,i.intents=e.intents,i.buffs=e.buffs,i.decorationEffect=0,t&&t.decorationEffect&&(i.decorationEffect=t.decorationEffect),e.materials.sort(function(e,a){return e.origin.localeCompare(a.origin)});var r=[];for(var l in e.materials){var n=e.materials[l];n.originVal=getOriginVal(e.materials[l].origin),n.addition="",n.quantity="",r.push(n)}i.materials=r;var o=[];for(var l in e.condiments){var p=e.condiments[l];p.rarityDisp=getRarityDisp(e.condiments[l].rarity);var d=getSkillInfo(e.skills,e.condiments[l].skill);p.skillDisp=d.skillDisp,p.skillSort=0,p.effect=d.skillEffect,p.icon="<div class='icon-condiment condiment_"+e.condiments[l].condimentId+"'></div>",o.push(p)}i.condiments=o;var u=[];for(var l in e.equips)if(e.equips[l].name){var f=e.equips[l];f.rarityDisp=getRarityDisp(e.equips[l].rarity);d=getSkillInfo(e.skills,e.equips[l].skill);f.skillDisp=d.skillDisp,f.skillSort=0,f.effect=d.skillEffect,f.disp="<span class='name'>"+e.equips[l].name+"</span><br><small>"+d.skillDisp+"</small>",e.equips[l].hide?f.icon="<div class='icon-equip2 equip_"+e.equips[l].equipId+"'></div>":f.icon="<div class='icon-equip equip_"+e.equips[l].equipId+"'></div>",u.push(f)}i.equips=u,i.disks=e.disks;var h=[];for(var l in e.ambers){var m=e.ambers[l];m.typeDisp=getAmberTypeDisp(e.ambers[l].type),m.rarityDisp=getRarityDisp(e.ambers[l].rarity);d=getSkillInfo(e.skills,e.ambers[l].skill);m.skillDisp=d.skillDisp,m.skillSort=0,m.effect=d.skillEffect,m.allDesc="",m.allEffect=[];for(c=1;c<=5;c++){m.allDesc+=getAmberDisplayByLevel(m,c)+"<br>";var v=getAmberEffectByLevel(m,c);m.allEffect.push(v)}e.ambers[l].hide?m.icon="<div class='icon-amber2 amber_"+e.ambers[l].amberId+"'></div>":m.icon="<div class='icon-amber amber_"+e.ambers[l].amberId+"'></div>",h.push(m)}i.ambers=h;var b=[],g=[];for(var l in e.decorations){var k=e.decorations[l];if(k.tipMin=k.tipMin||"-",k.tipMax=k.tipMax||"-",k.tipTimeDisp=secondsToTime(k.tipTime)||"-",k.tipTime){if(k.minEff=+(3600*k.tipMin*24/k.tipTime).toFixed(1),k.maxEff=+(3600*k.tipMax*24/k.tipTime).toFixed(1),k.tAvgEff=+((k.tipMin+k.tipMax)/2*3600*24/k.tipTime).toFixed(1),k.tipTime/3600%24>=20){var y=Math.ceil(k.tipTime/3600/24);k.rAvgEff=+((k.tipMin+k.tipMax)/2/y).toFixed(1)}k.avgEffDisp=getDecorationAvgEffDisp(k.tAvgEff,k.rAvgEff)}if(k.goldDisp=getPercentDisp(+(100*k.gold).toFixed(2))||"-",k.suitDisp=k.suit||"-",k.suitGoldDisp=getPercentDisp(+(100*k.suitGold).toFixed(2))||"-",e.decorations[l].hide?k.icon="<div class='icon-decoration2 decoration_"+k.icon+"'></div>":k.icon="<div class='icon-decoration decoration_"+k.icon+"'></div>",g.push(k),k.suit){var x=!1;for(var c in b)if(b[c].name==k.suit){b[c].decorations.push(k.id),x=!0;break}if(!x){var D={};D.name=k.suit,D.gold=k.suitGold,D.decorations=[],D.decorations.push(k.id),b.push(D)}}}i.decorations=g,i.suits=b;var C=[];for(var l in e.quests)if(e.quests[l].goal){var w=e.quests[l];w.questIdDisp=e.quests[l].questIdDisp?e.quests[l].questIdDisp:e.quests[l].questId;var T="",S="";for(var c in e.quests[l].rewards)T+=e.quests[l].rewards[c].name,e.quests[l].rewards[c].quantity&&(T+="*"+e.quests[l].rewards[c].quantity),T+=" ",S+=e.quests[l].rewards[c].name;w.rewardsVal=S,w.rewardsDisp=T,C.push(w)}i.quests=C;var q=t&&t.setting&&t.setting.final,E=$("#chk-chef-apply-equips").prop("checked"),I=$("#chk-chef-apply-ultimate").prop("checked"),R=$("#chk-chef-apply-ultimate-person").prop("checked"),N=getUltimateData(e.chefs,t,e.skills,I,R);i.ultimateData=N;var M=[];for(var l in e.chefs)if(e.chefs[l].name){var A=e.chefs[l];A.addition="",A.rarityDisp=getRarityDisp(e.chefs[l].rarity),e.chefs[l].hide?A.icon="<div class='icon-chef2 chef_"+e.chefs[l].chefId+"'></div>":A.icon="<div class='icon-chef chef_"+e.chefs[l].chefId+"'></div>";d=getSkillInfo(e.skills,e.chefs[l].skill);if(A.specialSkillDisp=d.skillDisp,A.specialSkillEffect=d.skillEffect,A.tags=e.chefs[l].tags||[],A.tagsDisp="",a)for(var c in a.chefsTags)if(a.chefsTags[c].chefId==e.chefs[l].chefId){A.tags=a.chefsTags[c].tags,A.tagsDisp=getTagsDisp(a.chefsTags[c].tags,a.tags);break}A.gender=getGender(A.tags);var O="";for(var c in e.chefs[l].ultimateGoal)for(var _ in e.quests)if(e.chefs[l].ultimateGoal[c]==e.quests[_].questId){O+=e.quests[_].goal+"<br>";break}A.ultimateGoalDisp=O;var G=getSkillInfo(e.skills,e.chefs[l].ultimateSkill);for(var c in A.ultimateSkillDisp=G.skillDisp,A.ultimateSkillEffect=G.skillEffect,A.ultimateCustomDisp=getChefUltimateCustomDisp(e.chefs[l].ultimateSkill,e.skills),A.got="",A.ultimate="",A.equip=null,A.equipId="",A.equipDisp="",A.diskId=e.chefs[l].disk,A.disk={},e.disks)if(e.disks[c].diskId==A.diskId){for(var _ in A.disk.maxLevel=e.disks[c].maxLevel,A.disk.level=1,A.disk.ambers=[],e.disks[c].info){m={};m.type=e.disks[c].info[_],m.data=null,A.disk.ambers.push(m)}break}A.diskDisp=GetDiskDisp(A.disk),t&&updateChefByLocalData(A,t,u,h),setDataForChef(A,A.equip,E,N.global,null,N.self,null,q,null,!0),M.push(A)}i.chefs=M;var P=[];for(var l in e.recipes)if(e.recipes[l].name){var V={};if(V=e.recipes[l],V.stirfry=e.recipes[l].stirfry||"",V.boil=e.recipes[l].boil||"",V.knife=e.recipes[l].knife||"",V.fry=e.recipes[l].fry||"",V.bake=e.recipes[l].bake||"",V.steam=e.recipes[l].steam||"",V.addition="",V.skillDisp=getSkillDisp(e.recipes[l]),V.timeDisp=secondsToTime(e.recipes[l].time),V.rarityDisp=getRarityDisp(e.recipes[l].rarity),e.recipes[l].hide?V.icon="<div class='icon-recipe2 recipe_"+e.recipes[l].recipeId+"'></div>":V.icon="<div class='icon-recipe recipe_"+e.recipes[l].recipeId+"'></div>",V.tags=e.recipes[l].tags||[],V.tagsDisp="",V.exTime=0,V.exTimeDisp="",a)for(var c in a.recipesTags)if(a.recipesTags[c].recipeId==e.recipes[l].recipeId){V.tags=a.recipesTags[c].tags,V.tagsDisp=getTagsDisp(a.recipesTags[c].tags,a.tags),V.exTime=a.recipesTags[c].experienceTime,V.exTimeDisp=getExTimeDisp(a.recipesTags[c].experienceTime,e.recipes[l].time);break}if(V.rank="",V.rankSort=1,V.ex="",V.got="",t)for(var c in t.recipes)if(e.recipes[l].recipeId==t.recipes[c].id){t.recipes[c].hasOwnProperty("rank")&&(V.rank=t.recipes[c].rank,V.rankSort=getRankSortValue(t.recipes[c].rank)),t.recipes[c].hasOwnProperty("ex")&&(V.ex=t.recipes[c].ex),t.recipes[c].hasOwnProperty("got")&&(V.got=t.recipes[c].got);break}V.oPrice=e.recipes[l].price;var L=ifUseEx(V);setDataForRecipe(V,N.global,L,null,q,null),V.efficiency=Math.floor(3600*e.recipes[l].price/e.recipes[l].time);var B=getMaterialsInfo(e.recipes[l],e.materials);V.materialsVal=B.materialsVal,V.materialsDisp=B.materialsDisp,V.veg=B.veg,V.meat=B.meat,V.creation=B.creation,V.fish=B.fish;var F=0,U=0;e.recipes[l].time>0&&(F=3600*B.materialsCount/e.recipes[l].time,U=3600*e.recipes[l].rarity/e.recipes[l].time),V.allMaterialsEff=F?Math.floor(F):"",V.condimentEff=U?Math.floor(U):"";var j="",H="-";for(var J in e.combos)for(var z in e.combos[J].recipes)if(e.combos[J].recipes[z]==e.recipes[l].recipeId){for(var Q in e.recipes)if(e.recipes[Q].recipeId==e.combos[J].recipeId){j=e.recipes[Q].recipeId,H=e.recipes[Q].name;break}break}V.comboVal=j,V.comboDisp=H;var X=getRankGuestInfo(e.recipes[l],V.rank);V.rankGuestsVal=X.rankGuestsVal,V.rankGuestsDisp=X.rankGuestsDisp;var W=getRankGiftInfo(e.recipes[l],V.rank);V.rankGiftVal=W.rankGiftVal,V.rankGiftDisp=W.rankGiftDisp;var K="",Y="";for(var J in e.guests)for(var z in e.guests[J].gifts)if(e.recipes[l].name==e.guests[J].gifts[z].recipe){K+=" "+e.guests[J].name+" "+e.guests[J].gifts[z].antique+" ",Y+=e.guests[J].name+"-"+e.guests[J].gifts[z].antique+"<br>";break}V.guestsVal=K,V.guestsDisp=Y||"-";var Z="",ee="";for(var J in e.invitationGuests)for(var z in e.invitationGuests[J].gifts)if(e.recipes[l].recipeId==e.invitationGuests[J].gifts[z].recipeId){Z+=" "+e.invitationGuests[J].name+" "+e.invitationGuests[J].gifts[z].gift+" ",ee+=e.invitationGuests[J].name+"-"+e.invitationGuests[J].gifts[z].gift+"<br>";break}V.invitationGuestsVal=Z,V.invitationGuestsDisp=ee||"-",V.condimentDisp=getCondimentDisp(e.recipes[l].condiment),P.push(V)}return i.recipes=P,i.selectedQuests=[],i.questMaterials=[],i.allSelectedMaterials=[],i.recipeColNum=$("#recipe-table-header th").length,i.recipeAddColNum=0,i.recipeAddColNumMax=15,i.chefColNum=$("#chef-table-header th").length,i.chefAddColNum=0,i.chefAddColNumMax=15,i}function updateRecipeChefTable(e){$(".loading").removeClass("hidden"),setTimeout(function(){e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),$("#recipe-table").DataTable().draw(!1),$("#chef-table").DataTable().draw(!1),$(".loading").addClass("hidden")},0),$("#btn-chef-recal").closest(".inline-wrapper").addClass("hidden"),$("#btn-recipe-recal").closest(".inline-wrapper").addClass("hidden")}function getUpdateData(e){var a=getLocalData(),t=$("#chk-setting-show-final").prop("checked"),i=$("#chk-chef-apply-equips").prop("checked"),l=$("#chk-chef-apply-ultimate").prop("checked"),s=$("#chk-chef-apply-ultimate-person").prop("checked"),c=getUltimateData(e.chefs,a,e.skills,l,s);e.ultimateData=c;var r=$("#chk-chef-partial-ultimate").val(),n=getPartialChefAddsByIds(e.chefs,e.partialSkill,l,r);for(var o in e.chefs)setDataForChef(e.chefs[o],e.chefs[o].equip,i,c.global,n,c.self,null,t,null,l);for(var o in e.recipes){var p=ifUseEx(e.recipes[o]);setDataForRecipe(e.recipes[o],c.global,p,null,t,null)}return updateRecipesChefsData(e),updateChefsRecipesData(e),e}function getQuestsData(e,a){var t=[];for(var i in e)e[i].type==a&&t.push(e[i]);return t}function getMaterialsData(e,a){if(!a){var t=$("#select-material-origin").val();for(var i in e.maps)if(t==e.maps[i].name){a=e.maps[i];break}}var l=a.materials,s=[],c=$("#chk-material-season").prop("checked"),r=Number($("#input-material-addition").val()),n=$("#input-material-skill").val();for(var i in l){var o={};for(var p in o.name=l[i].name,o.skill=l[i].skill,o.time=[],l[i].quantity){var d=0,u=0;(""==n||Number(n)>=l[i].skill)&&(d=l[i].quantity[p][0],u=l[i].quantity[p][1],c&&(d+=l[i].season[p],u+=l[i].season[p]),r&&(d=Math.ceil(+(d*(1+r/100)).toFixed(2)),u=Math.ceil(+(u*(1+r/100)).toFixed(2)))),o.time.push([d,u])}s.push(o)}var f={name:"总计",time:[]};for(var i in a.time){d=0,u=0;for(var p in s)d+=s[p].time[i][0],u+=s[p].time[i][1];f.time.push([d,u])}return s.push(f),s}function getMaterialsInfo(e,a){var t={},i="",l="",s=0,c=!1,r=!1,n=!1,o=!1;for(var p in e.materials)for(var d in a)if(e.materials[p].material==a[d].materialId){i+=a[d].name+"*"+e.materials[p].quantity+" ",l+=a[d].name+" ",s+=e.materials[p].quantity,e.materials[p].origin=a[d].origin,"菜棚"==a[d].origin||"菜地"==a[d].origin||"森林"==a[d].origin?c=!0:"鸡舍"==a[d].origin||"猪圈"==a[d].origin||"牧场"==a[d].origin?r=!0:"作坊"==a[d].origin?n=!0:"池塘"==a[d].origin&&(o=!0);break}return t.materialsDisp=i,t.materialsVal=l,t.materialsCount=s,t.veg=c,t.meat=r,t.creation=n,t.fish=o,t}function getGender(e){return e.indexOf(1)>=0?"男":e.indexOf(2)>=0?"女":""}function getTagsDisp(e,a){var t="";for(var i in e)for(var l in a)if(e[i]==a[l].Id){t+=a[l].name+" ";break}return t}function getExTimeDisp(e,a){var t=e/1.5,i=e/2,l=e/2.5,s=e/3,c="可-"+Math.ceil(e/a)+"-"+secondsToTime(e)+"<br>优-"+Math.ceil(t/a)+"-"+secondsToTime(t)+"<br>特-"+Math.ceil(i/a)+"-"+secondsToTime(i)+"<br>神-"+Math.ceil(l/a)+"-"+secondsToTime(l)+"<br>传-"+Math.ceil(s/a)+"-"+secondsToTime(s);return c}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"池塘"==e?a=8:console.log("cannot find origin: "+a),a}function getRankSortValue(e){return"传"==e?5:"神"==e?4:"特"==e?3:"优"==e?2:1}function getRankGuestInfo(e,a){var t="",i="",l=$("#chk-recipe-filter-guest").prop("checked"),s=$("#chk-setting-done-mark").prop("checked");for(var c in e.guests){var r=!1;("优"==a&&0==c||"特"==a&&2!=c||"神"==a||"传"==a)&&(r=!0);var n="";0==c?n="优":1==c?n="特":2==c&&(n="神"),t+=(r&&s?"<span class='rank-done'>":"")+n+"-"+(e.guests[c].guest?e.guests[c].guest:"未知")+(r&&s?"</span>":"")+"<br>",(!l||l&&!r)&&(i+=" "+e.guests[c].guest+" ")}var o={};return o.rankGuestsDisp=t,o.rankGuestsVal=i,o}function getRankGiftInfo(e,a){var t=e.gift,i="",l=$("#chk-recipe-filter-antique").prop("checked"),s=$("#chk-setting-done-mark").prop("checked");"神"!=a&&"传"!=a||!s||(t="<span class='rank-done'>"+t+"</span>"),(!l||l&&"神"!=a&&"传"!=a)&&(i=e.gift);var c={};return c.rankGiftDisp=t,c.rankGiftVal=i,c}function ifUseEx(e){var a=$("#chk-recipe-apply-ex").prop("checked"),t=$("#chk-recipe-apply-ex-person").prop("checked");return!(!a||(!t||"是"!=e.ex)&&t)}function getUltimateData(e,a,t,i,l){var s=[],c=[],r=[];for(var n in e)if(i&&e[n].ultimateSkill){var o=!1;if(l){if(a)for(var p in a.chefs)if(e[n].chefId==a.chefs[p].id&&"是"==a.chefs[p].ult){o=!0;break}}else e[n].hide||(o=!0);if(o)for(var d in t)if(e[n].ultimateSkill==t[d].skillId){var u=[],f=[];for(var h in t[d].effect)if("Partial"==t[d].effect[h].condition||"Next"==t[d].effect[h].condition)u.push(t[d].effect[h]);else if("Global"==t[d].effect[h].condition){var m=!1;for(var v in s)if(!(s[v].type!=t[d].effect[h].type||s[v].cal!=t[d].effect[h].cal&&(s[v].cal||t[d].effect[h].cal)||s[v].tag!=t[d].effect[h].tag&&(s[v].tag||t[d].effect[h].tag)||s[v].rarity!=t[d].effect[h].rarity&&(s[v].rarity||t[d].effect[h].rarity))){s[v].value=+(s[v].value+t[d].effect[h].value).toFixed(2),m=!0;break}m||s.push(JSON.parse(JSON.stringify(t[d].effect[h])))}else"Self"==t[d].effect[h].condition&&f.push(t[d].effect[h]);if(u.length){var b={};b.chefId=e[n].chefId,b.effect=u,c.push(b)}if(f.length){var g={};g.chefId=e[n].chefId,g.effect=f,r.push(g)}break}}var k={};return k.global=s,k.partial=c,k.self=r,k}function setPartialUltimateOptions(e,a){var t=[];for(var i in e)if(e[i].ultimateSkill)for(var l in a)if(e[i].ultimateSkill==a[l].skillId)for(var s in a[l].effect)if("Partial"==a[l].effect[s].condition||"Next"==a[l].effect[s].condition){var c=getSkillInfo(a,a[l].skillId),r={};r.skill=c,r.chef=e[i],t.push(r);break}for(var i in t.sort(function(e,a){return e.skill.skillDisp.localeCompare(a.skill.skillDisp)}),t){var n="<option value='"+t[i].chef.chefId+"' data-subtext='"+t[i].skill.skillDisp.replace(/<br>/g," ")+"'>"+t[i].chef.name+"</option>",o=!1;for(var p in t[i].skill.skillEffect)if("Partial"==t[i].skill.skillEffect[p].condition&&("Bake"==t[i].skill.skillEffect[p].type||"Steam"==t[i].skill.skillEffect[p].type||"Boil"==t[i].skill.skillEffect[p].type||"Fry"==t[i].skill.skillEffect[p].type||"Knife"==t[i].skill.skillEffect[p].type||"Stirfry"==t[i].skill.skillEffect[p].type)){o=!0;break}o&&$("#chk-chef-partial-ultimate").append(n),$("#chk-cal-partial-ultimate").append(n)}}function setSelfUltimateOptions(e,a){for(var t in e)if(e[t].ultimateSkill)for(var i in a)if(e[t].ultimateSkill==a[i].skillId){for(var l in a[i].effect)if("Self"==a[i].effect[l].condition&&"Material_Gain"!=a[i].effect[l].type&&"GuestDropCount"!=a[i].effect[l].type&&"GuestApearRate"!=a[i].effect[l].type){var s=getSkillInfo(a,a[i].skillId),c="<option value='"+e[t].chefId+"' data-subtext='"+s.skillDisp.replace(/<br>/g," ")+"'>"+e[t].name+"</option>";$("#chk-cal-self-ultimate").append(c);break}break}}function setExOptions(e){for(var a in e){var t="<option value='"+e[a].recipeId+"' data-subtext='+"+e[a].exPrice+"'>"+e[a].name+"</option>";$("#chk-cal-ex").append(t)}}function setDataForRecipe(e,a,t,i,l,s){if(e.limitVal=e.limit,e.ultimateAddition=0,!s||!s.hasOwnProperty("DisableChefSkillEffect")||0==s.DisableChefSkillEffect){for(var c in a)"MaxEquipLimit"==a[c].type&&a[c].rarity==e.rarity&&(e.limitVal+=a[c].value);e.ultimateAddition=getRecipeAddition(a,null,null,e,null,s).price}for(var c in i)"MaxEquipLimit"==i[c].type&&i[c].rarity==e.rarity&&(e.limitVal+=i[c].value);e.limitDisp=getAtrributeDisp(e.limitVal,e.limit,l),e.ultimateAdditionDisp=getPercentDisp(e.ultimateAddition),e.activityAddition=getRecipeAddition(i,null,null,e,null,s).price,e.activityAdditionDisp=getPercentDisp(e.activityAddition),e.price=e.oPrice,t&&(e.price+=e.exPrice),e.priceDisp=getAtrributeDisp(e.price,e.oPrice,l),e.totalPrice=e.price*e.limitVal,e.totalTime=e.time*e.limitVal,e.totalTimeDisp=secondsToTime(e.totalTime)}function getRankOptions(){var e=[],a={display:"",value:""};return e.push(a),a={},a.display="优",a.value="优",e.push(a),a={},a.display="特",a.value="特",e.push(a),a={},a.display="神",a.value="神",e.push(a),a={},a.display="传",a.value="传",e.push(a),e}function getCondimentDisp(e){return"Sweet"==e?"甜":"Sour"==e?"酸":"Spicy"==e?"辣":"Salty"==e?"咸":"Bitter"==e?"苦":"Tasty"==e?"鲜":""}function getGotOptions(){var e=[],a={display:"否",value:""};return e.push(a),a={},a.display="是",a.value="是",e.push(a),e}function getEquipsOptions(e,a){var t=[];if(a){var i={display:"无厨具",subtext:"",tokens:"",value:"",class:"hidden"};t.push(i)}for(var l in e){var s=e[l].skillDisp.replace(/<br>/g," ");i={};i.display=e[l].name,i.subtext=s,i.tokens=e[l].name+s,i.value=e[l].equipId,t.push(i)}return t}function getDiskLevelsOptions(e){for(var a=[],t=1;t<=e.maxLevel;t++){var i={};i.display="心法盘等级 "+t,i.value=t,e.level==t&&(i.selected=!0),a.push(i)}return a}function getAmberBtnClass(e){return 1==e?"btn-danger":2==e?"btn-success":3==e?"btn-primary":"btn-default"}function getAmbersOptions(e,a,t){var i=[];if(t){var l={display:"无遗玉",subtext:"",tokens:"",value:"",class:"hidden"};i.push(l)}for(var s in e){var c=e[s];if(!a||c.type==a.type){var r=e[s].skillDisp.replace(/<br>/g," ");l={};l.display=c.name,l.subtext=r,l.tokens=c.name+r,l.value=c.amberId,a&&a.data&&a.data.amberId==c.amberId&&(l.selected=!0),i.push(l)}}return i}function getOptionsString(e){var a="";return $.each(e,function(e,t){a=a+"<option value='"+t.value+"'",t.tokens&&(a+=" data-tokens='"+t.tokens+"'"),t.subtext&&(a+=" data-subtext='"+t.subtext+"'"),t.content&&(a+=' data-content="'+t.content+'"'),t.class&&(a+=" class='"+t.class+"'"),t.disabled&&(a+=" disabled"),t.selected&&(a+=" selected"),a+=">"+t.display+"</option>"}),a}function getSkillInfo(e,a){var t={},i="",l=[],s=[];for(var c in a.constructor===Array?s=a:a&&s.push(a),s){var r=!1;for(var n in e)if(e[n].skillId==s[c]){i+=e[n].desc+"<br>",l=l.concat(e[n].effect),r=!0;break}r||console.log(s[c])}return t.skillDisp=i,t.skillEffect=l,t}function getSkillDisp(e){var a="";return e.stirfry&&(a+="<span>炒"+e.stirfry+"</span>"),e.boil&&(a+="<span>煮"+e.boil+"</span>"),e.knife&&(a+="<span>切"+e.knife+"</span>"),e.fry&&(a+="<span>炸"+e.fry+"</span>"),e.bake&&(a+="<span>烤"+e.bake+"</span>"),e.steam&&(a+="<span>蒸"+e.steam+"</span>"),a}function GetDiskDisp(e){var a="心法盘等级 "+e.level+"<br>";for(var t in e.ambers){var i=e.ambers[t];a+=getAmberTypeDisp(i.type),i.data&&(a+="-"+i.data.name),a+=" "}return a}function getAmberTypeDisp(e){return 1==e?"红":2==e?"绿":3==e?"蓝":""}function getAmberDisplayByLevel(e,a){var t=e.effect[0].value+(a-1)*e.amplification;return e.desc.replace(/_/g,t)}function getAmberEffectByLevel(e,a){var t=JSON.parse(JSON.stringify(e.effect));for(var i in t)t[i].value=t[i].value+(a-1)*e.amplification;return t}function getAmberInfo(e,a){var t=null;if(e)for(var i in a)if(e==a[i].amberId)return a[i];return t}function updateModalAmberDisplay(e,a,t){var i="";a&&(i="<div class='icon'>"+a.icon+"</div><small>"+getAmberDisplayByLevel(a,t)+"</small>"),$("#disk-modal .amber-box:eq("+e+") .content").html(i)}function getDecorationAvgEffDisp(e,a){var t="(理论)"+ +e.toFixed(1);return a&&(t+=" (实际)"+ +a.toFixed(1)),t}function getMaxLimit(e,a){var t=0;for(var i in 1==a?t=40:2==a?t=30:3==a?t=25:4==a?t=20:5==a&&(t=15),e.ultimateData.global)if(e.ultimateData.global[i].rarity==a&&"MaxEquipLimit"==e.ultimateData.global[i].type){t+=e.ultimateData.global[i].value;break}var l=$("#chk-recipe-show-chef").val();if(1==l.length){var s=l[0];for(var i in e.chefs)if(e.chefs[i].chefId==s){var c=e.chefs[i];for(var r in c.maxLimitEffect)c.maxLimitEffect[r].rarity==a&&(t+=c.maxLimitEffect[r].value);break}}return t}function monitorStyle(){$("select.monitor-none").on("changed.bs.select",function(){changeSelectStyle(this)}),$("input[type=text].monitor-none, input[type=number].monitor-none").on("input",function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").click(function(){changeCheckStyle(this)})}function changeSelectStyle(e){0==$(e).val().length?$(e).selectpicker("setStyle","btn-info","remove"):$(e).selectpicker("setStyle","btn-info","add")}function changeInputStyle(e){$.trim($(e).val()).length>0?$(e).addClass("btn-info"):$(e).removeClass("btn-info")}function changeCheckStyle(e){$(e).prop("checked")?$(e).closest(".btn").addClass("btn-info"):$(e).closest(".btn").removeClass("btn-info")}function checkMonitorStyle(){$("input[type=text].monitor-none, input[type=number].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=search].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").each(function(){changeCheckStyle(this)})}function arraysEqual(e,a){if(e.length!=a.length)return!1;for(var t=0;t<e.length;t++)if(a.indexOf(e[t])<0)return!1;return!0}function changeTableHeaderClass(e,a,t){t?$(e.column(a).header()).removeClass("none never").addClass("all"):$(e.column(a).header()).removeClass("all never").addClass("none")}function resetExpendColumn(e,a){var t=$(a).val(),i=a+" option",l=$(i+":first").val(),s=t.indexOf(l);s>=0&&t.splice(s,1),t.length==$(i).length-1&&changeTableHeaderClass(e,Number(l),!1)}function initRecipeShow(){var e=$("#recipe-table").DataTable();$("#chk-recipe-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-recipe-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-recipe-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initChefShow(){var e=$("#chef-table").DataTable();$("#chk-chef-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-chef-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);var i=$("#chk-chef-show option[value=12]").is(":selected");for(t=13;t<=15;t++)changeTableHeaderClass(e,t,i);for(i=$("#chk-chef-show option[value=17]").is(":selected"),t=18;t<=22;t++)changeTableHeaderClass(e,t,i);resetExpendColumn(e,"#chk-chef-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initEquipShow(){var e=$("#equip-table").DataTable();$("#chk-equip-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-equip-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initAmberShow(){var e=$("#amber-table").DataTable();$("#chk-amber-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-amber-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCondimentShow(){var e=$("#condiment-table").DataTable();$("#chk-condiment-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-condiment-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initDecorationShow(){var e=$("#decoration-table").DataTable();$("#chk-decoration-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-decoration-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initQuestShow(e){e.column(1).visible("旧支线任务"==$("#select-quest-type").val(),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){$("#chk-cal-chefs-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-cal-chefs-show option[value=5]").is(":selected"),t=6;t<=10;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-cal-chefs-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){$("#chk-cal-equips-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-cal-equips-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){$("#chk-cal-materials-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),resetExpendColumn(e,"#chk-cal-materials-show"),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalRecipesShow(e){$("#chk-cal-recipes-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-cal-recipes-show option[value=16]").is(":selected"),t=17;t<=21;t++)changeTableHeaderClass(e,t,a);resetExpendColumn(e,"#chk-cal-recipes-show"),private||e.column(0).visible(!1,!1);var i=calCustomRule.rules[0];i&&i.hasOwnProperty("MaterialsNum")?e.column(5).visible(!0,!1):e.column(5).visible(!1,!1),i&&i.showTime&&e.column(9).visible(!0,!1),i&&i.showEff&&e.column(10).visible(!0,!1),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalCustomShow(){var e=$("#chk-cal-ui-show").val()
;e.indexOf("chef_icon")>=0?$(".chef-box-1").removeClass("no-icon"):$(".chef-box-1").addClass("no-icon"),e.indexOf("chef_skill")>=0?$(".chef-box-1").removeClass("no-skill"):$(".chef-box-1").addClass("no-skill"),e.indexOf("amber")>=0?$(".chef-box-2").removeClass("no-box"):$(".chef-box-2").addClass("no-box"),e.indexOf("amber_icon")>=0?$(".chef-box-2").removeClass("no-icon"):$(".chef-box-2").addClass("no-icon"),e.indexOf("amber_skill")>=0?$(".chef-box-2").removeClass("no-skill"):$(".chef-box-2").addClass("no-skill"),e.indexOf("equip_icon")>=0?$(".equip-box").removeClass("no-icon"):$(".equip-box").addClass("no-icon"),e.indexOf("equip_skill")>=0?$(".equip-box").removeClass("no-skill"):$(".equip-box").addClass("no-skill"),e.indexOf("condiment")>=0?$(".condiment-box").removeClass("no-condiment"):$(".condiment-box").addClass("no-condiment"),e.indexOf("condiment_icon")>=0?$(".condiment-box").removeClass("no-icon"):$(".condiment-box").addClass("no-icon"),e.indexOf("condiment_skill")>=0?$(".condiment-box").removeClass("no-skill"):$(".condiment-box").addClass("no-skill"),e.indexOf("recipe_icon")>=0?$(".recipe-box-1").removeClass("no-icon"):$(".recipe-box-1").addClass("no-icon"),e.indexOf("recipe_time")>=0?$(".recipe-box-1").removeClass("no-time"):$(".recipe-box-1").addClass("no-time"),e.indexOf("recipe_rarity")>=0?$(".recipe-box-2").removeClass("no-rarity"):$(".recipe-box-2").addClass("no-rarity"),e.indexOf("recipe_skill")>=0?$(".recipe-box-2").removeClass("no-skill"):$(".recipe-box-2").addClass("no-skill"),e.indexOf("recipe_material")>=0?$(".recipe-box-2").removeClass("no-material"):$(".recipe-box-2").addClass("no-material"),e.indexOf("recipe_add")>=0?$(".recipe-box-2").removeClass("no-add"):$(".recipe-box-2").addClass("no-add"),e.indexOf("recipe_rarity")<0&&e.indexOf("recipe_skill")<0&&e.indexOf("recipe_material")<0&&e.indexOf("recipe_add")<0?$(".recipe-box-2").addClass("hidden"):$(".recipe-box-2").removeClass("hidden"),resizeCalCustomTable()}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var t=historyTemplate(e);$("#data-history").html(t)},pageSize:5,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a='<table class="table table-condensed history-table">';return $.each(e,function(e,t){a+='<tr><td class="history-dt">'+t.date+"</td><td>"+t.content+"<td></tr>"}),a+="</table>",a}function initVersionTip(e){$(".alert-version").each(function(){if("true"==$(this).attr("data-show")){var a=$(this).attr("data-id"),t=Number($(this).attr("data-version")),i=!0;e&&e[a]&&Number(e[a])==t&&(i=!1),i&&$(this).removeClass("hidden"),$(this).on("closed.bs.alert",function(){updateLocalData(a,t),isMobile&&updateScrollHeight()})}})}function getInputHtml(e,a,t,i,l){var s,c,r;switch(r={type:"input",html:null,settings:null},t.inputTypes&&$.each(t.inputTypes,function(e,t){t.column==a&&(s=t,c=s.type.toLowerCase())}),r.settings=s,c){case"list":var n="data-live-search='false'";s.search&&(n="data-live-search='true'");var o,p=" ";s.clear&&(p=" data-actions-box='true' data-deselect-all-text='清空'"),s.done&&(p+=" data-done-button='true' data-done-button-text='关闭'"),r.html="<div class='table-select-picker' style='left:"+l.clientX+"px;top:"+l.clientY+"px'><select "+n+p+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",o=s.optionsp?s.options[e]:s.options,$.each(o,function(e,a){r.html=r.html+"<option value='"+a.value+"'",a.tokens&&(r.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(r.html+=" data-subtext='"+a.subtext+"'"),a.class&&(r.html+=" class='"+a.class+"'"),i==a.value&&(r.html+=" selected"),r.html+=">"+a.display+"</option>"}),r.html=r.html+"</select></div>",r.type=c;break;default:r.html="<input class='form-control' value='"+i+"'></input>"}return r}function sanitizeCellValue(e){return null==e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function UpdateQueryString(e,a,t){t||(t=window.location.href);var i,l=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(l.test(t))return null!=a?t.replace(l,"$1"+e+"="+a+"$2$3"):(i=t.split("#"),t=i[0].replace(l,"$1$3").replace(/(&|\?)$/,""),void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t);if(null!=a){var s=-1!==t.indexOf("?")?"&":"?";return i=t.split("#"),t=i[0]+s+e+"="+a,void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t}return t}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function centerModal(){var e=$(this).find(".modal-dialog");$(window).width()>=767?e.css("margin-top",Math.max(0,($(window).height()-e.height())/2)):e.css("margin-top","")}var calCustomRule,private=!1,isMobile=!1,expendBtn=!0;$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var t=$(e).closest("table").DataTable().table(),i=t.row($(e).parents("tr")),l=t.cell($(e).closest("td")),s=$(e),c=l.data(),r=s.val();l.data(r),a.onUpdate&&a.onUpdate(t,i,l,c)}}),"destroy"===e&&($(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(t){if(!$(this).hasClass("child")&&!$(this).hasClass("dataTables_empty")){var i=a.cell(this).index().row,l=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(l)>-1||!e.columns){var s=a.cell(this).node(),c=a.cell(this).data();if(c=sanitizeCellValue(c),!$(s).find("input").length&&!$(s).find("select").length){var r=getInputHtml(i,l,e,c,t);$(s).html($(s).html()+r.html),"input"==r.type?$(s).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==r.type&&($(a.cells().nodes()).removeClass("editing"),$(s).addClass("editing"),$(s).find("select").selectpicker("hide").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e),$(s).removeClass("editing")}),$(s).find("select").on("show.bs.select",function(e){var a=$(s).find(".dropdown-menu"),i=a.outerWidth(),l=t.clientX;if(a.hasClass("dropdown-menu-right")){var c=i-l;c>0&&(l+=c,$(s).find(".table-select-picker").css("left",l))}else{c=i-$(window).width()+l;c>0&&(l-=c,$(s).find(".table-select-picker").css("left",l))}}),setTimeout(function(){$(s).find("select").selectpicker("show").selectpicker("toggle")},0))}}}})}),$(function(){$(".modal.center").on("shown.bs.modal",centerModal),$(window).on("resize",function(){$(".modal.center:visible").each(centerModal),resizeCalCustomTable()}),$.popupmsg=function(e){var a,t,i=$.extend({event:null,message:"",mleft:0,mtop:0,fade:!0,delay:1e3,type:"alert-info"},e);i.message?(0==$("#popupmsg").length&&$("body").append("<div id='popupmsg'></div>"),$("#popupmsg").stop(!0,!0).html(i.message),i.event?(a=i.event.pageX-$(document).scrollLeft(),t=i.event.pageY-$(document).scrollTop()-40):(a=window.innerWidth/2-($("#popupmsg").width()+30)/2,t=window.innerHeight/2-40),$("#popupmsg").attr("class","alert "+i.type),$("#popupmsg").css({left:a+i.mleft,top:t+i.mtop}).show(),i.fade&&$("#popupmsg").delay(i.delay).fadeOut()):$("#popupmsg").hide()}});